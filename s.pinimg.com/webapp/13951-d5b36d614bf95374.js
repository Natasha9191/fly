"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([[13951],{313951:function(e,t,r){r.d(t,{i5:function(){return D},sX:function(){return M},aX:function(){return I},Z5:function(){return R},NG:function(){return P},MT:function(){return j},iu:function(){return k}});var n,a=r(76911),o=r(214494),s=r(827896),i=r(425288),u=r(505920),c=r(767546);function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function d(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function p(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?d(Object(r),!0).forEach(function(t){f(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):d(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function f(e,t,r){var n;return(n=function(e,t){if("object"!==l(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==l(n))return n;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"),(t="symbol"===l(n)?n:String(n))in e)?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function y(e){return function(e){if(Array.isArray(e))return v(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return v(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return v(e,t)}}(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function v(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var E=function(e,t){return e.data[t]&&e.data[t].messages||[]};function _(e,t){var r={};return e.filter(function(e){return!!e}).reduce(function(e,n){var a=t(n);return r[a]?(r[a]=(0,c.Z)(r[a],n),e):(r[a]=n,e.concat([n]))},[])}function m(e){return y(e).sort(function(e,t){return new Date(e.created_ms||e.created_at)-new Date(t.created_ms||t.created_at)})}function b(e,t,r){return m(_(E(e,t).concat(r),function(e){return e.id}))}var O={conversationsUnseenCount:0,data:{},newsHubCount:0,open:null,objectAttachment:null,showConversationsDropdown:!1,showNewMessageView:!1,ui:{},unread:0};function C(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:O,t=arguments.length>1?arguments[1]:void 0;if("CONVERSATION_OPEN"===t.type)return p(p({},e),{},{open:t.payload.id,objectAttachment:null,showNewMessageView:!1,ui:p(p({},e.ui),{},f({},t.payload.id,{contactRequestId:t.payload.contactRequestId||"",isPreview:t.payload.isPreview}))});if("CONVERSATION_CLOSE"===t.type)return p(p({},e),{},{open:null,objectAttachment:null,showNewMessageView:!1,ui:p(p({},e.ui),{},f({},t.payload.id,{contactRequestId:t.payload.contactRequestId||"",isPreview:!1,isDeclined:t.payload.isDeclined}))});if("CONVERSATION_CREATE"===t.type){var r=t.payload.id;return p(p({},e),{},{data:p(p({},e.data),{},f({},r,p(p({},e.data[r]||{}),t.payload)))})}if("CONVERSATION_DELETE"===t.type){var n=p(p({},e),{},{data:p({},e.data)}),a=t.payload.id;return delete n.data[a],n}if("FETCH_COMPLETE"===t.type){var o=t.payload,s=o.options,i=o.resource,u=o.response.resource_response.data;if("ConversationMessagesResource"===i){var c=u||[],l=(null==s?void 0:s.conversation_id)||"",d=b(e,l,c),v=d[d.length-1];return p(p({},e),{},{data:p(p({},e.data),{},f({},l,p(p({},e.data[l]),{},{id:l,messages:d,unread:0,last_message:v})))})}if("ConversationsResource"===i){var C=u||[],g=p(p({},e),{},{data:p({},e.data)});return C.forEach(function(e){var t=e.id,r=e.created_at,n=e.name,a=e.board,o=e.emails,s=e.unread,i=e.users,u=e.last_message,c=b(g,t,[u]);g.data[t]=p(p({},g.data[t]),{},{id:t,created_at:r,name:n,board:a,emails:o||[],unread:s||0,users:i||[],last_message:u,messages:c})}),g}if("ConversationResource"===i){var S=u||{},N=S.id,A=p(p({},e),{},{data:p({},e.data)});return N&&(A.data[N]=p(p({},A.data[N]),S)),A}if("NewsHubBadgeResource"===i&&u){var h=u.conversations_unseen_count||0;return p(p({},e),{},{unread:h})}}else if("MESSAGE_SEND_PENDING"===t.type){var w=t.payload,T=w.id,R=w.message;if(e.data[T])return p(p({},e),{},{data:p(p({},e.data),{},f({},T,p(p({},e.data[T]),{},{id:T,messages:[].concat(y(e.data[T].messages),[R])})))})}else if("MESSAGE_SEND_PENDING_SUCCESS"===t.type){var D=t.payload,I=D.id,P=D.tempMessage,M=D.newMessage;if(e.data[I]&&E(e,I).find(function(e){return e.id===P.id&&e.created_ms===P.created_ms})){var j=m(_(E(e,I).filter(function(e){return e.id!==P.id}).concat([M]),function(e){return e.id}));return p(p({},e),{},{data:p(p({},e.data),{},f({},I,p(p({},e.data[I]),{},{last_message:M,messages:j})))})}}else if("MESSAGE_SEND_PENDING_FAILURE"===t.type){var k=t.payload,U=k.id,V=k.tempMessageId;if(e.data[U]){var x=E(e,U).filter(function(e){return e.id!==V});return p(p({},e),{},{data:p(p({},e.data),{},f({},U,p(p({},e.data[U]),{},{messages:x})))})}}else if("OPEN_NEW_MESSAGE"===t.type){var G=(t.payload||null).objectAttachment;return p(p({},e),{},{showNewMessageView:!0,open:null,objectAttachment:G})}else if("CLOSE_DROPDOWN"===t.type)return p(p({},e),{},{showConversationsDropdown:!1,objectAttachment:null,showNewMessageView:!1});else if("OPEN_DROPDOWN"===t.type)return p(p({},e),{},{showConversationsDropdown:!0});else if("UPDATE_NEWSHUB_COUNT"===t.type)return p(p({},e),{},{newsHubCount:t.payload});else if("UPDATE_UNREAD_COUNT"===t.type)return p(p({},e),{},{conversationsUnseenCount:t.payload});else if("CLEAR_MESSAGE_BADGE"===t.type){var L=t.payload.id;return p(p({},e),{},{data:p(p({},e.data),{},f({},L,p(p({},e.data[L]),{},{unread:0})))})}else if("CONVERSATION_SAVE_POSITION"===t.type){var H=t.payload,B=H.id,Z=H.position;return p(p({},e),{},{data:p(p({},e.data),{},f({},B,p(p({},e.data[B]),{},{position:Z})))})}else if("CONVERSATION_RESET_POSITION"===t.type){var W=t.payload.id;return p(p({},e),{},{data:p(p({},e.data),{},f({},W,p(p({},e.data[W]),{},{position:null})))})}else if("SET_OBJECT_ATTACHMENT"===t.type){var q=t.payload.objectAttachment;return p(p({},e),{},{objectAttachment:q})}else if("REMOVE_OBJECT_ATTACHMENT"===t.type)return p(p({},e),{},{objectAttachment:null});return e}var g=r(515198);function S(e,t,r,n,a,o,s){try{var i=e[o](s),u=i.value}catch(e){r(e);return}i.done?t(u):Promise.resolve(u).then(n,a)}function N(e){return function(){var t=this,r=arguments;return new Promise(function(n,a){var o=e.apply(t,r);function s(e){S(o,n,a,s,i,"next",e)}function i(e){S(o,n,a,s,i,"throw",e)}s(void 0)})}}function A(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var h=(n=0,function(){return n++}),w=(0,i.Z)("Conversations"),T=w.Provider,R=w.useHook;function D(e){var t,r=e.children,n=function(e){if(Array.isArray(e))return e}(t=(0,a.useReducer)(C,O))||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,a,o,s,i=[],u=!0,c=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=o.call(r)).done)&&(i.push(n.value),i.length!==t);u=!0);}catch(e){c=!0,a=e}finally{try{if(!u&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(c)throw a}}return i}}(t,2)||function(e,t){if(e){if("string"==typeof e)return A(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return A(e,t)}}(t,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),s=n[0],i=n[1],c=(0,a.useCallback)(function(e){return i({type:"FETCH_COMPLETE",payload:e})},[]);(0,u.Z8)("ConversationMessagesResource",c),(0,u.my)("ConversationMessagesResource",c),(0,u.Z8)("ConversationsResource",c),(0,u.Z8)("ConversationResource",c),(0,u.Z8)("NewsHubBadgeResource",c);var l=(0,a.useCallback)(function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return i({type:"CONVERSATION_OPEN",payload:{id:e,isPreview:t,contactRequestId:r}})},[]),d=(0,a.useCallback)(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return i({type:"CONVERSATION_CLOSE",payload:{id:e,contactRequestId:t,isDeclined:r}})},[]),p=(0,a.useCallback)(function(e){return i({type:"CONVERSATION_CREATE",payload:e})},[]),f=(0,a.useCallback)(function(e){return i({type:"CONVERSATION_DELETE",payload:{id:e}})},[]),y=(0,a.useCallback)(function(e,t){return i({type:"CONVERSATION_SAVE_POSITION",payload:{id:e,position:t}})},[]),v=(0,a.useCallback)(function(e){return i({type:"CONVERSATION_RESET_POSITION",payload:{id:e}})},[]),E=(0,a.useCallback)(function(e,t,r){o.Z.create("ConversationsResource",{user_ids:e,emails:t,text:""}).callCreate().then(function(e){i({type:"CONVERSATION_OPEN",payload:{id:(e&&e.resource_response.data).id}})}).catch(function(e){r(e.message_detail||e.message||"")})},[]),_=(0,a.useCallback)(function(){i({type:"CLOSE_DROPDOWN"})},[]),m=(0,a.useCallback)(function(){i({type:"OPEN_DROPDOWN"})},[]),b=(0,a.useCallback)(function(e){i({type:"OPEN_NEW_MESSAGE",payload:{objectAttachment:e}})},[]),S=(0,a.useCallback)(function(e,t){return i({type:"MESSAGE_SEND_PENDING",payload:{id:e,message:t}})},[]),N=(0,a.useCallback)(function(e,t,r){return i({type:"MESSAGE_SEND_PENDING_SUCCESS",payload:{id:e,tempMessage:t,newMessage:r}})},[]),h=(0,a.useCallback)(function(e,t){return i({type:"MESSAGE_SEND_PENDING_FAILURE",payload:{id:e,tempMessageId:t}})},[]),w=(0,a.useCallback)(function(e){return i({type:"UPDATE_NEWSHUB_COUNT",payload:e})},[]),R=(0,a.useCallback)(function(e){return i({type:"UPDATE_UNREAD_COUNT",payload:e})},[]),D=(0,a.useCallback)(function(e){return i({type:"CLEAR_MESSAGE_BADGE",payload:{id:e}})},[]),I=(0,a.useCallback)(function(e){return i({type:"SET_OBJECT_ATTACHMENT",payload:{objectAttachment:e}})},[]),P=(0,a.useCallback)(function(){return i({type:"REMOVE_OBJECT_ATTACHMENT"})},[]),M=(0,a.useMemo)(function(){return{clearMessageBadge:D,conversationOpen:l,conversationClose:d,conversationCreate:p,conversationDelete:f,conversationGet:E,saveConversationPosition:y,resetConversationPosition:v,dropdownClose:_,dropdownOpen:m,newMessageOpen:b,pendingMessageSend:S,pendingMessageSuccess:N,pendingMessageFailure:h,updateNewsHubCount:w,updateUnreadCount:R,conversations:s,setObjectAttachment:I,removeObjectAttachment:P}},[D,l,d,p,f,E,y,v,_,m,b,S,N,h,w,R,s,I,P]);return(0,g.jsx)(T,{value:M,children:r})}function I(){var e,t=R().conversationCreate;return e=N(regeneratorRuntime.mark(function e(r){var n,a,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=o.Z.create("ConversationsResource",r),e.prev=1,e.next=4,a.callCreate();case 4:(s=e.sent.resource_response.data)&&(t(s),n=s),e.next=12;break;case 9:throw e.prev=9,e.t0=e.catch(1),Error(e.t0.message);case 12:return e.abrupt("return",n);case 13:case"end":return e.stop()}},e,null,[[1,9]])})),function(t){return e.apply(this,arguments)}}function P(){var e,t=R(),r=t.conversations,n=t.conversationCreate,a=t.pendingMessageSend,i=t.pendingMessageSuccess,u=t.pendingMessageFailure,c=(0,s.Z)();return e=N(regeneratorRuntime.mark(function e(t,s,l,d){var p,f,y,v,E,_,m,b,O;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(m=function(){return(m=N(regeneratorRuntime.mark(function e(){var r,n,s,_;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=o.Z.create("ConversationMessagesResource",{conversation_id:t,text:p,pin:f,board:y,user:v,user_did_it_data:E,source:l,client_tracking_params:c(null!=f?f:"")}),n="".concat(h()),a(t,s={text:p,sender:d,created_at:new Date().toString(),created_ms:Date.now(),id:n,type:"tempMessage"}),e.prev=4,e.next=7,r.callCreate();case 7:(_=e.sent.resource_response.data)&&i(t,s,_),e.next=16;break;case 12:throw e.prev=12,e.t0=e.catch(4),u(t,n),Error(e.t0.message);case 16:case"end":return e.stop()}},e,null,[[4,12]])}))).apply(this,arguments)},_=function(){return m.apply(this,arguments)},p=s.text,f=s.pinId,y=s.boardId,v=s.userId,E=s.didItId,r.data[t]){e.next=21;break}return b=o.Z.create("ConversationResource",{conversation_id:t}),e.prev=5,e.next=8,b.callGet();case 8:if(!(O=e.sent.resource_response.data)){e.next=14;break}return n(O),e.next=14,_();case 14:e.next=19;break;case 16:throw e.prev=16,e.t0=e.catch(5),Error(e.t0.message);case 19:e.next=23;break;case 21:return e.next=23,_();case 23:case"end":return e.stop()}},e,null,[[5,16]])})),function(t,r,n,a){return e.apply(this,arguments)}}function M(e){return R().conversations.data[e]}function j(e){return R().conversations.ui[e]||{contactRequestId:"",isDeclined:!1,isPreview:!1}}function k(){var e;return Array.from(Object.keys(e=R().conversations.data).map(function(t){return e[t]}).filter(function(e){return e.users&&e.last_message})).sort(function(e,t){return new Date((t.last_message||t).created_at)-new Date((e.last_message||e).created_at)})}}}]);
//# sourceMappingURL=https://sm.pinimg.com/webapp/13951-d5b36d614bf95374.js.map