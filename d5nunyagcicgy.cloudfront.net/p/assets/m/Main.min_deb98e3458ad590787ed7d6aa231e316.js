!function(t){class e{constructor(t){this._css=t}css(){return this._css}$(t){return!t&&this._cache||(this._cache=$(this._css))}join(t,o){return new e(this._css+o+t._css)}or(t){return this.join(t,", ")}and(t){return this.join(t,"")}anscestorOf(t){return this.join(t," ")}parentOf(t){return this.join(t,">")}followedBy(t){return this.join(t,"~")}immediatelyFollowedBy(t){return this.join(t,"+")}exists(t){return this.$(t).length>0}addClass(t){return this.$().addClass(t.name()),this}addClasses(...t){const e=t.map((t=>t.name())).join(" ");return this.$().addClass(e),this}removeClass(t){return this.$().removeClass(t.name()),this}removeClasses(...t){const e=t.map((t=>t.name())).join(" ");return this.$().removeClass(e),this}setClasses(...t){const e=t.map((t=>t.name())).join(" ");return this.$().attr("class",e),this}toggleClass(t,e){return this.$().toggleClass(t.name(),e),this}toggleClasses(t,...e){const o=e.map((t=>t.name())).join(" ");return this.$().toggleClass(o,t),this}hasClass(t){return this.$().hasClass(t.name())}addAttr(t){return this.$().attr(t,t),this}toggleAttr(t,e){return e?this.$().attr(t,t):this.$().removeAttr(t),this}removeAttr(t){return this.$().removeAttr(t),this}}class o extends e{tag(){return this.css()}constructor(t){super(t)}}class i extends e{name(){return this._name}constructor(t){super("."+t),this._name=t}elements(){return document.querySelectorAll(this.css())}}class s extends e{name(){return this._name}constructor(t){super("#"+t),this._name=t}el(){return document.getElementById(this._name)}}class r{constructor(t){this.key=t,this.caseSensitive=!0}caseInsensitive(){return this.caseSensitive=!1,this}exists(){return new e("["+this.key+"]")}build(t,o){return new e("["+this.key+t+'"'+o+'"'+(this.caseSensitive?"":" i")+"]")}equals(t){return this.build("=",t)}containsWhitespaceSeparatedToken(t){return this.build("~=",t)}equalsOrPlusDashStartsWith(t){return this.build("|=",t)}startsWith(t){return this.build("^=",t)}endsWidth(t){return this.build("$=",t)}contains(t){return this.build("*=",t)}}var n,a,l,c,p,u,h,d,g,m,f,S,w,C,y,b,v,A,k,M,x,T,_,D,P,R,E,F,I,B,O,L,z,U,G,N,H,V,W,X,Y,q,J,Q,j,Z,K,tt,et,ot,it,st,rt,nt,at,lt,ct,pt,ut,ht,dt,gt,mt,ft,St,wt,Ct,yt,bt,vt,At,kt,Mt,xt,Tt,_t;!function(t){function n(t){return new r(t)}t.empty=new e(""),t.html=new e("html"),t.body=new e("body"),t.htmlBody=new e("html, body"),t.$window=$(window),t.data=function(t){return n("data-"+t)},t.attr=n,t.id=function(t){return new s(t)},t.c=function(t){return new i(t)},t.tag=function(t){return new o(t)}}(P||(P={})),function(t){t.active=new i("active")}(n||(n={})),function(t){function e(t,e){return t[e]}t.get=e,t.getOrElse=function(t,o,i){var s=e(t,o);return void 0===s?i:s},t.set=function(t,e,o){return t[e]=o},t.cast=function(t){return t}}(a||(a={})),function(t){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=[],i=new Uint8Array(256);for(var s=0;s<64;s++)o[s]=e.charAt(s),i[e.charCodeAt(s)]=s;function r(t,e){return i[0|t.charCodeAt(e)]}function n(t){return o[63&t]}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63,t.decode=function(t){if(t.length%4>0)throw new Error("Invalid string. Length must be a multiple of 4. ");var e,o,i=t.length,s="="===t.charAt(i-2)?2:"="===t.charAt(i-1)?1:0,n=new Uint8Array(3*t.length/4-s),a=s>0?t.length-4:t.length,l=0;function c(t){n[l++]=255&t}for(e=0;e<a;e+=4)c((o=r(t,e)<<18|r(t,e+1)<<12|r(t,e+2)<<6|r(t,e+3))>>16),c(o>>8),c(o);return 2===s?c(o=r(t,e)<<2|r(t,e+1)>>4):1===s&&(c((o=r(t,e)<<10|r(t,e+1)<<4|r(t,e+2)>>2)>>8),c(o)),n},t.decodeString=function(t,e){try{return atob(t)}catch(t){}return e},t.encode=function(t,e){if(t instanceof Uint8Array){const r=(e=e||t.length)%3;var o,i="";const a=e-r;for(var s=0;s<a;s+=3)i+=n((o=(t[s]<<16)+(t[s+1]<<8)+t[s+2])>>18),i+=n(o>>12),i+=n(o>>6),i+=n(o);return 1==r?(i+=n((o=t[a])>>2),i+=n(o<<4),i+="=="):2==r&&(i+=n((o=(t[a]<<8)+t[a+1])>>10),i+=n(o>>4),i+=n(o<<2),i+="="),i.replace(/\!/,"!")}return btoa(a.cast(t))}}(l||(l={})),function(t){const e=[0];function o(t,e){return t.toFixed(e).replace(/\.?0+$/,"")}function i(t,e){"use strict";if(null==t)throw new TypeError("can't convert "+t+" to object");if((e=+e)!=e&&(e=0),e<0)throw new RangeError("repeat count must be non-negative");if(e==1/0)throw new RangeError("repeat count must be less than infinity");if(e=Math.floor(e),0==t.length||0==e)return"";if(t.length*e>=1<<28)throw new RangeError("repeat count must not overflow maximum string size");for(var o="",i=0;i<e;i++)o+=t;return o}function s(t,e){return(t%e+e)%e}function r(t,e){return(t%e-e)%e}function n(t){if(!t)return null;const e=t.match(/data:(.*?)(;base64)?,(.*)/);if(!e)return null;const o=e[1]||"text/plain",i=!!e[2],s=decodeURIComponent(e[3].trim());if(i){const t=l.decode(s);let e=new Blob([t],{type:o});return e.size!=t.length&&(e=new Blob([t.buffer],{type:o})),e}return new Blob([s],{type:o})}function c(t,e,o){return new File([t],e,{type:t.type,lastModified:o||Date.now()})}t.tic=function(){e.push(Date.now())},t.toc=function(t){Date.now(),e.pop()},t.toFixed=o,t.formatAspectRatio=function(t){return o(t.w,3)+":"+o(t.h,3)},t.hex=function(t,e){return("000000000"+t.toString(16)).substr(-e)},t.fuzzyAspectRatioEx=function(t,e){for(var o=t.w/t.h,i=0;i<e.length;i++){var s=e[i],r=s.w/s.h;if(Math.abs((o-r)/r)<.01)return s}return t.w>t.h?{w:t.w/t.h,h:1}:{w:1,h:t.h/t.w}},t.roundTo=function(t,e){return parseFloat(t.toFixed(e))},t.empty=function(){},t.sign=function(t){return 0==t?0:t>0?1:-1},t.clamp=function(t,e,o){return Math.max(e,Math.min(t,o))},t.log10=function(t){return Math.log(t)/Math.LN10},t.parseIntWithAlt=function(t,e,o){const i=parseInt(t,e);return isNaN(i)?o:i},t.padStart=function(t,e,o){return e>>=0,o=String(void 0!==o?o:" "),t.length>e?String(t):((e-=t.length)>o.length&&(o+=i(o,e/o.length)),o.slice(0,e)+String(t))},t.repeat=i,t.posMod=s,t.negMod=r,t.minMod=function(t,e){var o=s(t,e),i=r(t,e);return Math.abs(o)<=Math.abs(i)?o:i},t.startsWith=function(t,e){return 0==t.lastIndexOf(e,0)},t.endsWith=function(t,e){return t.indexOf(e,t.length-e.length)>=0},t.blobToArrayBuffer=function(t,e,o){var i=new FileReader;i.onerror=i.onabort=o,i.onloadend=function(t){e(a.cast(i.result))},i.readAsArrayBuffer(t)},t.blobToString=function(t,e,o){var i=new FileReader;i.onerror=i.onabort=o,i.onloadend=function(t){e(a.cast(i.result))},i.readAsText(t)},t.dataUrlToBlob=n,t.dataUrlToFile=function(t,e){return c(n(t),e)},t.blobToFile=c,t.svgStringToDataUrl=function(t){return"data:image/svg+xml;base64,"+btoa(t)},t.toDataUrl=function(t,e){return"data:"+e+";base64,"+l.encode(t)},t.min=function(t){return Math.min.apply(null,t)},t.max=function(t){return Math.max.apply(null,t)},t.minBy=function(t,e){if(0!=t.length){let o=0,i=t[0],s=e(i);for(let r=1;r<t.length;r++){let n=t[r],a=e(n);a<s&&(i=n,s=a,o=r)}return{min:i,value:s,index:o}}},t.maxBy=function(t,e){if(0!=t.length){let o=0,i=t[0],s=e(i);for(let r=1;r<t.length;r++){let n=t[r],a=e(n);a>s&&(i=n,s=a,o=r)}return{max:i,value:s,index:o}}},t.signedNumber=function(t){return 0==t?"0":t>0?"+"+t:""+t},t.splitExtensionFromFilename=function(t){let e=t.lastIndexOf(".");return e>=0?{base:t.substr(0,e),extension:t.substr(e+1)}:{base:t,extension:""}},t.dropExtension=function(t){let e=t.lastIndexOf(".");return e>=0?t.substr(0,e):t},t.getExtensionWithDot=function(t){let e=t.lastIndexOf(".");return e>=0?t.substr(e):""},t.getExtensionNoDot=function(t){let e=t.lastIndexOf(".");return e>=0?t.substr(e+1):""},t.parsePx=function(t){try{return parseInt(t)}catch(t){return 0}},t.colorBytesToRgbaCss=function(t){return"rgba("+t.join(",")+")"},t.colorBytesToAbgr32=function(t){return t[3]<<24|t[2]<<16|t[1]<<8|t[0]},t.colorBytesToRgba32=function(t){return t[0]<<24|t[1]<<16|t[2]<<8|t[3]},t.spliterate=function(t,e,o){for(var i,s=0;(i=t.indexOf(e,s))>=0;)o(t.substring(s,i)),s=i+e.length;s<t.length-1&&o(t.substring(s,t.length))},t.stringify=function(t){if(void 0===t)return"undefined";if(null==t)return"null";if(t.hasOwnProperty("message"))return t.message||"[No message]";if("string"==typeof t)return t;try{return JSON.stringify(t)}catch(e){return t.toString()}},t.join16=function(t,e){return t.map((t=>(0|t).toString(16))).join(e)},t.uint8ArrayToString=function(t){for(var e="",o=0;o<t.byteLength;o++)e+=String.fromCharCode(t[o]);return e},t.randomInt=function(t){return Math.floor(Math.random()*t)},t.randomInt2=function(t,e){return Math.floor(Math.random()*(e-t)+t)},t.centerElide=function(t,e){if(t&&t.length>=e){let o=Math.floor((e-4)/2);return t.substring(0,o)+"..."+t.substring(t.length-o)}return t},t.elide=function(t,e){return t&&t.length>=e?t.substring(0,e-3)+"...":t},t.sqr=function(t){return t*t},t.cube=function(t){return t*t*t},t.safeDiv=function(t,e,o=0){return 0==e?o:t/e},t.find=function(t,e){for(var o=0;o<t.length;o++)if(e(t[o]))return t[o];return null}}(R||(R={})),function(t){function e(t){return"undefined"==typeof csrfToken?t:t+(t.indexOf("?")<0?"?":"&")+csrfToken.name+"="+csrfToken.value}t.csrf=e,t.ajax=function(t){if("undefined"!=typeof csrfToken){"GET"!=(t.method||t.type||"GET").toUpperCase()&&(t.url=e(t.url||""))}return $.ajax(t)}}(c||(c={})),function(t){const e=/(''|[^']|^){(\d+)}/g,o=/(''|[^']|^){(\d+),plural,\s*(one\s*{([^}]*)})?\s*(few\s*{([^}]*)})?\s*other\s*{([^}]*)}\s*}/g;let i;t.s=function(t,...i){if(0==t.length)return"";const s=t;for(var r=t.length,n=0;n<r&&s.charCodeAt(n)<=32;)n++;for(;n<r&&s.charCodeAt(r-1)<=32;)r--;const a=0==n?"":s.substring(0,n);t=0==n&&r==s.length?s:s.substring(n,r);const l=r==s.length?"":s.substring(r,s.length);var p=window.I18nPhrases[t];return void 0===p&&(!function(t,e){if(window.I18nPhrases[t]=t,!window.I18nPhrases.__translations_disabled__){const i={en:t,args:e};c.ajax({url:"/logMissingI18nPhrase",method:"POST",dataType:"json",contentType:"application/json; charset=UTF-8",data:JSON.stringify(i)});const s=window.I18nPhrases||{};for(var o in s)s.hasOwnProperty(o)}}(t,i),p=t),i.length>0&&(p=(p=p.replace(e,(function(t,e,o){return"''"==e&&(e="'"),e+i[parseInt(o,10)]}))).replace(o,(function(t,e,o,s,r,n,a,l){"''"==e&&(e="'");const c=i[parseInt(o,10)];return e+(function(t,e,o){switch(GlobalsShared.locale.split("-")[0]){case"zh":case"ja":case"ko":case"tr":case"th":case"id":return;case"ru":return t%10==1&&t%100!=11?e:t%10>=2&&t%10<=4&&(t%100<10||t%100>=20)?o:void 0;case"po":return 1==t?e:t%10>=2&&t%10<=4&&(t%100<10||t%100>=20)?o:void 0;case"fr":case"pt":return t>1?e:void 0;default:return 1==t?e:void 0}}(parseInt(c),r,a)||l)}))),a&&(p=a+p),l&&(p+=l),p},t.commaList=function(t){return t.join(", ")},function(t){t.format=function(t){return"$"+t.toFixed(2)}}(i||(i={}));class s{constructor(t){this.currency=t}format(t){return this.currency+t.toFixed(2)}}const r={};function n(t,e,o=GlobalsShared.locale){const n=o+"-"+t,a=r[n]||(r[n]=function(t,e){try{return new Intl.NumberFormat(e,{style:"currency",currency:t})}catch(e){return"USD"==t?i:new s(t)}}(t,o));return a.format(e/100)}let a;t.dollars=function(t,e=GlobalsShared.locale){return n("USD",t,e)},t.currencyAmount=n,function(t){t.format=function(t){return(100*t).toFixed(0)+"%"}}(a||(a={}));const l={};t.percent=function(t,e=GlobalsShared.locale){return(l[e]||(l[e]=function(t){try{return new Intl.NumberFormat(t,{style:"percent",minimumFractionDigits:0})}catch(t){return a}}(e))).format(t/100)}}(p||(p={}));class Dt{constructor(t){this.data=new Uint8Array(t),this.offsetCount=0}length(){return this.data.length}hasMore(){return this.offsetCount<this.data.length}skip(t){this.offsetCount+=t}nonEmpty(){return this.data.length>0}readInt8(){return this.data[this.offsetCount++]}readInt8s(t){var e=this.data.slice(this.offsetCount,this.offsetCount+t);return this.offsetCount+=t,e}readInt16(){return 256*this.data[this.offsetCount++]+this.data[this.offsetCount++]}readInt24(){return 256*this.data[this.offsetCount++]*256+256*this.data[this.offsetCount++]+this.data[this.offsetCount++]}readInt32(){return 256*this.data[this.offsetCount++]*256*256+256*this.data[this.offsetCount++]*256+256*this.data[this.offsetCount++]+this.data[this.offsetCount++]}readSignedInt16(){var t=this.readInt16();return t>=32768&&(t-=65536),t}}!function(t){const e={36864:"ExifVersion",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37500:"MakerNote",37510:"UserComment",40964:"RelatedSoundFile",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBias",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37396:"SubjectArea",37386:"FocalLength",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRation",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",40965:"InteroperabilityIFDPointer",42016:"ImageUniqueID"},o={256:"ImageWidth",257:"ImageHeight",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer",40965:"InteroperabilityIFDPointer",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",274:"Orientation",277:"SamplesPerPixel",284:"PlanarConfiguration",530:"YCbCrSubSampling",531:"YCbCrPositioning",282:"XResolution",283:"YResolution",296:"ResolutionUnit",273:"StripOffsets",278:"RowsPerStrip",279:"StripByteCounts",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",301:"TransferFunction",318:"WhitePoint",319:"PrimaryChromaticities",529:"YCbCrCoefficients",532:"ReferenceBlackWhite",306:"DateTime",270:"ImageDescription",271:"Make",272:"Model",305:"Software",315:"Artist",33432:"Copyright"},i={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential"},s={ExposureProgram:{0:"Not defined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{0:"Unknown",1:"Daylight",2:"Fluorescent",3:"Tungsten (incandescent light)",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},SensingMethod:{1:"Not defined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},SceneType:{1:"Directly photographed"},CustomRendered:{0:"Normal process",1:"Custom process"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},GainControl:{0:"None",1:"Low gain up",2:"High gain up",3:"Low gain down",4:"High gain down"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},SubjectDistanceRange:{0:"Unknown",1:"Macro",2:"Close view",3:"Distant view"},FileSource:{3:"DSC"},Components:{0:"",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"}};const r={120:"caption",110:"credit",25:"keywords",55:"dateCreated",80:"byline",85:"bylineTitle",122:"captionWriter",105:"headline",116:"copyright",15:"category"};function n(t,e,o){for(var i,s,n,a,l=new DataView(t),p={},u=e;u<e+o;)28===l.getUint8(u)&&2===l.getUint8(u+1)&&(a=l.getUint8(u+2))in r&&((n=l.getInt16(u+3))+5,s=r[a],i=c(l,u+5,n),p.hasOwnProperty(s)?p[s]instanceof Array?p[s].push(i):p[s]=[p[s],i]:p[s]=i),u++;return p}function a(t,e,o,i,s){var r,n,a=t.getUint16(o,!s),c={};for(n=0;n<a;n++)r=o+12*n+2,c[i[t.getUint16(r,!s)]]=l(t,r,e,o,s);return c}function l(t,e,o,i,s){var r,n,a,l,p,u,h=t.getUint16(e+2,!s),d=t.getUint32(e+4,!s),g=t.getUint32(e+8,!s)+o;switch(h){case 1:case 7:if(1==d)return t.getUint8(e+8);for(r=d>4?g:e+8,n=[],l=0;l<d;l++)n[l]=t.getUint8(r+l);return n;case 2:return c(t,r=d>4?g:e+8,d-1);case 3:if(1==d)return t.getUint16(e+8,!s);for(r=d>2?g:e+8,n=[],l=0;l<d;l++)n[l]=t.getUint16(r+2*l,!s);return n;case 4:if(1==d)return t.getUint32(e+8,!s);for(n=[],l=0;l<d;l++)n[l]=t.getUint32(g+4*l,!s);return n;case 5:if(1==d)return p=t.getUint32(g,!s),u=t.getUint32(g+4,!s),(a=new Number(p/u)).numerator=p,a.denominator=u,a;for(n=[],l=0;l<d;l++)p=t.getUint32(g+8*l,!s),u=t.getUint32(g+4+8*l,!s),n[l]=new Number(p/u),n[l].numerator=p,n[l].denominator=u;return n;case 9:if(1==d)return t.getInt32(e+8,!s);for(n=[],l=0;l<d;l++)n[l]=t.getInt32(g+4*l,!s);return n;case 10:if(1==d)return t.getInt32(g,!s)/t.getInt32(g+4,!s);for(n=[],l=0;l<d;l++)n[l]=t.getInt32(g+8*l,!s)/t.getInt32(g+4+8*l,!s);return n}}function c(t,e,o){for(var i="",s=e;s<e+o;s++)i+=String.fromCharCode(t.getUint8(s));return i}function p(t,r,n){if("Exif"!=c(t,r,4))return!1;var l,p,u,h,d,g=r+6;if(18761==t.getUint16(g))l=!1;else{if(19789!=t.getUint16(g))return!1;l=!0}if(42!=t.getUint16(g+2,!l))return!1;var m=t.getUint32(g+4,!l);if(m<8)return!1;if((p=a(t,g,g+m,o,l)).ExifIFDPointer)for(u in h=a(t,g,g+p.ExifIFDPointer,e,l)){switch(u){case"LightSource":case"Flash":case"MeteringMode":case"ExposureProgram":case"SensingMethod":case"SceneCaptureType":case"SceneType":case"CustomRendered":case"WhiteBalance":case"GainControl":case"Contrast":case"Saturation":case"Sharpness":case"SubjectDistanceRange":case"FileSource":h[u]=s[u][h[u]];break;case"ExifVersion":case"FlashpixVersion":h[u]=String.fromCharCode(h[u][0],h[u][1],h[u][2],h[u][3]);break;case"ComponentsConfiguration":h[u]=s.Components[h[u][0]]+s.Components[h[u][1]]+s.Components[h[u][2]]+s.Components[h[u][3]]}p[u]=h[u]}if(p.GPSInfoIFDPointer)for(u in d=a(t,g,g+p.GPSInfoIFDPointer,i,l)){if("GPSVersionID"===u)d[u]=d[u][0]+"."+d[u][1]+"."+d[u][2]+"."+d[u][3];p[u]=d[u]}return p}t.readFromBinaryFile=function(t){const e=function(t){var e=new DataView(t);if(255!=e.getUint8(0)||216!=e.getUint8(1))return!1;for(var o=2,i=t.byteLength,s=function(t,e){return 56===t.getUint8(e)&&66===t.getUint8(e+1)&&73===t.getUint8(e+2)&&77===t.getUint8(e+3)&&4===t.getUint8(e+4)&&4===t.getUint8(e+5)};o<i;){if(s(e,o)){var r=e.getUint8(o+7);return r%2!=0&&(r+=1),0===r&&(r=4),n(t,o+8+r,e.getUint16(o+6+r))}o++}}(t),o=function(t){var e=new DataView(t);if(255!=e.getUint8(0)||216!=e.getUint8(1))return!1;for(var o=2,i=t.byteLength;o<i;){if(255!=e.getUint8(o))return!1;if(225==e.getUint8(o+1))return p(e,o+4,e.getUint16(o+2));o+=2+e.getUint16(o+2)}}(t);return{iptc:e,exif:o}}}(u||(u={})),function(t){t[t.Undefined=0]="Undefined",t[t.R0=1]="R0",t[t.R90=2]="R90",t[t.R180=3]="R180",t[t.R270=4]="R270"}(h||(h={})),function(t){t[t.Undefined=0]="Undefined",t[t.Uncalibrated=1]="Uncalibrated",t[t.sRgb=2]="sRgb",t[t.adobeRgb=3]="adobeRgb"}(d||(d={})),function(t){t[t.Success=0]="Success",t[t.ErrorFileReader=1]="ErrorFileReader",t[t.ErrorParse=2]="ErrorParse",t[t.ErrorException=3]="ErrorException"}(g||(g={})),function(t){t[t.Undefined=0]="Undefined",t[t.None=1]="None",t[t.Inch=2]="Inch",t[t.Centimeter=3]="Centimeter",t[t.Meter=4]="Meter"}(m||(m={}));class Pt{constructor(t,e,o,i,s,r,n,a){this.statusCode=t,this.width=e,this.height=o,this.orientation=i,this.resolutionUnits=s,this.resolutionX=r,this.resolutionY=n,this.colorSpace=a,this.wasRotated=!1}applyOrientation(){if(this.orientation==h.R90||this.orientation==h.R270){let t=this.width;this.width=this.height,this.height=t}this.wasRotated=!0}getRawDpi(){let t=this.resolutionX.valueOf();if(t<=0)return 72;switch(this.resolutionUnits){case m.Inch:return t;case m.Centimeter:return 2.54*t;case m.Meter:return 2.54*t/100;default:return 72}}dpi(){let t=this.getRawDpi(),e=Math.round(t),o=Math.abs(t-e);return 0<o&&o<.01?e:t}}!function(t){const e=[137,80,78,71,13,10,26,10],o=new Number(0);function i(t){return new Pt(t,0,0,h.Undefined,m.Undefined,0,0,d.Undefined)}t.inverseOrientation=function(t){switch(t){default:case h.Undefined:return h.Undefined;case h.R0:return h.R0;case h.R90:return h.R270;case h.R180:return h.R180;case h.R270:return h.R90}},t.get=function(t,s){R.blobToArrayBuffer(t,(function(r){try{let n=new Dt(r);switch(t.type){case"image/png":s(function(t){for(let o=0;o<e.length&&t.hasMore();o++)if(e[o]!=t.readInt8())return i(g.ErrorParse);let o=0,s=0,r=0,n=0,a=m.Undefined,l=d.Undefined,c=h.Undefined;for(;t.hasMore();){let e=t.readInt32(),i=R.uint8ArrayToString(t.readInt8s(4));if("pHYs"==i){o=t.readInt32(),s=t.readInt32();let e=t.readInt8();a=0==e?m.None:1==e?m.Meter:m.Undefined}else if("IHDR"==i){let o=t.offsetCount;r=t.readInt32(),n=t.readInt32(),t.offsetCount=o,t.readInt8s(e)}else if("iCCP"==i){let o=t.offsetCount,i="",s=t.readInt8(),r=0;for(;0!=s&&r<79;)i+=String.fromCharCode(s),s=t.readInt8(),r++;t.readInt8s(e-(t.offsetCount-o))}else t.readInt8s(e);t.readInt32()}return new Pt(g.Success,r,n,c,a,o,s,l)}(n));break;case"image/jpg":case"image/jpeg":s(function(t){let e=o,i=o,s=0,r=0,n=m.Undefined,l=d.Undefined,c=h.Undefined,p=u.readFromBinaryFile(t.data.buffer);if(p.exif){e=a.getOrElse(p.exif,"XResolution",o),i=a.getOrElse(p.exif,"YResolution",o),s=a.getOrElse(p.exif,"ImageWidth",0),r=a.getOrElse(p.exif,"ImageHeight",0);let t=a.getOrElse(p.exif,"ResolutionUnit",0);n=3==t?m.Centimeter:2==t?m.Inch:1==t?m.None:m.Undefined;let u=a.getOrElse(p.exif,"ColorSpace",0);l=65535==u?d.Uncalibrated:1==u?d.sRgb:d.Undefined;let g=a.getOrElse(p.exif,"Orientation",0);c=1==g?h.R0:3==g?h.R180:6==g?h.R90:8==g?h.R270:h.Undefined}return new Pt(g.Success,s,r,c,n,e,i,l)}(n));break;default:s(i(g.ErrorParse))}}catch(t){s(i(g.ErrorException))}}),(function(t){s(i(g.ErrorFileReader))}))}}(f||(f={}));class Rt{constructor(t,e){this.x=t,this.y=e}static empty(){return new Rt(0,0)}static zero(){return new Rt(0,0)}static nan(){return new Rt(Number.NaN,Number.NaN)}static from(t){return new Rt(t.x,t.y)}toString(){return"("+this.x+", "+this.y+")"}inFinite(){return this.isFinite()}isFinite(){return isFinite(this.x)&&isFinite(this.y)}isNaN(){return isNaN(this.x)||isNaN(this.y)}interpolate(t,e){return new Rt(this.x*(1-e)+t.x*e,this.y*(1-e)+t.y*e)}setInterpolated(t,e,o){return this.setXy(t.x*(1-o)+e.x*o,t.y*(1-o)+e.y*o)}distanceSqrTo(t){let e=this.x-t.x,o=this.y-t.y;return e*e+o*o}distanceTo(t){return Math.sqrt(this.distanceSqrTo(t))}offset(t,e){return new Rt(this.x+t,this.y+e)}set(t){return this.x=t.x,this.y=t.y,this}setXy(t,e){return this.x=t,this.y=e,this}setNan(){return this.setXy(Number.NaN,Number.NaN)}round(){return new Rt(Math.round(this.x),Math.round(this.y))}floor(){return new Rt(Math.floor(this.x),Math.floor(this.y))}snap(t=.5,e=.5){return new Rt(Math.floor(this.x)+t,Math.floor(this.y)+e)}rotateInPlace(t,e){const o=Math.sin(t),i=Math.cos(t),s=this.x-e.x,r=this.y-e.y;return this.setXy(e.x+i*s-o*r,e.y+o*s+i*r),this}rotateInto(t,e,o,i,s){const r=this.x-o,n=this.y-i;s.setXy(o+t*r-e*n,i+e*r+t*n)}rotate(t,e){const o=Math.sin(t),i=Math.cos(t),s=this.x-e.x,r=this.y-e.y;return new Rt(e.x+i*s-o*r,e.y+o*s+i*r)}plusEquals(t){return this.x+=t.x,this.y+=t.y,this}plusEqualsXy(t,e){return this.x+=t,this.y+=e,this}plusEqualsScaled(t,e){return this.x+=t*e.x,this.y+=t*e.y,this}equals(t){return t&&this.x==t.x&&this.y==t.y}notEquals(t){return!this.equals(t)}minusEquals(t){return this.x-=t.x,this.y-=t.y,this}minusXyEquals(t,e){return this.x-=t,this.y-=e,this}minus(t){return new Rt(this.x-t.x,this.y-t.y)}plus(t){return new Rt(this.x+t.x,this.y+t.y)}times(t){return new Rt(t*this.x,t*this.y)}timesEquals(t){return this.x*=t,this.y*=t,this}cross(t){return this.x*t.y-this.y*t.x}ortho(){return new Rt(this.y,-this.x)}dot(t){return this.x*t.x+this.y*t.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}lengthSqr(){return this.x*this.x+this.y*this.y}normalize(){var t=this.length();return 0!=t&&(this.x/=t,this.y/=t),this}capLength(t){let e=this.length();return e>t&&this.timesEquals(t/e),this}dup(){return Rt.from(this)}}!function(t){t[t.TopLeft=0]="TopLeft",t[t.Top=1]="Top",t[t.TopRight=2]="TopRight",t[t.Right=3]="Right",t[t.BottomRight=4]="BottomRight",t[t.Bottom=5]="Bottom",t[t.BottomLeft=6]="BottomLeft",t[t.Left=7]="Left",t[t.Center=8]="Center"}(S||(S={})),function(t){t.opposite=function(e){switch(e){case t.TopLeft:return t.BottomRight;case t.Top:return t.Bottom;case t.TopRight:return t.BottomLeft;case t.Right:return t.Left;case t.BottomRight:return t.TopLeft;case t.Bottom:return t.Top;case t.BottomLeft:return t.TopRight;case t.Left:return t.Right;case t.Center:return t.Center}return t.Center},t.flipX=function(e){switch(e){case t.TopLeft:return t.TopRight;case t.Top:return t.Top;case t.TopRight:return t.TopLeft;case t.Right:return t.Left;case t.BottomRight:return t.BottomLeft;case t.Bottom:return t.Bottom;case t.BottomLeft:return t.BottomRight;case t.Left:return t.Right;case t.Center:return t.Center}return t.Center},t.flipY=function(e){switch(e){case t.TopLeft:return t.BottomLeft;case t.Top:return t.Bottom;case t.TopRight:return t.BottomRight;case t.Right:return t.Right;case t.BottomRight:return t.TopRight;case t.Bottom:return t.Top;case t.BottomLeft:return t.TopLeft;case t.Left:return t.Left;case t.Center:return t.Center}return t.Center},t.interpolationCoefficientsFor=function(e){switch(e){case t.TopLeft:return{tx:0,ty:0};case t.Top:return{tx:.5,ty:0};case t.TopRight:return{tx:1,ty:0};case t.Right:return{tx:1,ty:.5};case t.BottomRight:return{tx:1,ty:1};case t.Bottom:return{tx:.5,ty:1};case t.BottomLeft:return{tx:0,ty:1};case t.Left:return{tx:0,ty:.5};case t.Center:return{tx:.5,ty:.5}}return{tx:.5,ty:.5}}}(S||(S={}));class Et{constructor(t,e,o,i){this.p0=t,this.p1=e,this.p2=o,this.p3=i,this.points=[],this.points.push(t,e,o,i)}static empty(){return new Et(Rt.empty(),Rt.empty(),Rt.empty(),Rt.empty())}set(t){return this.p0.set(t.p0),this.p1.set(t.p1),this.p2.set(t.p2),this.p3.set(t.p3),this}dup(){return new Et(this.p0.dup(),this.p1.dup(),this.p2.dup(),this.p3.dup())}contains(t,e){var o=!1;const i=this.points.length;for(var s=0;s<i;s++){var r=this.points[s],n=this.points[(s+1)%i];(n.y<e&&r.y>=e||r.y<e&&n.y>=e)&&n.x+(e-n.y)/(r.y-n.y)*(r.x-n.x)<t&&(o=!o)}return o}isConvex(){function t(t){return t<0?-1:t>0?1:0}var e=this.p1.minus(this.p0),o=this.p2.minus(this.p1),i=this.p3.minus(this.p2),s=this.p0.minus(this.p3),r=t(e.cross(o)),n=t(o.cross(i)),a=t(i.cross(s)),l=t(s.cross(e));return r==n&&r==a&&r==l}rotateInPlace(t,e){return this.p0.rotateInPlace(t,e),this.p1.rotateInPlace(t,e),this.p2.rotateInPlace(t,e),this.p3.rotateInPlace(t,e),this}rotate(t,e){return this.dup().rotateInPlace(t,e)}}class Ft{constructor(t,e,o,i){this.left=t,this.top=e,this.right=o,this.bottom=i}static empty(){return new Ft(0,0,0,0)}static unit(){return new Ft(0,0,1,1)}static fromBoundingRect(t){return new Ft(t[0],t[1],t[2],t[3])}static fromCropRect(t){return new Ft(t.left0,t.top0,t.right0,t.bottom0)}static fromPoints(t){if(0==t.length)return null;for(var e=t[0],o=new Ft(e.x,e.y,e.x,e.y),i=1;i<t.length;i++)o.addPoint(t[i]);return o}static fromQuad(t){return Ft.fromPoints(t.points)}dup(){return new Ft(this.left,this.top,this.right,this.bottom)}setNull(){return this.set(null,null,null,null)}setFrom(t){return this.left=t.left,this.top=t.top,this.right=t.right,this.bottom=t.bottom,this}set(t,e,o,i){return this.left=t,this.top=e,this.right=o,this.bottom=i,this}fromCropRect(t){return this.set(t.left0,t.top0,t.right0,t.bottom0)}containsPoint(t){return this.left<=t.x&&t.x<=this.right&&this.top<=t.y&&t.y<=this.bottom}intersectionWith(t){return this.left=Math.max(this.left,t.left),this.top=Math.max(this.top,t.top),this.right=Math.min(this.right,t.right),this.bottom=Math.min(this.bottom,t.bottom),this}leftCenter(){return new Rt(this.left,.5*(this.top+this.bottom))}topLeft(){return new Rt(this.left,this.top)}topCenter(){return new Rt(.5*(this.left+this.right),this.top)}topRight(){return new Rt(this.right,this.top)}rightCenter(){return new Rt(this.right,.5*(this.top+this.bottom))}bottomLeft(){return new Rt(this.left,this.bottom)}bottomCenter(){return new Rt(.5*(this.left+this.right),this.bottom)}bottomRight(){return new Rt(this.right,this.bottom)}center(){return new Rt(.5*(this.left+this.right),.5*(this.top+this.bottom))}translate(t,e){return this.top+=e,this.bottom+=e,this.left+=t,this.right+=t,this}point(t){switch(t){case S.TopLeft:return this.interpolate(0,0);case S.Top:return this.interpolate(.5,0);case S.TopRight:return this.interpolate(1,0);case S.Right:return this.interpolate(1,.5);case S.BottomRight:return this.interpolate(1,1);case S.Bottom:return this.interpolate(.5,1);case S.BottomLeft:return this.interpolate(0,1);case S.Left:return this.interpolate(0,.5);case S.Center:return this.interpolate(.5,.5)}return this.interpolate(.5,.5)}setAnchorPoint(t,e){switch(t){case S.TopLeft:this.left=e.x,this.top=e.y;break;case S.Top:this.top=e.y;break;case S.TopRight:this.top=e.y,this.right=e.x;break;case S.Right:this.right=e.x;break;case S.BottomRight:this.right=e.x,this.bottom=e.y;break;case S.Bottom:this.bottom=e.y;break;case S.BottomLeft:this.left=e.x,this.bottom=e.y;break;case S.Left:this.left=e.x;case S.Center:}return this}moveAnchorTo(t,e){let o=this.point(t);return this.translate(e.x-o.x,e.y-o.y),this}moveAnchor(t,e){switch(t){case S.TopLeft:this.left=Math.min(this.left+e.x,this.right),this.top=Math.min(this.top+e.y,this.bottom);break;case S.Top:this.top=Math.min(this.top+e.y,this.bottom);break;case S.TopRight:this.top=Math.min(this.top+e.y,this.bottom),this.right=Math.max(this.right+e.x,this.left);break;case S.Right:this.right=Math.max(this.right+e.x,this.left);break;case S.BottomRight:this.right=Math.max(this.right+e.x,this.left),this.bottom=Math.max(this.bottom+e.y,this.top);break;case S.Bottom:this.bottom=Math.max(this.bottom+e.y,this.top);break;case S.BottomLeft:this.left=Math.min(this.left+e.x,this.right),this.bottom=Math.max(this.bottom+e.y,this.top);break;case S.Left:this.left=Math.min(this.left+e.x,this.right);break;case S.Center:this.left+=e.x,this.top+=e.y,this.right+=e.x,this.bottom+=e.y}return this}moveAnchorToMinSize(t,e,o){var i=Math.max(0,e-this.width()),s=Math.max(0,o-this.height());switch(t){case S.TopLeft:this.left-=i,this.top-=s;break;case S.Top:this.top-=s;break;case S.TopRight:this.top-=s,this.right+=i;break;case S.Right:this.right+=i;break;case S.BottomRight:this.right+=i,this.bottom+=s;break;case S.Bottom:this.bottom+=s;break;case S.BottomLeft:this.left-=i,this.bottom+=s;break;case S.Left:this.left-=i;break;case S.Center:i*=.5,s*=.5,this.left-=i,this.right+=i,this.top-=s,this.bottom+=s}return this}forceAspectRatio(t,e){const o=t*this.width();var i=0,s=0;e==S.TopLeft||e==S.TopRight||e==S.BottomRight||e==S.BottomLeft?o>this.height()?i=o-this.height():s=this.height()/t-this.width():e==S.Top||e==S.Bottom?s=this.height()/t-this.width():i=o-this.height();const r=.5*s,n=.5*i;switch(e){case S.Top:this.bottom+=i,this.left-=r,this.right+=r;break;case S.Left:this.right+=s,this.top-=n,this.bottom+=n;break;case S.Bottom:this.top-=i,this.left-=r,this.right+=r;break;case S.Right:this.left-=s,this.top-=n,this.bottom+=n;break;case S.TopLeft:this.bottom+=i,this.right+=s;break;case S.TopRight:this.bottom+=i,this.left-=s;break;case S.BottomRight:this.top-=i,this.left-=s;break;case S.BottomLeft:this.top-=i,this.right+=s;break;case S.Center:this.top-=n,this.bottom+=n,this.left-=r,this.right+=r}return this}interpolate(t,e){return new Rt(this.left*(1-t)+t*this.right,this.top*(1-e)+e*this.bottom)}transform(t,e){return new Rt(e.left+(t.x-this.left)/this.width()*e.width(),e.top+(t.y-this.top)/this.height()*e.height())}sampleGrid(t,e){for(var o=[],i=0;i<e;i++)for(var s=i/(e-1),r=0;r<t;r++)o.push(this.interpolate(r/(t-1),s));return o}setHorizontal(t){return this.left=t.left,this.right=t.right,this}padToFit(t){var e=0,o=0;return e=Math.max(e,this.left-t.left),e=Math.max(e,t.right-this.right),o=Math.max(o,this.top-t.top),o=Math.max(o,t.bottom-this.bottom),this.left-=e,this.right+=e,this.top=Math.min(this.top,t.top),this.bottom=Math.max(this.bottom,t.bottom),this}addRect(t){return this.left=Math.min(this.left,t.left),this.right=Math.max(this.right,t.right),this.top=Math.min(this.top,t.top),this.bottom=Math.max(this.bottom,t.bottom),this}addPoint(t){this.left=Math.min(this.left,t.x),this.top=Math.min(this.top,t.y),this.right=Math.max(this.right,t.x),this.bottom=Math.max(this.bottom,t.y)}addPointSafe(t){t&&(null==this.left?(this.left=t.x,this.top=t.y,this.right=t.x,this.bottom=t.y):this.addPoint(t))}width(){return this.right-this.left}height(){return this.bottom-this.top}pad(t,e,o,i){return null==e&&(e=t),null==o&&(o=t),null==i&&(i=e),this.left-=t,this.top-=e,this.right+=o,this.bottom+=i,this}padBottom(t){return this.bottom+=t,this}toQuad(){return new Et(this.topLeft(),this.topRight(),this.bottomRight(),this.bottomLeft())}snap(){return this.left=Math.floor(this.left),this.top=Math.floor(this.top),this.right=Math.ceil(this.right),this.bottom=Math.ceil(this.bottom),this}round(){return this.left=Math.round(this.left),this.top=Math.round(this.top),this.right=Math.round(this.right),this.bottom=Math.round(this.bottom),this}normalize(){var t=Math.min(this.left,this.right),e=Math.max(this.left,this.right),o=Math.min(this.top,this.bottom),i=Math.max(this.top,this.bottom);return this.left=t,this.right=e,this.top=o,this.bottom=i,this}}!function(t){let e=!1,o=new Image;o.src="data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAIAAwMBEQACEQEDEQH/xABRAAEAAAAAAAAAAAAAAAAAAAAKEAEBAQADAQEAAAAAAAAAAAAGBQQDCAkCBwEBAAAAAAAAAAAAAAAAAAAAABEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEQMRAD8AG8T9NfSMEVMhQvoP3fFiRZ+MTHDifa/95OFSZU5OzRzxkyejv8ciEfhSceSXGjS8eSdLnZc2HDm4M3BxcXwH/9k=",o.onload=function(){e=2==o.width&&3==o.height},t.BrowserRotates=function(){return e}}(w||(w={})),function(t){t.RecodeJpegQuality=.95;const e=new Set(["image/png","image/jpeg"]);function o(e,o,i,s){f.get(e,(function(r){R.loadImageFromBlob(e,i,(e=>{if(r.statusCode!=g.Success||r.orientation==h.R0||r.orientation==h.Undefined||w.BrowserRotates()){const i=t.imageToCanvasEx(e,o);i.wasRotated=!1,s(i,r)}else{const i=t.rotateImageToCanvasEx(e,r.orientation,o);i.wasRotated=!0,r.applyOrientation(),s(i,r)}}))}))}function i(t,e){const o=t.naturalWidth,i=t.naturalHeight;let s=new Bt(o,i);return s.wasShrunk=!1,s.context().setGlobalAlpha(1),e&&(s.context().setFillStyle("rgb(255,255,255)"),s.context().fillRect(0,0,o,i)),s.context().context.drawImage(t,0,0,o,i),s}function s(t){return i(t,!0)}function r(t,e,o){const i=t.naturalWidth,r=t.naturalHeight;let n=i,a=r,l=0;switch(e){case h.Undefined:case h.R0:return s(t);case h.R90:n=r,a=i,l=.5*Math.PI;break;case h.R180:l=Math.PI;break;case h.R270:n=r,a=i,l=.5*-Math.PI}let c=new Bt(n,a);return c.wasShrunk=!1,c.context().setGlobalAlpha(1),o&&(c.context().setFillStyle("rgb(255,255,255)"),c.context().fillRect(0,0,n,a)),c.context().save(),c.context().translate(.5*n,.5*a),c.context().rotate(l),c.context().context.drawImage(t,.5*-i,.5*-r,i,r),c.context().restore(),c}t.DefaultFontFamily=function(){try{return window.getComputedStyle(document.querySelector("body")).fontFamily}catch(t){return"sans-serif"}}(),t.needsReencoding=function(t){return!e.has(t)},t.recodeCanvasFile=function(e,o){return i=e.type,R.endsWith(i,"jpeg")||R.endsWith(i,"jpg")||R.endsWith(i,"webp")||R.endsWith(i,"jp2")||R.endsWith(i,"cr2")||R.endsWith(i,"nef")||R.endsWith(i,"dng")||R.endsWith(i,"jps")||R.startsWith(i,"image/heif")||R.startsWith(i,"image/avif")?o.toFile("image/jpeg",t.RecodeJpegQuality,R.dropExtension(e.name)+".jpeg"):o.toFile("image/png",1,R.dropExtension(e.name)+".png");var i},t.loadCheckRotateImage=o,t.loadCheckRotateFlattenImage=function(t,e,i){o(t,!0,e,i)},t.imageToCanvasEx=i,t.flattenImage=s,t.rotateImageToCanvasEx=r,t.rotateAndFlattenImage=function(t,e){return r(t,e,!0)}}(pt||(pt={}));class It{constructor(t,e){this.canvas=t,this.context=e,this.toggleImageSmoothing(!1)}toggleImageSmoothing(t){this.context.mozImageSmoothingEnabled=t,this.context.webkitImageSmoothingEnabled=t,this.context.imageSmoothingEnabled=t}width(){return this.context.canvas.width}height(){return this.context.canvas.height}logicalWidth(){return this.canvas.logicalWidth()}logicalHeight(){return this.canvas.logicalHeight()}createPattern(t,e){return this.context.createPattern(t,e)}setStrokeStyle(t){this.context.strokeStyle=t}setLineDash(t){this.context.setLineDash(t)}setLineWidth(t){this.context.lineWidth=t}setLineJoin(t){this.context.lineJoin=t}setLineCap(t){this.context.lineCap=t}strokeText(t,e,o){this.context.strokeText(t,e,o)}fillText(t,e,o){this.context.fillText(t,e,o)}measureText(t){return this.context.measureText(t)}setFont(t){this.context.font=t}save(){this.context.save()}stroke(){this.context.stroke()}strokeRect(t,e,o,i){this.context.strokeRect(t,e,o,i)}createRadialGradient(t,e,o,i,s,r){return this.context.createRadialGradient(t,e,o,i,s,r)}createLinearGradient(t,e,o,i){return this.context.createLinearGradient(t,e,o,i)}scale(t,e){this.context.scale(t,e)}translate(t,e){this.context.translate(t,e)}setRectToRectTransform(t,e){let o=e.width()/t.width(),i=e.height()/t.height();this.context.setTransform(o,0,0,i,e.left-t.left*o,e.top-t.top*i)}moveTo(t,e){this.context.moveTo(t,e)}lineTo(t,e){this.context.lineTo(t,e)}quadraticCurveTo(t,e,o,i){this.context.quadraticCurveTo(t,e,o,i)}bezierCurveTo(t,e,o,i,s,r){this.context.bezierCurveTo(t,e,o,i,s,r)}rotate(t){this.context.rotate(t)}beginPath(){this.context.beginPath()}closePath(){this.context.closePath()}arc(t,e,o,i,s,r){this.context.arc(t,e,o,i,s,r)}rect(t,e,o,i){this.context.rect(t,e,o,i)}rectTo(t,e,o,i,s){let r=t+o,n=e+i;this.moveTo(t,e),s?(this.lineTo(r,e),this.lineTo(r,n),this.lineTo(t,n)):(this.lineTo(t,n),this.lineTo(r,n),this.lineTo(r,e)),this.lineTo(t,e),this.closePath()}clip(){this.context.clip()}clipBlock(t,e,o,i,s,r){t?(this.save(),this.beginPath(),this.rect(e,o,i-e,s-o),this.clip(),r(),this.restore()):r()}rotatedFrame(t,e,o){0!=t?(this.save(),this.translate(e.x,e.y),this.rotate(t),this.translate(-e.x,-e.y),o(),this.restore()):o()}restore(){this.context.restore()}setFillStyle(t){this.context.fillStyle=t}clearShadow(){this.context.shadowOffsetX=0,this.context.shadowOffsetY=0,this.context.shadowBlur=0,this.context.shadowColor=void 0}setShadow(t,e,o,i){this.context.shadowOffsetX=t,this.context.shadowOffsetY=e,this.context.shadowBlur=o,this.context.shadowColor=i}setGlobalAlpha(t){this.context.globalAlpha=t}withGlobalAlpha(t,e){let o=this.context.globalAlpha;this.setGlobalAlpha(t),e(),this.setGlobalAlpha(o)}clearRect(t,e,o,i){this.context.clearRect(t,e,o,i)}clearAll(){this.clearRect(0,0,this.logicalWidth(),this.logicalHeight())}createImageData(t,e){return this.context.createImageData(t,e)}getImageData(t,e,o,i){return this.context.getImageData(t,e,o,i)}getImageDataFull(){return this.context.getImageData(0,0,this.width(),this.height())}putImageData(t,e,o){this.context.putImageData(t,e,o)}putImageData2(t,e,o,i,s,r,n){this.context.putImageData(t,e,o,i,s,r,n)}fillRect(t,e,o,i){this.context.fillRect(t,e,o,i)}roundedRect(t,e,o,i,s){o<2*s&&(s=o/2),i<2*s&&(s=i/2),this.beginPath(),this.moveTo(t+s,e),this.context.arcTo(t+o,e,t+o,e+i,s),this.context.arcTo(t+o,e+i,t,e+i,s),this.context.arcTo(t,e+i,t,e,s),this.context.arcTo(t,e,t+o,e,s),this.closePath()}fillRoundedRect(t,e,o,i,s){this.roundedRect(t,e,o,i,s),this.context.fill()}drawImage(t,e,o){this.context.drawImage(t,e,o)}drawImage2(t,e,o,i,s){this.context.drawImage(t,e,o,i,s)}drawImage3(t,e,o,i,s,r,n,a,l){this.context.drawImage(t,e,o,i,s,r,n,a,l)}drawCanvasEx(t,e,o){this.context.drawImage(t.element,e,o)}drawCanvasEx2(t,e,o,i,s){this.context.drawImage(t.element,e,o,i,s)}drawCanvasEx3(t,e,o,i,s,r,n,a,l){this.context.drawImage(t.element,e,o,i,s,r,n,a,l)}circle(t,e,o){this.context.beginPath(),this.context.arc(t,e,o,0,2*Math.PI,!0)}fillCircle(t,e,o,i){i&&(this.context.fillStyle=i),this.circle(t,e,o),this.context.fill()}fillSquare(t,e,o,i){i&&(this.context.fillStyle=i),this.context.fillRect(t-o,e-o,2*o,2*o)}strokeSquare(t,e,o,i){i&&(this.context.strokeStyle=i),this.context.strokeRect(t-o,e-o,2*o,2*o)}strokeCircle(t,e,o,i){i&&(this.context.strokeStyle=i),this.circle(t,e,o),this.context.stroke()}strokeLine(t,e,o,i,s,r){s&&(this.context.lineWidth=s),r&&(this.context.strokeStyle=r),this.context.beginPath(),this.context.moveTo(t,e),this.context.lineTo(o,i),this.context.stroke()}strokePolyline(...t){if(t.length>1){this.context.beginPath(),this.context.moveTo(t[0].x,t[0].y);for(let e=1;e<t.length;e++)this.context.lineTo(t[e].x,t[e].y);this.context.stroke()}}triangle(t,e,o,i,s,r){var n=120*Math.PI/180;s=s||i,r=r||s,this.context.moveTo(t+i*Math.cos(o),e+i*Math.sin(o)),this.context.lineTo(t+s*Math.cos(o+n),e+s*Math.sin(o+n)),this.context.lineTo(t+r*Math.cos(o+2*n),e+r*Math.sin(o+2*n)),this.context.closePath()}strokeEx(t,e,o,i){o&&(this.context.lineJoin=o),i&&(this.context.lineCap=i),this.context.lineWidth=t,this.context.strokeStyle=e,this.context.stroke()}fillEx(t){this.context.fillStyle=t,this.context.fill()}drawCenteredText(t,e){var o=t;const i=t.length;this.setGlobalAlpha(1),this.setFont(this.canvas.largeFont);let s=18;var r=this.measureText(t).width;const n=this.canvas.logicalWidth();var a=n-20;r>a&&(this.setFont(this.canvas.smallFont),s=12,(r=this.measureText(t).width)>a&&(t=R.centerElide(o,.75*i),(r=this.measureText(t).width)>a&&(t=R.centerElide(o,.5*i),(r=this.measureText(t).width)>a&&(t=R.centerElide(o,.25*i),r=this.measureText(t).width))));let l=(n-r)/2,c=s+4,p=.25*s+1;this.setGlobalAlpha(.4),this.setFillStyle("#fff"),this.fillRoundedRect(l-4,e-c+p,r+8,c,.4*c),this.setGlobalAlpha(1),this.setFillStyle("#000"),this.fillText(t,l,e)}}class Bt{static fromHTMLImageElement(t,e=1){let o=t.naturalWidth*e,i=t.naturalHeight*e,s=new Bt(o,i);return s.context().drawImage2(t,0,0,o,i),s}constructor(t,e,o=1){this.w=t,this.h=e,this.highDpiRatio=1,this.largeFont="20px "+pt.DefaultFontFamily,this.smallFont="14px "+pt.DefaultFontFamily,this.element=document.createElement("canvas"),this.$element=$(this.element),this.setSize(t,e,o),this.wasShrunk=!1,this.contextCache=null}empty(){}width(){return this.w}height(){return this.h}snapStrokeCenterToDevice(t,e){let o=t*this.highDpiRatio,i=e*this.highDpiRatio;return i==Math.round(i)?i%2==0?Math.round(o)/this.highDpiRatio:(Math.floor(o)+.5)/this.highDpiRatio:t}logicalWidth(){return this.wLogical}logicalHeight(){return this.hLogical}boundsRect(){return new Ft(0,0,this.width(),this.height())}size(){return this.w*this.h}isInBounds(t,e){return 0<=t&&t<this.width()&&0<=e&&e<this.height()}byteLength(){return 4*this.size()}dup(){let t=new Bt(this.width(),this.height());return t.context().drawCanvasEx(this,0,0),t}crop(t,e,o,i){let s=new Bt(o,i);return s.context().drawCanvasEx(this,-t,-e),s}isOpaque(){let t=this.context().getImageDataFull().data,e=t.length/4;if(e>0)for(let o=0;o<e;o++){if(t[4*o+3]<255)return!1}return!0}hasTransparency(){return!this.isOpaque()}computeMeanRgba(t,e,o,i){if(null!=t&&null!=e&&null!=o&&null!=i){let s=this.context().getImageData(t,e,o,i).data,r=s.length/4;if(r>0){let t=new Float64Array(4);for(let e=0,o=0;e<r;e++)t[0]+=s[o++],t[1]+=s[o++],t[2]+=s[o++],t[3]+=s[o++];let e=new Uint8ClampedArray(4);return e[0]=t[0]/r,e[1]=t[1]/r,e[2]=t[2]/r,e[3]=t[3]/r,e}}}scale(t){let e=new Bt(Math.round(this.width()*t),Math.round(this.height()*t));return e.context().drawCanvasEx2(this,0,0,e.width(),e.height()),e}context(){return null==this.contextCache&&(this.contextCache=new It(this,this.element.getContext("2d")),1!=this.highDpiRatio&&this.contextCache.scale(this.highDpiRatio,this.highDpiRatio)),this.contextCache}checkSetSize(t,e,o=1){return(this.w!=t||this.h!=e||this.highDpiRatio!=o)&&(this.setSize(t,e,o),!0)}setSize(t,e,o=1){t>0&&e>0&&(this.highDpiRatio=o,this.wLogical=t,this.hLogical=e,this.w=t*this.highDpiRatio,this.h=e*this.highDpiRatio,this.element.style.width=t+"px",this.element.style.height=e+"px",this.element.width=this.w,this.element.height=this.h,this.contextCache=null)}clearAll(){this.context().clearRect(0,0,this.width(),this.height())}toImage(){let t=document.createElement("img");return t.src=this.toDataURL(),t}toDataURL(t,e){return this.element.toDataURL(t,e)}toBlob(t,e){return R.dataUrlToBlob(this.toDataURL(t,e))}toBlobAsync(t,e,o){this.element.toBlob(t)}toFile(t,e,o){return R.blobToFile(this.toBlob(t,e),o)}fillAliasedCircle(t,e,o,i){if(!(o<=0)){for(var s=this.context().getImageData(0,0,this.width(),this.height()),r=o*o,n=Math.max(0,Math.floor(t-o)),a=Math.min(this.width()-1,Math.ceil(t+o)),l=Math.max(0,Math.floor(e-o)),c=Math.min(this.height()-1,Math.ceil(e+o)),p=l;p<=c;p++)for(var u=n;u<=a;u++)if((u+.5-t)*(u+.5-t)+(p+.5-e)*(p+.5-e)<=r){var h=4*(p*this.width()+u);s.data[h]=i[0],s.data[h+1]=i[1],s.data[h+2]=i[2],s.data[h+3]=i[3]}this.context().putImageData(s,0,0)}}}!function(t){t.copyTextToClipboard=function(t,e,o){window.navigator&&window.navigator.clipboard&&window.navigator.clipboard.writeText?window.navigator.clipboard.writeText(t).then((()=>{e()}),(()=>{o()})):o()};const e=new RegExp("mobile|ip(hone|od|ad)|android|blackberry|iemobile|kindle|netfront|silk-accelerated|(hpw|web)os|fennec|minimo|opera m(obi|ini)|blazer|dolfin|dolphin|skyfire|zune");function o(t,e,o){navigator.clipboard&&navigator.clipboard.write?navigator.clipboard.write([new ClipboardItem({[t.type]:t})]).then((()=>{e()}),(t=>{o()})):setTimeout(o,0)}t.copyImageToClipboard=function(t,e,i){Bt.fromHTMLImageElement(t).toBlobAsync((t=>o(t,e,i)))},t.copyImageBlobToClipboard=o,t.isMobile=function(){return!!(navigator&&navigator.userAgent&&navigator.userAgent.length>0)&&e.test(navigator.userAgent.toLowerCase())};const i=/\<svg[^\>]+viewBox\s*=\s*"\s*([\d\.]+)\s+([\d\.]+)\s+([\d\.]+)\s+([\d\.]+)\s*"/,s=/\<svg[^\>]+width\s*=\s*"\s*([\d\.]+)/,r=/\<svg[^\>]+height\s*=\s*"\s*([\d\.]+)/;function n(t,e,o){let i=new Image;i.onload=function(){URL.revokeObjectURL(i.src),o(i)},i.onerror=e,i.src=t}t.loadImageFromSvgString=function(e,o,a){n(t.svgStringToDataUrl(function(t){let e=s.exec(t),o=r.exec(t);if(e&&2==e.length&&isFinite(parseInt(e[1]))&&o&&2==o.length&&isFinite(parseInt(o[1])))return t;{let e=i.exec(t);if(5==e.length){parseInt(e[1]),parseInt(e[2]);let o=parseInt(e[3]),i=parseInt(e[4]);if(isFinite(o)&&isFinite(i)){let e=150,s=Math.ceil(i/o*e);return t.replace("<svg",`<svg width="${e}" height="${s}"`)}}}return t}(e)),o,a)},t.loadImageFromDataUrl=n,t.loadImageFromUrl=function(t,e,o){let i=new Image;i.onload=()=>o(i),i.onerror=e,i.src=t},t.loadImageFromBlob=function(t,e,o){n(URL.createObjectURL(t),e,o)},t.loadFileFromUrl=function(e,o,i){let s=new XMLHttpRequest;s.open("GET",e,!0),s.responseType="blob",s.onload=function(s){if(200==this.status){let s=this.response,r=e.split("/");o||(o=r[r.length-1]),i(t.blobToFile(s,o))}},s.send()},t.gaTrack=function(t,e,o,i){"gtag"in window?gtag("event",e,{event_category:t,event_label:o,value:i,non_interaction:!0}):ga("send","event",t,e,o,i,{nonInteraction:!0})},t.gaSetPageAndSendPageview=function(t){ga("set","page",t||location.pathname),ga("send","pageview")},t.modal=function(t,e=!1,o=!1){var i="string"==typeof t?$(t):t.$();e?i.modal({backdrop:!o,keyboard:!0}):i.modal({backdrop:"static",keyboard:!1});var s=$(".modal-backdrop"),r=1040+2*(s.length-1);s.last().css("z-index",r),i.css("z-index",r+1)},t.blink=function(t,e=200,o=3){var i="string"==typeof t?$(t):t.$();function s(){i.fadeIn(e,r)}function r(){--o>0&&i.fadeOut(e,s)}i.fadeOut(e,s)},t.makeElement=function(t,e){var o=$(document.createElement(t));return o.text(e),o},t.formatXhrError=function(e,o){const i=e.responseURL||"[Unknown URL]";if(t.gaTrack("XhrError",i,e.status+", "+(o||"[unknown]")),0===e.status)return p.s("Failed to connect to the server.")+"\n"+p.s("Please verify your network connection.")+"\n";{const i=t.elide(e.responseText.toString(),200);return e.status<200||299<e.status?e.statusText+" ["+e.status+"]\n"+i:"parsererror"===o?p.s("Failed to parse JSON response.")+" ["+o+"]\n"+i:"timeout"===o?p.s("Request time out.")+" ["+o+"]":"abort"===o?p.s("Request aborted by the server.")+" ["+o+"]":"empty"===o?p.s("Server gave an empty response."):p.s("Unknown error.")+"\n"+i}}}(R||(R={})),function(t){t.initialize=function(t,e){t.$().click((function(){let t=prompt(p.s("Please enter the image URL to upload:"));return t&&(t=t.trim(),t.length>4&&e(t)),!1}))}}(C||(C={})),function(t){t.isCommandOrCtrl=function(t){return 17==t||224==t||91==t||93==t},t.isShift=function(t){return 16==t}}(y||(y={})),function(t){const e=".FileDropper";var o,i=!0;let s,r;!function(t){t[t.Dropped=0]="Dropped",t[t.Picked=1]="Picked",t[t.Pasted=2]="Pasted",t[t.Url=3]="Url"}(s=t.InputMethod||(t.InputMethod={})),function(t){t[t.NoBrowserSupport=0]="NoBrowserSupport",t[t.NonFileInput=1]="NonFileInput",t[t.NonImageInput=2]="NonImageInput"}(r=t.ErrorCode||(t.ErrorCode={})),t.initialize=function(t){var n=!1,a=$.extend({},{hover_class_on:t.monitor_drag,focusPasteOnCtrlV:!!t.monitor_paste,afterPaste:t=>{}},t);function l(t,e,o){a.afterPaste(!1),a.error(t,e,o)}function c(){i=!1,a.monitor_drag&&a.hover_class_on&&a.hover_class&&a.monitor_drag.$().off(e),a.monitor_file_input&&a.monitor_file_input.$().off(e),a.monitor_paste&&a.monitor_paste.$().off(e),a.focusPasteOnCtrlV&&$(window).off(e)}function u(t,e,o){i&&(t&&t.length>0?("Pasted"==e&&a.afterPaste(!0),a.beforeDrop&&a.beforeDrop(),o==s.Dropped&&a.hideDurationMs?setTimeout((()=>{a.drop.call(this,t,o),a.dropOnce&&c()}),a.hideDurationMs):(a.drop.call(this,t,o),a.dropOnce&&c())):l(p.s(e+" a non-file input"),o,r.NonFileInput))}function h(t,e){clearTimeout(o),t.stopImmediatePropagation(),t.preventDefault();let i=!1;try{let e=t.originalEvent.dataTransfer;if(e){let t=e.types;for(let e=0;e<t.length;e++){if("Files"==t[e]){i=!0;break}}}}catch(t){i=!0}let s=a.hover_class_on.$().hasClass(a.hover_class.name()),r=e&&i;return s&&!r?(a.beforeHide&&a.beforeHide(),a.hideDurationMs?setTimeout((()=>a.hover_class_on.$().removeClass(a.hover_class.name())),a.hideDurationMs):a.hover_class_on.$().removeClass(a.hover_class.name()),a.afterHide&&a.afterHide()):!s&&r&&(a.beforeShow&&a.beforeShow(),a.hover_class_on.$().addClass(a.hover_class.name())),i}function d(){a.pastedUrl?l(p.s("Pasted something that wasn't an image or URL?"),s.Pasted,r.NonImageInput):l(p.s("Pasted something that wasn't an image?"),s.Pasted,r.NonImageInput)}function g(t){let e=new Blob([t],{type:t.type});return e.lastModified=t.lastModified,e.name=function(){function t(t){return("0"+t).slice(-2)}let e=new Date;return"Pasted-"+e.getFullYear()+t(e.getMonth()+1)+t(e.getDate())+"-"+t(e.getHours())+t(e.getMinutes())+t(e.getSeconds())}(),e}return a.monitor_drag&&a.hover_class_on&&a.hover_class&&a.monitor_drag.$().on("drop"+e,(function(t){return h(t,!1)&&u(t.originalEvent.dataTransfer.files,"Dropped",s.Dropped),!1})).on("dragenter"+e,(function(t){h(t,!0),a.onDragEnter&&a.onDragEnter(t)})).on("dragover"+e,(function(t){let e=h(t,!0);t.originalEvent.dataTransfer.dropEffect=i&&e?"copy":"none",a.onDragOver&&a.onDragOver(t)})).on("dragleave"+e,(function(t){o=setTimeout((()=>{h(t,!1),a.onDragLeave&&a.onDragLeave(t)}),100)})),a.monitor_file_input&&a.monitor_file_input.$().on("change"+e,(t=>{let e=t.originalEvent.target;return u(e.files,"Picked",s.Picked),e.value=null,!1})),a.monitor_paste&&(a.monitor_paste.$().on("paste"+e,(function(t){if(!i)return;const e=t.originalEvent.clipboardData;if(e&&e.files&&e.files.length>0)1==e.files.length&&"image.png"==e.files[0].name?u([g(e.files[0])],"Pasted",s.Pasted):u(e.files,"Pasted",s.Pasted);else if(e&&!e.items)l(p.s("Terribly sorry, it seems like your browser doesn't fully support pasting of images yet?")+"\n\n"+p.s("Paste should work in at least Chrome, Firefox, and Microsoft Edge. "),s.Pasted,r.NoBrowserSupport);else if(e&&e.items&&e.items.length>0&&e.types&&e.types.length==e.items.length){const t=[];let o=!1,i=0;for(let s=0;s<e.items.length;s++)if("Files"==e.types[s]){let o=e.items[s].getAsFile();o&&(t[i]=g(o),i++)}else"text/plain"==e.types[s]&&a.pastedUrl&&(o=!0,e.items[s].getAsString((function(t){(t=t.trim()).length>5e3||t.length<=4||t.indexOf("\n")>=0||t.indexOf("\r")>=0||t.indexOf(" ")>=0||t.indexOf(".")<0?d():a.pastedUrl(t)})));i>0?u(t,"Pasted",s.Pasted):o||d()}else d();n&&(n=!1,a.monitor_paste.$().blur()),t.preventDefault()})),a.focusPasteOnCtrlV&&$(window).on("keydown"+e,(t=>{(t.ctrlKey||t.metaKey)&&86==t.keyCode&&($(document.activeElement).is("input")||(a.monitor_paste.$().focus(),n=!0))}))),{disable:c}};try{XMLHttpRequest.prototype.hasOwnProperty("sendAsBinary")||a.set(XMLHttpRequest.prototype,"sendAsBinary",(function(t){var e=Array.prototype.map.call(t,(function(t){return 255&t.charCodeAt(0)})),o=new Uint8Array(e);this.send(o.buffer)}))}catch(t){}}(b||(b={})),function(t){t[t.Trying=0]="Trying",t[t.Success=1]="Success",t[t.FailureSilent=2]="FailureSilent",t[t.FailureShown=3]="FailureShown",t[t.Stopped=4]="Stopped"}(v||(v={}));class Ot{constructor(t){this.opts=t,this.tries=0,this.triesEver=0,this.lastErrorMessage="",this.isTrying=!1,this.state=v.Trying,this.timeout=0,this.executionStopped=()=>{this.state=v.Stopped,this.isTrying=!1,this.tries=0,this.lastErrorMessage="",A.deregister(this)},this.executionSuccess=()=>{this.state=v.Success,this.isTrying=!1,this.tries=0,this.lastErrorMessage="",this.opts.success(),A.deregister(this)},this.executionError=t=>{this.isTrying=!1,this.lastErrorMessage=t.substr(0,200),this.tries<this.opts.numberOfSilentRetriesBeforeShowingErrorToUser?(this.state=v.FailureSilent,this.clearTimeout(),this.timeout=setTimeout(this.tryExecute,this.opts.millisBetweenSilentRetries)):this.opts.giveUpAfterSilentRetries?this.state=v.FailureSilent:(this.state=v.FailureShown,A.register(this))},this.executionPunt=()=>{this.isTrying=!1,this.state=v.FailureSilent,this.clearTimeout(),this.timeout=setTimeout(this.tryExecute,100)},this.tryExecute=()=>{if(this.clearTimeout(),!this.isTrying){this.state=v.Trying,this.isTrying=!0,this.tries+=1,this.triesEver+=1;try{this.opts.execute(this.executionSuccess,this.executionError)}catch(t){this.tries=Math.max(this.tries,this.opts.numberOfSilentRetriesBeforeShowingErrorToUser),setTimeout((()=>{this.executionError(t.toString())}),0)}return!0}return!1}}start(){return this.tryExecute(),this}clearTimeout(){this.timeout&&(clearTimeout(this.timeout),this.timeout=0)}makeHtmlRow(){let t=$(document.createElement("tr"));return t.append(R.makeElement("td",this.opts.label)),t.append(R.makeElement("td",this.lastErrorMessage)),t}toString(){return`RetryInstance(${this.opts.label}, tries: ${this.tries} (${this.triesEver}), err: '${this.lastErrorMessage}', isTrying: ${this.isTrying}, state: ${v[this.state]})`}}!function(t){setTimeout((function(){!0}),0);var e=[],o=5e3,i=36e5,s=null,r=0,n=o,a=!1;function l(){var t=P.RetryDialog.Body.$();t.empty();var o=$(document.createElement("tr"));o.append(R.makeElement("th",p.s("Task"))),o.append(R.makeElement("th",p.s("Error"))),t.append(o);for(var i=0;i<e.length;i++)t.append(e[i].makeHtmlRow())}function c(){r=Date.now(),null!=s&&(clearInterval(s),s=null),(n*=2)>i&&(n=i),P.RetryDialog.Countdown.$().text(p.s("Retrying now..."));for(var t=0;t<e.length;t++)e[t].tryExecute()}function u(){var t=Date.now(),e=Math.round((r+n-t)/1e3);e<=0?c():P.RetryDialog.Countdown.$().text(p.s("Retrying in {0} {0,plural,one{second}other{seconds}}...",e)),l()}t.register=function(t){e.indexOf(t)<0&&(R.gaTrack("ErrorShown",t.opts.label,t.lastErrorMessage,null),e.push(t),l()),R.modal(P.RetryDialog.Dialog.css()),a=!0,null==s&&(r=Date.now(),s=setInterval(u,1e3))},t.deregister=function(t){var i=e.indexOf(t);i>=0&&(e.splice(i,1),l()),n=o,r=Date.now(),0==e.length&&a&&P.RetryDialog.Dialog.$().modal("hide")},$((()=>{P.RetryDialog.RetryNowButton.$().click((()=>{c(),n=o}))}))}(A||(A={})),function(t){let e={label:"Unknown",url:"",tries:3,paramname:"file",withCredentials:!1,data:{},headers:{},progress:t=>{},success:()=>{},giveUpAfterSilentRetries:!1,timeout:3e4};function o(t,o,i){let s=$.extend({},e,o),r=new XMLHttpRequest,n=r.upload,a=new FormData;function l(){r.abort()}$.each(s.headers,(function(t,e){r.setRequestHeader(t,e)})),$.each(s.data,(function(t,e){a.append(t,e)})),a.append(s.paramname,t);let c=setTimeout(l,s.timeout),p=0;n.onprogress=function(t){if(clearTimeout(c),c=setTimeout(l,s.timeout),t.lengthComputable){let e=Math.round(100*t.loaded/t.total);p!==e&&(p=e,s.progress(p))}},n.onerror=function(t){i.errorHandler(R.formatXhrError(r,void 0))},n.onabort=function(t){i.errorHandler(R.formatXhrError(r,"abort"))},n.onloadend=function(t){clearTimeout(c)},r.onload=function(){clearTimeout(c),r.responseText?r.status<200||r.status>299?i.errorHandler(R.formatXhrError(r,"onload")):(s.progress(100),i.successHandler(r.responseText)):i.errorHandler(R.formatXhrError(r,"empty"))},r.withCredentials=!!s.withCredentials,r.open("POST",s.url,!0),r.send(a)}function i(t,i,s){const r=s.url,n=s.backupUrl;let a="",l=$.extend({},e,s);const c=t.size>i.maxBytes;return new Ot({label:l.label,execute:function(e,s){c?s(p.s("The file is too large to upload. ")+p.s("Please pick a file smaller than {0} {0,plural,one{byte}other{bytes}}. ",i.maxBytes)):(l.url=a=a==r&&n?n:r,function(t,e,i,s){i.data={acl:e.acl||"private",key:e.key,policy:e.policy,success_action_status:201,"x-amz-algorithm":"AWS4-HMAC-SHA256","x-amz-credential":e.credential,"x-amz-date":e.date,"x-amz-signature":e.signature,"Content-Type":t.type,"Cache-Control":i.maxAge?"max-age="+i.maxAge:"no-cache"},e.token&&(i.data["x-amz-security-token"]=e.token),o(t,i,s)}(t,i,l,{errorHandler:s,successHandler:e}))},success:function(){l.success()},numberOfSilentRetriesBeforeShowingErrorToUser:c?0:l.tries,millisBetweenSilentRetries:1e3,giveUpAfterSilentRetries:l.giveUpAfterSilentRetries}).start()}t.uploadRaw=o,t.uploadS3WithRetry=i,t.uploadS3JsonWithRetry=function(t,e,o){return i(new Blob([JSON.stringify(t)],{type:"application/json"}),e,o)}}(k||(k={})),function(t){var e;e=()=>{window.addEventListener("message",(t=>{if(t.data)if("ping"==t.data)t.source.postMessage("pong","*");else if("pong"==t.data)for(let e=0;e<a.length;e++)a[e].checkPong(t)&&(a.splice(e,1),e--);else if(t.data.file||t.data.blob){let e=t.data.file||t.data.blob;o?r(e):i.push(e)}}),!1)},"loading"!==document.readyState?e():document.addEventListener("DOMContentLoaded",e);let o,i=[],s=!1;function r(t){s&&window.hasOwnProperty("chrome")?t.arrayBuffer().then((e=>{o(new File([e],t.name,{type:t.type,lastModified:t.lastModified}))})).catch((t=>{})):o(t)}t.setFileReceiver=function(t,e=!1){s=e,o=t,setTimeout((()=>{for(let t of i)r(t);i=[]}),1)};class n{constructor(t,e){this.connected=!1,this.onOpens=[],this.targetWindow=window.open(t,e),this.targetWindow.postMessage("ping","*"),this.pingIntervalId=setInterval((()=>{this.targetWindow.postMessage("ping","*")}),30)}onOpen(t){return this.connected?t():this.onOpens.push(t),this}checkPong(t){if(t.source==this.targetWindow){clearInterval(this.pingIntervalId),this.connected=!0;for(let t of this.onOpens)t();return this.onOpens=[],!0}return!1}}let a=[],l={};function c(t,e,o,i){let s=e?l[e]:null;s&&!s.targetWindow.closed||(s=function(t,e){let o=new n(t,e);return a.push(o),e&&(l[e]=o),o}(t,e)),s.onOpen((function(){setTimeout((()=>{(i?s.targetWindow:window).focus(),s.targetWindow.postMessage({file:o},"*")}),1)}))}t.sendFile=c,t.sendFileToRecompressor=function(t,e){c("https://recompressor.com","recompressor",t,e)},t.sendFileToVectorMagic=function(t,e){c("https://vectormagic.com",null,t,e)},t.sendFileToVectorizer=function(t,e){c("https://vectorizer.ai",null,t,e)},t.sendFileToPixianFaceSticker=function(t,e){c("https://pixian.ai/face-stickers","pixian-face-stickers",t,e)},t.sendFileToPixianBg=function(t,e){c("https://pixian.ai","pixian",t,e)},t.sendFileToClippingMagic=function(t,e){c("https://clippingmagic.com",null,t,e)},t.sendFileToPixspy=function(t,e){c("https://pixspy.com","pixspy",t,e)}}(M||(M={}));class Lt{constructor(){this.a11=1,this.a12=0,this.a13=0,this.a21=0,this.a22=1,this.a23=0,this.a31=0,this.a32=0,this.a33=1}static from(t){var e=new Lt;return e.set(t.a11,t.a21,t.a31,t.a12,t.a22,t.a32,t.a13,t.a23,t.a33),e}pretty(){return"\n["+this.a11.toFixed(3)+", "+this.a21.toFixed(3)+", "+this.a31.toFixed(3)+"]\n["+this.a12.toFixed(3)+", "+this.a22.toFixed(3)+", "+this.a32.toFixed(3)+"]\n["+this.a13.toExponential(3)+", "+this.a23.toExponential(3)+", "+this.a33.toFixed(3)+"]\n"}set(t,e,o,i,s,r,n,a,l){this.a11=t,this.a12=i,this.a13=n,this.a21=e,this.a22=s,this.a23=a,this.a31=o,this.a32=r,this.a33=l}timesEquals(t){this.set(this.a11*t.a11+this.a21*t.a12+this.a31*t.a13,this.a11*t.a21+this.a21*t.a22+this.a31*t.a23,this.a11*t.a31+this.a21*t.a32+this.a31*t.a33,this.a12*t.a11+this.a22*t.a12+this.a32*t.a13,this.a12*t.a21+this.a22*t.a22+this.a32*t.a23,this.a12*t.a31+this.a22*t.a32+this.a32*t.a33,this.a13*t.a11+this.a23*t.a12+this.a33*t.a13,this.a13*t.a21+this.a23*t.a22+this.a33*t.a23,this.a13*t.a31+this.a23*t.a32+this.a33*t.a33)}adjointSelf(){this.set(this.a22*this.a33-this.a23*this.a32,this.a23*this.a31-this.a21*this.a33,this.a21*this.a32-this.a22*this.a31,this.a13*this.a32-this.a12*this.a33,this.a11*this.a33-this.a13*this.a31,this.a12*this.a31-this.a11*this.a32,this.a12*this.a23-this.a13*this.a22,this.a13*this.a21-this.a11*this.a23,this.a11*this.a22-this.a12*this.a21)}normalize(){var t=1/this.a33;this.a11*=t,this.a12*=t,this.a13*=t,this.a21*=t,this.a22*=t,this.a23*=t,this.a31*=t,this.a32*=t,this.a33=1}apply(t,e){var o=t.x,i=t.y,s=this.a13*o+this.a23*i+this.a33;e.x=(this.a11*o+this.a21*i+this.a31)/s,e.y=(this.a12*o+this.a22*i+this.a32)/s}applyWithGuard(t,e){var o=t.x,i=t.y,s=this.a13*o+this.a23*i+this.a33;return 0!=s&&(e.x=(this.a11*o+this.a21*i+this.a31)/s,e.y=(this.a12*o+this.a22*i+this.a32)/s,!0)}applyToQuad(t,e){this.apply(t.p0,e.p0),this.apply(t.p1,e.p1),this.apply(t.p2,e.p2),this.apply(t.p3,e.p3)}setSquareToQuadrilateral(t,e,o,i,s,r,n,a){var l=t-o+s-n,c=e-i+r-a;if(0==l&&0==c)this.set(o-t,s-o,t,i-e,r-i,e,0,0,1);else{var p=o-s,u=n-s,h=i-r,d=a-r,g=p*d-u*h,m=(l*d-u*c)/g,f=(p*c-l*h)/g;this.set(o-t+m*o,n-t+f*n,t,i-e+m*i,a-e+f*a,e,m,f,1)}}setQuadrilateralToSquare(t,e,o,i,s,r,n,a){this.setSquareToQuadrilateral(t,e,o,i,s,r,n,a),this.adjointSelf()}setQuadrilateralToQuadrilateral(t,e){this.setQuadrilateralToQuadrilateralRaw(t.p0.x,t.p0.y,t.p1.x,t.p1.y,t.p2.x,t.p2.y,t.p3.x,t.p3.y,e.p0.x,e.p0.y,e.p1.x,e.p1.y,e.p2.x,e.p2.y,e.p3.x,e.p3.y)}setQuadrilateralToQuadrilateralRaw(t,e,o,i,s,r,n,a,l,c,p,u,h,d,g,m){Lt.dummy.setQuadrilateralToSquare(t,e,o,i,s,r,n,a),this.setSquareToQuadrilateral(l,c,p,u,h,d,g,m),this.timesEquals(Lt.dummy),this.normalize()}setRotationAbout(t,e){var o=e.x,i=e.y,s=Math.cos(t),r=Math.sin(t);this.set(s,-r,o*(1-s)+i*r,r,s,i*(1-s)-o*r,0,0,1)}}Lt.dummy=new Lt;class zt{constructor(t,e){this.p0=t,this.p1=e}lengthSqr(){return this.p0.distanceSqrTo(this.p1)}direction(){return this.p1.minus(this.p0)}interpolate(t){return this.p0.interpolate(this.p1,t)}snapTo(t){let e=R.clamp(t.minus(this.p0).dot(this.direction())/this.lengthSqr(),0,1),o=this.interpolate(e);return{pp:o,t:e,distance:o.distanceTo(t)}}distSqrTo(t){let e=R.clamp(t.minus(this.p0).dot(this.direction())/this.lengthSqr(),0,1),o=this.interpolate(e);return{pp:o,t:e,distanceSqr:o.distanceSqrTo(t)}}}class $t{constructor(t){this.points=t}head(){return this.points[0]}last(){return this.points[this.points.length-1]}bounds(){return Ft.fromPoints(this.points)}snapTo(t){var e=this.points.length;if(0==e)return null;if(1==e)return{pp:this.points[0].dup(),t:0,distance:this.points[0].distanceTo(t)};for(var o=null,i=new zt(null,null),s=0;s<e-1;s++){i.p0=this.points[s],i.p1=this.points[s+1];var r=i.snapTo(t);(null==o||r.distance<o.distance)&&(o=r)}return o}rotateAndOffsetY(t,e,o){const i=Math.sin(t),s=Math.cos(t);return new $t(this.points.map((t=>{var r=t.x-e.x,n=t.y-e.y;return new Rt(e.x+s*r-i*n,e.y+i*r+s*n+o)})))}nonEmpty(){return this.points.length>0}isEmpty(){return 0==this.points.length}}class Ut{constructor(t){this.loops=t}contains(t,e){for(var o=!1,i=0;i<this.loops.length;i++)o=this.loops[i].contains(t,e,o);return o}}class Gt{constructor(t){this.points=t}contains(t,e,o=!1){var i=o;const s=this.points.length;for(var r=0;r<s;r++){var n=this.points[r],a=this.points[(r+1)%s];(a.y<e&&n.y>=e||n.y<e&&a.y>=e)&&a.x+(e-a.y)/(n.y-a.y)*(n.x-a.x)<t&&(i=!i)}return i}}!function(t){t.nearest=new Rt(0,0);const e=new Rt(0,0),o=new Rt(0,0),i=new Rt(0,0),s=new Rt(0,0);let r,n,a;function l(l){t.distanceSqr=t.distance=Number.MAX_VALUE,e.set(r.p0).minusEquals(l);let p=2*o.dot(o)+e.dot(i),u=e.dot(o);if(c(r.p0,l,0),c(r.p2,l,1),et.solve(n,a,p,u))for(let t=0;t<et.numRoots;t++)et.roots[t]>0&&et.roots[t]<1&&(r.evalTo(et.roots[t],s),c(s,l,et.roots[t]));return t.distanceSqr}function c(e,o,i){let s=e.distanceSqrTo(o);s<t.distanceSqr&&(t.t=i,t.distanceSqr=s,t.nearest.set(e))}t.reset=function(t){r!=t&&(r=t,o.set(r.p1).minusEquals(r.p0),i.set(r.p2).minusEquals(r.p1).minusEquals(o),n=i.dot(i),a=3*o.dot(i))},t.distanceToSqr=l,t.distanceTo=function(e){return t.distance=Math.sqrt(l(e))}}(x||(x={}));class Nt{constructor(t,e,o){this.p0=t,this.p1=e,this.p2=o,this.mp=this.eval(.5),this.updateIsLine()}static line(t,e){return new Nt(t,t.interpolate(e,.5),e)}static throughMidpoint(t,e,o){const i=new Nt(t,e.dup(),o);return i.mp.set(e),i.updateP1FromMp(),i}length(){const t=this.p0.x-2*this.p1.x+this.p2.x,e=this.p0.y-2*this.p1.y+this.p2.y,o=2*this.p1.x-2*this.p0.x,i=2*this.p1.y-2*this.p0.y,s=4*(t*t+e*e),r=4*(t*o+e*i),n=o*o+i*i,a=2*Math.sqrt(s+r+n),l=Math.sqrt(s),c=2*s*l,p=2*Math.sqrt(n),u=r/l;return(c*a+l*r*(a-p)+(4*n*s-r*r)*Math.log((2*l+u+a)/(u+p)))/(4*c)}lengthBySampling(){let t=this.eval(0),e=0;for(let o=1;o<=100;o++){let i=this.eval(o/100);e+=t.distanceTo(i),t=i}return e}argMinDistanceSqrToPoint(t){x.reset(this),x.distanceToSqr(t)}dup(){const t=new Nt(this.p0.dup(),this.p1.dup(),this.p2.dup());return t.mp.set(this.mp),t.isLine=this.isLine,t}slice(t,e){let o=this.eval(t),i=this.eval(e),s=(t+e)/2,r=this.eval(s);return Nt.throughMidpoint(o,r,i)}reverse(){var t=new Nt(this.p2.dup(),this.p1.dup(),this.p0.dup());return t.mp.set(this.mp),t.isLine=this.isLine,t}set(t){this.p0.set(t.p0),this.p1.set(t.p1),this.p2.set(t.p2),this.mp.set(t.mp),this.isLine=t.isLine}step(t,e,o,i){this.p0.set(this.p2),this.p1.setXy(t,e),this.p2.setXy(o,i),this.mp=this.eval(.5)}eval(t){return this.evalTo(t,new Rt(0,0))}evalTo(t,e){return e.x=this.p2.x*t*t+2*this.p1.x*(1-t)*t+this.p0.x*(1-t)*(1-t),e.y=this.p2.y*t*t+2*this.p1.y*(1-t)*t+this.p0.y*(1-t)*(1-t),e}evalToNode(t,e){let o=this.eval(t);return{x:o.x,y:o.y,isCorner:e}}getPoint(t){switch(t){case 0:return this.p0;case 1:return this.mp;case 2:return this.p2;default:return}}updateIsLine(){var t=this.p2.minus(this.p0).ortho().normalize(),e=Math.abs(t.dot(this.p1.minus(this.p0)));this.isLine=e<.001&&t.length()>0}updateP1FromMp(){this.p1.x=2*this.mp.x-.5*(this.p0.x+this.p2.x),this.p1.y=2*this.mp.y-.5*(this.p0.y+this.p2.y),this.updateIsLine()}move(t,e,o){if(o){var i=this.getPoint(t),s=i.dup();o.move(0==t?2:0,e),i.set(s),this.move(t,e)}else{var r=0==t?this.p0:this.p2,n=0==t?this.p2:this.p0;switch(t){case 2:case 0:this.isLine?(r.set(e),this.p1.set(r.interpolate(n,.5))):(r.set(e),this.updateP1FromMp()),this.mp.set(this.eval(.5));break;case 1:this.mp.set(e),this.updateP1FromMp()}this.updateIsLine()}}}class Ht{constructor(t=[]){this.active=!1,this.beziers=t}reverse(){for(var t=[],e=this.beziers.length-1;e>=0;e--)t.push(this.beziers[e].reverse());return new Ht(t)}getFirstPoint(){return this.beziers[0].p0}getLastPoint(){return this.beziers[this.beziers.length-1].p2}isClosed(){return this.getFirstPoint()==this.getLastPoint()}reverseInPlace(){for(var t=this.reverse(),e=this.beziers.length,o=0;o<e;o++)this.beziers[o].set(t.beziers[o])}}class Vt{constructor(){this.polyBeziers=[]}static decode(t,e){var o,i;e.polyBeziers.length=0;try{if(t&&t.swords){var s=[];for(o=0;o<t.points.length;o++)s.push(Rt.from(t.points[o]));var r=t.swords;for(o=0;o<r.length;o++){var n=r[o],a=[];for(i=0;i<n.length;i++){var l=n[i];a.push(new Nt(s[l[0]],s[l[1]],s[l[2]]))}a.length>0&&e.polyBeziers.push(new Ht(a))}}}catch(t){}return e}encode(){var t=new Wt,e=[];function o(o){var i=e.indexOf(o);return i<0&&(e.push(o),t.points.push({x:o.x,y:o.y}),i=t.points.length-1),i}for(var i=0;i<this.polyBeziers.length;i++){var s=this.polyBeziers[i],r=[];t.swords.push(r);for(var n=0;n<s.beziers.length;n++){var a=s.beziers[n];r.push([o(a.p0),o(a.p1),o(a.p2)])}}return t}}class Wt{constructor(){this.points=[],this.swords=[]}}class Xt{constructor(t=0,e=0,o=0,i=0){this.top0=t,this.right0=e,this.bottom0=o,this.left0=i}static from(t){return new Xt(t.top0,t.right0,t.bottom0,t.left0)}dup(){return Xt.from(this)}unionWith(t){return this.left0=Math.min(this.left0,t.left0),this.top0=Math.min(this.top0,t.top0),this.right0=Math.max(this.right0,t.right0),this.bottom0=Math.max(this.bottom0,t.bottom0),this}centerX(){return(this.left0+this.right0)/2}centerY(){return(this.top0+this.bottom0)/2}width(){return this.right0-this.left0}height(){return this.bottom0-this.top0}area(){return this.width()*this.height()}isEmpty(){return 0==this.top0&&0==this.right0&&0==this.bottom0&&0==this.left0}clear(){this.top0=0,this.right0=0,this.bottom0=0,this.left0=0}equals(t){return null!=t&&this.top0==t.top0&&this.right0==t.right0&&this.bottom0==t.bottom0&&this.left0==t.left0}softEquals(t,e=.001){return Math.abs(this.top0-t.top0)<e&&Math.abs(this.right0-t.right0)<e&&Math.abs(this.bottom0-t.bottom0)<e&&Math.abs(this.left0-t.left0)<e}set(t,e,o,i){this.left0=t,this.top0=e,this.right0=o,this.bottom0=i}setFrom(t){this.top0=t.top0,this.right0=t.right0,this.bottom0=t.bottom0,this.left0=t.left0,this.normalize()}normalize(){var t;this.top0>this.bottom0&&(t=this.top0,this.top0=this.bottom0,this.bottom0=t),this.left0>this.right0&&(t=this.left0,this.left0=this.right0,this.right0=t)}rotate(t,e,o){var i=t*Math.PI/180,s=Math.round(Math.cos(i)),r=Math.round(Math.sin(i)),n=this.left0-e,a=this.top0-o,l=this.right0-e,c=this.bottom0-o,p=s*n+r*a+e,u=-r*n+s*a+o,h=s*l+r*c+e,d=-r*l+s*c+o;this.left0=Math.min(p,h),this.top0=Math.min(u,d),this.right0=Math.max(p,h),this.bottom0=Math.max(u,d)}y2x(){return this.width()/this.height()}}!function(t){t.BrushSize=20,t.MaxBrushDiameter=100,t.ClientMaskAlphaFloat=.5,t.MaxSmoothingLevel=5,t.MaxBlurLevel=6,t.MaxOffset=10,t.MaxMaxNumMegapixels=25,t.BrowserChromeUrl="https://www.google.com/chrome/",t.BrowserFirefoxUrl="https://www.mozilla.org/en-US/firefox/new/",t.BrowserSafariUrl="https://www.apple.com/safari/",t.BrowserMicrosoftEdgeUrl="https://www.microsoft.com/en-us/edge",t.DefaultMaxNumMegapixels=8,t.ThumbWidth=290,t.ThumbHeight=200,t.MaxOutputWidthOrHeight=20480,t.MaxOutputSize=33513471,t.MinDpi=1,t.MaxDpi=4e3,t.CropObjectSizePercentPadMedium=.1,t.CropObjectSizePercentPadSmall=.2,t.DefaultCropMode="CropUnconstrained",t.DefaultCropMarginUnits="CropMarginPercent",t.DefaultCropObjectSizeE="CropSizeLarge",t.DefaultCropAlignmentE="CropAlignmentMiddle",t.DefaultCropShadowsE="CropShadowsPad",t.DefaultCropAllowEnlarging=!1,t.DefaultCropFitToResult=!1,t.DefaultCropPaddingMils=50,t.DefaultCropPaddingPixels=25,t.DefaultAutoClip=!0,t.DefaultOneClickDownloadEnabled=!0,t.DefaultUseCornerDetection=!0,t.DefaultUseLocalBlur=!0,t.DefaultUseLocalSmoothing=!0,t.DefaultGlobalSmoothingLevel=1,t.DefaultGlobalBlurLevel=1,t.DefaultGlobalOffset=0,t.BulkDownloadModeSingle="BulkDownloadModeSingle",t.BulkDownloadModeZip="BulkDownloadModeZip",t.DefaultBlurModeE="BlurModeAuto",t.BlurModeFixed="BlurModeFixed",t.BlurModeAuto="BlurModeAuto",t.BlurModeLocal="BlurModeLocal",t.DefaultCastColor=16777215,t.DefaultColorCastForegroundProtection=4,t.DefaultWhiteBalanceGrayColor=16777215,t.DefaultOutputDpi=72,t.DefaultOutputColorSpaceE="ColorSpaceSrgb",t.DefaultOpaqueFileFormatE="OpaqueFileFormatJpeg",t.DefaultPngModeE="PngModeLossless",t.DefaultJpegModeE="JpegModeMoz",t.DefaultJpegQuality=75,t.JpegQualityMin=1,t.JpegQualityMax=100,t.CropPaddingMilsMax=350,t.CropPaddingPixelsMax=250,t.MaxBlurRadius=75,t.MaxMirrorShadowHeight=800,t.MaxMirrorShadowOffset=400,t.AutoLevelsMaxNumSamples=3e4,t.AutoLevelsMaxSetting=10,t.AutoLevelsPercentile=.05,t.AutoLevelsNumBuckets=1e3,t.ImagesPerZipfile=50,t.ImagesPerCsvfile=500,t.ImagesPerClipBatch=500}(D||(D={}));class Yt{constructor(t){if(this.store={},t)for(var e in t){let o=e.toString();t.hasOwnProperty(o)&&this.put(a.cast(o),t[o])}}static from(t){for(var e=new Yt,o=0;o<t.length;o++){var i=t[o];if(2==i.length){var s=i[0],r=i[1];e.put(s,r)}}return e}getOrElse(t,e){return this.contains(t)?this.get(t):e}get(t){return this.store[t.toString()]}put(t,e){return this.store[t.toString()]=e}contains(t){return this.store.hasOwnProperty(t.toString())}remove(t){return!!this.contains(t)&&(delete this.store[t.toString()],!0)}clear(){this.store={}}}class qt{constructor(t){if(this.store={},this.size_=0,t)for(var e=0;e<t.length;e++)this.add(t[e])}size(){return this.size_}add(t){return!this.contains(t)&&(this.size_++,this.store[t.toString()]=!0)}addAll(t){let e=!0;for(let o=0;o<t.length;o++)e=e&&this.add(t[o]);return e}remove(t){return!!this.contains(t)&&(delete this.store[t.toString()],this.size_--,!0)}contains(t){return this.store.hasOwnProperty(t.toString())}}T||(T={}),function(t){const e=[],o=new Yt;t.tic=function(){e.push(Date.now())},t.toc=function(t){Date.now(),e.pop()},t.ping=function(t){var e=Date.now();if(o.contains(t))o.get(t);o.put(t,e)}}(_||(_={})),function(t){t.UseScalpelNeighborhoodUpdate=!0,t.TransparentColor="rgba(255,255,255,0.000000)",t.MaskVersion=2,t.LoupeRadius=120,t.ScreenshotMode=window.Globals.isDev&&!1,t.IncludeOriginal=!1,t.LightProgress="light-progress",t.LightConnecting="light-connecting",t.LightUpdating="light-updating",t.LightUpdated="light-updated",t.SaveSave="Save",t.SaveSaving="Saving...",t.SaveSaved="Saved",t.JPEG="JPEG",t.PNG="PNG",t.MaxBezierSetLengthForDrawingWhilePanningOrZooming=5e3,t.MaxBezierSetLengthForDrawingWhileStroking=1e4,t.Noop="Noop",t.SetTool="SetTool",t.SetGlobal="SetGlobal",t.SetUserMask="SetUserMask",t.SetEngineMask="SetEngineMask",t.SetClientRgbHistogram="SetClientRgbHistogram",t.ServerRgbHistogramResponse="ServerRgbHistogramResponse",t.RequestFullServerMask="RequestFullServerMask",t.GenerateResult="GenerateResult",t.DrawSquare="DrawSquare",t.DrawLine="DrawLine",t.Meta="Meta",t.ImageCategory="ImageCategory",t.ServerImageCategoriesKey="ServerImageCategories",t.StatusCheck="StatusCheck",t.EngineInitializing="EngineInitializing",t.EngineInitialized="EngineInitialized",t.Panic="Panic",t.Message="Message",t.SaveServerMask="SaveServerMask",t.SetSwords="SetSwords",t.SetActiveSwords="SetActiveSwords",t.SetSwordIntersections="SetSwordIntersections",t.SetDetectedCorners="SetDetectedCorners",t.SetClientShadows="SetClientShadows",t.ColorCastEstimate="ColorCastEstimate",t.WhiteBalanceEstimate="WhiteBalanceEstimate",t.DirtiesDrawCommandsSet=new qt([t.SetGlobal,t.SetUserMask,t.DrawSquare,t.DrawLine,t.SetSwords,t.SetClientShadows]),t.Skip="Skip",t.Exiting="Exiting",t.Exit="Exit",t.Error="Error",t.MaybeSaved="MaybeSaved",t.DocumentReady="DocumentReady",t.Booted="Booted",t.SavedAndResultReady="SavedAndResultReady",t.SavedMaskUpdated="SavedMaskUpdated",t.StickySettingsUpdated="StickySettingsUpdated",t.ServerMaskReset="ServerMaskReset",t.ServerMask="ServerMask",t.ServerMaskDone="ServerMaskDone",t.BezierSet="BezierSet",t.BezierSetDone="BezierSetDone",t.UpdateComplete="UpdateComplete",t.ResultReady="ResultReady",t.ResultPending="ResultPending",t.BoundingRect="BoundingRect",t.Highlighting="Highlighting",t.UpdateImageSpec="UpdateImageSpec",t.CropUnconstrained="CropUnconstrained",t.CropLockedAspectRatio="CropLockedAspectRatio",t.CropTargetSize="CropTargetSize",t.CropMarginPixels="CropMarginPixels",t.CropMarginPercent="CropMarginPercent",t.CropSizeSmall="CropSizeSmall",t.CropSizeMedium="CropSizeMedium",t.CropSizeLarge="CropSizeLarge",t.CropAlignmentTop="CropAlignmentTop",t.CropAlignmentMiddle="CropAlignmentMiddle",t.CropAlignmentBottom="CropAlignmentBottom",t.CropShadowsIgnore="CropShadowsIgnore",t.CropShadowsPad="CropShadowsPad",t.CropShadowsTight="CropShadowsTight",t.ColorSpaceSrgb="ColorSpaceSrgb",t.ColorSpaceAdobeRgb="ColorSpaceAdobeRgb",t.ColorSpaceAppleRgb="ColorSpaceAppleRgb",t.ColorSpaceColorMatchRgb="ColorSpaceColorMatchRgb",t.OpaqueFileFormatJpeg="OpaqueFileFormatJpeg",t.OpaqueFileFormatPng="OpaqueFileFormatPng",t.JpegModeNone="JpegModeNone",t.JpegModeMoz="JpegModeMoz",t.PngModeNone="PngModeNone",t.PngModeLossless="PngModeLossless",t.PngModeLossy="PngModeLossy",t.ViewPanesSplit="ViewPanesBoth",t.ViewPanesSingle="ViewPanesMarks",t.PricingMonthly="PricingMonthly",t.PricingAnnual="PricingAnnual",t.EllipseShadowFactoryDefaults={strength:.5,core:.25},t.DropShadowFactoryDefaults={enabled:!1,cropEnabled:!1,opacity:75,blurRadius:25,offsetX:30,offsetY:30},t.MirrorShadowFactoryDefaults={enabled:!1,opacity:50,height:200,offsetY:0,mutated:!1},t.PerspectiveShadowFactoryDefaults={enabled:!1,opacity:25,opacityScale:50,blurRadius:10,blurRadiusScale:400,mutated:!1},t.FactoryDefaults={autoLevels:a.cast(!1),brushSize:t.BrushSize,globalSmoothingLevel:t.DefaultGlobalSmoothingLevel,globalBlurLevel:t.DefaultGlobalBlurLevel,globalOffset:t.DefaultGlobalOffset,rotateAngleDeg:0,straightenAngleDeg:0,brightness:0,shadows:0,highlights:0,temperature:0,saturation:0,removeColorCast:!1,castColor:t.DefaultCastColor,colorCastForegroundProtection:t.DefaultColorCastForegroundProtection,whiteBalanceEnabled:!1,whiteBalanceGrayColor:t.DefaultWhiteBalanceGrayColor,useBrush:!0,useCornerDetection:t.DefaultUseCornerDetection,blurMode:t.DefaultBlurModeE,useLocalBlur:t.DefaultUseLocalBlur,useLocalSmoothing:t.DefaultUseLocalSmoothing,backgroundColor:null,cropMode:t.DefaultCropMode,cropMarginUnits:t.DefaultCropMarginUnits,cropObjectSize:t.DefaultCropObjectSizeE,cropVerticalAlignment:t.DefaultCropAlignmentE,cropShadows:t.DefaultCropShadowsE,cropAspectRatio:null,cropTargetSize:null,cropAllowEnlarging:t.DefaultCropAllowEnlarging,cropFitToResult:t.DefaultCropFitToResult,cropPaddingMils:t.DefaultCropPaddingMils,cropPaddingPixels:t.DefaultCropPaddingPixels,cropRect_o:null,outputDpi:t.DefaultOutputDpi,outputColorSpace:t.DefaultOutputColorSpaceE,jpegQuality:t.DefaultJpegQuality,pngMode:t.DefaultPngModeE,jpegMode:t.DefaultJpegModeE,opaqueFileFormat:t.DefaultOpaqueFileFormatE,maxNumMegapixels:t.DefaultMaxNumMegapixels,preCropEnabled:!1,preCropLockAspectRatio:!1,onlyUsePhotoMode:!0,autoClip:t.DefaultAutoClip,allowLogoMode:!0,allowScanMode:!0,autoHair:!0,oneClickDownloadEnabled:t.DefaultOneClickDownloadEnabled,viewPanesMode:t.ViewPanesSplit,ellipseShadow:t.EllipseShadowFactoryDefaults,dropShadow:t.DropShadowFactoryDefaults,mirrorShadow:t.MirrorShadowFactoryDefaults,perspectiveShadow:t.PerspectiveShadowFactoryDefaults},t.AspectRatios=[{w:1,h:1},{w:5,h:4},{w:4,h:3},{w:3,h:2},{w:1.618,h:1},{w:16,h:9}],t.TargetSizes=[{w:640,h:360},{w:851,h:315},{w:1920,h:1080},{w:2048,h:2048},{w:3e3,h:3e3}],t.LineOuterWidth=3.5,t.LineInnerWidth=2,t.isBulkLike=function(){return(window.Globals.Bulk.isIframe||window.Globals.Bulk.isApi)&&!window.Globals.Bulk.isApiSingle},t.isRegularAppMode=function(){let t=window.Globals.Bulk;return!t.isIframe&&!t.isApi},t.isBulkAppMode=function(){let t=window.Globals.Bulk;return t.isIframe&&!t.isApi},t.isBulkOrApi=function(){return window.Globals.Bulk.isIframe||window.Globals.Bulk.isApi}}(D||(D={})),function(t){let e,o,i,s,r,n,a,l,c,p,u,h,d,g,m,f,S,w,C,y,b,v,A,k,M,x;t.AppContent=t.id("AppContent"),t.AppOuterWrapper=t.id("AppOuterWrapper"),t.AppView=t.id("AppView"),t.AppWrapper=t.id("AppWrapper"),t.BulkLoadingErrorMessage=t.id("BulkLoadingErrorMessage"),t.BulkStatus=t.id("BulkStatus"),t.GuideLightbox=t.id("GuideLightbox"),t.GuideLightboxOuter=t.id("GuideLightboxOuter"),t.ImageColorCorrectionNotification=t.id("ImageColorCorrectionNotification"),t.ImageResizeNotification=t.id("ImageResizeNotification"),t.StickySettingsLightbox=t.id("StickySettingsLightbox"),t.SubappLightbox=t.id("subapp-lightbox"),t.TopAnimationImage=t.id("TopAnimationImage"),t.TutorialLightboxOuter=t.id("TutorialLightboxOuter"),t.UnpaidApiSubscription=t.id("UnpaidApiSubscription"),t.active=t.c("active"),t.ajax_loading=t.c("ajax-loading"),t.allow_auto_hair_checkbox=t.c("allow_auto_hair_checkbox"),t.allow_logo_mode_checkbox=t.c("allow_logo_mode_checkbox"),t.allow_scan_mode_checkbox=t.c("allow_scan_mode_checkbox"),t.app_starter=t.c("app_starter"),t.arrow=t.c("arrow"),t.autoClipDisabled=t.c("autoClipDisabled"),t.autoClipEnabled=t.c("autoClipEnabled"),t.bttn=t.c("bttn"),t.bttn_dark=t.c("bttn_dark"),t.bttn_icon_left=t.c("bttn_icon_left"),t.bttn_icon_right=t.c("bttn_icon_right"),t.bttn_red=t.c("bttn_red"),t.bttn_short=t.c("bttn_short"),t.bttn_white=t.c("bttn_white"),t.bttn_wire=t.c("bttn_wire"),t.bttn_wire_white=t.c("bttn_wire_white"),t.bulk_download_button=t.c("bulk_download_button"),t.bulk_download_button_csv=t.c("bulk_download_button_csv"),t.bulk_download_button_repeat=t.c("bulk_download_button_repeat"),t.bulk_download_button_zip=t.c("bulk_download_button_zip"),t.bulk_status_display=t.c("bulk_status_display"),t.cancel_upload=t.c("cancel_upload"),t.cannot_run_app=t.c("cannot_run_app"),t.disabled=t.c("disabled"),t.drop_ready=t.c("drop_ready"),t.dropdown_auto=t.c("dropdown_auto"),t.enable_auto_clip_checkbox=t.c("enable_auto_clip_checkbox"),t.enable_one_click_download_checkbox=t.c("enable_one_click_download_checkbox"),t.exclusive_group=t.c("exclusive-group"),t.exit_app=t.c("exit_app"),t.force_exit=t.c("force_exit"),t.guide_next_button=t.c("guide_next_button"),t.hide_bottom_toolbar=t.c("hide_bottom_toolbar"),t.modern_menu=t.c("modern_menu"),t.one_click_download_enabled=t.c("one_click_download_enabled"),t.only_use_photo_mode_checkbox=t.c("only_use_photo_mode_checkbox"),t.popover=t.c("popover"),t.popover_button=t.c("popover-button"),t.popover_dismiss=t.c("popover_dismiss"),t.popover_toolbar_no_auto_dismiss=t.c("popover_toolbar_no_auto_dismiss"),t.pre_crop_enabled_checkbox=t.c("pre_crop_enabled_checkbox"),t.returnUrlForm=t.c("returnUrlForm"),t.sticky_outline_active=t.c("sticky_outline_active"),t.sticky_settings=t.c("sticky_settings"),t.sticky_settings_close=t.c("sticky_settings_close"),t.subapp_sidebar=t.c("subapp_sidebar"),t.tabLink=t.c("tabLink"),t.video_green_lightbox=t.id("video_green_lightbox"),t.viewport_vertical=t.c("viewport_vertical"),function(e){let o,i;!function(e){let o,i;!function(e){let o;e.Dialog=t.id("Bulk-Download-Dialog-Dialog"),e.DownloadLink=t.id("Bulk-Download-Dialog-DownloadLink"),e.Empty=t.id("Bulk-Download-Dialog-Empty"),e.Error=t.id("Bulk-Download-Dialog-Error"),e.ErrorMsg=t.id("Bulk-Download-Dialog-ErrorMsg"),e.Progress=t.id("Bulk-Download-Dialog-Progress"),e.Ready=t.id("Bulk-Download-Dialog-Ready"),e.Single=t.id("Bulk-Download-Dialog-Single"),e.SingleDownloadLink=t.id("Bulk-Download-Dialog-SingleDownloadLink"),e.Waiting=t.id("Bulk-Download-Dialog-Waiting"),e.emailSent=t.c("Bulk-Download-Dialog-emailSent"),e.state=t.c("Bulk-Download-Dialog-state"),e.useCsv=t.c("Bulk-Download-Dialog-useCsv"),e.useZip=t.c("Bulk-Download-Dialog-useZip"),function(e){e.copy_to_clipboard=t.c("Bulk-Download-Dialog-CopyBtn-copy_to_clipboard"),e.show_copied=t.c("Bulk-Download-Dialog-CopyBtn-show_copied"),e.show_copy=t.c("Bulk-Download-Dialog-CopyBtn-show_copy"),e.show_copying=t.c("Bulk-Download-Dialog-CopyBtn-show_copying"),e.show_failed=t.c("Bulk-Download-Dialog-CopyBtn-show_failed")}(o||(o={})),e.CopyBtn=o}(o=e.Dialog||(e.Dialog={})),function(e){e.csv=t.c("Bulk-Download-Mode-csv"),e.group=t.c("Bulk-Download-Mode-group"),e.single=t.c("Bulk-Download-Mode-single"),e.zip=t.c("Bulk-Download-Mode-zip")}(i=e.Mode||(e.Mode={}))}(o=e.Download||(e.Download={})),function(e){e.Dialog=t.id("Bulk-Upload-Dialog"),e.DialogBody=t.id("Bulk-Upload-DialogBody"),e.StartClippingButton=t.id("Bulk-Upload-StartClippingButton")}(i=e.Upload||(e.Upload={}))}(e=t.Bulk||(t.Bulk={})),function(e){let o,i,s,r,n,a,l,c,p,u,h,d,g,m,f,S;e.dropdown_open=t.c("CmApp-dropdown_open"),e.tool_popover_content=t.c("CmApp-tool_popover_content"),function(e){e.OriginalButton=t.id("CmApp-BackgroundApp-OriginalButton"),e.Sidebar=t.id("CmApp-BackgroundApp-Sidebar"),e.Tab=t.id("CmApp-BackgroundApp-Tab"),e.close_button=t.c("CmApp-BackgroundApp-close_button"),e.reset_button=t.c("CmApp-BackgroundApp-reset_button")}(o=e.BackgroundApp||(e.BackgroundApp={})),function(e){let o;e.ColorPicker=t.id("color-picker-ui"),e.ColorPickerPopover=t.id("color-picker-ui-popover"),e.CurrentColor=t.id("CmApp-BgColor-CurrentColor"),e.Custom=t.id("background-color-swatch-button-custom"),e.in_bg_app=t.c("CmApp-BgColor-in_bg_app"),e.in_popover=t.c("CmApp-BgColor-in_popover"),e.swatch=t.c("swatch"),function(e){e.Button=t.id("CmApp-BgColor-Popover-Button"),e.Popover=t.id("CmApp-BgColor-Popover-Popover")}(o||(o={})),e.Popover=o}(i=e.BgColor||(e.BgColor={})),function(e){let o,i;e.brush_size_button=t.c("CmApp-Brush-brush_size_button"),function(e){e.Button=t.id("CmApp-Brush-Popover-Button"),e.Popover=t.id("CmApp-Brush-Popover-Popover")}(o||(o={})),e.Popover=o,function(e){e.container=t.c("CmApp-Brush-Size-container"),e.decrease=t.c("CmApp-Brush-Size-decrease"),e.display=t.c("CmApp-Brush-Size-display"),e.increase=t.c("CmApp-Brush-Size-increase"),e.reset=t.c("CmApp-Brush-Size-reset")}(i||(i={})),e.Size=i}(s=e.Brush||(e.Brush={})),function(e){e.disableInLogoMode=t.c("CmApp-Cat-disableInLogoMode"),e.disableInScanMode=t.c("CmApp-Cat-disableInScanMode"),e.isLogoMode=t.c("CmApp-Cat-isLogoMode"),e.isPhotoMode=t.c("CmApp-Cat-isPhotoMode"),e.isScanMode=t.c("CmApp-Cat-isScanMode"),e.logoMode=t.c("CmApp-Cat-logoMode"),e.photoMode=t.c("CmApp-Cat-photoMode"),e.scanMode=t.c("CmApp-Cat-scanMode")}(r=e.Cat||(e.Cat={})),function(e){let o,i,s,r;e.OriginalButton=t.id("CmApp-ColorsApp-OriginalButton"),e.Sidebar=t.id("CmApp-ColorsApp-Sidebar"),e.Tab=t.id("CmApp-ColorsApp-Tab"),e.close_button=t.c("CmApp-ColorsApp-close_button"),e.reset_button=t.c("CmApp-ColorsApp-reset_button"),function(e){let o;e.RemovalEnabled=t.id("CmApp-ColorsApp-ColorCast-RemovalEnabled"),e.Swatch=t.id("CmApp-ColorsApp-ColorCast-Swatch"),e.controls=t.c("CmApp-ColorsApp-ColorCast-controls"),function(e){e.container=t.c("CmApp-ColorsApp-ColorCast-ForegroundProtection-container"),e.decrease=t.c("CmApp-ColorsApp-ColorCast-ForegroundProtection-decrease"),e.display=t.c("CmApp-ColorsApp-ColorCast-ForegroundProtection-display"),e.increase=t.c("CmApp-ColorsApp-ColorCast-ForegroundProtection-increase"),e.reset=t.c("CmApp-ColorsApp-ColorCast-ForegroundProtection-reset")}(o||(o={})),e.ForegroundProtection=o}(o=e.ColorCast||(e.ColorCast={})),function(e){let o,i,s,r,n;e.auto=t.c("CmApp-ColorsApp-ColorLevels-auto"),e.reset=t.c("CmApp-ColorsApp-ColorLevels-reset"),function(e){e.container=t.c("CmApp-ColorsApp-ColorLevels-brightness-container"),e.decrease=t.c("CmApp-ColorsApp-ColorLevels-brightness-decrease"),e.display=t.c("CmApp-ColorsApp-ColorLevels-brightness-display"),e.increase=t.c("CmApp-ColorsApp-ColorLevels-brightness-increase"),e.reset=t.c("CmApp-ColorsApp-ColorLevels-brightness-reset")}(o||(o={})),e.brightness=o,function(e){e.container=t.c("CmApp-ColorsApp-ColorLevels-highlights-container"),e.decrease=t.c("CmApp-ColorsApp-ColorLevels-highlights-decrease"),e.display=t.c("CmApp-ColorsApp-ColorLevels-highlights-display"),e.increase=t.c("CmApp-ColorsApp-ColorLevels-highlights-increase"),e.reset=t.c("CmApp-ColorsApp-ColorLevels-highlights-reset")}(i||(i={})),e.highlights=i,function(e){e.container=t.c("CmApp-ColorsApp-ColorLevels-saturation-container"),e.decrease=t.c("CmApp-ColorsApp-ColorLevels-saturation-decrease"),e.display=t.c("CmApp-ColorsApp-ColorLevels-saturation-display"),e.increase=t.c("CmApp-ColorsApp-ColorLevels-saturation-increase"),e.reset=t.c("CmApp-ColorsApp-ColorLevels-saturation-reset")}(s||(s={})),e.saturation=s,function(e){e.container=t.c("CmApp-ColorsApp-ColorLevels-shadows-container"),e.decrease=t.c("CmApp-ColorsApp-ColorLevels-shadows-decrease"),e.display=t.c("CmApp-ColorsApp-ColorLevels-shadows-display"),e.increase=t.c("CmApp-ColorsApp-ColorLevels-shadows-increase"),e.reset=t.c("CmApp-ColorsApp-ColorLevels-shadows-reset")}(r||(r={})),e.shadows=r,function(e){e.container=t.c("CmApp-ColorsApp-ColorLevels-temperature-container"),e.decrease=t.c("CmApp-ColorsApp-ColorLevels-temperature-decrease"),e.display=t.c("CmApp-ColorsApp-ColorLevels-temperature-display"),e.increase=t.c("CmApp-ColorsApp-ColorLevels-temperature-increase"),e.reset=t.c("CmApp-ColorsApp-ColorLevels-temperature-reset"),e.swatch=t.c("CmApp-ColorsApp-ColorLevels-temperature-swatch")}(n||(n={})),e.temperature=n}(i=e.ColorLevels||(e.ColorLevels={})),function(e){e.AdobeRgb=t.c("CmApp-ColorsApp-ColorSpace-AdobeRgb"),e.AppleRgb=t.c("CmApp-ColorsApp-ColorSpace-AppleRgb"),e.ColorMatchRgb=t.c("CmApp-ColorsApp-ColorSpace-ColorMatchRgb"),e.SRgb=t.c("CmApp-ColorsApp-ColorSpace-SRgb"),e.button=t.c("CmApp-ColorsApp-ColorSpace-button"),e.display=t.c("CmApp-ColorsApp-ColorSpace-display")}(s=e.ColorSpace||(e.ColorSpace={})),function(e){e.Enabled=t.id("CmApp-ColorsApp-WhiteBalance-Enabled"),e.Swatch=t.id("CmApp-ColorsApp-WhiteBalance-Swatch"),e.controls=t.c("CmApp-ColorsApp-WhiteBalance-controls")}(r=e.WhiteBalance||(e.WhiteBalance={}))}(n=e.ColorsApp||(e.ColorsApp={})),function(e){let o,i,s,r,n,a,l,c,p,u,h,d,g;e.FitToResultButton=t.id("CmApp-CropApp-FitToResultButton"),e.Sidebar=t.id("CmApp-CropApp-Sidebar"),e.Tab=t.id("CmApp-CropApp-Tab"),e.allow_enlarging_result=t.c("CmApp-CropApp-allow_enlarging_result"),e.close_button=t.c("CmApp-CropApp-close_button"),e.fit_to_original_btn=t.c("CmApp-CropApp-fit_to_original_btn"),e.fit_to_result_comment=t.c("CmApp-CropApp-fit_to_result_comment"),e.fit_to_result_controls=t.c("CmApp-CropApp-fit_to_result_controls"),e.locked_aspect_ratio_display=t.c("CmApp-CropApp-locked_aspect_ratio_display"),e.output_size_display=t.c("CmApp-CropApp-output_size_display"),e.reset_button=t.c("CmApp-CropApp-reset_button"),e.target_size_display=t.c("CmApp-CropApp-target_size_display"),function(e){e.H=t.id("CmApp-CropApp-AspectRatio-H"),e.HFg=t.id("CmApp-CropApp-AspectRatio-HFg"),e.Lightbox=t.id("CmApp-CropApp-AspectRatio-Lightbox"),e.List=t.id("CmApp-CropApp-AspectRatio-List"),e.OkButton=t.id("CmApp-CropApp-AspectRatio-OkButton"),e.W=t.id("CmApp-CropApp-AspectRatio-W"),e.WFg=t.id("CmApp-CropApp-AspectRatio-WFg")}(o=e.AspectRatio||(e.AspectRatio={})),function(e){e.container=t.c("CmApp-CropApp-Dpi-container"),e.decrease=t.c("CmApp-CropApp-Dpi-decrease"),e.display=t.c("CmApp-CropApp-Dpi-display"),e.increase=t.c("CmApp-CropApp-Dpi-increase"),e.reset=t.c("CmApp-CropApp-Dpi-reset")}(i||(i={})),e.Dpi=i,function(e){e.preset300=t.c("CmApp-CropApp-DpiPresets-preset300"),e.preset72=t.c("CmApp-CropApp-DpiPresets-preset72"),e.preset96=t.c("CmApp-CropApp-DpiPresets-preset96")}(s=e.DpiPresets||(e.DpiPresets={})),function(e){e.Percent=t.c("CmApp-CropApp-MarginUnits-Percent"),e.Pixels=t.c("CmApp-CropApp-MarginUnits-Pixels"),e.group=t.c("CmApp-CropApp-MarginUnits-group")}(r=e.MarginUnits||(e.MarginUnits={})),function(e){e.LockedAspectRatio=t.c("CmApp-CropApp-Mode-LockedAspectRatio"),e.TargetSize=t.c("CmApp-CropApp-Mode-TargetSize"),e.Unconstrained=t.c("CmApp-CropApp-Mode-Unconstrained"),e.group=t.c("CmApp-CropApp-Mode-group")}(n=e.Mode||(e.Mode={})),function(e){e.Large=t.c("CmApp-CropApp-ObjectSize-Large"),e.Medium=t.c("CmApp-CropApp-ObjectSize-Medium"),e.Small=t.c("CmApp-CropApp-ObjectSize-Small"),e.group=t.c("CmApp-CropApp-ObjectSize-group")}(a=e.ObjectSize||(e.ObjectSize={})),function(e){e.container=t.c("CmApp-CropApp-PaddingPercent-container"),e.decrease=t.c("CmApp-CropApp-PaddingPercent-decrease"),e.display=t.c("CmApp-CropApp-PaddingPercent-display"),e.increase=t.c("CmApp-CropApp-PaddingPercent-increase"),e.reset=t.c("CmApp-CropApp-PaddingPercent-reset")}(l||(l={})),e.PaddingPercent=l,function(e){e.container=t.c("CmApp-CropApp-PaddingPixels-container"),e.decrease=t.c("CmApp-CropApp-PaddingPixels-decrease"),e.display=t.c("CmApp-CropApp-PaddingPixels-display"),e.increase=t.c("CmApp-CropApp-PaddingPixels-increase"),e.reset=t.c("CmApp-CropApp-PaddingPixels-reset")}(c||(c={})),e.PaddingPixels=c,function(e){e.container=t.c("CmApp-CropApp-RotateSpinner-container"),e.decrease=t.c("CmApp-CropApp-RotateSpinner-decrease"),e.display=t.c("CmApp-CropApp-RotateSpinner-display"),e.increase=t.c("CmApp-CropApp-RotateSpinner-increase"),e.reset=t.c("CmApp-CropApp-RotateSpinner-reset")}(p||(p={})),e.RotateSpinner=p,function(e){e.Ignore=t.c("CmApp-CropApp-Shadows-Ignore"),e.Pad=t.c("CmApp-CropApp-Shadows-Pad"),e.Tight=t.c("CmApp-CropApp-Shadows-Tight"),e.group=t.c("CmApp-CropApp-Shadows-group")}(u=e.Shadows||(e.Shadows={})),function(e){e.container=t.c("CmApp-CropApp-StraightenSpinner-container"),e.decrease=t.c("CmApp-CropApp-StraightenSpinner-decrease"),e.display=t.c("CmApp-CropApp-StraightenSpinner-display"),e.increase=t.c("CmApp-CropApp-StraightenSpinner-increase"),e.reset=t.c("CmApp-CropApp-StraightenSpinner-reset")}(h||(h={})),e.StraightenSpinner=h,function(e){e.H=t.id("CmApp-CropApp-TargetSize-H"),e.HFg=t.id("CmApp-CropApp-TargetSize-HFg"),e.Lightbox=t.id("CmApp-CropApp-TargetSize-Lightbox"),e.List=t.id("CmApp-CropApp-TargetSize-List"),e.OkButton=t.id("CmApp-CropApp-TargetSize-OkButton"),e.W=t.id("CmApp-CropApp-TargetSize-W"),e.WFg=t.id("CmApp-CropApp-TargetSize-WFg")}(d=e.TargetSize||(e.TargetSize={})),function(e){e.Bottom=t.c("CmApp-CropApp-VerticalAlignment-Bottom"),e.Middle=t.c("CmApp-CropApp-VerticalAlignment-Middle"),e.Top=t.c("CmApp-CropApp-VerticalAlignment-Top"),e.group=t.c("CmApp-CropApp-VerticalAlignment-group")}(g=e.VerticalAlignment||(e.VerticalAlignment={}))}(a=e.CropApp||(e.CropApp={})),function(e){e.viewport_set=t.c("CmApp-Dev-viewport_set")}(l=e.Dev||(e.Dev={})),function(e){let o;e.revert=t.c("CmApp-Ecommerce-revert"),e.set=t.c("CmApp-Ecommerce-set"),function(e){e.Button=t.id("CmApp-Ecommerce-Popover-Button"),e.Popover=t.id("CmApp-Ecommerce-Popover-Popover")}(o||(o={})),e.Popover=o}(c=e.Ecommerce||(e.Ecommerce={})),function(e){let o,i,s,r;e.BlurModeAuto=t.id("CmApp-Edges-BlurModeAuto"),e.BlurModeFixed=t.id("CmApp-Edges-BlurModeFixed"),e.BlurModeLocal=t.id("CmApp-Edges-BlurModeLocal"),e.blur_mode=t.c("CmApp-Edges-blur_mode"),function(e){e.container=t.c("CmApp-Edges-FeatheringRadius-container"),e.decrease=t.c("CmApp-Edges-FeatheringRadius-decrease"),e.display=t.c("CmApp-Edges-FeatheringRadius-display"),e.increase=t.c("CmApp-Edges-FeatheringRadius-increase"),e.reset=t.c("CmApp-Edges-FeatheringRadius-reset")}(o||(o={})),e.FeatheringRadius=o,function(e){e.container=t.c("CmApp-Edges-Offset-container"),e.decrease=t.c("CmApp-Edges-Offset-decrease"),e.display=t.c("CmApp-Edges-Offset-display"),e.increase=t.c("CmApp-Edges-Offset-increase"),e.reset=t.c("CmApp-Edges-Offset-reset")}(i||(i={})),e.Offset=i,function(e){e.Button=t.id("CmApp-Edges-Popover-Button"),e.Popover=t.id("CmApp-Edges-Popover-Popover")}(s||(s={})),e.Popover=s,function(e){e.container=t.c("CmApp-Edges-Smoothing-container"),e.decrease=t.c("CmApp-Edges-Smoothing-decrease"),e.display=t.c("CmApp-Edges-Smoothing-display"),e.increase=t.c("CmApp-Edges-Smoothing-increase"),e.reset=t.c("CmApp-Edges-Smoothing-reset")}(r||(r={})),e.Smoothing=r}(p=e.Edges||(e.Edges={})),function(e){let o;e.hovered=t.c("CmApp-Hair-hovered"),function(e){e.Button=t.id("CmApp-Hair-Popover-Button"),e.Popover=t.id("CmApp-Hair-Popover-Popover")}(o||(o={})),e.Popover=o}(u=e.Hair||(e.Hair={})),function(e){e.Button=t.id("CmApp-Help-Button"),e.Popover=t.id("CmApp-Help-Popover"),e.button=t.c("CmApp-Help-button"),e.scroll_crop=t.c("CmApp-Help-scroll_crop")}(h=e.Help||(e.Help={})),function(e){let o,i;!function(e){e.Button=t.id("CmApp-Review-Popover-Button"),e.Popover=t.id("CmApp-Review-Popover-Popover")}(o||(o={})),e.Popover=o,function(e){e.backward=t.c("CmApp-Review-Spinner-backward"),e.forward=t.c("CmApp-Review-Spinner-forward")}(i=e.Spinner||(e.Spinner={}))}(d=e.Review||(e.Review={})),function(e){let o,i,s,r;e.PreviewButton=t.id("CmApp-ShadowApp-PreviewButton"),e.ResetButton=t.id("CmApp-ShadowApp-ResetButton"),e.Sidebar=t.id("CmApp-ShadowApp-Sidebar"),e.Tab=t.id("CmApp-ShadowApp-Tab"),e.TabLink=t.id("CmApp-ShadowApp-TabLink"),e.close_button=t.c("CmApp-ShadowApp-close_button"),function(e){let o,i,s;e.CropEnabled=t.id("CmApp-ShadowApp-DropShadow-CropEnabled"),e.Enabled=t.id("CmApp-ShadowApp-DropShadow-Enabled"),e.UpdatingIndicator=t.id("CmApp-ShadowApp-DropShadow-UpdatingIndicator"),e.controls=t.c("CmApp-ShadowApp-DropShadow-controls"),e.crop_enabled=t.c("CmApp-ShadowApp-DropShadow-crop_enabled"),e.crop_enabled_display=t.c("CmApp-ShadowApp-DropShadow-crop_enabled_display"),e.offset_display=t.c("CmApp-ShadowApp-DropShadow-offset_display"),e.offset_down=t.c("CmApp-ShadowApp-DropShadow-offset_down"),e.offset_down_left=t.c("CmApp-ShadowApp-DropShadow-offset_down_left"),e.offset_down_right=t.c("CmApp-ShadowApp-DropShadow-offset_down_right"),function(e){e.down=t.c("CmApp-ShadowApp-DropShadow-ArrowControl-down"),e.left=t.c("CmApp-ShadowApp-DropShadow-ArrowControl-left"),e.right=t.c("CmApp-ShadowApp-DropShadow-ArrowControl-right"),e.up=t.c("CmApp-ShadowApp-DropShadow-ArrowControl-up"),e.zero=t.c("CmApp-ShadowApp-DropShadow-ArrowControl-zero")}(o=e.ArrowControl||(e.ArrowControl={})),function(e){e.container=t.c("CmApp-ShadowApp-DropShadow-BlurRadius-container"),e.decrease=t.c("CmApp-ShadowApp-DropShadow-BlurRadius-decrease"),e.display=t.c("CmApp-ShadowApp-DropShadow-BlurRadius-display"),e.increase=t.c("CmApp-ShadowApp-DropShadow-BlurRadius-increase"),e.reset=t.c("CmApp-ShadowApp-DropShadow-BlurRadius-reset")}(i||(i={})),e.BlurRadius=i,function(e){e.container=t.c("CmApp-ShadowApp-DropShadow-Opacity-container"),e.decrease=t.c("CmApp-ShadowApp-DropShadow-Opacity-decrease"),e.display=t.c("CmApp-ShadowApp-DropShadow-Opacity-display"),e.increase=t.c("CmApp-ShadowApp-DropShadow-Opacity-increase"),e.reset=t.c("CmApp-ShadowApp-DropShadow-Opacity-reset")}(s||(s={})),e.Opacity=s}(o=e.DropShadow||(e.DropShadow={})),function(e){let o,i;e.Container=t.id("CmApp-ShadowApp-EllipseShadow-Container"),function(e){e.container=t.c("CmApp-ShadowApp-EllipseShadow-Core-container"),e.decrease=t.c("CmApp-ShadowApp-EllipseShadow-Core-decrease"),e.display=t.c("CmApp-ShadowApp-EllipseShadow-Core-display"),e.increase=t.c("CmApp-ShadowApp-EllipseShadow-Core-increase"),e.reset=t.c("CmApp-ShadowApp-EllipseShadow-Core-reset")}(o||(o={})),e.Core=o,function(e){e.container=t.c("CmApp-ShadowApp-EllipseShadow-Strength-container"),e.decrease=t.c("CmApp-ShadowApp-EllipseShadow-Strength-decrease"),e.display=t.c("CmApp-ShadowApp-EllipseShadow-Strength-display"),e.increase=t.c("CmApp-ShadowApp-EllipseShadow-Strength-increase"),e.reset=t.c("CmApp-ShadowApp-EllipseShadow-Strength-reset")}(i||(i={})),e.Strength=i}(i=e.EllipseShadow||(e.EllipseShadow={})),function(e){let o,i,s;e.Enabled=t.id("CmApp-ShadowApp-MirrorShadow-Enabled"),e.UpdatingIndicator=t.id("CmApp-ShadowApp-MirrorShadow-UpdatingIndicator"),e.controls=t.c("CmApp-ShadowApp-MirrorShadow-controls"),function(e){e.container=t.c("CmApp-ShadowApp-MirrorShadow-Height-container"),e.decrease=t.c("CmApp-ShadowApp-MirrorShadow-Height-decrease"),e.display=t.c("CmApp-ShadowApp-MirrorShadow-Height-display"),e.increase=t.c("CmApp-ShadowApp-MirrorShadow-Height-increase"),e.reset=t.c("CmApp-ShadowApp-MirrorShadow-Height-reset")}(o||(o={})),e.Height=o,function(e){e.container=t.c("CmApp-ShadowApp-MirrorShadow-OffsetY-container"),e.decrease=t.c("CmApp-ShadowApp-MirrorShadow-OffsetY-decrease"),e.display=t.c("CmApp-ShadowApp-MirrorShadow-OffsetY-display"),e.increase=t.c("CmApp-ShadowApp-MirrorShadow-OffsetY-increase"),e.reset=t.c("CmApp-ShadowApp-MirrorShadow-OffsetY-reset")}(i||(i={})),e.OffsetY=i,function(e){e.container=t.c("CmApp-ShadowApp-MirrorShadow-Opacity-container"),e.decrease=t.c("CmApp-ShadowApp-MirrorShadow-Opacity-decrease"),e.display=t.c("CmApp-ShadowApp-MirrorShadow-Opacity-display"),e.increase=t.c("CmApp-ShadowApp-MirrorShadow-Opacity-increase"),e.reset=t.c("CmApp-ShadowApp-MirrorShadow-Opacity-reset")}(s||(s={})),e.Opacity=s}(s=e.MirrorShadow||(e.MirrorShadow={})),function(e){let o,i,s,r;e.Enabled=t.id("CmApp-ShadowApp-PerspectiveShadow-Enabled"),e.UpdatingIndicator=t.id("CmApp-ShadowApp-PerspectiveShadow-UpdatingIndicator"),e.controls=t.c("CmApp-ShadowApp-PerspectiveShadow-controls"),function(e){e.container=t.c("CmApp-ShadowApp-PerspectiveShadow-BlurRadius-container"),e.decrease=t.c("CmApp-ShadowApp-PerspectiveShadow-BlurRadius-decrease"),e.display=t.c("CmApp-ShadowApp-PerspectiveShadow-BlurRadius-display"),e.increase=t.c("CmApp-ShadowApp-PerspectiveShadow-BlurRadius-increase"),e.reset=t.c("CmApp-ShadowApp-PerspectiveShadow-BlurRadius-reset")}(o||(o={})),e.BlurRadius=o,function(e){e.container=t.c("CmApp-ShadowApp-PerspectiveShadow-BlurRadiusScale-container"),e.decrease=t.c("CmApp-ShadowApp-PerspectiveShadow-BlurRadiusScale-decrease"),e.display=t.c("CmApp-ShadowApp-PerspectiveShadow-BlurRadiusScale-display"),e.increase=t.c("CmApp-ShadowApp-PerspectiveShadow-BlurRadiusScale-increase"),e.reset=t.c("CmApp-ShadowApp-PerspectiveShadow-BlurRadiusScale-reset")}(i||(i={})),e.BlurRadiusScale=i,function(e){e.container=t.c("CmApp-ShadowApp-PerspectiveShadow-OpacityScale-container"),e.decrease=t.c("CmApp-ShadowApp-PerspectiveShadow-OpacityScale-decrease"),e.display=t.c("CmApp-ShadowApp-PerspectiveShadow-OpacityScale-display"),e.increase=t.c("CmApp-ShadowApp-PerspectiveShadow-OpacityScale-increase"),e.reset=t.c("CmApp-ShadowApp-PerspectiveShadow-OpacityScale-reset")}(s||(s={})),e.OpacityScale=s,function(e){e.container=t.c("CmApp-ShadowApp-PerspectiveShadow-ShadowOpacity-container"),e.decrease=t.c("CmApp-ShadowApp-PerspectiveShadow-ShadowOpacity-decrease"),e.display=t.c("CmApp-ShadowApp-PerspectiveShadow-ShadowOpacity-display"),e.increase=t.c("CmApp-ShadowApp-PerspectiveShadow-ShadowOpacity-increase"),e.reset=t.c("CmApp-ShadowApp-PerspectiveShadow-ShadowOpacity-reset")}(r||(r={})),e.ShadowOpacity=r}(r=e.PerspectiveShadow||(e.PerspectiveShadow={}))}(g=e.ShadowApp||(e.ShadowApp={})),function(e){e.auto_clip=t.c("CmApp-Sidebar-auto_clip"),e.container=t.c("CmApp-Sidebar-container"),e.marks=t.c("CmApp-Sidebar-marks"),e.mode_container=t.c("CmApp-Sidebar-mode_container"),e.preview=t.c("CmApp-Sidebar-preview"),e.selected=t.c("CmApp-Sidebar-selected"),e.viewOriginal=t.c("CmApp-Sidebar-viewOriginal")}(m=e.Sidebar||(e.Sidebar={})),function(e){e.tab=t.c("CmApp-SubApps-tab")}(f=e.SubApps||(e.SubApps={})),function(e){e.ColorPicker=t.id("color-picker-color"),e.brush=t.c("CmApp-Tools-brush"),e.clear_all_edits=t.c("CmApp-Tools-clear_all_edits"),e.clear_user_mask_tool=t.c("CmApp-Tools-clear_user_mask_tool"),e.copy_mask_tool=t.c("CmApp-Tools-copy_mask_tool"),e.download=t.c("CmApp-Tools-download"),e.ecommerce=t.c("CmApp-Tools-ecommerce"),e.editMenu=t.c("CmApp-Tools-editMenu"),e.paste_mask_tool=t.c("CmApp-Tools-paste_mask_tool"),e.redo=t.c("CmApp-Tools-redo"),e.redoMenuItem=t.c("CmApp-Tools-redoMenuItem"),e.review=t.c("CmApp-Tools-review"),e.save=t.c("CmApp-Tools-save"),e.show_background_app_button=t.c("CmApp-Tools-show_background_app_button"),e.show_colors_app_button=t.c("CmApp-Tools-show_colors_app_button"),e.show_crop_app_button=t.c("CmApp-Tools-show_crop_app_button"),e.show_shadow_app_button=t.c("CmApp-Tools-show_shadow_app_button"),e.skip=t.c("CmApp-Tools-skip"),e.subapp_zoom_in=t.c("CmApp-Tools-subapp_zoom_in"),e.subapp_zoom_out=t.c("CmApp-Tools-subapp_zoom_out"),e.subapp_zoom_to_fit=t.c("CmApp-Tools-subapp_zoom_to_fit"),e.undo=t.c("CmApp-Tools-undo"),e.undoMenuItem=t.c("CmApp-Tools-undoMenuItem"),e.zoom_in=t.c("CmApp-Tools-zoom_in"),e.zoom_out=t.c("CmApp-Tools-zoom_out"),e.zoom_to_fit=t.c("CmApp-Tools-zoom_to_fit")}(S=e.Tools||(e.Tools={}))}(o=t.CmApp||(t.CmApp={})),function(e){e.notSupported=t.c("CopyPaste-notSupported"),e.supported=t.c("CopyPaste-supported")}(i=t.CopyPaste||(t.CopyPaste={})),function(e){let o,i,s,r,n,a;!function(e){e.group=t.c("ExportOptions-JpegOptimization-group"),e.moz=t.c("ExportOptions-JpegOptimization-moz"),e.none=t.c("ExportOptions-JpegOptimization-none")}(o=e.JpegOptimization||(e.JpegOptimization={})),function(e){e.container=t.c("ExportOptions-JpgQuality-container"),e.decrease=t.c("ExportOptions-JpgQuality-decrease"),e.display=t.c("ExportOptions-JpgQuality-display"),e.increase=t.c("ExportOptions-JpgQuality-increase"),e.reset=t.c("ExportOptions-JpgQuality-reset")}(i||(i={})),e.JpgQuality=i,function(e){e.preset100=t.c("ExportOptions-JpgQualityPresets-preset100"),e.preset25=t.c("ExportOptions-JpgQualityPresets-preset25"),e.preset50=t.c("ExportOptions-JpgQualityPresets-preset50"),e.preset75=t.c("ExportOptions-JpgQualityPresets-preset75"),e.preset90=t.c("ExportOptions-JpgQualityPresets-preset90")}(s=e.JpgQualityPresets||(e.JpgQualityPresets={})),function(e){let o,i,s,r;e.comment=t.c("ExportOptions-NoColorSpaceOrDpiInOptimizedOutput-comment"),e.emphasize=t.c("ExportOptions-NoColorSpaceOrDpiInOptimizedOutput-emphasize"),function(e){e.comment=t.c("ExportOptions-NoColorSpaceOrDpiInOptimizedOutput-ColorSpace-comment")}(o=e.ColorSpace||(e.ColorSpace={})),function(e){e.comment=t.c("ExportOptions-NoColorSpaceOrDpiInOptimizedOutput-Dpi-comment")}(i=e.Dpi||(e.Dpi={})),function(e){e.comment=t.c("ExportOptions-NoColorSpaceOrDpiInOptimizedOutput-Jpeg-comment")}(s=e.Jpeg||(e.Jpeg={})),function(e){e.comment=t.c("ExportOptions-NoColorSpaceOrDpiInOptimizedOutput-Png-comment")}(r=e.Png||(e.Png={}))}(r=e.NoColorSpaceOrDpiInOptimizedOutput||(e.NoColorSpaceOrDpiInOptimizedOutput={})),function(e){e.group=t.c("ExportOptions-OpaqueFormat-group"),e.jpg=t.c("ExportOptions-OpaqueFormat-jpg"),e.png=t.c("ExportOptions-OpaqueFormat-png")}(n=e.OpaqueFormat||(e.OpaqueFormat={})),function(e){e.group=t.c("ExportOptions-PngOptimization-group"),e.lossless=t.c("ExportOptions-PngOptimization-lossless"),e.lossy=t.c("ExportOptions-PngOptimization-lossy"),e.none=t.c("ExportOptions-PngOptimization-none")}(a=e.PngOptimization||(e.PngOptimization={}))}(s=t.ExportOptions||(t.ExportOptions={})),function(e){let o;e.Field=t.id("FileInput-Field"),e.PasteTarget=t.id("FileInput-PasteTarget"),e.click_to_upload=t.c("FileInput-click_to_upload"),function(e){e.show_dialog=t.c("FileInput-UploadFromWeb-show_dialog")}(o=e.UploadFromWeb||(e.UploadFromWeb={}))}(r=t.FileInput||(t.FileInput={})),function(e){e.admin_show_original=t.c("ImageThumbs-admin_show_original"),e.admin_show_original_button=t.c("ImageThumbs-admin_show_original_button")}(n=t.ImageThumbs||(t.ImageThumbs={})),function(e){e.active_key=t.c("MainUploadTarget-active_key"),e.ctl_key=t.c("MainUploadTarget-ctl_key"),e.jsNotInitializedYet=t.c("MainUploadTarget-jsNotInitializedYet"),e.paste_buttons=t.c("MainUploadTarget-paste_buttons"),e.pasted=t.c("MainUploadTarget-pasted"),e.v_key=t.c("MainUploadTarget-v_key"),e.wrong_shake=t.c("MainUploadTarget-wrong_shake")}(a=t.MainUploadTarget||(t.MainUploadTarget={})),function(e){e.container=t.c("MaxNumMegapixels-container"),e.decrease=t.c("MaxNumMegapixels-decrease"),e.display=t.c("MaxNumMegapixels-display"),e.increase=t.c("MaxNumMegapixels-increase"),e.reset=t.c("MaxNumMegapixels-reset")}(l||(l={})),t.MaxNumMegapixels=l,function(e){let o;!function(e){e.active=t.c("Modal-Show-active")}(o=e.Show||(e.Show={}))}(c=t.Modal||(t.Modal={})),function(e){let o;e.App=t.id("PreCrop-App"),e.ViewContainer=t.id("PreCrop-ViewContainer"),function(e){let o;e.cancel_button=t.c("PreCrop-Sidebar-cancel_button"),e.crop_button=t.c("PreCrop-Sidebar-crop_button"),e.cropped_image_aspect_ratio_display=t.c("PreCrop-Sidebar-cropped_image_aspect_ratio_display"),e.cropped_image_megapixels_display=t.c("PreCrop-Sidebar-cropped_image_megapixels_display"),e.cropped_image_size_display=t.c("PreCrop-Sidebar-cropped_image_size_display"),e.cropped_image_success=t.c("PreCrop-Sidebar-cropped_image_success"),e.cropped_image_warning=t.c("PreCrop-Sidebar-cropped_image_warning"),e.input_image_aspect_ratio_display=t.c("PreCrop-Sidebar-input_image_aspect_ratio_display"),e.input_image_megapixels_display=t.c("PreCrop-Sidebar-input_image_megapixels_display"),e.input_image_size_display=t.c("PreCrop-Sidebar-input_image_size_display"),e.lock_aspect_ratio_button=t.c("PreCrop-Sidebar-lock_aspect_ratio_button"),function(e){e.container=t.c("PreCrop-Sidebar-MaxNumMegapixels-container"),e.decrease=t.c("PreCrop-Sidebar-MaxNumMegapixels-decrease"),e.display=t.c("PreCrop-Sidebar-MaxNumMegapixels-display"),e.increase=t.c("PreCrop-Sidebar-MaxNumMegapixels-increase"),e.reset=t.c("PreCrop-Sidebar-MaxNumMegapixels-reset")}(o||(o={})),e.MaxNumMegapixels=o}(o=e.Sidebar||(e.Sidebar={}))}(p=t.PreCrop||(t.PreCrop={})),function(e){e.DefaultSettingsTab=t.id("PreferencesDialog-DefaultSettingsTab"),e.ExportOptionsTab=t.id("PreferencesDialog-ExportOptionsTab"),e.ImportOptionsTab=t.id("PreferencesDialog-ImportOptionsTab"),e.open=t.c("PreferencesDialog-open"),e.openExportOptions=t.c("PreferencesDialog-openExportOptions"),e.openImportOptions=t.c("PreferencesDialog-openImportOptions")}(u=t.PreferencesDialog||(t.PreferencesDialog={})),function(e){e.period_annual=t.c("PricingPanel-period_annual"),e.period_annual_container=t.c("PricingPanel-period_annual_container"),e.period_group=t.c("PricingPanel-period_group"),e.period_monthly=t.c("PricingPanel-period_monthly"),e.period_monthly_container=t.c("PricingPanel-period_monthly_container")}(h=t.PricingPanel||(t.PricingPanel={})),function(e){e.Body=t.id("RetryDialog-Body"),e.Countdown=t.id("RetryDialog-Countdown"),e.Dialog=t.id("RetryDialog-Dialog"),e.RetryNowButton=t.id("RetryDialog-RetryNowButton")}(d=t.RetryDialog||(t.RetryDialog={})),function(e){let o,i,s,r,n,a,l,c;!function(e){e.displayCurrent=t.c("Settings-BackgroundColor-displayCurrent"),e.displayDefault=t.c("Settings-BackgroundColor-displayDefault"),e.displayFactory=t.c("Settings-BackgroundColor-displayFactory"),e.setCurrentAndStickyToFactory=t.c("Settings-BackgroundColor-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("Settings-BackgroundColor-setCurrentToDefault"),e.setStickyToCurrent=t.c("Settings-BackgroundColor-setStickyToCurrent")}(o||(o={})),e.BackgroundColor=o,function(e){e.displayCurrent=t.c("Settings-BrushSize-displayCurrent"),e.displayDefault=t.c("Settings-BrushSize-displayDefault"),e.displayFactory=t.c("Settings-BrushSize-displayFactory"),e.setCurrentAndStickyToFactory=t.c("Settings-BrushSize-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("Settings-BrushSize-setCurrentToDefault"),e.setStickyToCurrent=t.c("Settings-BrushSize-setStickyToCurrent")}(i||(i={})),e.BrushSize=i,function(e){let o,i;!function(e){e.displayCurrent=t.c("Settings-Colors-AutoLevels-displayCurrent"),e.displayDefault=t.c("Settings-Colors-AutoLevels-displayDefault"),e.displayFactory=t.c("Settings-Colors-AutoLevels-displayFactory"),e.setCurrentAndStickyToFactory=t.c("Settings-Colors-AutoLevels-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("Settings-Colors-AutoLevels-setCurrentToDefault"),e.setStickyToCurrent=t.c("Settings-Colors-AutoLevels-setStickyToCurrent")}(o||(o={})),e.AutoLevels=o,function(e){e.displayCurrent=t.c("Settings-Colors-ColorSpace-displayCurrent"),e.displayDefault=t.c("Settings-Colors-ColorSpace-displayDefault"),e.displayFactory=t.c("Settings-Colors-ColorSpace-displayFactory"),e.setCurrentAndStickyToFactory=t.c("Settings-Colors-ColorSpace-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("Settings-Colors-ColorSpace-setCurrentToDefault"),e.setStickyToCurrent=t.c("Settings-Colors-ColorSpace-setStickyToCurrent")}(i||(i={})),e.ColorSpace=i}(s=e.Colors||(e.Colors={})),function(e){let o,i,s,r,n,a,l,c,p,u,h,d;!function(e){e.displayCurrent=t.c("Settings-Crop-AllowEnlarging-displayCurrent"),e.displayDefault=t.c("Settings-Crop-AllowEnlarging-displayDefault"),e.displayFactory=t.c("Settings-Crop-AllowEnlarging-displayFactory"),e.setCurrentAndStickyToFactory=t.c("Settings-Crop-AllowEnlarging-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("Settings-Crop-AllowEnlarging-setCurrentToDefault"),e.setStickyToCurrent=t.c("Settings-Crop-AllowEnlarging-setStickyToCurrent")}(o||(o={})),e.AllowEnlarging=o,function(e){e.displayCurrent=t.c("Settings-Crop-AspectRatio-displayCurrent"),e.displayDefault=t.c("Settings-Crop-AspectRatio-displayDefault"),e.displayFactory=t.c("Settings-Crop-AspectRatio-displayFactory"),e.setCurrentAndStickyToFactory=t.c("Settings-Crop-AspectRatio-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("Settings-Crop-AspectRatio-setCurrentToDefault"),e.setStickyToCurrent=t.c("Settings-Crop-AspectRatio-setStickyToCurrent")}(i||(i={})),e.AspectRatio=i,function(e){e.displayCurrent=t.c("Settings-Crop-Dpi-displayCurrent"),e.displayDefault=t.c("Settings-Crop-Dpi-displayDefault"),e.displayFactory=t.c("Settings-Crop-Dpi-displayFactory"),e.setCurrentAndStickyToFactory=t.c("Settings-Crop-Dpi-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("Settings-Crop-Dpi-setCurrentToDefault"),e.setStickyToCurrent=t.c("Settings-Crop-Dpi-setStickyToCurrent")}(s||(s={})),e.Dpi=s,function(e){e.displayCurrent=t.c("Settings-Crop-FitToResult-displayCurrent"),e.displayDefault=t.c("Settings-Crop-FitToResult-displayDefault"),e.displayFactory=t.c("Settings-Crop-FitToResult-displayFactory"),e.setCurrentAndStickyToFactory=t.c("Settings-Crop-FitToResult-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("Settings-Crop-FitToResult-setCurrentToDefault"),e.setStickyToCurrent=t.c("Settings-Crop-FitToResult-setStickyToCurrent")}(r||(r={})),e.FitToResult=r,function(e){e.displayCurrent=t.c("Settings-Crop-MarginUnits-displayCurrent"),e.displayDefault=t.c("Settings-Crop-MarginUnits-displayDefault"),e.displayFactory=t.c("Settings-Crop-MarginUnits-displayFactory"),e.setCurrentAndStickyToFactory=t.c("Settings-Crop-MarginUnits-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("Settings-Crop-MarginUnits-setCurrentToDefault"),e.setStickyToCurrent=t.c("Settings-Crop-MarginUnits-setStickyToCurrent")}(n||(n={})),e.MarginUnits=n,function(e){e.displayCurrent=t.c("Settings-Crop-Mode-displayCurrent"),e.displayDefault=t.c("Settings-Crop-Mode-displayDefault"),e.displayFactory=t.c("Settings-Crop-Mode-displayFactory"),e.setCurrentAndStickyToFactory=t.c("Settings-Crop-Mode-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("Settings-Crop-Mode-setCurrentToDefault"),e.setStickyToCurrent=t.c("Settings-Crop-Mode-setStickyToCurrent")}(a||(a={})),e.Mode=a,function(e){e.displayCurrent=t.c("Settings-Crop-ObjectSize-displayCurrent"),e.displayDefault=t.c("Settings-Crop-ObjectSize-displayDefault"),e.displayFactory=t.c("Settings-Crop-ObjectSize-displayFactory"),e.setCurrentAndStickyToFactory=t.c("Settings-Crop-ObjectSize-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("Settings-Crop-ObjectSize-setCurrentToDefault"),e.setStickyToCurrent=t.c("Settings-Crop-ObjectSize-setStickyToCurrent")}(l||(l={})),e.ObjectSize=l,function(e){e.displayCurrent=t.c("Settings-Crop-PaddingMils-displayCurrent"),e.displayDefault=t.c("Settings-Crop-PaddingMils-displayDefault"),e.displayFactory=t.c("Settings-Crop-PaddingMils-displayFactory"),e.setCurrentAndStickyToFactory=t.c("Settings-Crop-PaddingMils-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("Settings-Crop-PaddingMils-setCurrentToDefault"),e.setStickyToCurrent=t.c("Settings-Crop-PaddingMils-setStickyToCurrent")}(c||(c={})),e.PaddingMils=c,function(e){e.displayCurrent=t.c("Settings-Crop-PaddingPixels-displayCurrent"),e.displayDefault=t.c("Settings-Crop-PaddingPixels-displayDefault"),e.displayFactory=t.c("Settings-Crop-PaddingPixels-displayFactory"),e.setCurrentAndStickyToFactory=t.c("Settings-Crop-PaddingPixels-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("Settings-Crop-PaddingPixels-setCurrentToDefault"),e.setStickyToCurrent=t.c("Settings-Crop-PaddingPixels-setStickyToCurrent")}(p||(p={})),e.PaddingPixels=p,function(e){e.displayCurrent=t.c("Settings-Crop-Shadows-displayCurrent"),e.displayDefault=t.c("Settings-Crop-Shadows-displayDefault"),e.displayFactory=t.c("Settings-Crop-Shadows-displayFactory"),e.setCurrentAndStickyToFactory=t.c("Settings-Crop-Shadows-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("Settings-Crop-Shadows-setCurrentToDefault"),e.setStickyToCurrent=t.c("Settings-Crop-Shadows-setStickyToCurrent")}(u||(u={})),e.Shadows=u,function(e){e.displayCurrent=t.c("Settings-Crop-TargetSize-displayCurrent"),e.displayDefault=t.c("Settings-Crop-TargetSize-displayDefault"),e.displayFactory=t.c("Settings-Crop-TargetSize-displayFactory"),e.setCurrentAndStickyToFactory=t.c("Settings-Crop-TargetSize-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("Settings-Crop-TargetSize-setCurrentToDefault"),e.setStickyToCurrent=t.c("Settings-Crop-TargetSize-setStickyToCurrent")}(h||(h={})),e.TargetSize=h,function(e){e.displayCurrent=t.c("Settings-Crop-VerticalAlignment-displayCurrent"),e.displayDefault=t.c("Settings-Crop-VerticalAlignment-displayDefault"),e.displayFactory=t.c("Settings-Crop-VerticalAlignment-displayFactory"),e.setCurrentAndStickyToFactory=t.c("Settings-Crop-VerticalAlignment-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("Settings-Crop-VerticalAlignment-setCurrentToDefault"),e.setStickyToCurrent=t.c("Settings-Crop-VerticalAlignment-setStickyToCurrent")}(d||(d={})),e.VerticalAlignment=d}(r=e.Crop||(e.Crop={})),function(e){let o,i,s,r,n,a,l;!function(e){e.displayCurrent=t.c("Settings-Edge-BlurLevel-displayCurrent"),e.displayDefault=t.c("Settings-Edge-BlurLevel-displayDefault"),e.displayFactory=t.c("Settings-Edge-BlurLevel-displayFactory"),e.setCurrentAndStickyToFactory=t.c("Settings-Edge-BlurLevel-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("Settings-Edge-BlurLevel-setCurrentToDefault"),e.setStickyToCurrent=t.c("Settings-Edge-BlurLevel-setStickyToCurrent")}(o||(o={})),e.BlurLevel=o,function(e){e.displayCurrent=t.c("Settings-Edge-BlurMode-displayCurrent"),e.displayDefault=t.c("Settings-Edge-BlurMode-displayDefault"),e.displayFactory=t.c("Settings-Edge-BlurMode-displayFactory"),e.setCurrentAndStickyToFactory=t.c("Settings-Edge-BlurMode-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("Settings-Edge-BlurMode-setCurrentToDefault"),e.setStickyToCurrent=t.c("Settings-Edge-BlurMode-setStickyToCurrent")}(i||(i={})),e.BlurMode=i,function(e){e.displayCurrent=t.c("Settings-Edge-Offset-displayCurrent"),e.displayDefault=t.c("Settings-Edge-Offset-displayDefault"),e.displayFactory=t.c("Settings-Edge-Offset-displayFactory"),e.setCurrentAndStickyToFactory=t.c("Settings-Edge-Offset-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("Settings-Edge-Offset-setCurrentToDefault"),e.setStickyToCurrent=t.c("Settings-Edge-Offset-setStickyToCurrent")}(s||(s={})),e.Offset=s,function(e){e.displayCurrent=t.c("Settings-Edge-SmoothingLevel-displayCurrent"),e.displayDefault=t.c("Settings-Edge-SmoothingLevel-displayDefault"),e.displayFactory=t.c("Settings-Edge-SmoothingLevel-displayFactory"),e.setCurrentAndStickyToFactory=t.c("Settings-Edge-SmoothingLevel-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("Settings-Edge-SmoothingLevel-setCurrentToDefault"),e.setStickyToCurrent=t.c("Settings-Edge-SmoothingLevel-setStickyToCurrent")}(r||(r={})),e.SmoothingLevel=r,function(e){e.displayCurrent=t.c("Settings-Edge-UseCornerDetection-displayCurrent"),e.displayDefault=t.c("Settings-Edge-UseCornerDetection-displayDefault"),e.displayFactory=t.c("Settings-Edge-UseCornerDetection-displayFactory"),e.setCurrentAndStickyToFactory=t.c("Settings-Edge-UseCornerDetection-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("Settings-Edge-UseCornerDetection-setCurrentToDefault"),e.setStickyToCurrent=t.c("Settings-Edge-UseCornerDetection-setStickyToCurrent")}(n||(n={})),e.UseCornerDetection=n,function(e){e.displayCurrent=t.c("Settings-Edge-UseLocalBlur-displayCurrent"),e.displayDefault=t.c("Settings-Edge-UseLocalBlur-displayDefault"),e.displayFactory=t.c("Settings-Edge-UseLocalBlur-displayFactory"),e.setCurrentAndStickyToFactory=t.c("Settings-Edge-UseLocalBlur-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("Settings-Edge-UseLocalBlur-setCurrentToDefault"),e.setStickyToCurrent=t.c("Settings-Edge-UseLocalBlur-setStickyToCurrent")}(a||(a={})),e.UseLocalBlur=a,function(e){e.displayCurrent=t.c("Settings-Edge-UseLocalSmoothing-displayCurrent"),e.displayDefault=t.c("Settings-Edge-UseLocalSmoothing-displayDefault"),e.displayFactory=t.c("Settings-Edge-UseLocalSmoothing-displayFactory"),e.setCurrentAndStickyToFactory=t.c("Settings-Edge-UseLocalSmoothing-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("Settings-Edge-UseLocalSmoothing-setCurrentToDefault"),e.setStickyToCurrent=t.c("Settings-Edge-UseLocalSmoothing-setStickyToCurrent")}(l||(l={})),e.UseLocalSmoothing=l}(n=e.Edge||(e.Edge={})),function(e){let o,i,s,r;!function(e){e.displayCurrent=t.c("Settings-ExportOptions-JpegMode-displayCurrent"),e.displayDefault=t.c("Settings-ExportOptions-JpegMode-displayDefault"),e.displayFactory=t.c("Settings-ExportOptions-JpegMode-displayFactory"),e.setCurrentAndStickyToFactory=t.c("Settings-ExportOptions-JpegMode-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("Settings-ExportOptions-JpegMode-setCurrentToDefault"),e.setStickyToCurrent=t.c("Settings-ExportOptions-JpegMode-setStickyToCurrent")}(o||(o={})),e.JpegMode=o,function(e){e.displayCurrent=t.c("Settings-ExportOptions-JpegQuality-displayCurrent"),e.displayDefault=t.c("Settings-ExportOptions-JpegQuality-displayDefault"),e.displayFactory=t.c("Settings-ExportOptions-JpegQuality-displayFactory"),e.setCurrentAndStickyToFactory=t.c("Settings-ExportOptions-JpegQuality-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("Settings-ExportOptions-JpegQuality-setCurrentToDefault"),e.setStickyToCurrent=t.c("Settings-ExportOptions-JpegQuality-setStickyToCurrent")}(i||(i={})),e.JpegQuality=i,function(e){e.displayCurrent=t.c("Settings-ExportOptions-OpaqueFileFormat-displayCurrent"),e.displayDefault=t.c("Settings-ExportOptions-OpaqueFileFormat-displayDefault"),e.displayFactory=t.c("Settings-ExportOptions-OpaqueFileFormat-displayFactory"),e.setCurrentAndStickyToFactory=t.c("Settings-ExportOptions-OpaqueFileFormat-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("Settings-ExportOptions-OpaqueFileFormat-setCurrentToDefault"),e.setStickyToCurrent=t.c("Settings-ExportOptions-OpaqueFileFormat-setStickyToCurrent")}(s||(s={})),e.OpaqueFileFormat=s,function(e){e.displayCurrent=t.c("Settings-ExportOptions-PngMode-displayCurrent"),e.displayDefault=t.c("Settings-ExportOptions-PngMode-displayDefault"),e.displayFactory=t.c("Settings-ExportOptions-PngMode-displayFactory"),e.setCurrentAndStickyToFactory=t.c("Settings-ExportOptions-PngMode-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("Settings-ExportOptions-PngMode-setCurrentToDefault"),e.setStickyToCurrent=t.c("Settings-ExportOptions-PngMode-setStickyToCurrent")}(r||(r={})),e.PngMode=r}(a=e.ExportOptions||(e.ExportOptions={})),function(e){e.displayCurrent=t.c("Settings-MaxNumMegapixels-displayCurrent"),e.displayDefault=t.c("Settings-MaxNumMegapixels-displayDefault"),e.displayFactory=t.c("Settings-MaxNumMegapixels-displayFactory"),e.setCurrentAndStickyToFactory=t.c("Settings-MaxNumMegapixels-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("Settings-MaxNumMegapixels-setCurrentToDefault"),e.setStickyToCurrent=t.c("Settings-MaxNumMegapixels-setStickyToCurrent")}(l||(l={})),e.MaxNumMegapixels=l,function(e){let o,i,s,r;!function(e){let o,i,s,r,n,a;!function(e){e.displayCurrent=t.c("Settings-Shadows-Drop-BlurRadius-displayCurrent"),e.displayDefault=t.c("Settings-Shadows-Drop-BlurRadius-displayDefault"),e.displayFactory=t.c("Settings-Shadows-Drop-BlurRadius-displayFactory"),e.setCurrentAndStickyToFactory=t.c("Settings-Shadows-Drop-BlurRadius-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("Settings-Shadows-Drop-BlurRadius-setCurrentToDefault"),e.setStickyToCurrent=t.c("Settings-Shadows-Drop-BlurRadius-setStickyToCurrent")}(o||(o={})),e.BlurRadius=o,function(e){e.displayCurrent=t.c("Settings-Shadows-Drop-CropEnabled-displayCurrent"),e.displayDefault=t.c("Settings-Shadows-Drop-CropEnabled-displayDefault"),e.displayFactory=t.c("Settings-Shadows-Drop-CropEnabled-displayFactory"),e.setCurrentAndStickyToFactory=t.c("Settings-Shadows-Drop-CropEnabled-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("Settings-Shadows-Drop-CropEnabled-setCurrentToDefault"),e.setStickyToCurrent=t.c("Settings-Shadows-Drop-CropEnabled-setStickyToCurrent")}(i||(i={})),e.CropEnabled=i,function(e){e.displayCurrent=t.c("Settings-Shadows-Drop-Enabled-displayCurrent"),e.displayDefault=t.c("Settings-Shadows-Drop-Enabled-displayDefault"),e.displayFactory=t.c("Settings-Shadows-Drop-Enabled-displayFactory"),e.setCurrentAndStickyToFactory=t.c("Settings-Shadows-Drop-Enabled-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("Settings-Shadows-Drop-Enabled-setCurrentToDefault"),e.setStickyToCurrent=t.c("Settings-Shadows-Drop-Enabled-setStickyToCurrent")}(s||(s={})),e.Enabled=s,function(e){e.displayCurrent=t.c("Settings-Shadows-Drop-OffsetX-displayCurrent"),e.displayDefault=t.c("Settings-Shadows-Drop-OffsetX-displayDefault"),e.displayFactory=t.c("Settings-Shadows-Drop-OffsetX-displayFactory"),e.setCurrentAndStickyToFactory=t.c("Settings-Shadows-Drop-OffsetX-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("Settings-Shadows-Drop-OffsetX-setCurrentToDefault"),e.setStickyToCurrent=t.c("Settings-Shadows-Drop-OffsetX-setStickyToCurrent")}(r||(r={})),e.OffsetX=r,function(e){e.displayCurrent=t.c("Settings-Shadows-Drop-OffsetY-displayCurrent"),e.displayDefault=t.c("Settings-Shadows-Drop-OffsetY-displayDefault"),e.displayFactory=t.c("Settings-Shadows-Drop-OffsetY-displayFactory"),e.setCurrentAndStickyToFactory=t.c("Settings-Shadows-Drop-OffsetY-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("Settings-Shadows-Drop-OffsetY-setCurrentToDefault"),e.setStickyToCurrent=t.c("Settings-Shadows-Drop-OffsetY-setStickyToCurrent")}(n||(n={})),e.OffsetY=n,function(e){e.displayCurrent=t.c("Settings-Shadows-Drop-Opacity-displayCurrent"),e.displayDefault=t.c("Settings-Shadows-Drop-Opacity-displayDefault"),e.displayFactory=t.c("Settings-Shadows-Drop-Opacity-displayFactory"),e.setCurrentAndStickyToFactory=t.c("Settings-Shadows-Drop-Opacity-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("Settings-Shadows-Drop-Opacity-setCurrentToDefault"),e.setStickyToCurrent=t.c("Settings-Shadows-Drop-Opacity-setStickyToCurrent")}(a||(a={})),e.Opacity=a}(o=e.Drop||(e.Drop={})),function(e){let o,i;!function(e){e.displayCurrent=t.c("Settings-Shadows-Ellipse-Core-displayCurrent"),e.displayDefault=t.c("Settings-Shadows-Ellipse-Core-displayDefault"),e.displayFactory=t.c("Settings-Shadows-Ellipse-Core-displayFactory"),e.setCurrentAndStickyToFactory=t.c("Settings-Shadows-Ellipse-Core-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("Settings-Shadows-Ellipse-Core-setCurrentToDefault"),e.setStickyToCurrent=t.c("Settings-Shadows-Ellipse-Core-setStickyToCurrent")}(o||(o={})),e.Core=o,function(e){e.displayCurrent=t.c("Settings-Shadows-Ellipse-Strength-displayCurrent"),e.displayDefault=t.c("Settings-Shadows-Ellipse-Strength-displayDefault"),e.displayFactory=t.c("Settings-Shadows-Ellipse-Strength-displayFactory"),e.setCurrentAndStickyToFactory=t.c("Settings-Shadows-Ellipse-Strength-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("Settings-Shadows-Ellipse-Strength-setCurrentToDefault"),e.setStickyToCurrent=t.c("Settings-Shadows-Ellipse-Strength-setStickyToCurrent")}(i||(i={})),e.Strength=i}(i=e.Ellipse||(e.Ellipse={})),function(e){let o,i,s,r;!function(e){e.displayCurrent=t.c("Settings-Shadows-Mirror-Enabled-displayCurrent"),e.displayDefault=t.c("Settings-Shadows-Mirror-Enabled-displayDefault"),e.displayFactory=t.c("Settings-Shadows-Mirror-Enabled-displayFactory"),e.setCurrentAndStickyToFactory=t.c("Settings-Shadows-Mirror-Enabled-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("Settings-Shadows-Mirror-Enabled-setCurrentToDefault"),e.setStickyToCurrent=t.c("Settings-Shadows-Mirror-Enabled-setStickyToCurrent")}(o||(o={})),e.Enabled=o,function(e){e.displayCurrent=t.c("Settings-Shadows-Mirror-Height-displayCurrent"),e.displayDefault=t.c("Settings-Shadows-Mirror-Height-displayDefault"),e.displayFactory=t.c("Settings-Shadows-Mirror-Height-displayFactory"),e.setCurrentAndStickyToFactory=t.c("Settings-Shadows-Mirror-Height-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("Settings-Shadows-Mirror-Height-setCurrentToDefault"),e.setStickyToCurrent=t.c("Settings-Shadows-Mirror-Height-setStickyToCurrent")}(i||(i={})),e.Height=i,function(e){e.displayCurrent=t.c("Settings-Shadows-Mirror-OffsetY-displayCurrent"),e.displayDefault=t.c("Settings-Shadows-Mirror-OffsetY-displayDefault"),e.displayFactory=t.c("Settings-Shadows-Mirror-OffsetY-displayFactory"),e.setCurrentAndStickyToFactory=t.c("Settings-Shadows-Mirror-OffsetY-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("Settings-Shadows-Mirror-OffsetY-setCurrentToDefault"),e.setStickyToCurrent=t.c("Settings-Shadows-Mirror-OffsetY-setStickyToCurrent")}(s||(s={})),e.OffsetY=s,function(e){e.displayCurrent=t.c("Settings-Shadows-Mirror-Opacity-displayCurrent"),e.displayDefault=t.c("Settings-Shadows-Mirror-Opacity-displayDefault"),e.displayFactory=t.c("Settings-Shadows-Mirror-Opacity-displayFactory"),e.setCurrentAndStickyToFactory=t.c("Settings-Shadows-Mirror-Opacity-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("Settings-Shadows-Mirror-Opacity-setCurrentToDefault"),e.setStickyToCurrent=t.c("Settings-Shadows-Mirror-Opacity-setStickyToCurrent")}(r||(r={})),e.Opacity=r}(s=e.Mirror||(e.Mirror={})),function(e){let o,i,s,r,n;!function(e){e.displayCurrent=t.c("Settings-Shadows-Perspective-BlurRadius-displayCurrent"),e.displayDefault=t.c("Settings-Shadows-Perspective-BlurRadius-displayDefault"),e.displayFactory=t.c("Settings-Shadows-Perspective-BlurRadius-displayFactory"),e.setCurrentAndStickyToFactory=t.c("Settings-Shadows-Perspective-BlurRadius-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("Settings-Shadows-Perspective-BlurRadius-setCurrentToDefault"),e.setStickyToCurrent=t.c("Settings-Shadows-Perspective-BlurRadius-setStickyToCurrent")}(o||(o={})),e.BlurRadius=o,function(e){e.displayCurrent=t.c("Settings-Shadows-Perspective-BlurRadiusScale-displayCurrent"),e.displayDefault=t.c("Settings-Shadows-Perspective-BlurRadiusScale-displayDefault"),e.displayFactory=t.c("Settings-Shadows-Perspective-BlurRadiusScale-displayFactory"),e.setCurrentAndStickyToFactory=t.c("Settings-Shadows-Perspective-BlurRadiusScale-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("Settings-Shadows-Perspective-BlurRadiusScale-setCurrentToDefault"),e.setStickyToCurrent=t.c("Settings-Shadows-Perspective-BlurRadiusScale-setStickyToCurrent")}(i||(i={})),e.BlurRadiusScale=i,function(e){e.displayCurrent=t.c("Settings-Shadows-Perspective-Enabled-displayCurrent"),e.displayDefault=t.c("Settings-Shadows-Perspective-Enabled-displayDefault"),e.displayFactory=t.c("Settings-Shadows-Perspective-Enabled-displayFactory"),e.setCurrentAndStickyToFactory=t.c("Settings-Shadows-Perspective-Enabled-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("Settings-Shadows-Perspective-Enabled-setCurrentToDefault"),e.setStickyToCurrent=t.c("Settings-Shadows-Perspective-Enabled-setStickyToCurrent")}(s||(s={})),e.Enabled=s,function(e){e.displayCurrent=t.c("Settings-Shadows-Perspective-Opacity-displayCurrent"),e.displayDefault=t.c("Settings-Shadows-Perspective-Opacity-displayDefault"),e.displayFactory=t.c("Settings-Shadows-Perspective-Opacity-displayFactory"),e.setCurrentAndStickyToFactory=t.c("Settings-Shadows-Perspective-Opacity-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("Settings-Shadows-Perspective-Opacity-setCurrentToDefault"),e.setStickyToCurrent=t.c("Settings-Shadows-Perspective-Opacity-setStickyToCurrent")}(r||(r={})),e.Opacity=r,function(e){e.displayCurrent=t.c("Settings-Shadows-Perspective-OpacityScale-displayCurrent"),e.displayDefault=t.c("Settings-Shadows-Perspective-OpacityScale-displayDefault"),e.displayFactory=t.c("Settings-Shadows-Perspective-OpacityScale-displayFactory"),e.setCurrentAndStickyToFactory=t.c("Settings-Shadows-Perspective-OpacityScale-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("Settings-Shadows-Perspective-OpacityScale-setCurrentToDefault"),e.setStickyToCurrent=t.c("Settings-Shadows-Perspective-OpacityScale-setStickyToCurrent")}(n||(n={})),e.OpacityScale=n}(r=e.Perspective||(e.Perspective={}))}(c=e.Shadows||(e.Shadows={}))}(g=t.Settings||(t.Settings={})),function(e){let o,i,s,r,n,a,l,c,p;!function(e){e.button=t.c("SettingsGroups-All-button"),e.menu=t.c("SettingsGroups-All-menu"),e.outline=t.c("SettingsGroups-All-outline"),e.setCurrentAndStickyToFactory=t.c("SettingsGroups-All-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("SettingsGroups-All-setCurrentToDefault"),e.setStickyToCurrent=t.c("SettingsGroups-All-setStickyToCurrent")}(o||(o={})),e.All=o,function(e){e.button=t.c("SettingsGroups-BackgroundColor-button"),e.menu=t.c("SettingsGroups-BackgroundColor-menu"),e.outline=t.c("SettingsGroups-BackgroundColor-outline"),e.setCurrentAndStickyToFactory=t.c("SettingsGroups-BackgroundColor-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("SettingsGroups-BackgroundColor-setCurrentToDefault"),e.setStickyToCurrent=t.c("SettingsGroups-BackgroundColor-setStickyToCurrent")}(i||(i={})),e.BackgroundColor=i,function(e){e.button=t.c("SettingsGroups-BrushSize-button"),e.menu=t.c("SettingsGroups-BrushSize-menu"),e.outline=t.c("SettingsGroups-BrushSize-outline"),e.setCurrentAndStickyToFactory=t.c("SettingsGroups-BrushSize-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("SettingsGroups-BrushSize-setCurrentToDefault"),e.setStickyToCurrent=t.c("SettingsGroups-BrushSize-setStickyToCurrent")}(s||(s={})),e.BrushSize=s,function(e){let o,i;!function(e){e.button=t.c("SettingsGroups-Colors-AutoLevels-button"),e.menu=t.c("SettingsGroups-Colors-AutoLevels-menu"),e.outline=t.c("SettingsGroups-Colors-AutoLevels-outline"),e.setCurrentAndStickyToFactory=t.c("SettingsGroups-Colors-AutoLevels-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("SettingsGroups-Colors-AutoLevels-setCurrentToDefault"),e.setStickyToCurrent=t.c("SettingsGroups-Colors-AutoLevels-setStickyToCurrent")}(o||(o={})),e.AutoLevels=o,function(e){e.button=t.c("SettingsGroups-Colors-ColorSpace-button"),e.menu=t.c("SettingsGroups-Colors-ColorSpace-menu"),e.outline=t.c("SettingsGroups-Colors-ColorSpace-outline"),e.setCurrentAndStickyToFactory=t.c("SettingsGroups-Colors-ColorSpace-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("SettingsGroups-Colors-ColorSpace-setCurrentToDefault"),e.setStickyToCurrent=t.c("SettingsGroups-Colors-ColorSpace-setStickyToCurrent")}(i||(i={})),e.ColorSpace=i}(r=e.Colors||(e.Colors={})),function(e){let o,i,s;!function(e){e.button=t.c("SettingsGroups-Crop-Dpi-button"),e.menu=t.c("SettingsGroups-Crop-Dpi-menu"),e.outline=t.c("SettingsGroups-Crop-Dpi-outline"),e.setCurrentAndStickyToFactory=t.c("SettingsGroups-Crop-Dpi-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("SettingsGroups-Crop-Dpi-setCurrentToDefault"),e.setStickyToCurrent=t.c("SettingsGroups-Crop-Dpi-setStickyToCurrent")}(o||(o={})),e.Dpi=o,function(e){e.button=t.c("SettingsGroups-Crop-FitToResult-button"),e.menu=t.c("SettingsGroups-Crop-FitToResult-menu"),e.outline=t.c("SettingsGroups-Crop-FitToResult-outline"),e.setCurrentAndStickyToFactory=t.c("SettingsGroups-Crop-FitToResult-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("SettingsGroups-Crop-FitToResult-setCurrentToDefault"),e.setStickyToCurrent=t.c("SettingsGroups-Crop-FitToResult-setStickyToCurrent")}(i||(i={})),e.FitToResult=i,function(e){e.button=t.c("SettingsGroups-Crop-Mode-button"),e.menu=t.c("SettingsGroups-Crop-Mode-menu"),e.outline=t.c("SettingsGroups-Crop-Mode-outline"),e.setCurrentAndStickyToFactory=t.c("SettingsGroups-Crop-Mode-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("SettingsGroups-Crop-Mode-setCurrentToDefault"),e.setStickyToCurrent=t.c("SettingsGroups-Crop-Mode-setStickyToCurrent")}(s||(s={})),e.Mode=s}(n=e.Crop||(e.Crop={})),function(e){e.button=t.c("SettingsGroups-Edges-button"),e.menu=t.c("SettingsGroups-Edges-menu"),e.outline=t.c("SettingsGroups-Edges-outline"),e.setCurrentAndStickyToFactory=t.c("SettingsGroups-Edges-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("SettingsGroups-Edges-setCurrentToDefault"),e.setStickyToCurrent=t.c("SettingsGroups-Edges-setStickyToCurrent")}(a||(a={})),e.Edges=a,function(e){let o,i,s,r;!function(e){e.button=t.c("SettingsGroups-ExportOptions-JpegMode-button"),e.menu=t.c("SettingsGroups-ExportOptions-JpegMode-menu"),e.outline=t.c("SettingsGroups-ExportOptions-JpegMode-outline"),e.setCurrentAndStickyToFactory=t.c("SettingsGroups-ExportOptions-JpegMode-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("SettingsGroups-ExportOptions-JpegMode-setCurrentToDefault"),e.setStickyToCurrent=t.c("SettingsGroups-ExportOptions-JpegMode-setStickyToCurrent")}(o||(o={})),e.JpegMode=o,function(e){e.button=t.c("SettingsGroups-ExportOptions-JpegQuality-button"),e.menu=t.c("SettingsGroups-ExportOptions-JpegQuality-menu"),e.outline=t.c("SettingsGroups-ExportOptions-JpegQuality-outline"),e.setCurrentAndStickyToFactory=t.c("SettingsGroups-ExportOptions-JpegQuality-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("SettingsGroups-ExportOptions-JpegQuality-setCurrentToDefault"),e.setStickyToCurrent=t.c("SettingsGroups-ExportOptions-JpegQuality-setStickyToCurrent")}(i||(i={})),e.JpegQuality=i,function(e){e.button=t.c("SettingsGroups-ExportOptions-OpaqueFileFormat-button"),e.menu=t.c("SettingsGroups-ExportOptions-OpaqueFileFormat-menu"),e.outline=t.c("SettingsGroups-ExportOptions-OpaqueFileFormat-outline"),e.setCurrentAndStickyToFactory=t.c("SettingsGroups-ExportOptions-OpaqueFileFormat-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("SettingsGroups-ExportOptions-OpaqueFileFormat-setCurrentToDefault"),e.setStickyToCurrent=t.c("SettingsGroups-ExportOptions-OpaqueFileFormat-setStickyToCurrent")}(s||(s={})),e.OpaqueFileFormat=s,function(e){e.button=t.c("SettingsGroups-ExportOptions-PngMode-button"),e.menu=t.c("SettingsGroups-ExportOptions-PngMode-menu"),e.outline=t.c("SettingsGroups-ExportOptions-PngMode-outline"),e.setCurrentAndStickyToFactory=t.c("SettingsGroups-ExportOptions-PngMode-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("SettingsGroups-ExportOptions-PngMode-setCurrentToDefault"),e.setStickyToCurrent=t.c("SettingsGroups-ExportOptions-PngMode-setStickyToCurrent")}(r||(r={})),e.PngMode=r}(l=e.ExportOptions||(e.ExportOptions={})),function(e){e.button=t.c("SettingsGroups-MaxNumMegapixels-button"),e.menu=t.c("SettingsGroups-MaxNumMegapixels-menu"),e.outline=t.c("SettingsGroups-MaxNumMegapixels-outline"),e.setCurrentAndStickyToFactory=t.c("SettingsGroups-MaxNumMegapixels-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("SettingsGroups-MaxNumMegapixels-setCurrentToDefault"),e.setStickyToCurrent=t.c("SettingsGroups-MaxNumMegapixels-setStickyToCurrent")}(c||(c={})),e.MaxNumMegapixels=c,function(e){let o,i,s,r;!function(e){e.button=t.c("SettingsGroups-Shadows-Drop-button"),e.menu=t.c("SettingsGroups-Shadows-Drop-menu"),e.outline=t.c("SettingsGroups-Shadows-Drop-outline"),e.setCurrentAndStickyToFactory=t.c("SettingsGroups-Shadows-Drop-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("SettingsGroups-Shadows-Drop-setCurrentToDefault"),e.setStickyToCurrent=t.c("SettingsGroups-Shadows-Drop-setStickyToCurrent")}(o||(o={})),e.Drop=o,function(e){e.button=t.c("SettingsGroups-Shadows-Ellipse-button"),e.menu=t.c("SettingsGroups-Shadows-Ellipse-menu"),e.outline=t.c("SettingsGroups-Shadows-Ellipse-outline"),e.setCurrentAndStickyToFactory=t.c("SettingsGroups-Shadows-Ellipse-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("SettingsGroups-Shadows-Ellipse-setCurrentToDefault"),e.setStickyToCurrent=t.c("SettingsGroups-Shadows-Ellipse-setStickyToCurrent")}(i||(i={})),e.Ellipse=i,function(e){e.button=t.c("SettingsGroups-Shadows-Mirror-button"),e.menu=t.c("SettingsGroups-Shadows-Mirror-menu"),e.outline=t.c("SettingsGroups-Shadows-Mirror-outline"),e.setCurrentAndStickyToFactory=t.c("SettingsGroups-Shadows-Mirror-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("SettingsGroups-Shadows-Mirror-setCurrentToDefault"),e.setStickyToCurrent=t.c("SettingsGroups-Shadows-Mirror-setStickyToCurrent")}(s||(s={})),e.Mirror=s,function(e){e.button=t.c("SettingsGroups-Shadows-Perspective-button"),e.menu=t.c("SettingsGroups-Shadows-Perspective-menu"),e.outline=t.c("SettingsGroups-Shadows-Perspective-outline"),e.setCurrentAndStickyToFactory=t.c("SettingsGroups-Shadows-Perspective-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("SettingsGroups-Shadows-Perspective-setCurrentToDefault"),e.setStickyToCurrent=t.c("SettingsGroups-Shadows-Perspective-setStickyToCurrent")}(r||(r={})),e.Perspective=r}(p=e.Shadows||(e.Shadows={}))}(m=t.SettingsGroups||(t.SettingsGroups={})),function(e){e.Dialog=t.id("Signon-Dialog"),e.Header=t.id("Signon-Header"),e.IframeContainer=t.id("Signon-IframeContainer"),e.LoadingIndicator=t.id("Signon-LoadingIndicator"),e.preload=t.c("Signon-preload"),e.trigger=t.c("Signon-trigger")}(f=t.Signon||(t.Signon={})),function(e){e.Id=t.id("StartupLightbox-Id"),e.Initializing=t.id("StartupLightbox-Initializing"),e.Outer=t.id("StartupLightbox-Outer"),e.Uploading=t.id("StartupLightbox-Uploading"),e.content=t.c("StartupLightbox-content"),e.single_pane=t.c("StartupLightbox-single_pane"),e.video=t.id("StartupLightbox-video"),e.video_playing=t.c("StartupLightbox-video_playing")}(S=t.StartupLightbox||(t.StartupLightbox={})),function(e){e.iframe=t.c("TutorialScreenshots-iframe"),e.wrapper=t.c("TutorialScreenshots-wrapper")}(w=t.TutorialScreenshots||(t.TutorialScreenshots={})),function(e){e.remove=t.c("UserImage-remove"),e.rename=t.c("UserImage-rename"),e.undelete=t.c("UserImage-undelete")}(C=t.UserImage||(t.UserImage={})),function(e){let o;!function(e){e.active=t.c("V2-DemoPitch-active"),e.progress_bar=t.c("V2-DemoPitch-progress_bar"),e.video_no_shadow=t.c("V2-DemoPitch-video_no_shadow"),e.video_progress_chunks=t.c("V2-DemoPitch-video_progress_chunks")}(o=e.DemoPitch||(e.DemoPitch={}))}(y=t.V2||(t.V2={})),function(e){e.both=t.c("ViewPanes-both"),e.group=t.c("ViewPanes-group"),e.marks=t.c("ViewPanes-marks")}(b=t.ViewPanes||(t.ViewPanes={})),function(e){e.Lightbox=t.id("contextMenu-Lightbox"),e.ToolbarBackgroundApp=t.id("contextMenu-ToolbarBackgroundApp"),e.ToolbarColorsApp=t.id("contextMenu-ToolbarColorsApp"),e.ToolbarMark=t.id("contextMenu-ToolbarMark"),e.ToolbarShadowApp=t.id("contextMenu-ToolbarShadowApp"),e.toolbar=t.c("contextMenu-toolbar")}(v=t.contextMenu||(t.contextMenu={})),function(e){e.connecting=t.c("lightState-connecting"),e.progress=t.c("lightState-progress"),e.updated=t.c("lightState-updated"),e.updating=t.c("lightState-updating")}(A=t.lightState||(t.lightState={})),function(e){e.AcceptTerms=t.id("merchant-AcceptTerms"),e.AcceptTermsWrapper=t.id("merchant-AcceptTermsWrapper"),e.BraintreeDropinContainer=t.id("merchant-BraintreeDropinContainer"),e.Cents=t.id("merchant-Cents"),e.CreditCardProcessorForm=t.id("merchant-CreditCardProcessorForm"),e.DefaultPaymentMethod=t.id("merchant-DefaultPaymentMethod"),e.FailedToLoadPaymentBackendJs=t.id("merchant-FailedToLoadPaymentBackendJs"),e.InitializingIndicator=t.id("merchant-InitializingIndicator"),e.PaymentError=t.id("merchant-PaymentError"),e.PaymentForm=t.id("merchant-PaymentForm"),e.PaymentMethodForm=t.id("merchant-PaymentMethodForm"),e.PaymentMethodFormSubmit=t.id("merchant-PaymentMethodFormSubmit"),e.RadioBraintree=t.id("paymentMethod_braintree"),e.RadioStripe=t.id("paymentMethod_stripe"),e.ShowWhenCreatingPm=t.id("merchant-ShowWhenCreatingPm"),e.ShowWhenMinibrowsing=t.id("merchant-ShowWhenMinibrowsing"),e.ShowWhenSubmitting=t.id("merchant-ShowWhenSubmitting"),e.StreamlexPaymentToken=t.id("merchant-StreamlexPaymentToken"),e.StripeCardElement=t.id("merchant-StripeCardElement"),e.StripeCardErrors=t.id("merchant-StripeCardErrors"),e.StripeNameElement=t.id("merchant-StripeNameElement"),e.StripeNameErrors=t.id("merchant-StripeNameErrors"),e.StripePaymentError=t.id("merchant-StripePaymentError"),e.SubmitSection=t.id("merchant-SubmitSection"),e.TaxLocationPostalCode=t.id("merchant-TaxLocationPostalCode"),e.TaxPostalCode=t.id("merchant-TaxPostalCode"),e.TaxPostalCodeFormGroup=t.id("merchant-TaxPostalCodeFormGroup"),e.TaxSection=t.id("merchant-TaxSection"),e.has_error=t.c("has-error"),e.radio_paymentMethod=t.c("radio_paymentMethod")}(k=t.merchant||(t.merchant={})),function(e){let o,i,s;e.Error=t.id("resultDialog-Error"),e.ErrorMsg=t.id("resultDialog-ErrorMsg"),e.Ready=t.id("resultDialog-Ready"),e.ReadyDownloadImage=t.id("resultDialog-ReadyDownloadImage"),e.ReadyShareLink=t.c("resultDialog-ReadyShareLink"),e.Waiting=t.id("resultDialog-Waiting"),e.WaitingBar=t.id("resultDialog-WaitingBar"),e.WaitingMsg=t.id("resultDialog-WaitingMsg"),e.download_alpha_mask_menu_item=t.c("resultDialog-download_alpha_mask_menu_item"),e.download_combo_button=t.c("resultDialog-download_combo_button"),e.download_link=t.c("resultDialog-download_link"),e.download_menu_button=t.c("resultDialog-download_menu_button"),e.download_svg_path_menu_item=t.c("resultDialog-download_svg_path_menu_item"),e.download_tiff_path_menu_item=t.c("resultDialog-download_tiff_path_menu_item"),e.hasDownloaded=t.c("resultDialog-hasDownloaded"),e.ready_download_link=t.c("resultDialog-ready_download_link"),e.ready_download_menu_item=t.c("resultDialog-ready_download_menu_item"),e.ready_download_menu_item_text=t.c("resultDialog-ready_download_menu_item_text"),e.state=t.c("resultDialog-state"),function(e){e.copy_to_clipboard=t.c("resultDialog-CopyBtn-copy_to_clipboard"),e.show_copied=t.c("resultDialog-CopyBtn-show_copied"),e.show_copy=t.c("resultDialog-CopyBtn-show_copy"),e.show_copying=t.c("resultDialog-CopyBtn-show_copying"),e.show_failed=t.c("resultDialog-CopyBtn-show_failed")}(o||(o={})),e.CopyBtn=o,function(e){let o,i,s,r,n;e.Row=t.id("resultDialog-SettingsSummary-Row"),function(e){e.Key=t.id("resultDialog-SettingsSummary-BackgroundApp-Key"),e.Value=t.id("resultDialog-SettingsSummary-BackgroundApp-Value")}(o||(o={})),e.BackgroundApp=o,function(e){e.Key=t.id("resultDialog-SettingsSummary-ColorsApp-Key"),e.Value=t.id("resultDialog-SettingsSummary-ColorsApp-Value")}(i||(i={})),e.ColorsApp=i,function(e){e.Key=t.id("resultDialog-SettingsSummary-CropApp-Key"),e.Value=t.id("resultDialog-SettingsSummary-CropApp-Value")}(s||(s={})),e.CropApp=s,function(e){e.Key=t.id("resultDialog-SettingsSummary-ExportOptions-Key"),e.Value=t.id("resultDialog-SettingsSummary-ExportOptions-Value")}(r||(r={})),e.ExportOptions=r,function(e){e.Key=t.id("resultDialog-SettingsSummary-ShadowsApp-Key"),e.Value=t.id("resultDialog-SettingsSummary-ShadowsApp-Value")}(n||(n={})),e.ShadowsApp=n}(i=e.SettingsSummary||(e.SettingsSummary={})),function(e){e.Row=t.id("resultDialog-UploadNext-Row"),e.Wrapper=t.id("resultDialog-UploadNext-Wrapper")}(s=e.UploadNext||(e.UploadNext={}))}(M=t.resultDialog||(t.resultDialog={})),function(e){let o,i;e.hero=t.id("video-hero"),e.main=t.id("video-main"),function(e){e.Id=t.id("video-erase-Id"),e.Tool=t.id("erase-tool"),e.show=t.c("video-erase-show")}(o||(o={})),e.erase=o,function(e){e.Id=t.id("video-green-Id"),e.Tool=t.id("green-tool"),e.show=t.c("video-green-show")}(i||(i={})),e.green=i}(x=t.video||(t.video={}))}(P||(P={}));class Jt{constructor(t,e,o,i,s,r){this.btn=t,this.action=e,this.delay=o,this.firstDelayMultiplier=i,this.ondown=s,this.onup=r,this.t=void 0,this.repeat=()=>{this.action(),this.t=setTimeout(this.repeat,this.delay)},this.startHandler=t=>{this.btn.on("mouseup mouseout",this.endHandler),this.ondown&&this.ondown(),this.action(),this.t=setTimeout(this.repeat,this.delay*this.firstDelayMultiplier),t.preventDefault()},this.endHandler=t=>{this.btn.off("mouseup mouseout",this.endHandler),this.onup&&this.onup(),clearTimeout(this.t),this.t=void 0,t.preventDefault()},t.on("touchstart mousedown",this.startHandler),t.on("touchend",this.endHandler)}}!function(t){function e(e){window.Globals.Bulk.isIframe||window.Globals.Bulk.isApi?window.checkPostMessage({command:D.Error,error:{code:2e3,status:400,message:e}}):($("#fatal-error-p").text(e),t.modal("#fatal-error")),t.gaTrack("ErrorShown","Fatal",e)}function o(e){e?t.modal("#spinner-lightbox"):$("#spinner-lightbox").modal("hide")}function i(e){e?t.modal("#progress-lightbox"):$("#progress-lightbox").modal("hide")}t.addEventListener=function(t,e,o){t.each(((t,i)=>{i.addEventListener(e,o)}))},t.fuzzyAspectRatio=function(e){return t.fuzzyAspectRatioEx(e,D.AspectRatios)},t.imageIsReady=function(t){return null!=t&&0!=t.width()&&0!=t.height()},t.fatalError=function(s){o(!1),i(!1),e(t.stringify(s))},t.fatalErrorStr=e,t.spinner=o,t.progress=i,t.progressUpdate=function(t){$("#progress-lightbox-bar").attr("style","width:"+t+"%")},t.saveAndExit=function(e){e?t.modal("#save-and-exit-lightbox"):$("#save-and-exit-lightbox").modal("hide")},t.hoverHelper=function(e,o){t.addEventListener(e,"touchstart",(t=>{o(!0),t.preventDefault()})),t.addEventListener(e,"touchend",(t=>{o(!1),t.preventDefault()})),e.hover((()=>{o(!0)}),(()=>{o(!1)}))},t.mouseDownRepeater=function(t,e,o,i,s,r){new Jt(t,e,o,i,s,r)},t.LittleEndian=function(){try{var t=new ArrayBuffer(2);return new DataView(t).setInt16(0,256,!0),256===new Int16Array(t)[0]}catch(t){return!0}}(),t.fetchJson=function(e,o){var i={cache:!1,dataType:"json",error:(e,o,i)=>{t.fatalErrorStr(t.formatXhrError(e,o))},success:o,type:"GET"};$.ajax(e,i)},t.blink2=function(t){let e=200,o=e;t.$().animate({opacity:0},0).delay(e).animate({opacity:1},0).delay(o).animate({opacity:0},0).delay(e).animate({opacity:1},0).delay(o).animate({opacity:0},0).delay(e).animate({opacity:1},0).delay(o).animate({opacity:0},0).delay(e).animate({opacity:1},0).delay(o).animate({opacity:0},0).delay(e).animate({opacity:1},0)}}(R||(R={}));class Qt{constructor(t=0,e=0,o=0,i=0){this.rf=t,this.gf=e,this.bf=o,this.af=i}static intToFloat(t){return(255&t)*Qt.IntToFloat}static isInRange(t){return t>=0&&t<=1}static transparentWhite(){return new Qt(1,1,1,0)}static empty(){return new Qt(0,0,0,0)}static fromInts(t,e,o,i){return(new Qt).fromInts(t,e,o,i)}static fromInt(t){return(new Qt).fromInt(t)}static fromCss(t){return(new Qt).fromCss(t)}fromInts(t,e,o,i){return this.af=Qt.intToFloat(t),this.rf=Qt.intToFloat(e),this.gf=Qt.intToFloat(o),this.bf=Qt.intToFloat(i),this}fromInt(t){return this.fromInts(t>>24,t>>16,t>>8,t)}fromCss(t){if(t.startsWith("rgba(")){let e=t.match(Qt.RbgaRx);if(e&&5==e.length){let t=Qt.intToFloat(parseInt(e[1])),o=Qt.intToFloat(parseInt(e[2])),i=Qt.intToFloat(parseInt(e[3])),s=parseFloat(e[4]);return new Qt(t,o,i,s).clamp()}}if(t.startsWith("rgb(")){let e=t.match(Qt.RbgRx);if(e&&4==e.length){let t=Qt.intToFloat(parseInt(e[1])),o=Qt.intToFloat(parseInt(e[2])),i=Qt.intToFloat(parseInt(e[3]));return new Qt(t,o,i,1).clamp()}}if(t.startsWith("#")){let e=t.match(Qt.Hex6Rx);if(e&&4==e.length){let t=Qt.intToFloat(parseInt(e[1],16)),o=Qt.intToFloat(parseInt(e[2],16)),i=Qt.intToFloat(parseInt(e[3],16));return new Qt(t,o,i,1).clamp()}let o=t.match(Qt.Hex3Rx);if(o&&4==o.length){let t=Qt.intToFloat(parseInt(o[1]+o[1],16)),e=Qt.intToFloat(parseInt(o[2]+o[2],16)),i=Qt.intToFloat(parseInt(o[3]+o[3],16));return new Qt(t,e,i,1).clamp()}}return Qt.transparentWhite()}dup(){return(new Qt).setArgb(this)}aInt(){return Math.round(this.af*Qt.FloatToInt)}rInt(){return Math.round(this.rf*Qt.FloatToInt)}gInt(){return Math.round(this.gf*Qt.FloatToInt)}bInt(){return Math.round(this.bf*Qt.FloatToInt)}toInt(){return(255&this.aInt())<<24|(255&this.rInt())<<16|(255&this.gInt())<<8|255&this.bInt()}toRgbCss(){return"rgb("+this.rInt()+","+this.gInt()+","+this.bInt()+")"}toRgbaCss(){return"rgba("+this.rInt()+","+this.gInt()+","+this.bInt()+","+this.af+")"}clamp(){return this.af=Math.max(0,Math.min(1,this.af)),this.rf=Math.max(0,Math.min(1,this.rf)),this.gf=Math.max(0,Math.min(1,this.gf)),this.bf=Math.max(0,Math.min(1,this.bf)),this}scale(t){return this.af*=t,this.rf*=t,this.gf*=t,this.bf*=t,this}normalize(){var t=this.norm();return t>0&&this.scale(1/t),t}normalized(){var t=this.norm();return t>0&&this.scale(1/t),this}normSqr(){return this.af*this.af+this.rf*this.rf+this.gf*this.gf+this.bf*this.bf}norm(){return Math.sqrt(this.af*this.af+this.rf*this.rf+this.gf*this.gf+this.bf*this.bf)}setArgb(t){return this.af=t.af,this.rf=t.rf,this.gf=t.gf,this.bf=t.bf,this}set(t,e,o,i){return this.af=t,this.rf=e,this.gf=o,this.bf=i,this}plusEquals(t){return this.af+=t.af,this.rf+=t.rf,this.gf+=t.gf,this.bf+=t.bf,this}minusEquals(t){return this.af-=t.af,this.rf-=t.rf,this.gf-=t.gf,this.bf-=t.bf,this}timesEquals(t){return this.af*=t,this.rf*=t,this.gf*=t,this.bf*=t,this}dot(t){return this.af*t.af+this.rf*t.rf+this.gf*t.gf+this.bf*t.bf}grayscale(){return.299*this.rf+.587*this.gf+.114*this.bf}desaturate(){var t=this.grayscale();return this.rf=this.gf=this.bf=t,this}desaturateEvenly(){var t=(this.rf+this.gf+this.bf)/3;return this.rf=this.gf=this.bf=t,this}mixWith(t,e){if(this.af+t.af==0)this.set(0,0,0,0);else{var o=this.af*e+t.af*(1-e);this.rf=(this.rf*this.af*e+t.rf*t.af*(1-e))/o,this.gf=(this.gf*this.af*e+t.gf*t.af*(1-e))/o,this.bf=(this.bf*this.af*e+t.bf*t.af*(1-e))/o,this.af=o}return this}}Qt.FloatToInt=255,Qt.IntToFloat=1/Qt.FloatToInt,Qt.RbgaRx=/rgba\(\s*([0-9]+)\s*,\s*([0-9]+)\s*,\s*([0-9]+)\s*,\s*([0-9.]+)\s*\)/,Qt.RbgRx=/rgb\(\s*([0-9]+)\s*,\s*([0-9]+)\s*,\s*([0-9]+)\s*\)/,Qt.Hex3Rx=/#([0-9a-fA-F])([0-9a-fA-F])([0-9a-fA-F])/,Qt.Hex6Rx=/([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})/;class jt{constructor(t,e,o,i,s,r,n,a,l){this.a00=t,this.a01=e,this.a02=o,this.a10=i,this.a11=s,this.a12=r,this.a20=n,this.a21=a,this.a22=l}static empty(){return new jt(1,0,0,0,1,0,0,0,1)}static diag(t,e,o){return new jt(e,0,0,0,e,0,0,0,o)}static buildWhiteBalancerFromGrayColorSampleBradford(t){var e=jt.SrgbToBradford.times(t),o=jt.SrgbToBradford.times(t.dup().desaturate()),i=jt.diag((o.rf+jt.Epsilon)/(e.rf+jt.Epsilon),(o.gf+jt.Epsilon)/(e.gf+jt.Epsilon),(o.bf+jt.Epsilon)/(e.bf+jt.Epsilon));return jt.bradfordToSrgb.dup().timesEquals(i).timesEquals(jt.SrgbToBradford)}static buildWhiteBalancerFromGrayColorSampleXyz(t){var e=jt.SrgbToXyz.times(t),o=jt.SrgbToXyz.times(t.dup().desaturate()),i=jt.diag(o.rf/e.rf,o.gf/e.gf,o.bf/e.bf);return jt.bradfordToSrgb.dup().timesEquals(i).timesEquals(jt.SrgbToBradford)}dup(){return new jt(this.a00,this.a01,this.a02,this.a10,this.a11,this.a12,this.a20,this.a21,this.a22)}set(t,e,o,i,s,r,n,a,l){this.a00=t,this.a01=e,this.a02=o,this.a10=i,this.a11=s,this.a12=r,this.a20=n,this.a21=a,this.a22=l}matrixMatrixMultiply(t,e){e.set(this.a00*t.a00+this.a01*t.a10+this.a02*t.a20,this.a00*t.a01+this.a01*t.a11+this.a02*t.a21,this.a00*t.a02+this.a01*t.a12+this.a02*t.a22,this.a10*t.a00+this.a11*t.a10+this.a12*t.a20,this.a10*t.a01+this.a11*t.a11+this.a12*t.a21,this.a10*t.a02+this.a11*t.a12+this.a12*t.a22,this.a20*t.a00+this.a21*t.a10+this.a22*t.a20,this.a20*t.a01+this.a21*t.a11+this.a22*t.a21,this.a20*t.a02+this.a21*t.a12+this.a22*t.a22)}timesMatrix(t){var e=jt.empty();return this.matrixMatrixMultiply(t,e),e}timesEquals(t){return this.matrixMatrixMultiply(t,this),this}matrixVectorMultiply(t,e){e.rf=this.a00*t.rf+this.a01*t.gf+this.a02*t.bf,e.gf=this.a10*t.rf+this.a11*t.gf+this.a12*t.bf,e.bf=this.a20*t.rf+this.a21*t.gf+this.a22*t.bf}times(t){var e=Qt.empty();return this.matrixVectorMultiply(t,e),e}}jt.SrgbToXyz=new jt(.4124564,.3575761,.1804375,.2126729,.7151522,.072175,.0193339,.119192,.9503041),jt.XyzTosRgb=new jt(3.2404542,-1.5371385,-.4985314,-.969266,1.8760108,.041556,.0556434,-.2040259,1.0572252),jt.BradfordMa=new jt(.8951,.2664,-.1614,-.7502,1.7135,.0367,.0389,-.0685,1.0296),jt.BradfordMaInv=new jt(.9869929,-.1470543,.1599627,.4323053,.5183603,.0492912,-.0085287,.0400428,.9684867),jt.SrgbToBradford=jt.BradfordMa.timesMatrix(jt.SrgbToXyz),jt.bradfordToSrgb=jt.XyzTosRgb.timesMatrix(jt.BradfordMaInv),jt.Epsilon=1e-6;class Zt{constructor(t,e){this.id=t,this.value=e}}class Kt{constructor(t){this.items=t}update(t){for(var e=0;e<this.items.length;e++){var o=this.items[e];o.value==t&&o.id.$().button("toggle")}}}!function(t){function e(t,e){t.id.$().click((()=>{e(t.value)}))}t.registerRadioGroup=function(t,o){for(var i=0;i<t.items.length;i++)e(t.items[i],o)}}(E||(E={}));class te{constructor(t,e,o,i=(()=>{}),s=(()=>{})){this.action=t,this.delay=e,this.firstDelayMultiplier=o,this.ondown=i,this.onup=s,this.timer=-1}repeat(){this.action(),this.timer=setTimeout((()=>{this.repeat()}),this.delay)}up(){-1!=this.timer&&(this.onup&&this.onup(),clearTimeout(this.timer),this.timer=-1)}down(){-1==this.timer&&(this.ondown&&this.ondown(),this.action(),this.timer=setTimeout((()=>{this.repeat()}),this.delay*this.firstDelayMultiplier))}}function ee(t,e){if(e)try{self.postMessage(t,e)}catch(e){self.postMessage(t)}else self.postMessage(t)}class oe{constructor(t,e=null,o=null,i=null){this.name=t,this.scriptUrls=e,this.workerFunction=o,this.messageListener=i,this.myMessageListener=t=>this.messageListener?this.messageListener(t):void 0}static getBasics(){return ee.toString()}ensureWorker(){if(!this.worker){let t="'use strict';\n";if(t+=oe.getBasics()+";\n",this.scriptUrls&&this.scriptUrls.length>0){let e=this.scriptUrls.map((function(t){return t.length>1&&"/"==t[0]&&"/"==t[1]?"https:"+t:t.length>0&&"/"==t[0]?location.protocol+"//"+location.host+t:t}));t+="importScripts(\n  '"+e.join("',\n  '")+"');\n"}this.workerFunction&&(t+="("+this.workerFunction.toString()+")();\n");let e=new Blob([t],{type:"text/javascript"}),o=URL.createObjectURL(e);this.worker=new Worker(o),this.worker.addEventListener("error",(t=>{R.gaTrack("YoWorker","Error",t.filename+":"+t.lineno+":"+t.colno+", '"+t.message+"', '"+t.error+"'")})),this.worker.addEventListener("message",this.myMessageListener)}return this.worker}setMessageListener(t){this.messageListener=t}postMessage(t,e){try{try{this.ensureWorker().postMessage(t,e)}catch(e){this.worker.postMessage(t)}}catch(t){throw R.gaTrack("YoWorker","Exception",this.name+": '"+t+"', '"+t.stack+"'"),t}}terminate(){this.worker&&(this.worker.terminate(),this.worker=null)}}!function(t){let e=!0,o=0;const i=new Yt;t.ThumbnailJpegQuality=.7;class s{constructor(t,e){if(this.canvasId=t,this.spec=e,this.failSafeTimeout=void 0,this.croppedCanvas=this.spec.inputCanvas,this.spec.crop){const t=this.spec.crop,e=t.right-t.left,o=t.bottom-t.top;if(0!=t.top||0!=t.left||e!=this.spec.inputCanvas.width()||o!=this.spec.inputCanvas.height()){const i=new Bt(e,o);i.context().drawCanvasEx3(this.spec.inputCanvas,t.left,t.top,i.width(),i.height(),0,0,i.width(),i.height()),this.croppedCanvas=i,this.croppedCanvas.wasCropped=!0}}let o=this.croppedCanvas.width(),i=this.croppedCanvas.height();this.wOut=o,this.hOut=i;if(o*i>this.spec.maxNumPixels){const t=Math.sqrt(this.spec.maxNumPixels/(o*i));if(o<i){for(this.wOut=Math.max(1,0|Math.round(o*t)),this.hOut=0|Math.round(i*this.wOut/o);this.wOut*this.hOut>this.spec.maxNumPixels&&this.wOut>1;)this.wOut--,this.hOut=0|Math.round(i*this.wOut/o);1==this.wOut&&this.hOut>this.spec.maxNumPixels&&(this.hOut=this.spec.maxNumPixels)}else{for(this.hOut=Math.max(1,0|Math.round(i*t)),this.wOut=0|Math.round(o*this.hOut/i);this.wOut*this.hOut>this.spec.maxNumPixels&&this.hOut>1;)this.hOut--,this.wOut=0|Math.round(o*this.hOut/i);1==this.hOut&&this.wOut>this.spec.maxNumPixels&&(this.wOut=this.spec.maxNumPixels)}}}shrinkingNeeded(){return this.wOut!=this.croppedCanvas.width()||this.hOut!=this.croppedCanvas.height()}createOutputCanvas(){return new Bt(this.wOut,this.hOut)}shrinkWithWorker(){try{const t=this.croppedCanvas.context().getImageData(0,0,this.croppedCanvas.width(),this.croppedCanvas.height()).data,e={canvasId:this.canvasId,wIn:this.croppedCanvas.width(),hIn:this.croppedCanvas.height(),dataIn:t,wOut:this.wOut,hOut:this.hOut};this.failSafeTimeout=setTimeout((()=>this.shrinkWithWorkerFailSafe("fail-safe timeout reached")),1e4),this.spec.worker.setMessageListener(r),this.spec.worker.postMessage(e,[t.buffer])}catch(t){this.shrinkWithWorkerFailSafe("exception in spawning worker or sending work message")}}shrinkWithWorkerResultHandler(t){if(t.success&&t.wOut==this.wOut&&t.hOut==this.hOut&&null!=t.dataOut&&t.dataOut.length>0){R.gaTrack("WebWorker","Downsample","Succeeded",1);const e=this.createOutputCanvas(),o=e.context().createImageData(e.width(),e.height());o.data.set(t.dataOut),e.context().putImageData(o,0,0),e.wasShrunk=!0,e.wasCropped=this.croppedCanvas.wasCropped,this.completed(e)}else this.shrinkWithWorkerFailSafe("Worker reports failure")}shrinkWithWorkerFailSafe(t){R.gaTrack("WebWorker","Downsample","Failed",0),e=!1,this.shrinkWithoutWorker()}shrinkWithoutWorker(){var t=this.createOutputCanvas();t.context().drawCanvasEx2(this.croppedCanvas,0,0,t.width(),t.height()),t.wasShrunk=!0,t.wasCropped=this.croppedCanvas.wasCropped,this.completed(t)}produceThumbnail(e){if(this.spec.thumbnailSize){const o=this.spec.thumbnailSize.w,i=this.spec.thumbnailSize.h,s=new Bt(o,i);s.context().setFillStyle("rgb(255,255,255)"),s.context().fillRect(0,0,o,i);const r=Math.min(o/e.width(),i/e.height());return s.context().context.drawImage(e.element,(o-e.width()*r)/2,(i-e.height()*r)/2,e.width()*r,e.height()*r),s.toBlob("image/jpeg",t.ThumbnailJpegQuality)}return null}completed(t){clearTimeout(this.failSafeTimeout),this.failSafeTimeout=void 0,i.remove(this.canvasId),this.spec.completed(t,t.wasShrunk||t.wasCropped,(()=>this.produceThumbnail(t)))}process(){this.shrinkingNeeded()?e&&this.spec.worker?this.shrinkWithWorker():this.shrinkWithoutWorker():this.completed(this.croppedCanvas)}}function r(t){const e=t.data;i.contains(e.canvasId)&&i.get(e.canvasId).shrinkWithWorkerResultHandler(e)}t.process=function(t){const e=new s("cs_"+o++,t);i.put(e.canvasId,e),e.process()}}(F||(F={}));class ie{constructor(t=32){this.pos=0,this.data=new Uint8Array(t)}ensure(t){if(t>this.data.length){for(var e=new Uint8Array(Math.max(t,2*this.data.length)),o=0;o<this.pos;o++)e[o]=this.data[o];this.data=e}}size(){return this.pos}reset(){this.pos=0}toUint8Array(){return this.data.slice(0,this.size())}writeUintVariableLength(t){(t&=ie.MaskInput)<=ie.Size0?this.writeUint8(ie.Code0|ie.MaskLower&t):t<=ie.Size1?(this.writeUint8(ie.Code1|ie.MaskLower&t>>>8),this.writeUint8(t)):t<=ie.Size2?(this.writeUint8(ie.Code2|ie.MaskLower&t>>>16),this.writeUint8(t>>>8),this.writeUint8(t)):t<=ie.Size3&&(this.writeUint8(ie.Code3|ie.MaskLower&t>>>24),this.writeUint8(t>>>16),this.writeUint8(t>>>8),this.writeUint8(t))}writeASCII(t){for(let e=0;e<t.length;e++)this.writeUint8(t.charCodeAt(e))}writeUint8(t){this.ensure(this.pos+1),this.data[this.pos++]=255&t}writeUint16(t){this.ensure(this.pos+2),this.writeUint8(255&t>>8),this.writeUint8(255&t)}writeUint24(t){this.ensure(this.pos+3),this.writeUint8(255&t>>16),this.writeUint8(255&t>>8),this.writeUint8(255&t)}writeUint32(t){this.ensure(this.pos+4),this.writeUint8(255&t>>24),this.writeUint8(255&t>>16),this.writeUint8(255&t>>8),this.writeUint8(255&t)}writeUint16Le(t){this.ensure(this.pos+2),this.writeUint8(255&t),this.writeUint8(255&t>>8)}writeUint24Le(t){this.ensure(this.pos+3),this.writeUint8(255&t),this.writeUint8(255&t>>8),this.writeUint8(255&t>>16)}writeUint32Le(t){this.ensure(this.pos+4),this.writeUint8(255&t),this.writeUint8(255&t>>8),this.writeUint8(255&t>>16),this.writeUint8(255&t>>24)}toBase64(){return l.encode(this.data,this.pos)}}ie.Size0=63,ie.Size1=16383,ie.Size2=4194303,ie.Size3=1073741823,ie.Code0=0,ie.Code1=64,ie.Code2=128,ie.Code3=192,ie.MaskLower=63,ie.MaskInput=1073741823;class se{constructor(){this.data=new Float32Array(se.NumBins)}static clamp(t){return Math.max(0,Math.min(t,se.LinearSize-1))}addWeight(t,e,o,i){var s=se.clamp(t)*se.SquaredSize+se.clamp(e)*se.LinearSize+se.clamp(o);this.data[s]=this.data[s]+i}add(t,e,o){var i=t/se.BinWidth,s=e/se.BinWidth,r=o/se.BinWidth,n=Math.floor(i-.5),a=Math.floor(s-.5),l=Math.floor(r-.5),c=i-(n+.5),p=s-(a+.5),u=r-(l+.5);this.addWeight(n,a,l,(1-c)*(1-p)*(1-u)),this.addWeight(n,a,l+1,(1-c)*(1-p)*u),this.addWeight(n,a+1,l,(1-c)*p*(1-u)),this.addWeight(n,a+1,l+1,(1-c)*p*u),this.addWeight(n+1,a,l,c*(1-p)*(1-u)),this.addWeight(n+1,a,l+1,c*(1-p)*u),this.addWeight(n+1,a+1,l,c*p*(1-u)),this.addWeight(n+1,a+1,l+1,c*p*u)}findMaxBinCenter(){for(var t=-1,e=-1,o=-1,i=-1,s=0,r=0;s<se.LinearSize;s++)for(var n=0;n<se.LinearSize;n++)for(var a=0;a<se.LinearSize;a++,r++)this.data[r]>i&&(i=this.data[r],t=s,e=n,o=a);return 255<<24|(255&(t+.5)*se.BinWidth)<<16|(255&(e+.5)*se.BinWidth)<<8|255&(o+.5)*se.BinWidth}printStats(){for(var t=0;t<this.data.length;t++)this.data[t]}encode(){for(var t=new ie,e=this.data,o=0,i=0;i<e.length;){for(;i<e.length&&0==Math.floor(e[i]);)i++;if(i!=e.length){var s=i-o,r=Math.floor(e[i]);s+","+r+";",t.writeUintVariableLength(s),t.writeUintVariableLength(r),o=i,i++}}return t.toBase64()}}se.NumBitsKept=4,se.NumBitsCleared=8-se.NumBitsKept,se.BinWidth=1<<se.NumBitsCleared,se.LinearSize=1<<se.NumBitsKept,se.SquaredSize=se.LinearSize*se.LinearSize,se.CubedSize=se.SquaredSize*se.LinearSize,se.NumBins=se.CubedSize,function(t){t[t.Disconnected=0]="Disconnected",t[t.Connecting=1]="Connecting",t[t.Connected=2]="Connected",t[t.Error=3]="Error"}(I||(I={}));class re{constructor(t){this.state=I.Disconnected,this.websocket=null,this.arraybuffer=null,this.hasReceivedMessage=!1,this.closeReason=null,this.lastDebugUrl="unknown",this.opts=$.extend({numberOfSilentRetriesBeforeShowingErrorToUser:3,millisBetweenSilentRetries:1e3},t),this.eventHandlers={open:t=>{this.onOpen()},close:t=>{this.onClose(t)},message:t=>{this.onMessage(t)},heartbeater:()=>{this.opts.heartbeat&&null!=this.websocket&&this.websocket.readyState==WebSocket.OPEN&&this.doSend(this.opts.heartbeat.message)}},this.retryable=new Ot({label:this.opts.label,execute:(t,e)=>{this.clearWebSocket(I.Connecting),this.hasReceivedMessage=!1,this.closeReason=null;let o=this.opts.url();this.lastDebugUrl=o.split("?")[0],this.websocket=new WebSocket(o),this.websocket.binaryType="arraybuffer",this.websocket.addEventListener("open",this.eventHandlers.open),this.websocket.addEventListener("close",this.eventHandlers.close),this.websocket.addEventListener("message",this.eventHandlers.message)},success:()=>{this.opts.connectedToNewServer()},numberOfSilentRetriesBeforeShowingErrorToUser:this.opts.numberOfSilentRetriesBeforeShowingErrorToUser,millisBetweenSilentRetries:this.opts.millisBetweenSilentRetries}).start()}clearWebSocket(t){this.state=t,null!=this.websocket&&(this.websocket.removeEventListener("open",this.eventHandlers.open),this.websocket.removeEventListener("close",this.eventHandlers.close),this.websocket.removeEventListener("message",this.eventHandlers.message),this.websocket.close(),this.websocket=null),this.arraybuffer=null,this.heartbeatTimer&&(clearTimeout(this.heartbeatTimer),this.heartbeatTimer=void 0)}onOpen(){R.gaTrack("WebSocket",this.lastDebugUrl,"connected",1),this.opts.heartbeat&&this.opts.heartbeat.millis>0&&(this.heartbeatTimer=setInterval(this.eventHandlers.heartbeater,this.opts.heartbeat.millis)),this.opts.sendOnOpen?this.doSend(this.opts.sendOnOpen):this.eventHandlers.heartbeater()}onClose(t){this.clearWebSocket(I.Disconnected);let e=t.reason;if(this.closeReason&&!e&&(e=this.closeReason.code.toString()),e){if(this.opts.puntOnCloseReason&&this.opts.puntOnCloseReason(e))return void this.retryable.executionPunt();{let t=this.opts.closeReasonToMessage(e);if(t)return this.onError(t)}}else if(!this.hasReceivedMessage)return this.onError(this.opts.unableToConnectMessage);this.opts.disconnectedFromServer()?this.onError(this.opts.unexpectedCloseMessage):this.retryable.executionStopped()}onError(t){R.gaTrack("WebSocket",this.lastDebugUrl,"error: "+t,0),this.opts.customOnError&&!this.opts.customOnError(t)||this.retryable.executionError(t)}onMessage(t){if("string"==typeof t.data){const e=JSON.parse(t.data);if(e.closeReason)return this.closeReason=e.closeReason,void this.websocket.close();!this.hasReceivedMessage&&this.doSend(this.opts.heartbeat.message)&&(this.hasReceivedMessage=!0,this.state=I.Connected,this.retryable.executionSuccess()),null!=this.arraybuffer&&(e.arraybuffer=this.arraybuffer,this.arraybuffer=null),this.opts.newMessageFromServer(e)}else this.arraybuffer=t.data}doSend(t,e=!1){try{let o=e?t:JSON.stringify(t);return this.websocket.send(o),!0}catch(t){return this.clearWebSocket(I.Error),this.onError(this.opts.sendFailedMessage+"Error: "+t),!1}}send0(t,e){return null==this.websocket||this.websocket.readyState!=WebSocket.OPEN?(null==this.websocket&&this.retryable.tryExecute(),!1):this.doSend(t,e)}send(t){return this.send0(t,!1)}sendBinary(t){return this.send0(t,!0)}getState(){return this.state}forceClose(){this.clearWebSocket(I.Disconnected)}}!function(t){var e,o=0;function i(){return e.getState()==I.Connected}t.checkForceClose=function(){e&&i()&&(e.forceClose(),e=void 0)},t.isConnected=i,t.initialize=function(t){e=new re({url:function(){return G.getWorkerUrl("/api/websocket",{imageId:t.imageId.toString(),secret:t.secret,requestScanMask:t.requestScanMask.toString(),requestPhotoMask:t.requestPhotoMask.toString(),priority:o.toString()})},connectedToNewServer:function(){o=0,t.connectedToNewServer()},disconnectedFromServer:t.disconnectedFromServer,newMessageFromServer:t.newMessageFromServer,heartbeat:{millis:2e4,message:{command:D.StatusCheck}},label:p.s("Connect to worker"),puntOnCloseReason:function(t){return"-3"==t&&o++<window.Globals.NumPuntsWhenWorkersBusy},closeReasonToMessage:function(t){switch(t){case"2":return p.s("Unknown image - it may have been deleted, or you may not have the necessary credentials to access it");case"-3":return p.s("Workers overloaded. Additional workers are being spawned - they should be online in a couple of minutes. ");case"-4":return;default:return t}},unableToConnectMessage:p.s("Unable to connect to the worker. Is your firewall or proxy blocking WebSockets?"),unexpectedCloseMessage:p.s("Unexpected worker disconnection. "),sendFailedMessage:p.s("Failed to send message to worker. ")})},t.send=function(t){return e.send(t)}}(B||(B={}));class ne{static createBrush(t,e){const o=new Bt(t,t),i=new Bt(t,t),s=new Bt(t,t),r=t/2;o.fillAliasedCircle(r,r,r,e),s.fillAliasedCircle(r,r,r,[255,255,255,255]);const n=new Uint32Array(o.context().getImageDataFull().data.buffer),a=255==e[3];if(a)i.context().drawCanvasEx(o,0,0);else{const t=e.slice();t[3]=255,i.fillAliasedCircle(r,r,r,t)}return{canvas:o,opaqueCanvas:o,mask:s,data:n,isOpaque:a}}constructor(t,e,o,i,s,r=!1,n=!1,a=ne.DefaultCursorSpec,l=1,c=1){this.key=t,this.colorBytesRgba=e,this.isEraser=o,this.needBrushes=i,this.isEyeDropper=s,this.isDeselectable=r,this.serverCares=n,this.cursorSpec=a,this.diameterScale=l,this.minDiameter=c,this.cssClass=t+"-tool",this.buttonSelector="label."+t+"-tool",this.cursorSpec=a,this.elems=null,this.needsHover=o||i,this.mask=null,this.brushCache=new Yt,this.cssColor=R.colorBytesToRgbaCss(e),this.abgr32=R.colorBytesToAbgr32(e),this.rgba32=R.colorBytesToRgba32(e),this.endian32=R.LittleEndian?this.abgr32:this.rgba32,O.addMode(this)}static simple(t,e=ne.DefaultCursorSpec){return new ne(t,[0,0,0],!1,!1,!1,!1,!1,e)}static deselectable(t,e){return new ne(t,[0,0,0],!1,!1,!1,e)}isGrab(){return this==O.Grab}isFgOrBg(){return this==O.Foreground||this==O.Background}elements(){return null==this.elems&&(this.elems=$(this.buttonSelector),this.elems.click((()=>{this.pick()}))),this.elems}pick(){O.select(this)}getBrush(t){return this.needBrushes?this.brushCache.get(t)||this.brushCache.put(t,ne.createBrush(t,this.colorBytesRgba)):ne.EmptyBrush}drawSquare(t,e,o){this.isEraser?this.mask&&this.mask.clearSquare(t,e,o):this.mask&&this.mask.drawBrush(t,e,o,this.getBrush(o))}drawLine(t,e,o){this.isEraser?this.mask&&this.mask.clearLine(t,e,o):this.mask&&this.mask.drawBrushLine(t,e,o,this.getBrush(o))}getCursor(){return D.ScreenshotMode?(this.cursorSpec.img||(this.cursorSpec.img=new Image,this.cursorSpec.src||(this.cursorSpec.src=this.key+"-tool-icon.png"),this.cursorSpec.img.src="/assets/m/drawings/"+this.cursorSpec.src),this.cursorSpec):null}}ne.DefaultCursorSpec={x:0,y:0,src:"pan-tool-icon.png"},ne.EmptyBrush=ne.createBrush(0,[0,0,0,0]),function(t){const e=[],o=new Yt;t.addMode=function(t){e.push(t),o.put(t.key,t)},t.getMode=function(t){return o.get(t)},t.Background=new ne("red",[255,0,0,255],!1,!0,!1,!1,!0,{x:0,y:0}),t.Foreground=new ne("green",[0,255,0,255],!1,!0,!1,!1,!0,{x:0,y:0}),t.Hair=new ne("hair",[255,255,0,128],!1,!0,!1,!1,!0,{x:0,y:0,src:"hair-brush-icon.png"},1.5,3),t.MaskEraser=new ne("erase",[0,0,255,255],!0,!1,!1,!1,!0,{x:0,y:0},1.5,3),t.BackgroundEyeDropper=new ne("eyedropper-bg",[255,0,128,255],!1,!1,!0,!1,!1,{x:0,y:13}),t.GrayEyeDropper=new ne("eyedropper-gray",[128,128,128,255],!1,!1,!0,!1,!1,{x:0,y:13}),t.Grab=ne.simple("pan"),t.ContextMenu=ne.simple("context-menu"),t.ResizeTop=ne.simple("resize-top"),t.ResizeTopRight=ne.simple("resize-top-right"),t.ResizeRight=ne.simple("resize-right"),t.ResizeBottomRight=ne.simple("resize-bottom-right"),t.ResizeBottom=ne.simple("resize-bottom"),t.ResizeBottomLeft=ne.simple("resize-bottom-left"),t.ResizeLeft=ne.simple("resize-left"),t.ResizeTopLeft=ne.simple("resize-top-left"),t.ResizeMove=ne.simple("resize-move"),t.Sword=ne.simple("sword",{x:1,y:1}),t.ShadowArrow=ne.simple("shadow-arrow"),t.ShadowEllipse=ne.simple("shadow-ellipse",{x:3,y:3,src:"shadow-ellipse-tool-cursor.png"}),t.ShadowMove=ne.deselectable("shadow-move",!1),t.ShadowMirror=ne.simple("shadow-mirror");var i=t.Grab,s=t.Grab,r=null,n=null;function a(t){T.App.toolModeChangeHandler(t)}function l(){return s}function c(){return n||r||s}function p(t=!1){(i!=c()||t)&&(null!=i&&(t?$(".tool-radio-button").removeClass("active"):i.elements().removeClass("active")),(i=c()).elements().button("toggle"),null!=a&&a(i))}function u(e){s==e&&s.isDeselectable?(u(t.Grab),setTimeout(p,0,!0)):!function(t){return T.App.toolModeValidate(t)}(e)?setTimeout(p,0,!0):(r=null,s=e,e.mask&&e.mask.resetLast(),p())}function h(t){r=t,p()}t.buildUserMask=function(e,o){return new he(e,o,[0,t.Background.endian32,t.Foreground.endian32,t.Hair.endian32])},t.HairLevelToEndian32=[0,t.Hair.endian32,t.Hair.endian32,t.Hair.endian32,t.Hair.endian32],t.initialize=function(){for(var t=0;t<e.length;t++)e[t].elements()},t.getSelectedMode=l,t.getVisibleMode=function(){return i},t.getTempMode=function(){return r},t.getActiveMode=c,t.update=p,t.cycle=function(t,e){u(l()==t?e:t)},t.select=u,t.is=function(t){return c()==t},t.isNot=function(t){return c()!=t},t.setTempSelect=h,t.releaseTempSelect=function(){h(null)},t.mouseDown=function(){n=c()},t.mouseUp=function(){n&&(n=null,p())},t.forceSelection=function(t,e,o){s=t,r=e,n=o,p()}}(O||(O={})),function(t){const e=[],o=[];t.sourceFunction=R.empty,t.stateUpdated=R.empty;const i=100,s=2e3;var r=0;function n(n){n=n||t.sourceFunction(),e.push(n),e.length>i&&e.shift(),o.length=0,r=Date.now()+s,t.stateUpdated()}t.push=n,t.undo=function(){var i=e.pop();return o.push(t.sourceFunction()),t.stateUpdated(),i},t.redo=function(){var i=o.pop();return e.push(t.sourceFunction()),t.stateUpdated(),i},t.canUndo=function(){return e.length>0},t.canRedo=function(){return o.length>0},t.schedulePush=function(){Date.now()>r&&n()}}(L||(L={})),function(t){t.downloadUrl=function(t,e){return"/images/"+t+"/download/"+e},t.downloadParityUrl=function(t,e,o,i,s,r){return"/images/"+t+"/downloadParity2/"+e+"/"+o+"/"+i+"/"+s+"/"+encodeURIComponent(r)},t.downloadAlphaGrayscaleUrl=function(t,e){return"/images/"+t+"/downloadAlphaGrayscale/"+e},t.downloadSvgPathUrl=function(t,e){return"/images/"+t+"/downloadSvgPath/"+e},t.downloadTiffPathUrl=function(t,e){return"/images/"+t+"/downloadEmbeddedClippingPath/"+e},t.shareUrl=function(t,e){return"/images/"+t+"/"+e},t.surveyUrl=function(t,e){return"/survey?id="+t+"&secret="+e},t.redirectUrl=function(t,e,o){return"/internal/redirect?url="+encodeURIComponent(t)+"&kind="+encodeURIComponent(e)+"&message="+encodeURIComponent(o)},t.fetchUrl=function(t){return"/api/fetchUrl?url="+encodeURIComponent(t)},t.userImageRemove=function(t,e){return"/api/images/delete/"+t+"?bulk="+e},t.userImageUndelete=function(t,e,o,i){return"/api/images/undelete/"+t+"?bulk="+i+"&s="+encodeURIComponent(e)+"&us="+encodeURIComponent(o)},t.userImageRename=function(t,e){return"/api/images/rename/"+t+"?bulk="+e}}(z||(z={}));class ae{constructor(t=0){this.seed=t}nextInt(){return this.seed=(ae.a*this.seed+ae.c)%ae.m,this.seed}nextDouble(){return this.nextInt()/ae.m}nextIntBounded(t){return Math.abs(this.nextInt())%t}}ae.a=1103515245,ae.c=12345,ae.m=1<<31,function(t){const e=D.AutoLevelsMaxNumSamples,o=D.AutoLevelsPercentile,i=D.AutoLevelsMaxSetting,s=D.AutoLevelsNumBuckets;t.run=function(t,r,n){let a=new ae(1e4*n+r),l=t.length/4,c=Math.min(e,l),p=c*o,u=new Uint32Array(s),h=new Uint32Array(s);for(let e=0;e<c;e++){let e=4*a.nextIntBounded(l),o=t[e]/255,i=t[e+1]/255,s=t[e+2]/255,r=0|R.clamp(Math.min(o,i,s)*h.length,0,h.length-1),n=0|R.clamp(Math.max(o,i,s)*u.length,0,u.length-1);h[r]++,u[n]++}let d=0,g=0;for(;d<h.length&&(g+=h[d],!(g>=p));d++);let m=0;for(g=0;m<u.length&&(g+=u[u.length-m-1],!(g>=p));m++);d/=h.length,m=1-m/u.length;let f=1/m,S=1/(1-d/m);return f=R.clamp(Math.floor(100*(f-1)),0,i),S=R.clamp(Math.floor(100*(S-1)),0,i),{highlights:f,shadows:S}}}(U||(U={})),function(t){function e(t){return function(e,o,i){t(R.formatXhrError(e,o))}}function o(t,e){return function(o,i,s){o.error?t(o.error):e(o)}}t.createUserImageSpec=function(t,i,s,r){c.ajax({url:"/api/images",cache:!1,data:{originalFilename:t.name,contentType:t.type,w:i.width(),h:i.height(),sizePixels:i.width()*i.height(),sizeBytes:t.size},dataType:"json",error:e(s),success:o(s,r),type:"POST"})},t.readUserImageSpec=function(t,i,s,r){$.ajax("/api/images/"+t+"/"+i,{cache:!1,dataType:"json",error:e(s),success:o(s,r),type:"GET"})},t.updateMetaData=function(t,i,s,r,n){c.ajax({url:"/api/images/"+t+"/"+i,cache:!1,data:s,dataType:"json",error:e(r),success:o(r,n),type:"POST"})},t.listImagesEx=function(t,i,s,r,n,a,l,c){$.ajax("/api/imagesEx/"+t,{cache:!1,data:{minId:i,maxId:s,maxCount:r,ids:n,q:a},dataType:"json",error:e(l),success:o(l,c),type:"GET"})},t.setStickySettings=function(t,i,s){c.ajax({url:"/api/setStickySettings?stickySettings="+encodeURIComponent(t),cache:!1,data:{},dataType:"json",error:e(i),success:o(i,s),type:"POST"})},t.modifyStickySettings=function(t,i,s){c.ajax({url:"/api/modifyStickySettings?stickySettings="+encodeURIComponent(t),cache:!1,data:{},dataType:"json",error:e(i),success:o(i,s),type:"POST"})},t.getWorkerUrl=function(t,e){let o=("http:"==location.protocol?"ws:":"wss:")+"//"+location.host+t+"?"+GlobalsShared.localeQueryParameter+"="+GlobalsShared.locale;for(let t in e)e.hasOwnProperty(t)&&(o+="&"+t+"="+e[t]);return o}}(G||(G={})),function(t){let e=null;function o(){return location.href.split("#")[0]}function i(t){const i=t.originalEvent;if(i.state&&!T.M.appHasAlreadyRun){const t=i.state;window.resumeUserImage(t.id,t.secret)}else T.M.appHasAlreadyRun&&e!=o()&&(location.replace(location.href),location.href.indexOf("#")>=0&&location.reload());e=o()}t.exitHref="/bulk",t.initialize=function(){e=o(),P.$window.on("popstate",i)},t.goTo=function(i,s){const r=location,n=r.pathname,a="/images/"+i.id+"/edit/"+i.secret,l=0===n.lastIndexOf(a,0);document.title=i.originalFilename+" - Clipping Magic",l?s&&(t.exitHref=r.protocol+"//"+r.host):(s&&(t.exitHref=r.href),history.pushState(i,"",a),R.gaSetPageAndSendPageview("/images/edit"),e=o())},t.exit=function(){const e=o();location.href=t.exitHref,t.exitHref.indexOf("#")>=0&&R.startsWith(t.exitHref,e)&&location.reload()}}(N||(N={})),function(t){let e=!1,o=null;function i(){return e?r():s(),!1}function s(){e||($("html").addClass("help-showing").removeClass("help-hidden"),P.CmApp.Help.Button.$().addClass("active"),P.CmApp.Help.Popover.$().fadeIn(),P.TutorialLightboxOuter.$().fadeIn(),o&&o.play(),e=!0)}function r(){return!!e&&($("html").removeClass("help-showing").addClass("help-hidden"),P.CmApp.Help.Button.$().removeClass("active"),P.CmApp.Help.Popover.$().slideUp(),P.TutorialLightboxOuter.$().fadeOut(),o&&o.pause(),e=!1,!0)}t.toggle=i,t.initialize=function(e){o||(P.CmApp.Help.button.$().click(i),P.TutorialLightboxOuter.$().click(r),o=P.video_green_lightbox.el()),e&&t.show()},t.show=s,t.hide=r}(H||(H={})),function(t){t.visible=!1;let e=!0;const o=3e4;let i,s,r=0,n=null;function a(t,e){e.$().attr("style","width:"+t+"%"),e.$().toggleClass("active",.1<t&&t<99.9)}function l(t){a(t,P.StartupLightbox.Uploading)}function c(t){a(t,P.StartupLightbox.Initializing)}function p(){return P.StartupLightbox.Uploading.$().parent().parent().parent()}function u(){p().hide()}function h(){R.gaTrack("StartupProgress","timeout",s,o),e=!1}t.hideShadowPane=function(){P.StartupLightbox.Outer.addClass(P.StartupLightbox.single_pane)},t.showShadowPane=function(){P.StartupLightbox.Outer.removeClass(P.StartupLightbox.single_pane)},t.uploadProgress=l,t.initProgress=c,t.alreadyUploaded=u,t.track=function(t){r=Date.now(),s=t},t.show=function(e,s=!1){t.visible=!0,clearTimeout(i),i=setTimeout(h,o),P.StartupLightbox.content.$().attr("style",""),P.StartupLightbox.Id.$().find(".modal-content").attr("style","margin: 0 auto;"),P.StartupLightbox.Id.$().show(),P.StartupLightbox.Outer.$().show(),s||p().show(),e&&window.GlobalsEx.showTutorial?(P.StartupLightbox.Id.addClass(P.StartupLightbox.video_playing),n=P.StartupLightbox.video.el(),n&&n.play()):P.StartupLightbox.video.$().hide(),H.initialize(!1)},t.hide=function(){t.visible&&(t.visible=!1,clearTimeout(i),P.StartupLightbox.Outer.$().fadeOut(),P.StartupLightbox.Id.$().hide(),n&&(n.pause(),R.blink2(P.CmApp.Help.Button)),l(0),c(0),u(),e&&(R.gaTrack("StartupProgress","initializing",s,Date.now()-r),e=!1))}}(V||(V={})),function(t){function e(t,e,o){let i="";if(o){let t=new Date;t.setTime(t.getTime()+24*o*60*60*1e3),i="; expires="+t.toUTCString()}document.cookie=t+"="+l.encode(e||"")+i+"; path=/"}function o(t,e=void 0){let o=t+"=",i=document.cookie.split(";");for(let t=0;t<i.length;t++){let s=i[t];for(;" "==s.charAt(0);)s=s.substring(1,s.length);if(0==s.indexOf(o))return l.decodeString(s.substring(o.length,s.length),e)}return e}function i(t){document.cookie=t+"=; Max-Age=-99999999;"}t.Cookie=class{constructor(t,e=365){this.name=t,this.days=e}get(t=void 0){return o(this.name,t)}set(t){return e(this.name,t,this.days)}getBoolean(){return!!this.get()}setBoolean(t){t?this.set("1"):this.erase()}erase(){i(this.name)}},t.set=e,t.get=o,t.containsKey=function(t){return!!o(t)},t.getBoolean=function(t,e=void 0){let i=o(t);return"true"==i||"false"!=i&&e},t.getInt=function(t,e=void 0){let i=o(t);if(null!=i){let t=parseInt(i);if(isFinite(t))return t}return e},t.getFloat=function(t,e=void 0){let i=o(t);if(null!=i){let t=parseFloat(i);if(isFinite(t))return t}return e},t.getJson=function(t,e=void 0){let i=o(t);try{if(null!=i)return a.cast(JSON.parse(i))}catch(t){}return e},t.setJson=function(t,o,i){e(t,JSON.stringify(o),i)},t.erase=i}(W||(W={})),function(t){const e=P.video.green.show.name()+" "+P.video.erase.show.name();var o=!1,i=null,s=!1;const r=5;var n=0,a=0,l=!1,c=!1;function p(s){c=!0,o||(o=!0,P.guide_next_button.$().click(t.hide)),function(t){s=t.show,P.GuideLightbox.$().removeClass(e).addClass(s.name()),function(t){var e=u(t)-20-10+"px";P.GuideLightbox.$().css({left:e});var o=u(t)-10+"px";P.GuideLightbox.$().children(P.arrow.css()).css({left:o})}(t.Tool),o=t,i&&(i.pause(),i=null),(i=o.Id.el())&&i.play();var o;var s}(s),P.GuideLightboxOuter.$().show()}function u(t){var e=t.$(),o=e.offset(),i=e.outerWidth();return Math.max(0,i/2+o.left)}function h(){if(!T.M.settings.autoClip&&!l&&(n>=r&&0==a||0==n&&a>=r)){l=!0;let t=window.GlobalsEx.showGuides;R.gaTrack("guide","showAlternate",t.toString(),t?1:0),t&&p(P.video.green)}}t.hide=function(){c&&(c=!1,P.GuideLightboxOuter.$().hide())},t.checkShowHighlighting=function(){if(!s){s=!0;let t=window.GlobalsEx.showGuides;R.gaTrack("guide","showHighlighting",t.toString(),t?1:0),t&&p(P.video.erase)}},t.strokeGreen=function(){n++,h()},t.strokeRed=function(){a++,h()},t.strokeResume=function(){n++,a++}}(X||(X={})),function(t){t.decode=function(t,e,o,i){for(var s=new Uint8Array(t),r=0,n=0,a=0;r<s.length;){var l=s[r++],c=3&l,p=1+(l>>3&31);if(0==(4&l)?3==c||(p+=s[r++]<<5):p+=3==c?s[r++]<<5:(s[r++]<<5)+(s[r++]<<13)+(s[r++]<<21),0==c)n+=p;else if(1==c)for(a=0;a<p;a++,n++)e(4*n);else if(2==c)for(a=0;a<p;a++,n++)o(4*n);else for(a=0;a<p;a++,n++)i(4*n,s[r++],s[r++],s[r++],s[r++])}}}(Y||(Y={})),function(t){function e(){return null!=t.savedMask}t.hasSavedMaskS3=function(){return window.GlobalsEx.hasSavedMask},t.hasSavedMaskClient=e;var o=-1,i=-1,s=!1,r=null,n=-1;function a(){return e()?(null!=r&&r.width()==t.savedMask.width&&r.height()==t.savedMask.height||(r=O.buildUserMask(t.savedMask.width,t.savedMask.height)).decode(t.savedMask.userMask,t.savedMask.maskVersion),0!=n&&clearTimeout(n),n=setTimeout(l,1e4),r):null}function l(){n=-1,r=null}function c(){e()?P.CmApp.Tools.paste_mask_tool.$().removeAttr("disabled"):P.CmApp.Tools.paste_mask_tool.$().attr("disabled","disabled")}function u(){var t=Math.floor(50*i/o),e=O.buildUserMask(50,t),s=Math.floor(.8*t);e.context().setFillStyle(O.Background.cssColor),e.context().fillRect(0,0,1,s),e.context().fillRect(0,0,50,1),e.context().fillRect(49,0,1,s),h({userMask:e.encode(),maskVersion:D.MaskVersion,width:50,height:t,toolModeKey:O.Foreground.key})}function h(e){t.savedMask=e,l(),c()}function d(){var e=T.M.userMask;h({userMask:e.encode(),maskVersion:D.MaskVersion,width:e.width(),height:e.height(),toolModeKey:O.getSelectedMode().key}),window.GlobalsEx.savedMaskS3Spec&&k.uploadS3JsonWithRetry(t.savedMask,window.GlobalsEx.savedMaskS3Spec,{url:window.Globals.s3_url,backupUrl:window.Globals.s3_backup_url,label:p.s("Storing Copied Mask"),maxAge:0,success:()=>{window.GlobalsEx.hasSavedMask=!0,T.M.sendSetGlobal(),window.Globals.Bulk.isIframe&&window.checkPostMessage({command:D.SavedMaskUpdated})},giveUpAfterSilentRetries:!0})}function g(){var e=a();if(null!=e){for(var s=e.width(),r=e.height(),n=e.context().getImageData(0,0,s,r).data,l=T.M.userMask,c=l.context().getImageData(0,0,o,i),p=c.data,u=s/o,h=r/i,d=0,g=0;d<i;d++)for(var m=Math.floor(d*h),f=0;f<o;f++,g+=4)for(var S=4*(Math.floor(f*u)+s*m),w=0;w<3;w++){var C=n[S+w];0!=C&&(p[g+w]=C,p[g+3]=255)}L.push(),l.putImageData(c),setTimeout((()=>{T.M.sendSetUserMask(!0),T.App.refreshAllViews()}))}t.pasteButtonIsHovered=!1,T.App.refreshAllViews()}t.savedMask=null,t.pasteButtonIsHovered=!1,t.getMask=a,t.initializeUi=function(e,r){if(!s){if(o=e,i=r,window.GlobalsEx.savedMaskS3Spec)P.CmApp.Tools.copy_mask_tool.$().click(d),P.CmApp.Tools.paste_mask_tool.$().click(g),P.CmApp.Tools.paste_mask_tool.$().hover((()=>{t.pasteButtonIsHovered=!0,T.M.tempViewMarksToggle(!0),T.App.refreshAllViews()}),(()=>{t.pasteButtonIsHovered=!1,T.M.tempViewMarksToggle(!1),T.App.refreshAllViews()}));else{const t=P.CmApp.Tools.copy_mask_tool.or(P.CmApp.Tools.paste_mask_tool).$().parent();if(window.Globals.Bulk.isApi)t.hide();else{const e=p.s("Please log in to copy/paste masks. ");t.addClass("disabled").attr({title:e,alt:e})}}s=!0}},t.checkFetch=function(){c(),window.GlobalsEx.hasSavedMask&&window.GlobalsEx.savedMaskS3Spec?$.ajax(window.GlobalsEx.savedMaskS3Spec.url,{cache:!1,dataType:"json",error:(t,e,o)=>{u()},success:h,type:"GET"}):u()},t.pasteMask=g}(q||(q={})),function(t){let e=!1;t.doApply=function(){e=!0};const o="ClippingMagic.com";let i,s,r,n=-1,a=-1,l=[-1,-1,-1,-1];t.checkApply=function(t,c){if(e){const e=t.context();if(c&&4==c.length||(c=[0,0,e.width(),e.height()]),l[0]!=c[0]||l[1]!=c[1]||l[2]!=c[2]||l[3]!=c[3])for(n=c[2]-c[0],a=c[3]-c[1],l[0]=c[0],l[1]=c[1],l[2]=c[2],l[3]=c[3],i=10,r=0;r<.65*n||r<50;)i+=2,s="bold "+i+"px sans-serif",e.setFont(s),r=e.measureText(o).width;let p=i+4,u=l[0]+(n-r)/2,h=l[1]+(a-p)/2;e.setGlobalAlpha(.25),e.setFont(s),e.setFillStyle("#fff"),e.fillText(o,u,h),e.setFillStyle("#000"),e.fillText(o,u,h),e.setStrokeStyle("#fff"),e.strokeText(o,u,h)}}}(J||(J={})),function(t){var e={showPreview:!0,showFrame:!0,showBackground:!0,title:""};const o=20,i=60;var s=!1,r=!1,n=!1,a=0;const l=new Kt([new Zt(P.CmApp.CropApp.MarginUnits.Pixels,D.CropMarginPixels),new Zt(P.CmApp.CropApp.MarginUnits.Percent,D.CropMarginPercent)]),c=new Kt([new Zt(P.CmApp.CropApp.ObjectSize.Small,D.CropSizeSmall),new Zt(P.CmApp.CropApp.ObjectSize.Medium,D.CropSizeMedium),new Zt(P.CmApp.CropApp.ObjectSize.Large,D.CropSizeLarge)]),u=new Kt([new Zt(P.CmApp.CropApp.VerticalAlignment.Top,D.CropAlignmentTop),new Zt(P.CmApp.CropApp.VerticalAlignment.Middle,D.CropAlignmentMiddle),new Zt(P.CmApp.CropApp.VerticalAlignment.Bottom,D.CropAlignmentBottom)]),h=new Kt([new Zt(P.CmApp.CropApp.Shadows.Ignore,D.CropShadowsIgnore),new Zt(P.CmApp.CropApp.Shadows.Pad,D.CropShadowsPad),new Zt(P.CmApp.CropApp.Shadows.Tight,D.CropShadowsTight)]);function d(){n=!1,g(),ht.subViewPort.refreshAllViews()}function g(){0!=a&&(clearTimeout(a),a=0)}function m(t){t.$().hover((()=>{n=!0,g(),ht.subViewPort.refreshAllViews()}),(()=>{g(),a=setTimeout(d,1e4)}))}function f(t,e,o,s){R.mouseDownRepeater(t.decrease.$(),(()=>{e(),ht.subViewPort.zoomToFit()}),i,5,L.schedulePush,lt.sendSetGlobal),R.mouseDownRepeater(t.increase.$(),(()=>{o(),ht.subViewPort.zoomToFit()}),i,5,L.schedulePush,lt.sendSetGlobal),t.reset.$().click((()=>{s(),ht.subViewPort.zoomToFit()}))}function S(){if(!s){s=!0,P.CmApp.CropApp.close_button.$().click(_),P.CmApp.CropApp.Mode.Unconstrained.$().click((()=>{v(D.CropUnconstrained)})),P.CmApp.CropApp.Mode.LockedAspectRatio.$().click((()=>{v(D.CropLockedAspectRatio)})),P.CmApp.CropApp.Mode.TargetSize.$().click((()=>{v(D.CropTargetSize)})),P.CmApp.CropApp.fit_to_original_btn.$().click((()=>{lt.setCropFitToResult(!1,!0),lt.setCropMode(D.CropUnconstrained,!0),lt.setCrop_o(null,!0),ht.subViewPort.zoomToFit()})),E.registerRadioGroup(l,A),E.registerRadioGroup(c,k),E.registerRadioGroup(u,M),E.registerRadioGroup(h,x),f(P.CmApp.CropApp.PaddingPercent,lt.cropPaddingDecrease,lt.cropPaddingIncrease,lt.cropPaddingReset),f(P.CmApp.CropApp.PaddingPixels,lt.cropPaddingPixelsDecrease,lt.cropPaddingPixelsIncrease,lt.cropPaddingPixelsReset),f(P.CmApp.CropApp.Dpi,lt.outputDpiDecrease,lt.outputDpiIncrease,lt.outputDpiReset),P.CmApp.CropApp.DpiPresets.preset72.$().click((()=>lt.setOutputDpi(72,!0))),P.CmApp.CropApp.DpiPresets.preset96.$().click((()=>lt.setOutputDpi(96,!0))),P.CmApp.CropApp.DpiPresets.preset300.$().click((()=>lt.setOutputDpi(300,!0))),m(P.CmApp.CropApp.StraightenSpinner.decrease),m(P.CmApp.CropApp.StraightenSpinner.increase),P.CmApp.CropApp.FitToResultButton.$().click((()=>{lt.setCropFitToResult(!lt.settings.cropFitToResult,!0),ht.subViewPort.animateZoomToFit()})),P.CmApp.CropApp.reset_button.$().click((()=>{lt.resetCrop(),ht.subViewPort.animateZoomToFit()})),P.CmApp.CropApp.allow_enlarging_result.$().click((()=>{lt.setCropAllowEnlarging(!lt.settings.cropAllowEnlarging,!0,!0),ht.subViewPort.animateZoomToFit()}));var t=P.CmApp.CropApp.AspectRatio.List.$();t.empty();for(var e=0;e<D.AspectRatios.length;e++)y(t,D.AspectRatios[e]);var o=R.fuzzyAspectRatio(lt.imageSize);D.AspectRatios.indexOf(o)<0&&(w(t),y(t,o)),w(t),C(t,p.s("Custom"),(function(){R.modal(P.CmApp.CropApp.AspectRatio.Lightbox.css())})),P.CmApp.CropApp.AspectRatio.OkButton.$().click((()=>{var t={w:parseFloat(P.CmApp.CropApp.AspectRatio.W.$().val()),h:parseFloat(P.CmApp.CropApp.AspectRatio.H.$().val())},e=t.w<=0||isNaN(t.w),o=t.h<=0||isNaN(t.h);o||e||(t.h/t.w>10||t.w/t.h>10)&&(e=o=!0),P.CmApp.CropApp.AspectRatio.WFg.$().toggleClass("has-error",e),P.CmApp.CropApp.AspectRatio.HFg.$().toggleClass("has-error",o),e||o||(lt.setCropAspectRatio(t,!0,!0),P.CmApp.CropApp.AspectRatio.Lightbox.$().modal("hide"),ht.subViewPort.animateZoomToFit())}));var i=P.CmApp.CropApp.TargetSize.List.$();i.empty();for(e=0;e<D.TargetSizes.length;e++)b(i,D.TargetSizes[e]);w(i),b(i,lt.imageSize),w(i),function(t){C(t,p.s("Custom"),(function(){R.modal(P.CmApp.CropApp.TargetSize.Lightbox.css())}))}(i),P.CmApp.CropApp.TargetSize.OkButton.$().click((()=>{var t={w:parseInt(P.CmApp.CropApp.TargetSize.W.$().val()),h:parseInt(P.CmApp.CropApp.TargetSize.H.$().val())};let e=!(t.h*t.w<D.MaxOutputSize),o=t.w<1||isNaN(t.w)||t.w>D.MaxOutputWidthOrHeight||e,i=t.h<1||isNaN(t.h)||t.h>D.MaxOutputWidthOrHeight||e;P.CmApp.CropApp.TargetSize.WFg.$().toggleClass("has-error",o),P.CmApp.CropApp.TargetSize.HFg.$().toggleClass("has-error",i),o||i||(lt.setCropTargetSize(t,!0,!0),P.CmApp.CropApp.TargetSize.Lightbox.$().modal("hide"),ht.subViewPort.animateZoomToFit())}))}}function w(t){var e=$(document.createElement("li"));e.addClass("divider"),t.append(e)}function C(t,e,o){var i=$(document.createElement("li")),s=$(document.createElement("a"));return s.attr("href","#"),s.text(e),s.click((t=>{o(),ht.subViewPort.animateZoomToFit(),t.preventDefault()})),i.append(s),t.append(i),s}function y(t,e){C(t,R.formatAspectRatio(e),(function(){lt.setCropAspectRatio(e,!0,!0)}))}function b(t,e){C(t,lt.formatTargetSize(e),(function(){lt.setCropTargetSize(e,!0,!0)}))}function v(t){lt.setCropMode(t,!0),ht.subViewPort.zoomToFit()}function A(t){lt.setCropMarginUnits(t,!0),ht.subViewPort.zoomToFit()}function k(t){lt.setCropObjectSize(t,!0),ht.subViewPort.zoomToFit()}function M(t){lt.setCropVerticalAlignment(t,!0),ht.subViewPort.zoomToFit()}function x(t){lt.setCropShadows(t,!0),ht.subViewPort.zoomToFit()}function _(){P.CmApp.CropApp.Sidebar.$().hide(),P.SubappLightbox.$().modal("hide"),r=ht.subViewPort.showing=!1,T.App.subAppHidden(),n=!1}t.showGrid=function(){return n},t.initialize=S,t.show=function(){S(),O.Grab.pick(),P.subapp_sidebar.$().hide(),P.CmApp.CropApp.Sidebar.$().show(),P.CmApp.SubApps.tab.$().removeClass("active"),P.CmApp.CropApp.Tab.$().addClass("active"),R.modal(P.SubappLightbox.css()),ht.subViewPort.setViewConfigAndShow(e,t),r=!0,z()},t.hide=_,t.keyDownHandler=function(t){if(t.ctrlKey||t.altKey||t.metaKey)return!1;switch(t.keyCode){case 27:if(gt.hide())break;_();break;case 82:t.shiftKey?T.App.straightenCounterclockwiseRepeater.down():lt.rotateCounterclockwise();break;case 84:t.shiftKey?T.App.straightenClockwiseRepeater.down():lt.rotateClockwise()}return!0},t.keyUpHandler=function(t){if(t.ctrlKey||t.altKey||t.metaKey)return!1;switch(t.keyCode){case 82:T.App.straightenCounterclockwiseRepeater.up();break;case 84:T.App.straightenClockwiseRepeater.up()}return!0};let F={w:-1,h:-1},I="";function B(){const t=function(){let t=lt.getCrop_o();if(lt.settings.cropMode==D.CropTargetSize){let e=lt.getCropTargetSize();if(null!=e&&(lt.settings.cropAllowEnlarging||e.w<t.width()||e.h<t.height()))return e}return{w:t.width(),h:t.height()}}();return t.w==F.w&&t.h==F.h||(F=t,I=lt.formatTargetSize(t)),I}function z(){if(r){var t=lt.getCropAspectRatio();P.CmApp.CropApp.locked_aspect_ratio_display.$().text(R.formatAspectRatio(t));var e=lt.getCropTargetSize();P.CmApp.CropApp.target_size_display.$().text(lt.formatTargetSize(e));var o=lt.settings.cropMode;o==D.CropUnconstrained?P.CmApp.CropApp.Mode.Unconstrained.$().prop("checked",!0):o==D.CropLockedAspectRatio?P.CmApp.CropApp.Mode.LockedAspectRatio.$().prop("checked",!0):o==D.CropTargetSize&&P.CmApp.CropApp.Mode.TargetSize.$().prop("checked",!0),l.update(lt.settings.cropMarginUnits),c.update(lt.settings.cropObjectSize),u.update(lt.settings.cropVerticalAlignment),h.update(lt.settings.cropShadows);var i=lt.settings.cropMarginUnits==D.CropMarginPercent;P.CmApp.CropApp.PaddingPercent.container.$().toggle(i),P.CmApp.CropApp.PaddingPixels.container.$().toggle(!i),P.CmApp.CropApp.PaddingPercent.display.$().text((.1*lt.settings.cropPaddingMils).toFixed(1)+"%"),P.CmApp.CropApp.PaddingPixels.display.$().text(lt.settings.cropPaddingPixels.toFixed(0)+"px"),P.CmApp.CropApp.FitToResultButton.$().prop("checked",lt.settings.cropFitToResult),P.CmApp.CropApp.fit_to_result_controls.$().toggle(lt.settings.cropFitToResult),P.CmApp.CropApp.fit_to_result_comment.$().toggle(!lt.settings.cropFitToResult),P.CmApp.CropApp.output_size_display.$().text(B()),P.CmApp.CropApp.allow_enlarging_result.$().prop("checked",lt.settings.cropAllowEnlarging)}}t.outputSizeS=B,t.updateDisplay=z;var U=null,G=new Xt,N=!1;t.pointerInteraction=function(t){switch(t.type){case ut.InteractionType.CanvasLeave:O.releaseTempSelect();break;case ut.InteractionType.Hover:if(!ht.subViewPort.getShiftIsDown()){let t=function(){var t=ht.subViewPort.getMouse_c(),e=ht.subViewPort.getCrop_c();if(Math.abs(e.centerX()-t.x)<=o&&Math.abs(e.centerY()-t.y)<=o)return O.ResizeMove;if(t.x>e.left0-o&&t.x<e.right0+o&&t.y>e.top0-o&&t.y<e.bottom0+o){var i=t.x<e.left0+o,s=t.x>e.right0-o,r=t.y<e.top0+o,n=t.y>e.bottom0-o;if(i)return r?O.ResizeTopLeft:n?O.ResizeBottomLeft:O.ResizeLeft;if(s)return r?O.ResizeTopRight:n?O.ResizeBottomRight:O.ResizeRight;if(r)return O.ResizeTop;if(n)return O.ResizeBottom}return O.Grab}();O.setTempSelect(t)}break;case ut.InteractionType.ActionStart:O.isNot(O.Grab)&&(N=!1,U=lt.getCrop_o());break;case ut.InteractionType.ActionMove:if(O.isNot(O.Grab)){let o=O.getActiveMode();N||(N=!0,lt.settings.cropFitToResult?lt.setCropFitToResult(!1,!0):L.push());var e=ht.subViewPort.getZoomScale(),i=ht.subViewPort.getClick_c(),s=(t.pageX-i.x)/e,r=(t.pageY-i.y)/e;if(G.setFrom(U),o==O.ResizeMove)G.left0+=s,G.right0+=s,G.top0+=r,G.bottom0+=r;else{var n=null;lt.settings.cropMode==D.CropLockedAspectRatio?n=lt.getCropAspectRatio():lt.settings.cropMode==D.CropTargetSize&&(n=lt.getCropTargetSize());var a=n?n.w/n.h:0,l=n?n.h/n.w:0;o==O.ResizeTop?(G.top0=U.top0+r,n&&(G.left0=U.left0+r*a/2,G.right0=U.right0-r*a/2)):o==O.ResizeTopRight?(G.top0=U.top0+r,G.right0=U.right0+s,n&&(G.y2x()>a?G.top0=U.top0-s*l:G.right0=U.right0-r*a)):o==O.ResizeRight?(G.right0=U.right0+s,n&&(G.top0=U.top0-s*l/2,G.bottom0=U.bottom0+s*l/2)):o==O.ResizeBottomRight?(G.bottom0=U.bottom0+r,G.right0=U.right0+s,n&&(G.y2x()>a?G.bottom0=U.bottom0+s*l:G.right0=U.right0+r*a)):o==O.ResizeBottom?(G.bottom0=U.bottom0+r,n&&(G.left0=U.left0-r*a/2,G.right0=U.right0+r*a/2)):o==O.ResizeBottomLeft?(G.bottom0=U.bottom0+r,G.left0=U.left0+s,n&&(G.y2x()>a?G.bottom0=U.bottom0-s*l:G.left0=U.left0-r*a)):o==O.ResizeLeft?(G.left0=U.left0+s,n&&(G.top0=U.top0+s*l/2,G.bottom0=U.bottom0-s*l/2)):o==O.ResizeTopLeft&&(G.top0=U.top0+r,G.left0=U.left0+s,n&&(G.y2x()>a?G.top0=U.top0+s*l:G.left0=U.left0+r*a))}lt.setCrop_o(G,!1),ht.subViewPort.refreshAllViews()}break;case ut.InteractionType.ActionEnd:N&&lt.sendSetGlobal()}};const H=20,V=18;t.drawOver_i=function(t,e){},t.drawUnder_i=function(t,e,o,i){},t.drawUnder_c=function(t,e,o,i){},t.drawOver_c=function(t,e){t.empty(),e.setGlobalAlpha(1),e.setLineJoin("miter"),e.setLineCap("square");var i=ht.subViewPort.getCrop_c();function s(t,o,i,s,r){var n=O.is(r);e.setFillStyle("#ffffff"),e.fillRect(t+i,o+s,i*H,6*s),e.fillRect(t+i,o+s,6*i,s*H),e.setFillStyle(n?"#ff0000":"#000000"),e.fillRect(t+2*i,o+2*s,i*V,4*s),e.fillRect(t+2*i,o+2*s,4*i,s*V)}function r(t,o,i,s){var r=O.is(s);e.setFillStyle("#ffffff"),e.fillRect(t+i,o-10,6*i,H),e.setFillStyle(r?"#ff0000":"#000000"),e.fillRect(t+2*i,o-9,4*i,V)}function n(t,o,i,s){var r=O.is(s);e.setFillStyle("#ffffff"),e.fillRect(t-10,o+i,H,6*i),e.setFillStyle(r?"#ff0000":"#000000"),e.fillRect(t-9,o+2*i,V,4*i)}s(i.left0,i.top0,1,1,O.ResizeTopLeft),s(i.right0,i.top0,-1,1,O.ResizeTopRight),s(i.right0,i.bottom0,-1,-1,O.ResizeBottomRight),s(i.left0,i.bottom0,1,-1,O.ResizeBottomLeft),r(i.left0,Math.round(i.centerY()),1,O.ResizeLeft),r(i.right0,Math.round(i.centerY()),-1,O.ResizeRight),n(Math.round(i.centerX()),i.top0,1,O.ResizeTop),n(Math.round(i.centerX()),i.bottom0,-1,O.ResizeBottom),function(t,i,s){var r=o/2,n=1.75*r,a=O.is(s)?"#ff0000":"#000000";e.beginPath(),e.triangle(t,i-n,-Math.PI/2,2,5),e.triangle(t,i+n,Math.PI/2,2,5),e.triangle(t-n,i,Math.PI,2,5),e.triangle(t+n,i,0,2,5),e.strokeEx(2,"#FFF"),e.fillEx(a);var l=r+2;e.fillCircle(t,i,l,"#FFFFFF"),e.fillCircle(t,i,l-1,a)}(Math.round(i.centerX()),Math.round(i.centerY()),O.ResizeMove)}}(Q||(Q={})),function(t){var e=!1;function o(t=null){return e&&(e=!1,P.contextMenu.Lightbox.$().modal("hide"),null!=t&&t.preventDefault(),P.contextMenu.toolbar.$().hide()),!1}function i(t,o){return e=!0,R.modal(P.contextMenu.Lightbox.css(),!0,!0),t.preventDefault(),o.$().show().offset({left:t.clientX,top:t.clientY-30}),!1}t.dismiss=o,t.showMain=function(t){return i(t,P.contextMenu.ToolbarMark)},t.showShadowApp=function(t){return i(t,P.contextMenu.ToolbarShadowApp)},t.showColorsApp=function(t){return i(t,P.contextMenu.ToolbarColorsApp)},t.showBackgroundApp=function(t){return i(t,P.contextMenu.ToolbarBackgroundApp)},$((()=>{P.contextMenu.Lightbox.$().on("click",o).on("contextmenu",o)}))}(j||(j={})),function(t){var e={showPreview:!0,showFrame:!0,showBackground:!0,showEyeDropperLoupe:!0,title:"",contextMenuHandler:j.showColorsApp},o=!1;function i(){o||(o=!0,P.CmApp.ColorsApp.close_button.$().click(s),P.CmApp.ColorsApp.ColorSpace.SRgb.$().click((()=>lt.setOutputColorSpace(D.ColorSpaceSrgb,!0))),P.CmApp.ColorsApp.ColorSpace.AdobeRgb.$().click((()=>lt.setOutputColorSpace(D.ColorSpaceAdobeRgb,!0))),P.CmApp.ColorsApp.ColorSpace.AppleRgb.$().click((()=>lt.setOutputColorSpace(D.ColorSpaceAppleRgb,!0))),P.CmApp.ColorsApp.ColorSpace.ColorMatchRgb.$().click((()=>lt.setOutputColorSpace(D.ColorSpaceColorMatchRgb,!0))),R.hoverHelper(P.CmApp.ColorsApp.OriginalButton.$(),(t=>{ht.subViewPort.setViewConfigs([t?nt.OrigConfig:e]),ht.subViewPort.refreshAllViews()})))}function s(){P.CmApp.ColorsApp.Sidebar.$().hide(),P.SubappLightbox.$().modal("hide"),ht.subViewPort.showing=!1,T.App.subAppHidden()}t.initialize=i,t.show=function(){try{i(),O.Grab.pick(),P.subapp_sidebar.$().hide(),P.CmApp.ColorsApp.Sidebar.$().show(),P.SubappLightbox.$().show(),P.CmApp.SubApps.tab.$().removeClass("active"),P.CmApp.ColorsApp.Tab.$().addClass("active"),R.modal("#subapp-lightbox"),ht.subViewPort.setViewConfigAndShow(e,t),!0}catch(t){}},t.hide=s,t.keyDownHandler=function(t){if(t.ctrlKey||t.altKey||t.metaKey)return!1;switch(t.keyCode){case 27:if(gt.hide())break;s()}return!0},t.keyUpHandler=function(t){return!(t.ctrlKey||t.altKey||t.metaKey)&&(t.keyCode,!0)},t.mouseDownHandler=function(t){var e=O.getVisibleMode();if(e.isEyeDropper&&0==t){var o=ht.subViewPort.getMouse_ii(),i=lt.getOriginalPixel(o.x,o.y);e==O.BackgroundEyeDropper?lt.setCastColor(i,!0,!0):e==O.GrayEyeDropper&&lt.setWhiteBalanceGrayColor(i,!0,!0)}},t.mouseMoveHandler=function(t,e,o){},t.mouseUpHandler=function(t){O.getSelectedMode().isEyeDropper&&O.Grab.pick()},t.mouseDoubleClickHandler=function(t){},t.touchEndHandler=function(){},t.mouseWheelHandler=function(t){},t.pointerInteraction=function(t){if(t.type===ut.InteractionType.ActionEnd){let t=O.getVisibleMode();if(t.isEyeDropper){var e=ht.subViewPort.getMouse_ii(),o=lt.getOriginalPixel(e.x,e.y);t==O.BackgroundEyeDropper?lt.setCastColor(o,!0,!0):t==O.GrayEyeDropper&&lt.setWhiteBalanceGrayColor(o,!0,!0)}O.getSelectedMode().isEyeDropper&&O.Grab.pick()}},t.drawUnder_c=function(t,e,o,i){},t.drawOver_i=function(t,e){},t.drawUnder_i=function(t,e,o,i){},t.drawOver_c=function(t,e){}}(Z||(Z={})),function(t){var e={showPreview:!0,showFrame:!0,showBackground:!0,showEyeDropperLoupe:!0,title:"",contextMenuHandler:j.showBackgroundApp},o=!1;function i(){o||(o=!0,P.CmApp.BackgroundApp.close_button.$().click(s),R.hoverHelper(P.CmApp.BackgroundApp.OriginalButton.$(),(t=>{ht.subViewPort.setViewConfigs([t?nt.OrigConfig:e]),ht.subViewPort.refreshAllViews()})))}function s(){P.CmApp.BackgroundApp.Sidebar.$().hide(),P.SubappLightbox.$().modal("hide"),ht.subViewPort.showing=!1,T.App.subAppHidden()}t.initialize=i,t.show=function(){try{i(),O.Grab.pick(),P.subapp_sidebar.$().hide(),P.CmApp.BackgroundApp.Sidebar.$().show(),P.SubappLightbox.$().show(),P.CmApp.SubApps.tab.$().removeClass("active"),P.CmApp.BackgroundApp.Tab.$().addClass("active"),R.modal("#subapp-lightbox"),ht.subViewPort.setViewConfigAndShow(e,t),!0}catch(t){}},t.hide=s,t.keyDownHandler=function(t){if(t.ctrlKey||t.altKey||t.metaKey)return!1;switch(t.keyCode){case 27:if(gt.hide())break;s();break;case 66:lt.stepBackgroundColor(t.shiftKey);break;case 71:lt.jumpToLastBackgroundColor(t.shiftKey)}return!0},t.keyUpHandler=function(t){return!(t.ctrlKey||t.altKey||t.metaKey)&&(t.keyCode,!0)},t.mouseDownHandler=function(t){},t.mouseMoveHandler=function(t,e,o){},t.mouseUpHandler=function(t){},t.mouseDoubleClickHandler=function(t){},t.touchEndHandler=function(){},t.mouseWheelHandler=function(t){},t.pointerInteraction=function(t){},t.drawUnder_c=function(t,e,o,i){},t.drawOver_i=function(t,e){},t.drawUnder_i=function(t,e,o,i){},t.drawOver_c=function(t,e){}}(K||(K={})),function(t){const e=2-(1+Math.sqrt(5))/2;function o(t,o){return t+e*(o-t)}function i(t,o){return o-e*(o-t)}function s(t,e,s,r){let n=e,a=s,l=o(n,a),c=i(n,a),p=t(n),u=t(l),h=t(c),d=t(a);for(;a-n>r;)h<u?(n=l,p=u,l=c,u=h,c=i(n,a),h=t(c)):(a=c,d=h,c=l,h=u,l=o(n,a),u=t(l));return p<=u&&p<=h&&p<=d?{t:n,f:p}:u<=h&&u<=d?{t:l,f:u}:h<=d?{t:c,f:h}:{t:a,f:d}}t.findArgMaxGoldenSection=function(t,e,s,r){let n=e,a=s,l=o(n,a),c=i(n,a),p=t(n),u=t(l),h=t(c),d=t(a);for(;a-n>r;)h>u?(n=l,p=u,l=c,u=h,c=i(n,a),h=t(c)):(a=c,d=h,c=l,h=u,l=o(n,a),u=t(l));return p>=u&&p>=h&&p>=d?{t:n,f:p}:u>=h&&u>=d?{t:l,f:u}:h>=d?{t:c,f:h}:{t:a,f:d}},t.findArgMinGoldenSection=s,t.findArgMinSamplingThenGoldenSection=function(t,e,o,i,r){let n=Number.MAX_VALUE,a=-1;for(let i=0;i<r.length;i++){let s=t(e+(o-e)*i/(r.length-1));r[i]=s,s<=n&&(n=s,a=i)}let l=e;for(let t=a-1;t>=0;t--)r[t]>n&&(l=e+(o-e)*t/(r.length-1));let c=o;for(let t=a+1;t<r.length;t++)r[t]>n&&(c=e+(o-e)*t/(r.length-1));return s(t,l,c,i)}}(tt||(tt={})),function(t){const e=1e-6;t.roots=new Float64Array(3),t.numRoots=0;const o=Math.cbrt?Math.cbrt:function(t){var e=Math.pow(Math.abs(t),1/3);return t<0?-e:e};t.solve=function(i,s,r,n){if(Math.abs(i)<e)if(Math.abs(s)<e)Math.abs(r)<e?t.numRoots=0:(t.roots[0]=-n/r,t.numRoots=1);else{let o=r*r-4*s*n;o>e?(t.roots[0]=(-r+Math.sqrt(o))/(2*s),t.roots[1]=(-r-Math.sqrt(o))/(2*s),t.numRoots=2):o<-e?t.numRoots=0:(t.numRoots=1,t.roots[0]=-r/(2*s))}else{s/=i,r/=i,n/=i,i=1;let e=s/3,a=s*s,l=(3*r-a)/9,c=(9*s*r-27*n-2*s*a)/54,p=l*l*l,u=p+c*c;if(u>0){t.numRoots=1;let i=Math.sqrt(u),s=o(c+i),r=o(c-i);t.roots[0]=s+r-e,t.roots[1]=t.roots[2]=NaN}else if(u<0){t.numRoots=3;let o=Math.acos(c/Math.sqrt(-p)),i=Math.sqrt(-l);t.roots[0]=2*i*Math.cos(o/3)-e,t.roots[1]=2*i*Math.cos((o+2*Math.PI)/3)-e,t.roots[2]=2*i*Math.cos((o+4*Math.PI)/3)-e}else{t.numRoots=3;let i=o(c);t.roots[0]=2*i-e,t.roots[2]=t.roots[1]=-i-e}}return t.numRoots>0}}(et||(et={})),function(t){const e="#00cc00",o="#FFFFFF",i="#E67A00",s="#888888";class r{constructor(t,e,o){this.mouse_i=t,this.zoomScale=e,this.isTouch=o;const i=o?1.5:1;this.innerRadius_c=R.clamp(8*Math.log(e),6,10)*i,this.outerRadius_c=5*this.innerRadius_c,this.innerRadius_i=this.innerRadius_c/e,this.outerRadius_i=this.outerRadius_c/e,this.innerRadiusSqr_i=this.innerRadius_i*this.innerRadius_i,this.outerRadiusSqr_i=this.outerRadius_i*this.outerRadius_i,this.unscaled=o?new r(t,e,!1):this}static forDrawing(t){return new r(null,t.getZoomScale(),ut.lastUserInteractionWasTouch)}}const n=new class{constructor(){this.pEval=new Rt(0,0),this.testLine=new zt(new Rt(0,0),new Rt(0,0))}set(t,e){this.p0=t.p0,this.p1=t.controlNext,this.p2=e.controlPrev,this.p3=e.p0}eval(t){return this.pEval.x=this.p3.x*t*t*t+3*this.p2.x*(1-t)*t*t+3*this.p1.x*(1-t)*(1-t)*t+this.p0.x*(1-t)*(1-t)*(1-t),this.pEval.y=this.p3.y*t*t*t+3*this.p2.y*(1-t)*t*t+3*this.p1.y*(1-t)*(1-t)*t+this.p0.y*(1-t)*(1-t)*(1-t),this.pEval}distanceSqrToLines(t,e){let o=0;this.testLine.p0.set(this.eval(o));let i=null;for(let s=1;s<=e;s++){let r=s/e;this.testLine.p1.set(this.eval(r));let n=this.testLine.distSqrTo(t);(null==i||n.distanceSqr<i.distanceSqr)&&(i=n,i.t=o+i.t/e),this.testLine.p0.set(this.testLine.p1),o=r}return i}distanceSqrTo(t,e){let o=this.distanceSqrToLines(t,10);return o.distanceSqr<2*e?this.distanceSqrToLines(t,100):o}},a=(new Float64Array(20),new Rt(0,0));const l=new class{p1c(t){return this.pc.minus(this.p0.times((1-t)*(1-t))).minus(this.p2.times(t*t)).times(1/Math.max(1e-6,2*t*(1-t)))}fitGoldenSection(t,e,o){this.p0=t,this.pc=e,this.p2=o;let i=R.safeDiv(.1,t.distanceTo(e)+e.distanceTo(o)),s=tt.findArgMinGoldenSection((i=>(a.setInterpolated(t,o,i).minusEquals(e),R.sqr(1/(i*(1-i)))*a.lengthSqr())),.001,.999,i);this.tc=s.t,this.p1=this.p1c(this.tc)}fit(t,e,o){this.p0=t,this.pc=e,this.p2=o;let i=t.lengthSqr(),s=t.dot(e),r=e.lengthSqr(),n=t.dot(o),a=e.dot(o),l=-2*(2*s-i-r),c=-2*(3*i-5*s+2*r-n+a),p=-2*(-3*i+3*s+3*n-3*a),u=-2*(i-2*n+o.lengthSqr());if(this.tc=.5,et.solve(u,p,c,l))for(let t=0;t<et.numRoots;t++){let e=et.roots[t];e>=0&&e<=1&&(this.tc=e)}this.p1=this.p1c(this.tc)}tangent(t){let e=2*(1-t),o=2*t;return new Rt(e*(this.p1.x-this.p0.x)+o*(this.p2.x-this.p1.x),e*(this.p1.y-this.p0.y)+o*(this.p2.y-this.p1.y)).normalize()}};function c(t,e,o,i,s,r){t.setLineWidth(1);let n=i.unscaled.innerRadius_c;if(r){let i=Math.round(.785*n);t.fillSquare(e,o,i,s),t.strokeSquare(e,o,i,"#000000")}else t.fillCircle(e,o,n,s),t.strokeCircle(e,o,n,"#000000")}const p=1/3;class u{constructor(t){this._isCorner=!1,this.p0=new Rt(t.x,t.y),this._isCorner=!!t.isCorner}toString(){return"Node("+this.p0.x+", "+this.p0.y+")"}move(t){this.p0.set(t),D.UseScalpelNeighborhoodUpdate?this.updateControlPointsInNeighborhood():this.cut.updateAllControlPoints()}deleteNode(){this.cut.isLoop()?this.cut.cutLoopAt(this):(this.prev&&(this.prev.next=this.next),this.next&&(this.next.prev=this.prev),this.cut.nodeDeleted(this))}setIsCorner(t){this._isCorner=t,D.UseScalpelNeighborhoodUpdate?this.updateControlPointsInNeighborhood():this.cut.updateAllControlPoints()}toggleSmooth(){this.setIsCorner(!this._isCorner)}canSnapTo(t){return this.isEndNode()&&t.isEndNode()&&this!=t&&(this.cut!=t.cut||this.cut.getNodeCount()>3)}updateControlPointsInNeighborhood(){this.prev&&(this.prev.prev&&this.prev.prev.updateControlPoints(),this.prev.updateControlPoints()),this.updateControlPoints(),this.next&&(this.next.updateControlPoints(),this.next.next&&this.next.next.updateControlPoints())}updateControlPoints(){if(this._isCorner||this.isEndNode()){if(this.next)if(this.next.next&&!this.next._isCorner){l.fit(this.p0,this.next.p0,this.next.next.p0);let t=l.tangent(0).timesEquals(p);this.controlNext=this.p0.plus(t.times(this.p0.distanceTo(this.next.p0)))}else{let t=this.next.p0.minus(this.p0).timesEquals(p);this.controlNext=this.p0.plus(t),this.next.controlPrev=this.next.p0.minus(t)}else this.controlNext=null;if(this.prev){if(this.prev.prev&&!this.prev._isCorner){l.fit(this.p0,this.prev.p0,this.prev.prev.p0);let t=l.tangent(0).timesEquals(p);this.controlPrev=this.p0.plus(t.times(this.p0.distanceTo(this.prev.p0)))}}else this.controlPrev=null}else{l.fit(this.prev.p0,this.p0,this.next.p0);let t=l.tangent(l.tc).timesEquals(p);this.controlNext=this.p0.plus(t.times(this.p0.distanceTo(this.next.p0))),this.controlPrev=this.p0.minus(t.times(this.prev.p0.distanceTo(this.p0)))}}encode(){return{x:this.p0.x,y:this.p0.y,isCorner:this.isCorner()}}xc(t){return t.o2cX(this.p0.x)}yc(t){return t.o2cY(this.p0.y)}cPrevX(t){return t.o2cX(this.controlPrev.x)}cPrevY(t){return t.o2cY(this.controlPrev.y)}cNextX(t){return t.o2cX(this.controlNext.x)}cNextY(t){return t.o2cY(this.controlNext.y)}isCorner(){return this._isCorner}hoveringNearNode(){return!m&&this==A.node&&2!=A.zone}isOverNode(){return this==A.node&&3==A.zone}isEndNode(){return!this.prev||!this.next}withinHitRadius(t){return this.withinHitRadiusSqr(t.mouse_i,t.outerRadiusSqr_i)}withinHitRadiusSqr(t,e){return this.isEndNode()||(e*=.4623999999999999),this.distanceToSqr(t)<e}withinNodeRadius(t){return this.distanceToSqr(t.mouse_i)<t.innerRadiusSqr_i}distanceToSqr(t){return this.p0.distanceSqrTo(t)}hitTest(t){let e=t.innerRadius_i,o=this.p0.distanceTo(t.mouse_i),i=e*Math.SQRT2*(this.isEndNode()?2:1.2),s=new d(6,this,this.cut);return s.deletePoint=this.p0.offset(i,-i),s.toggleCornerPoint=this.p0.offset(-i,-i),o<=e?s.zone=3:this.isEndNode()&&o<=3*e?s.zone=1:s.deletePoint.distanceTo(t.mouse_i)<=e?s.zone=4:s.toggleCornerPoint.distanceTo(t.mouse_i)<=e&&(s.zone=5),1!=s.zone&&(s.mouseOffset_i=this.p0.minus(t.mouse_i)),s}drawDelete(t,e,o,i,s){let r=o.unscaled.innerRadius_c/3;e.withGlobalAlpha(1,(()=>{let n=o.unscaled.innerRadius_c,a=.8*n*Math.SQRT1_2,l=t.o2cX(i.x),c=t.o2cY(i.y);e.fillCircle(l,c,n,s?"#cc0000":"rgb(120,60,60)"),e.beginPath(),e.moveTo(l-a,c-a),e.lineTo(l+a,c+a),e.moveTo(l-a,c+a),e.lineTo(l+a,c-a),e.strokeEx(r,s?"#FFFFFF":"#DDDDDD")}))}drawToggle(t,e,o,i,s){let r=o.unscaled.innerRadius_c/3;e.withGlobalAlpha(1,(()=>{let n=o.unscaled.innerRadius_c,a=.8*n,l=t.o2cX(i.x),c=t.o2cY(i.y);if(e.fillCircle(l,c,n,s?"#5377cc":"#405b8a"),e.context.lineWidth=r,e.context.strokeStyle=s?"#FFFFFF":"#DDDDDD",e.context.lineJoin="miter",e.context.beginPath(),this._isCorner){let t=.866*a,o=.5*a,i=.5*a;e.context.moveTo(l-t,c+o),e.context.quadraticCurveTo(l-i,c-i,l,c-.33*a),e.context.quadraticCurveTo(l+i,c-i,l+t,c+o)}else{let t=.866*a,o=.33*a;e.context.moveTo(l-t,c+o),e.context.lineTo(l,c-.5*a),e.context.lineTo(l+t,c+o)}e.context.stroke()}))}drawButtonsAndExtendsZone(t,e,o){A.deletePoint&&(this.drawDelete(t,e,o,A.deletePoint,4==A.zone),this.drawToggle(t,e,o,A.toggleCornerPoint,5==A.zone));let i=this.xc(t),s=this.yc(t);this.isEndNode()&&e.withGlobalAlpha(1==A.zone?.25:.125,(()=>{let t=3*o.innerRadius_c;e.fillCircle(i,s,t,"#FFFFFF"),e.strokeEx(1,"#000000")}))}drawNodeExtendPreview(t,o,i){let s=t.getMouse_c();if(s.x>me.OffScreen&&s.y>me.OffScreen){let s=t.getMouse_i(),r=t.o2c(s);o.beginPath(),o.moveTo(this.xc(t),this.yc(t)),o.lineTo(r.x,r.y),o.strokeEx(D.LineOuterWidth,"#000000"),o.strokeEx(D.LineInnerWidth,e),c(o,r.x,r.y,i,e,this.isCorner())}}drawControlPoints(t,e){e.withGlobalAlpha(1,(()=>{let o=this.xc(t),i=this.yc(t);if(this.controlPrev){let s=t.o2c(this.controlPrev);e.strokeLine(o,i,s.x,s.y,1,"#00ffff")}if(this.controlNext){let s=t.o2c(this.controlNext);e.strokeLine(o,i,s.x,s.y,1,"#00ffff")}}))}draw(t,e,r,n){let a=n||(this.cut.isActive?i:s);O.getActiveMode()==O.Sword&&(this.hoveringNearNode()?(this.drawButtonsAndExtendsZone(t,e,r),1==A.zone&&this.drawNodeExtendPreview(t,e,r)):m&&m.node==this&&(2!=y&&b||this.drawButtonsAndExtendsZone(t,e,r)),n||(this.isOverNode()?a=1==y&&b?"rgba(255,255,255,0.25)":o:this.hoveringNearNode()&&(a=this.cut.isActive?"#FFB866":"#bbbbbb"))),c(e,this.xc(t),this.yc(t),r,a,this.isCorner())}}class h{constructor(t,e,o){this.nodeFirst=t,this.nodeLast=e,this.nodeCount=o,this.isActive=!1,this.setCut(this),this.updateAllControlPoints()}static fromPoint(t){return h.fromPoints(t,t)}static fromPoints(t,e){let o=new u(t),i=new u(e);return o.next=i,i.prev=o,new h(o,i,2)}static decode(t){const e=t.nodes.map((function(t){return new u(t)}));for(let t=1;t<e.length;t++){const o=e[t-1],i=e[t];o.next=i,i.prev=o}let o=new h(e[0],e[e.length-1],e.length);return t.isLoop&&o.closeLoopLastToFirst(),o}encode(){const t=[];for(let e=this.nodeFirst,o=0;o<this.nodeCount;e=e.next,o++)t.push(e.encode());return{nodes:t,isLoop:this.isLoop()}}closeLoopLastToFirst(){this.nodeLast.next=this.nodeFirst,this.nodeFirst.prev=this.nodeLast,this.nodeLast=this.nodeFirst,this.updateAllControlPoints()}getNodeCount(){return this.nodeCount}dup(){return h.decode(this.encode())}isLoop(){return this.nodeFirst==this.nodeLast}findNode(t){for(let e=this.nodeFirst,o=0;o<this.nodeCount;e=e.next,o++)if(e.p0.equals(t))return e;return null}toString(){let t="Cut(";for(let e=this.nodeFirst,o=0;o<this.nodeCount;e=e.next,o++)t+=e.p0.x+","+e.p0.y+"; ";return t+=")",t}iterateNodePairs(t){for(let e=this.nodeFirst,o=1;o<this.nodeCount;e=e.next,o++)t(e,e.next)}samplePoints(t,e){for(let o=this.nodeFirst,i=1;i<this.nodeCount;o=o.next,i++){n.set(o,o.next);for(let i=1;i<t;i++){let s=i/t;e(n.eval(s),o.next)}}}appendToPolyBezierSet(t){let e=t.points.length,o=[];t.swords.push(o);for(let i=this.nodeFirst,s=this.isLoop()?0:1;s<this.nodeCount;i=i.next,s++){let s=i.p0,r=i.controlNext,n=i.next.controlPrev;i.next.p0;t.points.push(s,r,n),o.push([e++,e++,e++,e])}t.points.push(this.nodeLast.p0)}setCut(t){for(let e=this.nodeFirst,o=0;o<this.nodeCount;e=e.next,o++)e.cut=t}reverseInPlace(){for(let t=this.nodeFirst,e=0;e<this.nodeCount;e++){const e=t.next;t.next=t.prev,t.prev=e,t=e}const t=this.nodeFirst;this.nodeFirst=this.nodeLast,this.nodeLast=t}joinCutsByNodes(t,e){if(this!=t.cut)throw"Must call on lion!";if(this==e.cut)this.nodeFirst.prev=this.nodeLast.prev,this.nodeLast.prev.next=this.nodeFirst,this.nodeLast=this.nodeFirst,this.nodeCount--;else{const o=e.cut;o.setCut(this),t==this.firstNode()&&this.reverseInPlace(),e==o.lastNode()&&o.reverseInPlace(),t.next=e.next,e.next.prev=t,t.setIsCorner(t.isCorner()||e.isCorner()),this.nodeLast=o.nodeLast,this.nodeCount+=o.getNodeCount()-1,o.deleteCut()}this.updateAllControlPoints()}firstNode(){return this.nodeFirst}lastNode(){return this.nodeLast}extend(t,e){let o=new u(e);return o.setIsCorner(t.isCorner()),o.cut=this,t==this.nodeLast?(t.next=o,o.prev=t,this.nodeLast=o):(t.prev=o,o.next=t,this.nodeFirst=o),this.nodeCount++,D.UseScalpelNeighborhoodUpdate?o.updateControlPointsInNeighborhood():this.updateAllControlPoints(),o}updateAllControlPoints(){for(let t=this.nodeFirst,e=0;e<this.nodeCount;t=t.next,e++)t.updateControlPoints()}cutLoopAt(t){this.isLoop()&&(this.nodeFirst=t.next,this.nodeFirst.prev=null,this.nodeLast=t.prev,this.nodeLast.next=null,this.nodeCount--,this.updateAllControlPoints())}nodeDeleted(t){this.isLoop()||(this.nodeCount--,t==this.nodeFirst?this.nodeFirst=this.nodeFirst.next:t==this.nodeLast&&(this.nodeLast=this.nodeLast.prev),this.nodeFirst==this.nodeLast?this.deleteCut():this.updateAllControlPoints())}deleteCut(){t.cutSet.deleteCut(this)}addNode(t,e,o){let i=new u(e.plus(o));return i.cut=this,i.prev=t.prev,i.prev.next=i,i.next=t,t.prev=i,this.nodeCount++,D.UseScalpelNeighborhoodUpdate?i.updateControlPointsInNeighborhood():this.updateAllControlPoints(),i}hitTestNodesOnly(t){for(let e=this.nodeLast,o=0;o<this.nodeCount;e=e.prev,o++)if(e.withinNodeRadius(t))return e.hitTest(t);return null}hitTest(t){for(let e=this.nodeLast,o=0;o<this.nodeCount;e=e.prev,o++)if(e.withinHitRadius(t))return e.hitTest(t);const e=t.innerRadiusSqr_i;for(let o=this.nodeLast,i=this.isLoop()?0:1;i<this.nodeCount;o=o.prev,i++){n.set(o.prev,o);const i=n.distanceSqrToLines(t.mouse_i,100);if(i.distanceSqr<e)return new d(2,o,this,i.pp.minusEquals(t.mouse_i))}return null}draw(t,o,r,n){let a=n||(this.isActive?i:s);o.beginPath(),o.moveTo(this.nodeFirst.xc(t),this.nodeFirst.yc(t));for(let e=this.nodeFirst.next,i=this.isLoop()?0:1;i<this.nodeCount;e=e.next,i++){let i=e.prev;o.bezierCurveTo(i.cNextX(t),i.cNextY(t),e.cPrevX(t),e.cPrevY(t),e.xc(t),e.yc(t))}if(o.strokeEx(D.LineOuterWidth,"#000000"),o.strokeEx(D.LineInnerWidth,a),O.getSelectedMode()==O.Sword)for(let e=this.nodeFirst,i=0;i<this.nodeCount;e=e.next,i++)A.node!=e&&e.draw(t,o,r,n);if(O.getActiveMode()==O.Sword&&2==A.zone&&A.cut==this){let i=t.getMouse_i().plusEquals(A.getMouseOffset_i()),s=t.o2c(i);c(o,s.x,s.y,r,e,!1)}}}class d{constructor(t,e,o,i,s){this.zone=t,this.node=e,this.cut=o,this.mouseOffset_i=i,this.interactionIdentifier=s}getMouseOffset_i(){return this.mouseOffset_i?this.mouseOffset_i:Rt.empty()}dup(){return new d(this.zone,this.node,this.cut,this.mouseOffset_i,this.interactionIdentifier)}}t.cutSet=new class{constructor(){this.cuts=[]}decode(t){this.cuts=t.cuts.map(h.decode)}encode(){return{cuts:this.cuts.map((function(t){return t.encode()}))}}encodedPolyBezierSet(){let t=new Wt;for(let e of this.cuts)e.appendToPolyBezierSet(t);return t}setActiveSwords(t){if(t.length==this.cuts.length)for(let e=0;e<t.length;e++)this.cuts[e].isActive=t[e]}checkClear(){return this.cuts.length>0&&(this.cuts.length=0,!0)}hitTest(t){if(A.node&&A.node.withinHitRadius(t)){let e=A.node.hitTest(t);switch(e.zone){case 3:case 5:case 4:return e}}for(let e=this.cuts.length-1;e>=0;e--){let o=this.cuts[e].hitTestNodesOnly(t);if(o)return o}if(A.node&&A.node.withinHitRadius(t))return A.node.hitTest(t);for(let e=this.cuts.length-1;e>=0;e--){let o=this.cuts[e].hitTest(t);if(o)return o}return new d(0,null,null)}addCut(t){let e=h.fromPoint(t);return this.cuts.push(e),e}deleteCut(t){const e=this.cuts.indexOf(t);e>=0&&this.cuts.splice(e,1)}snapToNodeOrNull(t,e){const o=1.5*t.innerRadiusSqr_i*1.5;for(let e=this.cuts.length-1;e>=0;e--){const i=this.cuts[e];if(m.node.canSnapTo(i.lastNode())&&i.lastNode().withinHitRadiusSqr(t.mouse_i,o))return i.lastNode();if(m.node.canSnapTo(i.firstNode())&&i.firstNode().withinHitRadiusSqr(t.mouse_i,o))return i.firstNode()}return null}draw(t,i){const s=r.forDrawing(t);ut.lastUserInteractionWasTouch||!A.node||5!=A.zone&&4!=A.zone||i.withGlobalAlpha(.5,(()=>{if(5==A.zone&&(A.node.toggleSmooth(),A.node.cut.draw(t,i,s,e),A.node.toggleSmooth()),4==A.zone){let o=A.node.cut;if(!o.isLoop()&&o.getNodeCount()>2){let r=o.dup();r.findNode(A.node.p0).deleteNode(),r.draw(t,i,s,e)}}})),i.withGlobalAlpha(1,(()=>{for(let e of this.cuts)e.draw(t,i,s);if(A.node&&A.node.draw(t,i,s),A.snapTo){const e=A.snapTo;c(i,e.xc(t),e.yc(t),s,o,e.isCorner())}})),i.withGlobalAlpha(1,(()=>{if(this.cuts.length>0)for(let e=0;e<C.length;e++){let o=C[e],r=t.o2cX(o.x),n=t.o2cY(o.y),a=1.5*s.innerRadius_c;i.strokeCircle(r,n,a,"#FF0000"),i.strokeCircle(r,n,a-1,"#880000")}}))}};let g,m,f=null,S=!1,w=0,C=[],y=0,b=!1;const v=new d(0,null,null,null);let A=v;function k(){y=0,g=null,m=null,b=!1}function M(){S&&(S=!1,w=T.M.sendSetSword())}function x(){f=null,S=!0}t.clearDownState=k,t.pointerInteraction=function e(o,i,s){const n=new r(i,s,o.isTouch);switch(o.type){case ut.InteractionType.Hover:let r=t.cutSet.hitTest(n);r.interactionIdentifier=A.node&&A.node==r.node?A.interactionIdentifier:o.interactionIdentifier,A=r;break;case ut.InteractionType.Tap:A.interactionIdentifier!=o.interactionIdentifier&&(e(o.dup(ut.InteractionType.ActionStart),i,s),e(o.dup(ut.InteractionType.ActionEnd),i,s));break;case ut.InteractionType.ActionStart:switch(k(),A.zone){case 0:L.push(),A.cut=t.cutSet.addCut(i),A.node=A.cut.lastNode(),A.zone=3,y=1,x();break;case 1:A.interactionIdentifier!=o.interactionIdentifier&&(L.push(),A.node=A.node.cut.extend(A.node,i),A.zone=3,y=1,x());break;case 2:L.push(),A.node=A.cut.addNode(A.node,i,A.getMouseOffset_i()),A.zone=3,y=1,x();break;case 3:L.push(),y=1,x();break;case 4:case 5:y=2;break;case 6:y=0}g=i,m=A.dup();break;case ut.InteractionType.ActionMove:switch(y){case 1:m.node.isEndNode()&&(A.snapTo=t.cutSet.snapToNodeOrNull(n,m.node.cut))?m.node.move(A.snapTo.p0):m.node.move(i.plus(m.getMouseOffset_i())),x();break;case 2:A=A.node.hitTest(n)}b=b||!i.equals(g);break;case ut.InteractionType.ActionEnd:if(1==y)A.snapTo&&m.node.cut.joinCutsByNodes(m.node,A.snapTo),A=v,A=t.cutSet.hitTest(n);else if(m&&A&&2==y&&m.zone==A.zone&&m.node==A.node&&A.interactionIdentifier!=o.interactionIdentifier)switch(m.zone){case 4:L.push(),m.node.deleteNode(),A=v,A=t.cutSet.hitTest(n),x();break;case 5:L.push(),m.node.toggleSmooth(),x()}k(),M();break;case ut.InteractionType.DoubleClick:A&&3==A.zone&&(L.push(),A.node.toggleSmooth(),x(),k(),M(),A=t.cutSet.hitTest(n))}};function _(e){f=e,t.cutSet.decode(e),A=new d(0,null,null),k()}t.decodeSword=function(t){R.tic();let e=Vt.decode(t,new Vt).polyBeziers.map((function(t){let e=[];for(let o of t.beziers)if(o.isLine)e.push(o.evalToNode(0,!0));else{let t=h.fromPoints(o.p0,o.p2);t.firstNode().toggleSmooth();let i=new Yt;i.put(t.firstNode(),0),i.put(t.lastNode(),1);let s=0,r=new Rt(0,0),a=t.lastNode(),l=0,c=0;do{if(s>.25){let e=t.addNode(a,r.dup(),Rt.empty());i.put(e,l),s=0}t.iterateNodePairs((function(t,e){let c=(i.get(t)+i.get(e))/2,p=o.eval(c);n.set(t,e);let u=n.distanceSqrTo(p,s);u.distanceSqr>s&&(s=u.distanceSqr,r.set(p),a=e,l=c)})),c+=1}while(s>.25&&c<10);for(let o=t.firstNode(),i=0,s=t.getNodeCount()-1;i<s;o=o.next,i++)e.push(o.encode())}let o=t.beziers[t.beziers.length-1];return e.push(o.evalToNode(1,!0)),{nodes:e}}));R.toc("Decoded sword"),_({cuts:e})},t.decode=_,t.encode=function(){return null==f&&(f=t.cutSet.encode()),f},t.clear=function(){t.cutSet.checkClear()&&(x(),M())},t.clearHoverState=function(){A=v},t.setSwordIntersections=function(t){C.length=0;for(let e=0;e<t.length;e++)C.push(t[e])},t.setActiveSwords=function(e,o){o>=w&&!S&&t.cutSet.setActiveSwords(e)}}(ot||(ot={})),function(t){t.attachToLink=function(t,e){t.off("dragstart.DragUrl").on("dragstart.DragUrl",(function(t){const o=e();o&&t.originalEvent.dataTransfer.setData("DownloadURL",o+":"+this.href)}))},t.attachDecorated=function(){$("a[data-dragurl]").on("dragstart",(function(t){const e=$(this).data("dragurl");e&&t.originalEvent.dataTransfer.setData("DownloadURL",e)}))}}(it||(it={})),function(t){var e=/%([0-9A-Fa-f]{2})/g,o=/[^\x20-\x7e\xa0-\xff]/g,i=/\\([\u0000-\u007f])/g,s=/; *([!#$%&'\*\+\-\.0-9A-Z\^_`a-z\|~]+) *= *("(?:[ !\x23-\x5b\x5d-\x7e\x80-\xff]|\\[\x20-\x7e])*"|[!#$%&'\*\+\-\.0-9A-Z\^_`a-z\|~]+) */g,r=/^([A-Za-z0-9!#$%&+\-^_`{}~]+)'(?:[A-Za-z]{2,3}(?:-[A-Za-z]{3}){0,3}|[A-Za-z]{4,8}|)'((?:%[0-9A-Fa-f]{2}|[A-Za-z0-9!#$&+\-\.^_`|~])+)$/,n=/^([!#$%&'\*\+\-\.0-9A-Z\^_`a-z\|~]+) *(?:$|;)/;function a(t){var i=r.exec(t);if(!i)throw new TypeError("invalid extended field value");var s,n=i[1].toLowerCase(),a=i[2].replace(e,l);switch(n){case"iso-8859-1":s=String(a).replace(o,"?");break;case"utf-8":s=decodeURIComponent(escape(a));break;default:throw new TypeError("unsupported charset in extended field")}return s}function l(t,e){return String.fromCharCode(parseInt(e,16))}t.parse=function(t){if(t&&"string"==typeof t){var e=n.exec(t);if(e){var o,r,l=e[0].length,c=(e[1].toLowerCase(),[]),p={};try{for(l=s.lastIndex=";"===e[0].substr(-1)?l-1:l;e=s.exec(t);){if(e.index!==l)throw new TypeError("invalid parameter format");if(l+=e[0].length,o=e[1].toLowerCase(),r=e[2],-1!==c.indexOf(o))throw new TypeError("invalid duplicate parameter");c.push(o),o.indexOf("*")+1!==o.length?"string"!=typeof p[o]&&('"'===r[0]&&(r=r.substr(1,r.length-2).replace(i,"$1")),p[o]=r):(o=o.slice(0,-1),r=a(r),p[o]=r)}if(-1!==l&&l!==t.length)throw new TypeError("invalid parameter format")}catch(t){}return p.filename}}}}(st||(st={})),function(t){const e={url:"",progress:R.empty,error:R.empty,success:R.empty,withCredentials:!1,contentType:null};function o(t,e){return R.blobToFile(t,e||"FetchedFromUrl_"+Date.now())}t.download=function(t){let i=$.extend({},e,t),s=R.dataUrlToBlob(i.url)||R.dataUrlToBlob(i.displayUrl);if(s)setTimeout((function(){i.success(o(s))}),0);else{let t=new XMLHttpRequest,e=0;i.progress!=R.empty&&(t.onprogress=t=>{if(t.lengthComputable){let o=Math.round(100*t.loaded/t.total);e!==o&&(e=o,i.progress(e))}}),t.onerror=e=>{i.error(R.formatXhrError(t,void 0))},t.onabort=e=>{i.error(R.formatXhrError(t,"abort"))},t.withCredentials=!!i.withCredentials,t.onload=e=>{if(t.response)if(t.status<200||t.status>299){let e=String.fromCharCode.apply(null,new Uint8Array(t.response));i.error(p.s('Failed to fetch "{0}"',i.displayUrl||i.url)+"\n"+e)}else{let e=i.contentType||t.getResponseHeader("Content-Type"),s=st.parse(t.getResponseHeader("Content-Disposition")),r=t.response,n=o(new Blob([r],{type:e}),s);i.success(n)}},t.open("GET",i.url,!0),t.responseType="arraybuffer",t.send()}}}(rt||(rt={})),function(t){t.OrigConfig={title:"Original",showOriginal:!0,showHoverTool:!0,contextMenuHandler:j.showMain};const e={title:"Original + Marks",showOriginal:!0,showUserMask:!0,showSword:!0,showBeziers:!0,showHoverTool:!0,showReviewCursor:!0,contextMenuHandler:j.showMain},o={title:"Preview",showPreview:!0,showFrame:!0,showBackground:!0,showHairLoupe:!0,clip:!0,panModeOnly:!0,showHoverTool:!D.ScreenshotMode,showReviewCursor:!0,contextMenuHandler:j.showMain,showSize:!0},i={title:"Preview",showPreview:!0,showFrame:!0,showBackground:!0,showHairLoupe:!0,clip:!0,panModeOnly:!1,showHoverTool:!D.ScreenshotMode,showReviewCursor:!0,contextMenuHandler:j.showMain,showSize:!0};t.NormalSplit=[e,o];const s=t.NormalSplit,r=[t.OrigConfig,t.OrigConfig],n=[t.NormalSplit,s,r],a=[e];t.PreviewSingle=[i];const l=[t.OrigConfig],c=[a,t.PreviewSingle,l];t.get=function(t,e){return(t?n:c)[e]};let u=!1;t.translateTitles=function(i){u||(t.OrigConfig.title=p.s(t.OrigConfig.title),e.title=p.s(e.title),o.title=p.s(o.title),u=!0),t.OrigConfig.filename=e.filename=i}}(nt||(nt={}));class le{static checkSupported(t){t.addClass(navigator.clipboard&&navigator.clipboard.write?P.CopyPaste.supported:P.CopyPaste.notSupported)}constructor(t,e){this.btn=t,this.performCopy=e,this.isDisabled=!1,this.clearCopyModeTimeoutId=-1,this.click=t=>{this.isDisabled||(this.setClass(this.btn.show_copying),this.performCopy((()=>{this.setClass(this.btn.show_copied),this.clearModesTimeout()}),(()=>{this.setClass(this.btn.show_failed),this.clearModesTimeout()})))},t.copy_to_clipboard.$().click(this.click),this.setClass(this.btn.show_copy)}disabled(t){this.isDisabled=t,this.btn.copy_to_clipboard.$().toggleClass("disabled",t)}setClass(t=null){this.btn.copy_to_clipboard.removeClass(this.btn.show_copy),this.btn.copy_to_clipboard.removeClass(this.btn.show_copying),this.btn.copy_to_clipboard.removeClass(this.btn.show_copied),this.btn.copy_to_clipboard.removeClass(this.btn.show_failed),t&&this.btn.copy_to_clipboard.addClass(t)}clearModesTimeout(){-1!=this.clearCopyModeTimeoutId&&clearTimeout(this.clearCopyModeTimeoutId),this.clearCopyModeTimeoutId=setTimeout((()=>{this.setClass(this.btn.show_copy),this.clearCopyModeTimeoutId=-1}),3e3)}}!function(t){let e=!1;const o=[P.CmApp.Brush.Popover,P.CmApp.BgColor.Popover,P.CmApp.Edges.Popover,P.CmApp.Hair.Popover,P.CmApp.Review.Popover,P.CmApp.Ecommerce.Popover];var i,s,r=null,l=0,c=0,u=null,h=null,d=!1;let g;t.ViewPanesGroup=new Kt([new Zt(P.ViewPanes.marks,D.ViewPanesSingle),new Zt(P.ViewPanes.both,D.ViewPanesSplit)]),t.hide=function(){};var m=30;function f(t,e,o,i,s){t.reset.$().click(e),R.mouseDownRepeater(t.decrease.$(),o,m,5,L.push,s),R.mouseDownRepeater(t.increase.$(),i,m,5,L.push,s)}function S(t,e,o,i){t.reset.$().click(e),t.decrease.$().click((function(){o(-i)})),t.increase.$().click((function(){o(i)}))}function w(t,e,o,i){f(t,e,o,i,(()=>{lt.updateColorLevels(),lt.sendSetGlobal()}))}function C(){$("#result-dialog").modal("hide")}function y(){u=K,M(),K.show()}function b(){u=Z,M(),Z.show()}function v(){u=Q,M(),Q.show()}function A(){u=dt,M(),dt.show()}function k(t){$("#result-dialog").toggleClass(P.resultDialog.hasDownloaded.name(),t)}function M(){ht.subViewPort.initialize({image:r,canvasDiv:$("#subapp-view"),showGrid:Q.showGrid,viewConfigs:nt.PreviewSingle})}function x(){L.canUndo()?P.CmApp.Tools.undo.$().removeAttr("disabled"):P.CmApp.Tools.undo.$().attr("disabled","disabled"),P.CmApp.Tools.undoMenuItem.$().toggleClass("disabled",!L.canUndo()),L.canRedo()?P.CmApp.Tools.redo.$().removeAttr("disabled"):P.CmApp.Tools.redo.$().attr("disabled","disabled"),P.CmApp.Tools.redoMenuItem.$().toggleClass("disabled",!L.canRedo())}t.imageUpdated=function(){P.CmApp.tool_popover_content.$().find(".dropdown").on("show.bs.dropdown",(function(t){const e=t.target.closest(P.CmApp.tool_popover_content.css());e.classList.add(P.CmApp.dropdown_open.name()),e.style.right=3+e.scrollWidth-window.innerWidth+"px",P.$window.on("resize.positioner",(()=>{e.style.right=3+e.scrollWidth-window.innerWidth+"px"}))})).on("hide.bs.dropdown",(function(t){const e=t.target.closest(P.CmApp.tool_popover_content.css());e.classList.remove(P.CmApp.dropdown_open.name()),e.style.removeProperty("right"),P.$window.off("resize.positioner")}));let p=nt.NormalSplit;D.IncludeOriginal&&p.unshift(nt.OrigConfig),$(".navbar").hide(),$(".footer").hide(),$(".container >").hide(),P.AppOuterWrapper.$().show(),P.AppWrapper.$().show(),$("html").addClass("html-app-mode").toggleClass(P.hide_bottom_toolbar.name(),window.GlobalsEx.hideBottomToolbar),ht.main.showing=!0,r=lt.imageCanvas,l=r.width(),c=r.height(),h=$(".canvas-view"),D.IncludeOriginal&&P.AppView.$().css("width","1138px"),D.ScreenshotMode&&($("#viewport-debug-group").show(),P.CmApp.Dev.viewport_set.$().click((()=>{ht.main.fromString($("#viewport-setting").val())}))),ht.main.initialize({image:r,canvasDiv:P.AppView.$(),viewConfigs:p,app:t}),nt.translateTitles(lt.getFilename()),function(){if(!e){P.$window.keydown(G),P.$window.keyup(z),P.$window.resize((()=>{window.innerWidth<=768&&lt.setViewPanesMode(D.ViewPanesSingle)}));var r=ht.main.repeaterDelay;R.mouseDownRepeater(P.CmApp.Tools.zoom_in.$(),ht.main.animateZoomInAboutCenter,r,1),R.mouseDownRepeater(P.CmApp.Tools.zoom_out.$(),ht.main.animateZoomOutAboutCenter,r,1),P.CmApp.Tools.zoom_to_fit.$().click((t=>{t.shiftKey?ht.main.zoomToFitTight():ht.main.animateZoomToFit()})),R.mouseDownRepeater(P.CmApp.Tools.subapp_zoom_in.$(),ht.subViewPort.animateZoomInAboutCenter,r,1),R.mouseDownRepeater(P.CmApp.Tools.subapp_zoom_out.$(),ht.subViewPort.animateZoomOutAboutCenter,r,1),P.CmApp.Tools.subapp_zoom_to_fit.$().click((t=>{t.shiftKey?ht.subViewPort.zoomToFitTight():ht.subViewPort.animateZoomToFit()})),P.CmApp.Tools.clear_user_mask_tool.$().click((()=>{lt.clearUserMask(),O.is(O.Sword)&&O.Grab.pick()})),P.CmApp.Tools.clear_all_edits.$().click((()=>{lt.clearAllEdits(),O.Grab.pick()}));for(var p=0;p<o.length;p++){var u=o[p].Button;u.$().click(F(u,o[p].Popover))}P.CmApp.Tools.save.$().click((()=>lt.checkSaveDrawCommands())),P.CmApp.Tools.download.$().click((function(t){t.preventDefault(),lt.updateResultParitySalt(),N();let e=lt.sendGenerateResult(),o=D.isRegularAppMode()&&lt.oneClickDownloadEnabledAndAllowed(),i=D.isBulkAppMode()&&window.bulkDownloadMode==D.BulkDownloadModeSingle;if(!o&&!i||lt.isOutOfCredits())k(!1);else{k(!0);let t=e?!lt.resultParity:lt.resultParity,o=lt.downloadParityUrl(t,i?window.GlobalsEx.Bulk_downloadFormat:0),s=document.createElement("a");s.href=o,s.download="",s.click()}lt.updateSettingsSummary(),D.isBulkLike()?setTimeout(R.modal,500,"#result-dialog"):R.modal("#result-dialog",!0)})),P.CmApp.Tools.skip.$().click(lt.skip),P.CmApp.Tools.undo.$().click(lt.tryUndo),P.CmApp.Tools.redo.$().click(lt.tryRedo),P.resultDialog.SettingsSummary.ExportOptions.Key.$().click((()=>(C(),gt.show(P.PreferencesDialog.ExportOptionsTab),!1))),P.resultDialog.SettingsSummary.ColorsApp.Key.$().click((()=>{C(),b()})),P.resultDialog.SettingsSummary.BackgroundApp.Key.$().click((()=>{C(),y()})),P.resultDialog.SettingsSummary.CropApp.Key.$().click((()=>{C(),v()})),P.resultDialog.SettingsSummary.ShadowsApp.Key.$().click((()=>{C(),A()})),P.resultDialog.download_link.$().click((()=>{k(!0)})),P.resultDialog.ReadyDownloadImage.$().mousedown((()=>{k(!0)})),g=new le(P.resultDialog.CopyBtn,(function(t,e){let o=a.cast(P.resultDialog.ReadyDownloadImage.$().get(0));R.copyImageToClipboard(o,t,e),k(!0)})),lt.hasUser()?(P.enable_one_click_download_checkbox.$().click(lt.toggleEnableOneClickDownload),P.pre_crop_enabled_checkbox.$().click(lt.toggleEnablePreCrop),P.only_use_photo_mode_checkbox.$().click(lt.toggleOnlyUsePhotoMode),P.enable_auto_clip_checkbox.$().click(lt.toggleDefaultToAutoClip),P.allow_logo_mode_checkbox.$().click(lt.toggleAllowLogoMode),P.allow_scan_mode_checkbox.$().click(lt.toggleAllowScanMode),P.allow_auto_hair_checkbox.$().click(lt.toggleAllowAutoHair),S(P.MaxNumMegapixels,lt.resetMaxNumMegapixels,lt.incrementMaxNumMegapixels,1)):(P.enable_one_click_download_checkbox.$().addClass("disabled").attr("disabled","disabled").parent().addClass("gray"),P.pre_crop_enabled_checkbox.$().addClass("disabled").attr("disabled","disabled").parent().addClass("gray"),P.only_use_photo_mode_checkbox.$().addClass("disabled").attr("disabled","disabled").parent().addClass("gray"),P.enable_auto_clip_checkbox.$().addClass("disabled").attr("disabled","disabled").parent().addClass("gray"),P.MaxNumMegapixels.increase.$().toggleClass("disabled",!0),P.MaxNumMegapixels.decrease.$().toggleClass("disabled",!0),P.MaxNumMegapixels.reset.$().toggleClass("disabled",!0)),S(P.CmApp.CropApp.RotateSpinner,lt.rotateReset,lt.incrementRotateAngleDeg,-90),f(P.CmApp.CropApp.StraightenSpinner,lt.straightenReset,lt.straightenCounterclockwise,lt.straightenClockwise,lt.straightenCommit),t.straightenClockwiseRepeater=new te(lt.straightenClockwise,30,5,L.push,lt.straightenCommit),t.straightenCounterclockwiseRepeater=new te(lt.straightenCounterclockwise,30,5,L.push,lt.straightenCommit),P.CmApp.ColorsApp.ColorCast.RemovalEnabled.$().click(lt.toggleColorCast),P.CmApp.ColorsApp.ColorCast.controls.$().toggle(lt.settings.removeColorCast),P.CmApp.ColorsApp.WhiteBalance.Enabled.$().click(lt.toggleWhiteBalanceEnabled),P.CmApp.ColorsApp.WhiteBalance.controls.$().toggle(lt.settings.whiteBalanceEnabled),w(P.CmApp.ColorsApp.ColorLevels.brightness,lt.brightnessReset,lt.brightnessDecrement,lt.brightnessIncrement),w(P.CmApp.ColorsApp.ColorLevels.shadows,lt.shadowsReset,lt.shadowsDecrement,lt.shadowsIncrement),w(P.CmApp.ColorsApp.ColorLevels.highlights,lt.highlightsReset,lt.highlightsDecrement,lt.highlightsIncrement),w(P.CmApp.ColorsApp.ColorLevels.temperature,lt.temperatureReset,lt.temperatureDecrement,lt.temperatureIncrement),w(P.CmApp.ColorsApp.ColorLevels.saturation,lt.saturationReset,lt.saturationDecrement,lt.saturationIncrement),w(P.CmApp.ColorsApp.ColorCast.ForegroundProtection,lt.colorCastForegroundProtectionReset,lt.colorCastForegroundProtectionDecrement,lt.colorCastForegroundProtectionIncrement),S(P.CmApp.Edges.Smoothing,lt.resetGlobalSmoothingLevel,lt.stepGlobalSmoothingLevel,.5),S(P.CmApp.Edges.FeatheringRadius,lt.resetGlobalBlurLevel,lt.stepGlobalBlurLevel,.5),S(P.CmApp.Edges.Offset,lt.resetGlobalOffset,lt.stepGlobalOffset,.25),f(P.ExportOptions.JpgQuality,lt.jpegQualityReset,lt.jpegQualityDecrease,lt.jpegQualityIncrease,lt.sendSetGlobal),P.ExportOptions.JpgQualityPresets.preset25.$().click((()=>lt.setJpegQuality(25,!0))),P.ExportOptions.JpgQualityPresets.preset50.$().click((()=>lt.setJpegQuality(50,!0))),P.ExportOptions.JpgQualityPresets.preset75.$().click((()=>lt.setJpegQuality(75,!0))),P.ExportOptions.JpgQualityPresets.preset90.$().click((()=>lt.setJpegQuality(90,!0))),P.ExportOptions.JpgQualityPresets.preset100.$().click((()=>lt.setJpegQuality(100,!0))),E.registerRadioGroup(lt.OpaqueFileFormatGroup,(t=>lt.setOpaqueFileFormat(t,!0))),E.registerRadioGroup(lt.PngModeGroup,(t=>lt.setPngMode(t,!0))),E.registerRadioGroup(lt.JpegModeGroup,(t=>lt.setJpegMode(t,!0))),P.PreferencesDialog.openExportOptions.$().click((()=>(C(),gt.show(P.PreferencesDialog.ExportOptionsTab),!1))),P.PreferencesDialog.openImportOptions.$().click((()=>(C(),gt.show(P.PreferencesDialog.ImportOptionsTab),!1))),P.CmApp.ColorsApp.ColorLevels.auto.$().click(lt.colorLevelsAuto),P.CmApp.ColorsApp.reset_button.$().click(lt.colorLevelsResetAll),P.CmApp.ColorsApp.ColorLevels.reset.$().click(lt.colorLevelsResetLevels),P.CmApp.Tools.review.$().click((()=>{U(),P.CmApp.Review.Popover.Popover.$().addClass(n.active.name()),lt.Review.start()})),P.CmApp.Tools.ecommerce.$().click((()=>{U(),P.CmApp.Ecommerce.Popover.Popover.$().addClass(n.active.name())})),P.popover_dismiss.$().click((t=>{U(),t.preventDefault()})),R.mouseDownRepeater(P.CmApp.Review.Spinner.backward.$(),lt.Review.back,30,2,R.empty,R.empty),R.mouseDownRepeater(P.CmApp.Review.Spinner.forward.$(),lt.Review.forward,30,2,R.empty,R.empty),P.CmApp.Ecommerce.set.$().click(gt.Settings.Ecommerce.set),P.CmApp.Ecommerce.revert.$().click(gt.Settings.Ecommerce.revert),P.PreferencesDialog.open.$().click((()=>gt.show(null))),P.sticky_settings.$().click((()=>gt.show())),P.sticky_settings_close.$().click(gt.hide),P.CmApp.Tools.show_crop_app_button.$().click(v),P.CmApp.Tools.show_shadow_app_button.$().click(A),P.CmApp.Tools.show_colors_app_button.$().click(b),P.CmApp.Tools.show_background_app_button.$().click(y),x();var h=30;function d(t,e){R.addEventListener(t.$(),"touchstart",(t=>{e(!0),t.preventDefault()})),R.addEventListener(t.$(),"touchend",(t=>{e(!1),t.preventDefault()})),t.$().hover((()=>{e(!0)}),(()=>{e(!1)}))}P.CmApp.Brush.brush_size_button.$().click((t=>{lt.setBrushSize(parseInt($(t.currentTarget).data("size")),!0)})),R.mouseDownRepeater(P.CmApp.Brush.Size.decrease.$(),lt.decrementBrushSize,h,5,L.push),R.mouseDownRepeater(P.CmApp.Brush.Size.increase.$(),lt.incrementBrushSize,h,5,L.push),i=new te(lt.decrementBrushSize,30,5,L.push),s=new te(lt.incrementBrushSize,30,5,L.push),$(".global-smoothing-level-button").click((t=>{lt.setGlobalSmoothingLevel(parseInt($(t.currentTarget).data("level")),!0)})),$(".global-blur-level-button").click((t=>{lt.setGlobalBlurLevel(parseInt($(t.currentTarget).data("level")),!0)})),$(".background-color-swatch-button").click((t=>{let e=$(t.currentTarget).data("color"),o=Qt.fromInt(e);lt.setBackgroundColor(o.toRgbaCss(),!0)})),$(".global-offset-button").click((t=>{lt.setGlobalOffset(parseFloat($(t.currentTarget).data("offset")),!0)})),$(".use-corner-detection-button").click((t=>{lt.setUseCornerDetection($(t.currentTarget).data("usecornerdetection"),!0)})),P.CmApp.Edges.blur_mode.$().click((t=>{lt.setBlurMode($(t.currentTarget).data("blurmode"),!0)})),$(".use-local-smoothing-button").click((t=>{lt.setUseLocalSmoothing($(t.currentTarget).data("uselocalsmoothing"),!0)})),P.CmApp.Sidebar.auto_clip.$().click((t=>{lt.setAutoClip(!lt.settings.autoClip,!0,!0)})),E.registerRadioGroup(t.ViewPanesGroup,lt.setViewPanesMode),d(P.CmApp.Sidebar.preview,lt.tempPreviewViewPaneToggle),d(P.CmApp.Sidebar.viewOriginal,lt.tempViewOriginalToggle),d(P.CmApp.Sidebar.marks,lt.tempViewMarksToggle),lt.setBrushSize(lt.defaultSettings.brushSize,!1),window.Globals.Bulk.isApi||q.initializeUi(l,c),gt.ensureInitialized(),e=!0}}(),u&&(u.hide(),u=null),U(),O.Background.mask=lt.userMask,O.Foreground.mask=lt.userMask,O.Hair.mask=lt.userMask,O.MaskEraser.mask=lt.userMask,"create"!=lt.entryPoint||lt.settings.autoClip?(O.Grab.pick(),O.update(!0),lt.checkUpdateTempPreviewPaneToggle()):O.Foreground.pick(),ht.main.zoomToFit(!1),ht.main.updateSize(),ht.main.zoomToFit(!0),ht.subViewPort.zoomToFit(!1),ht.subViewPort.updateSize(),ht.subViewPort.zoomToFit(!0)},t.subAppHidden=function(){O.releaseTempSelect(),O.Grab.pick(),u=null},t.updateUndoRedoState=x,L.stateUpdated=x;var T="mousedown.popoverToolbar";function _(){lt.Review.reset(),P.popover_button.removeClass(P.active),P.exclusive_group.and(P.popover).removeClass(P.active),d=!1,P.$window.off(T),P.AppContent.$().off(T),P.popover_toolbar_no_auto_dismiss.$().off(T)}function F(t,e){return()=>{const o=t.hasClass(P.active);if(_(),!o){const i=!o;t.addClass(P.active),e.addClass(P.active),t!=P.CmApp.Hair.Popover.Button&&t!=P.CmApp.Review.Popover.Button&&(P.$window.on(T,(()=>{d||_(),d=!1})),P.AppContent.$().on(T,(()=>{O.getActiveMode()==O.Grab&&(d=!0)})),P.popover_toolbar_no_auto_dismiss.$().on(T,(()=>{d=!0}))),i&&t==P.CmApp.Review.Popover.Button&&lt.Review.start()}return ht.main.refreshAllViews(),!1}}var I="";function B(t){return $(t.target).is("input")}function z(e){if(B(e))return!0;if(u)return ht.subViewPort.keyUpHandler(e)||u.keyUpHandler(e),!0;switch(ht.main.keyUpHandler(e),e.keyCode){case 82:t.straightenCounterclockwiseRepeater.up();break;case 84:t.straightenClockwiseRepeater.up();break;case 87:lt.tempPreviewViewPaneToggle(!1);break;case 81:lt.tempViewOriginalToggle(!1);break;case 219:i.up();break;case 221:s.up()}return!0}function U(){j.dismiss(),_(),ot.clearDownState(),ht.refreshAllViews(),H.hide(),X.hide(),gt.hide(),lt.Review.reset(),C()}function G(e){if(B(e))return!0;if(e.altKey||e.metaKey)return!0;if(u){if(ht.subViewPort.keyDownHandler(e))return!0;if(u.keyDownHandler(e))return!0}if(ht.main.keyDownHandler(e))return!0;if(e.ctrlKey)return!0;switch(e.keyCode){case 27:U();break;case 49:lt.setViewPanesMode(D.ViewPanesSingle);break;case 50:lt.setViewPanesMode(D.ViewPanesSplit);break;case 68:lt.Review.back();break;case 70:lt.Review.forward();break;case 112:H.toggle(),e.preventDefault();break;case 32:O.cycle(O.Background,O.Foreground),e.preventDefault();break;case 88:O.cycle(O.MaskEraser,O.Grab);break;case 66:window.GlobalsEx.hideBottomToolbar||lt.stepBackgroundColor(e.shiftKey);break;case 71:window.GlobalsEx.hideBottomToolbar||lt.jumpToLastBackgroundColor(e.shiftKey);break;case 67:O.cycle(O.Grab,O.MaskEraser);break;case 86:2!=lt.imageCategory.user&&O.cycle(O.Hair,O.Grab);break;case 82:window.GlobalsEx.hideBottomToolbar||(e.shiftKey?t.straightenCounterclockwiseRepeater.down():lt.rotateCounterclockwise());break;case 84:window.GlobalsEx.hideBottomToolbar||(e.shiftKey?t.straightenClockwiseRepeater.down():lt.rotateClockwise());break;case 87:lt.tempPreviewViewPaneToggle(!0);break;case 80:window.GlobalsEx.hideBottomToolbar||q.pasteMask();break;case 81:lt.tempViewOriginalToggle(!0);break;case 219:window.GlobalsEx.hideBottomToolbar||i.down();break;case 221:window.GlobalsEx.hideBottomToolbar||s.down();break;case 83:O.select(O.getSelectedMode()==O.Sword?O.Grab:O.Sword)}return!0}function N(t="Requesting result generation. ",e=5){P.resultDialog.WaitingMsg.$().text(t),P.resultDialog.WaitingBar.$().css("width",e+"%"),P.resultDialog.state.$().hide(),P.resultDialog.Waiting.$().show(),g.disabled(!0),P.resultDialog.ReadyDownloadImage.$().attr("src","")}t.toolModeValidate=function(t){return!0},t.toggleAllCanvasViewsClass=function(t,e){h.toggleClass(t,e)},t.toolModeChangeHandler=function(t){h.removeClass(I).addClass(I=t.cssClass),lt.sendSetTool(),ht.main.refreshAllViews()},t.keyUpHandler=z,t.keyDownHandler=G,t.pointerInteraction=function(t){switch(t.type){case ut.InteractionType.ActionStart:if(O.getActiveMode().needsHover){let t=ht.main.getMouse_ii();lt.drawSquare(t.x,t.y,ht.main.diameter())}O.is(O.Foreground)&&X.strokeGreen(),O.is(O.Background)&&X.strokeRed();break;case ut.InteractionType.ActionMove:if(O.getActiveMode().needsHover){let t=ht.main.getMouse_ii();lt.drawLine(t.x,t.y,ht.main.diameter())}break;case ut.InteractionType.PanZoom:ot.clearHoverState()}O.is(O.Sword)&&ot.pointerInteraction(t,ht.main.getMouse_i(),ht.main.getZoomScale())},t.drawUnder_c=function(t,e,o,i){},t.drawOver_c=function(t,e){},t.drawOver_i=function(t,e){},t.drawUnder_i=function(t,e,o,i){},t.setSaveState=function(t){const e=P.CmApp.Tools.save;t==D.SaveSave?e.removeClass(P.disabled):(t==D.SaveSaving||t==D.SaveSaved)&&e.addClass(P.disabled)},t.setLightState=function(t){t==D.LightUpdated?P.CmApp.Tools.download.$().removeAttr("disabled"):P.CmApp.Tools.download.$().attr("disabled","disabled"),P.lightState.progress.$().toggle(t==D.LightProgress),P.lightState.connecting.$().toggle(t==D.LightConnecting),P.lightState.updating.$().toggle(t==D.LightUpdating),P.lightState.updated.$().toggle(t==D.LightUpdated),P.AppView.$().toggleClass("busy",t!=D.LightUpdated)},t.resultPending=N,t.resultReady=function(t,e){if(P.resultDialog.state.$().hide(),t){let t=lt.downloadParityUrl(lt.resultParity);P.resultDialog.ready_download_menu_item.$().attr("href",t),P.resultDialog.ready_download_menu_item_text.$().text(p.s("Result ("+lt.exportFileFormat()+")"));var o=P.resultDialog.ready_download_link.$().attr("href",t);it.attachToLink(o,(function(){var t=lt.result.filename;return t?"image/"+t.substr(t.lastIndexOf(".")+1)+":"+t:null}));let e=P.resultDialog.ReadyDownloadImage.$();e.on("load",(()=>{g.disabled(!1)})),e.attr("src",t),P.resultDialog.download_alpha_mask_menu_item.$().attr("href",lt.downloadAlphaGrayscaleUrl()),P.resultDialog.download_svg_path_menu_item.$().attr("href",lt.downloadSvgPathUrl()),P.resultDialog.download_tiff_path_menu_item.$().attr("href",lt.downloadTiffPathUrl()),P.resultDialog.Ready.$().show()}else P.resultDialog.ErrorMsg.$().text(e),P.resultDialog.Error.$().show()},t.refreshAllViews=function(){ht.refreshAllViews()}}(at||(at={})),function(t){L.sourceFunction=ee;const e=0,o=1,i=2,s=3,r=20;const a=.5/255;t.hasServerRgbHistogramResponse=!1,t.appHasAlreadyRun=!1;let l,c,u,h,d=!1;t.imageCanvas=null,t.previewCanvas=null,t.userMask=null;let g,m=!1,f=!1;function S(){return{autoLevels:null,autoClip:null,brushSize:D.BrushSize,globalSmoothingLevel:0,globalBlurLevel:1,globalOffset:0,rotateAngleDeg:0,straightenAngleDeg:0,brightness:0,shadows:0,highlights:0,temperature:0,removeColorCast:!1,castColor:16777215,colorCastForegroundProtection:4,whiteBalanceEnabled:!1,whiteBalanceGrayColor:16777215,useBrush:!0,useCornerDetection:!0,blurMode:void 0,useLocalBlur:!0,useLocalSmoothing:!0,backgroundColor:null,cropMode:D.CropUnconstrained,cropMarginUnits:D.CropMarginPercent,cropObjectSize:D.CropSizeLarge,cropVerticalAlignment:D.CropAlignmentMiddle,cropShadows:D.CropShadowsPad,cropAspectRatio:null,cropTargetSize:null,cropAllowEnlarging:!1,cropFitToResult:!1,cropPaddingMils:50,cropPaddingPixels:25,cropRect_o:new Xt,outputDpi:72,outputColorSpace:D.ColorSpaceSrgb,jpegQuality:92,pngMode:D.PngModeNone,jpegMode:D.JpegModeNone,opaqueFileFormat:D.OpaqueFileFormatJpeg,maxNumMegapixels:null,preCropEnabled:!1,preCropLockAspectRatio:!1,viewPanesMode:D.ViewPanesSplit}}t.settings=S(),t.entryPoint=null,t.boundingRect=null,t.shadowsRect=null,t.result={ready:!1,success:!1,msg:null,shown:!1,posted:!1,filename:"unknown.png"},t.imageSize=null,t.imageAspectRatio=null,t.stickySettings=null,t.defaultSettings=null,t.resultParitySalt=Date.now().toString(),t.bezierSet=[],t.bezierSetLength=0;let w=[];t.detectedCorners=[];let C=0,y=0,b=0,v=0,A=Rt.empty(),M=!1,x=255,_=255,E=255,F=0,I=new Xt;t.resultParity=!1;let W=!1,j=!1,Z=!1,K=!1,tt=null,et=5e3,it=null,st=!1,rt=!1,lt=null,pt=null,ut=0,mt=0,ft=null,St=!1,wt=null;t.previewCanvasData=null;let Ct=null,yt=null,bt=!1,vt=function(t,e,o,i,s){!function(t,e,o,i,s){yt[t]=o,yt[t+1]=i,yt[t+2]=s,yt[t+3]=e}(t,e,o,i,s)},At=null,kt=null,Mt=null,xt=!0,Tt=null,_t=null,Pt=null,Et={hasImage:0,hasDrawCommands:0};t.imageCategory={user:0,server:0},t.serverImageCategories={preferred:0,allowPhoto:!1,allowLogo:!1,allowScan:!1},t.hasUser=function(){return!!window.GlobalsEx.email};let It=null,Ot=!1;function Lt(){const t=Ht();Ot&&!t&&Gt(!0),zt(t),Vi(),qi({command:D.MaybeSaved})}function zt(t){t?P.resultDialog.download_link.$().attr("target","_blank"):P.resultDialog.download_link.$().removeAttr("target")}function $t(){$(window).off("beforeunload")}function Ut(){H.hide()||(window.Globals.Bulk.isIframe&&qi({command:D.Exiting}),Ht()?(R.saveAndExit(!0),Ot=!0,te()):(window.Globals.Bulk.isIframe&&!window.Globals.Bulk.isApiSingle&&R.saveAndExit(!0),Gt(!0)))}function Gt(t=!1){return $t(),window.Globals.Bulk.isIframe?qi({command:D.Exit,isNice:!!t}):N.exit(),!1}function Ht(){return W||st||0==Et.hasImage||Et.hasDrawCommands!=t.hasDrawCommands||t.imageCategory.server!=t.imageCategory.user}function Vt(t,e,o,i,s){t.decrease.$().toggleClass("disabled",e==o),t.increase.$().toggleClass("disabled",e==i),t.reset.$().toggleClass("disabled",e==s)}function Wt(t){return t.w.toFixed(0)+" x "+t.h.toFixed(0)+"px ("+R.formatAspectRatio(R.fuzzyAspectRatio(t))+")"}function Yt(){let e;e=0==t.hasImage?D.LightProgress:mt==ut?D.LightUpdated:B.isConnected()?D.LightUpdating:D.LightConnecting,pt!=e&&(pt=e,T.App.setLightState(e))}function qt(){let t;t=st||rt?D.SaveSaving:W?D.SaveSave:D.SaveSaved,lt!=t&&(lt=t,T.App.setSaveState(t))}function Jt(e=void 0){t.appHasAlreadyRun&&Ht()?t.checkSaveDrawCommands(e):e&&setTimeout(e,0)}function te(e=void 0){function o(){clearTimeout(tt),tt=setTimeout((()=>t.checkSaveDrawCommands()),et),qt(),Lt(),e&&e()}if(clearTimeout(tt),st)rt=!0;else if(W){W=!1;let e=oe();if(it!=e){st=!0,zt(!0),qt();let i=new Blob([e],{type:"application/json"});k.uploadS3WithRetry(i,ft.drawCommands,{url:window.Globals.s3_url,backupUrl:window.Globals.s3_backup_url,label:p.s("Saving edits"),maxAge:0,success:()=>{it=e,st=!1,0==t.hasDrawCommands&&(t.hasDrawCommands=1,Ei()),rt?(rt=!1,te()):o()}})}else o()}else o()}function ee(){switch(t.imageCategory.user){case 0:l=t.userMask.encodeEx();break;case 1:c=t.userMask.encodeEx();break;case 2:u=t.userMask.encodeEx();break;case 3:h=t.userMask.encodeEx()}let e={userMask:!!c||!!u||!!h?void 0:l.data,maskVersion:D.MaskVersion,photoMask:c,logoMask:u,scanMask:h,duplicateState:{imageCategory:t.imageCategory.user,serverImageCategories:t.serverImageCategories},hasReceivedInitialScanMask:m,hasReceivedInitialPhotoMask:f,scalpel:ot.encode(),shadowApp:dt.encode()};window.Globals.isDev&&(e.exampleSword=ot.cutSet.encodedPolyBezierSet());let o=$.extend(!0,e,t.settings);return t.settings.cropFitToResult?delete o.cropRect_o:o.cropRect_o=t.settings.cropRect_o.dup(),o}function oe(){return JSON.stringify(ee())}function ie(){let e=2==t.imageCategory.user,o=1==t.imageCategory.user,i=3==t.imageCategory.user;P.AppOuterWrapper.toggleClass(P.CmApp.Cat.isLogoMode,e).toggleClass(P.CmApp.Cat.isScanMode,i).toggleClass(P.CmApp.Cat.isPhotoMode,o),P.CmApp.Cat.logoMode.$().toggleClass("active",e).toggleClass("disabled",!t.serverImageCategories.allowLogo).toggle(t.serverImageCategories.allowLogo),P.CmApp.Cat.scanMode.$().toggleClass("active",i).toggleClass("disabled",!t.serverImageCategories.allowScan).toggle(t.serverImageCategories.allowScan),P.CmApp.Cat.photoMode.$().toggleClass("active",o).toggleClass("disabled",0==t.imageCategory.server),P.CmApp.Cat.disableInLogoMode.or(P.CmApp.Cat.disableInScanMode).removeClass(P.disabled).removeAttr("disabled"),e&&P.CmApp.Cat.disableInLogoMode.addAttr("disabled").addClass(P.disabled),i&&P.CmApp.Cat.disableInScanMode.addAttr("disabled").addClass(P.disabled);let s=P.CmApp.Sidebar.mode_container.$(),r=s.hasClass(n.active.name()),a=t.serverImageCategories.allowLogo||t.serverImageCategories.allowScan;a!=r&&s.toggle(200),s.toggleClass(n.active.name(),a),e&&O.is(O.Hair)&&O.Grab.pick()}function re(e){0==t.imageCategory.server||2==e&&!t.serverImageCategories.allowLogo||3==e&&!t.serverImageCategories.allowScan||t.imageCategory.user!=e&&(t.imageCategory.user=e,t.imageCategory.server,V.show(!1,!0),Fi(),ie(),me())}function ne(t){let e=P.CmApp.Tools.ColorPicker.$(),o=P.CmApp.BgColor.ColorPickerPopover.$();function i(){let i=e.position(),s=o.hasClass(P.CmApp.BgColor.in_bg_app.name()),r=window.innerWidth>768,n=s;if(o.toggleClass("bottom",n).toggleClass("top",!n),s)o.css({top:e.outerHeight()+i.top,left:i.left+(e.outerWidth()-o.outerWidth())/2,right:"auto",bottom:"auto"}).show();else if(r||t)o.css({bottom:e.outerHeight()+i.top+6,left:i.left+(e.outerWidth()-o.outerWidth())/2,right:"auto"}).show();else{const t=o.closest(P.CmApp.tool_popover_content.css());t.addClass(P.CmApp.dropdown_open.name()),t.css({right:3+t[0].scrollWidth-window.innerWidth}),o.css({bottom:"100%",left:"auto",right:10}).show()}}Mt=$.farbtastic(P.CmApp.BgColor.ColorPicker.css(),P.CmApp.Tools.ColorPicker.css(),(e=>{let o=Qt.fromCss(e);P.CmApp.BgColor.Custom.$().data("color",o.toInt()),P.CmApp.BgColor.Custom.anscestorOf(P.CmApp.BgColor.swatch).$().css("background-color",e),P.CmApp.Tools.ColorPicker.$().css("background-color",e),xt&&!t&&(clearTimeout(Tt),Tt=setTimeout((()=>{je(e,!0)}),100))})),e.blur((()=>{o.hide();o.closest(P.CmApp.tool_popover_content.css()).removeClass(P.CmApp.dropdown_open.name())})).focus(i).keydown((t=>{t.stopPropagation()})),P.$window.resize((()=>{e.blur()})),t&&i()}function ae(){t.defaultSettings.autoLevels&&Ci(),null==t.settings.autoClip&&we(t.defaultSettings.autoClip,!1,!0)}function le(t){void 0===t.blurMode&&void 0!==t.useLocalBlur&&(t.blurMode=t.useLocalBlur?D.BlurModeLocal:D.BlurModeFixed),t.useLocalBlur=void 0}function ce(e,o){if("string"==typeof e)try{"object"!=typeof(e=JSON.parse(e))&&(e={})}catch(t){e={}}le(e),o&&G.setStickySettings(JSON.stringify(e),(function(t){R.gaTrack("ErrorShown","Failed to save sticky settings",t),alert(p.s("Sorry, failed to save your sticky settings:")+" "+t+"\n\n"+p.s("Please try again and let us know if the error persists!"))}),(function(){window.Globals.Bulk.isIframe&&window.checkPostMessage({command:D.StickySettingsUpdated,settings:e})})),t.stickySettings=$.extend({dropShadow:{},mirrorShadow:{},perspectiveShadow:{},ellipseShadow:{}},e),t.defaultSettings=$.extend(!0,{},D.FactoryDefaults,t.stickySettings),t.defaultSettings.ellipseShadow=$.extend(!0,{},D.FactoryDefaults.ellipseShadow,t.stickySettings.ellipseShadow),t.defaultSettings.dropShadow=$.extend(!0,{},D.FactoryDefaults.dropShadow,t.stickySettings.dropShadow),t.defaultSettings.mirrorShadow=$.extend(!0,{},D.FactoryDefaults.mirrorShadow,t.stickySettings.mirrorShadow),t.defaultSettings.perspectiveShadow=$.extend(!0,{},D.FactoryDefaults.perspectiveShadow,t.stickySettings.perspectiveShadow),Ne(),pe()}function pe(){P.CmApp.Edges.Smoothing.reset.$().toggleClass("disabled",t.settings.globalSmoothingLevel==t.defaultSettings.globalSmoothingLevel),P.CmApp.Edges.FeatheringRadius.reset.$().toggleClass("disabled",t.settings.globalBlurLevel==t.defaultSettings.globalBlurLevel),P.CmApp.Edges.Offset.reset.$().toggleClass("disabled",t.settings.globalOffset==t.defaultSettings.globalOffset),mo(),bo(),_o(),ui(),Me(),ve(),Te(),De(),Fe(),Oe(),Re(),$e(),qe(),Q.updateDisplay(),dt.updateDisplay()}function ue(e,o,i){g=$.extend(!0,{},i),j=!1,St=!1,It=null,t.result={ready:!1,success:!1,msg:null,shown:!1,posted:!1,filename:"unknown.png"},d||(ne(!1),Je(Qe())),C=e.width(),y=e.height(),I.right0=C,I.bottom0=y,t.boundingRect=null,t.imageSize={w:C,h:y},t.imageAspectRatio=R.fuzzyAspectRatio(t.imageSize),b=C/2,v=y/2,A.setXy(b,v),t.imageCanvas=e,ft=o,t.previewCanvas=new Bt(C,y),t.previewCanvas.context().drawCanvasEx(t.imageCanvas,0,0),wt=t.previewCanvas.context().getImageData(0,0,C,y),t.previewCanvasData=wt.data,Ct=wt,yt=t.previewCanvasData,At=t.imageCanvas.context().getImageData(0,0,C,y),kt=At.data,l=c=u=h=void 0,"create"==t.entryPoint?i.hasReceivedInitialPhotoMask=!t.defaultSettings.autoClip:"resume"==t.entryPoint?ft.hasDrawCommands>0?void 0===i.hasReceivedInitialPhotoMask&&(i.hasReceivedInitialPhotoMask=!0):i.hasReceivedInitialPhotoMask=!!i.hasReceivedInitialPhotoMask||!t.defaultSettings.autoClip||!t.defaultSettings.autoHair:i.hasReceivedInitialPhotoMask=!0,m=!!i.hasReceivedInitialScanMask,f=!!i.hasReceivedInitialPhotoMask||!t.defaultSettings.autoHair,window.Globals.Bulk.isIframe||N.goTo(ft,!t.appHasAlreadyRun),t.appHasAlreadyRun||(P.$window.on("beforeunload",(e=>t.hasUnsavedChanges()?(e.preventDefault(),p.s("There are unsaved changes.")):void 0)),P.force_exit.$().click(Gt),P.exit_app.$().click(Ut).removeAttr("disabled"),$(document).on("mouseleave",(()=>Jt())),t.appHasAlreadyRun=!0),P.resultDialog.ReadyShareLink.$(!0).attr("href",t.shareUrl()),B.initialize({imageId:ft.id,secret:ft.secret,requestScanMask:!m,requestPhotoMask:!f,newMessageFromServer:xi,connectedToNewServer:Ti,disconnectedFromServer:_i}),mt=0,ut=0,t.userMask=O.buildUserMask(t.imageCanvas.width(),t.imageCanvas.height()),t.bezierSet=[],w=[],t.bezierSetLength=0,t.settings=S(),dt.updateImage(),ot.clear(),fe(i,!1),"duplicate"==t.entryPoint?(W=!0,it=null):(W=!1,it=oe()),te(),j=!0,o.hasDrawCommands?null==t.settings.autoClip&&we(!1,!1,!0):ae(),T.App.imageUpdated(),Yt(),window.Globals.Bulk.isApi||q.checkFetch(),ct.initialized&&null!=ct.maxNumMegapixels&&(ct.maxNumMegapixels==t.stickySettings.maxNumMegapixels&&ct.lockAspectRatio==t.stickySettings.preCropLockAspectRatio||(ze(ct.maxNumMegapixels,!1),t.stickySettings.preCropLockAspectRatio=ct.lockAspectRatio,gt.commitSticky(!0))),qe(),Ve(),d||(P.CmApp.Cat.logoMode.$().click((function(){re(2)})),P.CmApp.Cat.scanMode.$().click((function(){re(3)})),P.CmApp.Cat.photoMode.$().click((function(){re(1)})),d=!0),pe(),qi({command:D.Booted})}function he(r){R.loadImageFromDataUrl(r,(t=>{}),(r=>{r.width==t.imageCanvas.width()&&r.height==t.imageCanvas.height()&&function(r){let n=t.imageCanvas.context();n.drawImage(r,0,0),At=n.getImageData(0,0,C,y),kt=At.data;for(let r=0;r<t.previewCanvasData.length;r+=4)255==t.previewCanvasData[r+s]&&(t.previewCanvasData[r+e]=kt[r+e],t.previewCanvasData[r+o]=kt[r+o],t.previewCanvasData[r+i]=kt[r+i]);Ri(),Di(),P.ImageColorCorrectionNotification.$().show().click((function(){$(this).hide()})),setTimeout((()=>{P.ImageColorCorrectionNotification.$().hide()}),2e4),Wi({command:D.RequestFullServerMask}),ht.refreshAllViews()}(r)}))}function de(t){return!function(t){return null==t}(t)}function ge(t,e,o){return de(t)?t:de(e)?e:o}function me(){switch(t.imageCategory.user){case 0:t.userMask.decodeFrom(l);break;case 1:t.userMask.decodeFrom(c||l);break;case 2:t.userMask.decodeFrom(u||l);break;case 3:t.userMask.decodeFrom(h||l)}}function fe(e,o){le(e),e.hasOwnProperty("photoMask")&&(c=e.photoMask),e.hasOwnProperty("logoMask")&&(u=e.logoMask),e.hasOwnProperty("scanMask")&&(h=e.scanMask),e.hasOwnProperty("userMask")&&(l={data:e.userMask,version:e.maskVersion}),me(),e.hasReceivedInitialScanMask&&(m=!0),e.hasReceivedInitialPhotoMask&&(f=!0);let i=t.defaultSettings;ye(ge(e.brushSize,i.brushSize),!1),je(ge(e.backgroundColor,i.backgroundColor),!1),to(ge(e.globalBlurLevel,i.globalBlurLevel),!1),Ke(ge(e.globalSmoothingLevel,i.globalSmoothingLevel),!1),eo(ge(e.globalOffset,i.globalOffset),!1),oo(ge(e.useCornerDetection,i.useCornerDetection),!1),io(ge(e.blurMode,i.blurMode),!1),so(ge(e.useLocalSmoothing,i.useLocalSmoothing),!1),Vo(ge(e.rotateAngleDeg,0),!1),Yo(ge(e.straightenAngleDeg,0)),K=!0,Ko(ge(e.brightness,0)),ei(ge(e.shadows,0)),ii(ge(e.highlights,0)),ri(ge(e.temperature,0)),ai(ge(e.saturation,0)),gi(ge(e.removeColorCast,i.removeColorCast),!1),mi(ge(e.castColor,i.castColor),!1),fi(ge(e.colorCastForegroundProtection,i.colorCastForegroundProtection)),hi(ge(e.whiteBalanceEnabled,i.whiteBalanceEnabled),!1),di(ge(e.whiteBalanceGrayColor,i.whiteBalanceGrayColor),!1),ci(ge(e.outputColorSpace,i.outputColorSpace),!1),we(ge(e.autoClip,null),!1,!1),K=!1,Z=!0,e.cropRect_o&&ao(Xt.from(e.cropRect_o),!1),lo(ge(e.cropMode,i.cropMode),!1),co(ge(e.cropMarginUnits,i.cropMarginUnits),!1),po(ge(e.cropObjectSize,i.cropObjectSize),!1),uo(ge(e.cropVerticalAlignment,i.cropVerticalAlignment),!1),ho(ge(e.cropShadows,i.cropShadows),!1),Uo(ge(e.cropAspectRatio,i.cropAspectRatio,t.settings.cropAspectRatio),!1,!1),No(ge(e.cropTargetSize,i.cropTargetSize,t.settings.cropTargetSize),!1,!1),go(ge(e.cropPaddingMils,i.cropPaddingMils),!1),So(ge(e.cropPaddingPixels,i.cropPaddingPixels),!1),Oo(ge(e.cropFitToResult,i.cropFitToResult),!1),Lo(ge(e.cropAllowEnlarging,i.cropAllowEnlarging),!1,!1),Co(ge(e.outputDpi,i.outputDpi),!1),vo(ge(e.jpegQuality,i.jpegQuality),!1),ko(ge(e.opaqueFileFormat,i.opaqueFileFormat),!1),Mo(ge(e.pngMode,i.pngMode),!1),xo(ge(e.jpegMode,i.jpegMode),!1),Z=!1,Zo(jo()),Fo(),vi(),ro(),e.scalpel?ot.decode(e.scalpel):e.sword&&ot.decodeSword(e.sword),e.shadowApp&&dt.decode(e.shadowApp),o&&(Oi(!0),zi(),Gi(),Ni(),Li(!0),ht.main.refreshAllViews()),T.StickySettings.updateDisplay()}function Se(e=!0){e&&L.push(),t.userMask.clearAll(),setTimeout((()=>{Li(!0),ot.clear(),ht.main.refreshAllViews()}),0)}function we(e,o,i){return P.body.toggleClass(P.autoClipEnabled,e).toggleClass(P.autoClipDisabled,!e),e!=t.settings.autoClip&&(o&&L.push(),t.settings.autoClip=e,Ce(),i&&zi(),!0)}function Ce(){P.CmApp.Sidebar.auto_clip.$().toggleClass(P.active.name(),t.settings.autoClip)}function ye(e,o){return(e=R.clamp(e,1,40))!=t.settings.brushSize&&(o&&L.push(),t.settings.brushSize=e,P.CmApp.Brush.Size.display.$().text(e+"px"),Vt(P.CmApp.Brush.Size,e,1,40,0),ht.main.refreshAllViews(),!0)}function be(e,o){e!=t.defaultSettings.oneClickDownloadEnabled&&(t.stickySettings.oneClickDownloadEnabled=e,ve(),o&&gt.commitSticky(!0))}function ve(){P.enable_one_click_download_checkbox.$().prop("checked",t.defaultSettings.oneClickDownloadEnabled);let e=Ae();$("#result-dialog").toggleClass(P.one_click_download_enabled.name(),e),P.resultDialog.download_combo_button.$().toggle(!e),P.resultDialog.download_menu_button.$().toggle(e)}function Ae(){return t.defaultSettings.oneClickDownloadEnabled&&!R.isMobile()}function ke(e,o){e!=t.stickySettings.preCropEnabled&&(t.stickySettings.preCropEnabled=e,Me(),o&&gt.commitSticky(!0))}function Me(){P.pre_crop_enabled_checkbox.$().prop("checked",t.stickySettings.preCropEnabled)}function xe(e,o){e!=t.stickySettings.onlyUsePhotoMode&&(t.defaultSettings.onlyUsePhotoMode=t.stickySettings.onlyUsePhotoMode=e,Te(),Oe(),Fe(),o&&gt.commitSticky(!0),e&&2==t.imageCategory.user&&re(1))}function Te(){P.only_use_photo_mode_checkbox.$().prop("checked",t.stickySettings.onlyUsePhotoMode)}function _e(e,o){e!=t.defaultSettings.autoClip&&(t.defaultSettings.autoClip=t.stickySettings.autoClip=e,De(),o&&gt.commitSticky(!0))}function De(){P.enable_auto_clip_checkbox.$().prop("checked",t.defaultSettings.autoClip),P.allow_auto_hair_checkbox.toggleClass(P.disabled,!t.defaultSettings.autoClip).toggleAttr("disabled",!t.defaultSettings.autoClip)}function Pe(e,o){e!=t.defaultSettings.autoHair&&(t.defaultSettings.autoHair=t.stickySettings.autoHair=e,Re(),o&&gt.commitSticky(!0))}function Re(){P.allow_auto_hair_checkbox.$().prop("checked",t.defaultSettings.autoHair)}function Ee(e,o){e!=Ie()&&(e&&t.stickySettings.onlyUsePhotoMode&&(t.defaultSettings.onlyUsePhotoMode=t.stickySettings.onlyUsePhotoMode=!1,t.defaultSettings.allowScanMode=t.stickySettings.allowScanMode=!1),t.defaultSettings.allowLogoMode=t.stickySettings.allowLogoMode=e,Fe(),Te(),o&&gt.commitSticky(!0))}function Fe(){P.allow_logo_mode_checkbox.$().prop("checked",Ie())}function Ie(){return!t.stickySettings.onlyUsePhotoMode&&t.defaultSettings.allowLogoMode}function Be(e,o){e!=Le()&&(e&&t.stickySettings.onlyUsePhotoMode&&(t.defaultSettings.onlyUsePhotoMode=t.stickySettings.onlyUsePhotoMode=!1,t.defaultSettings.allowLogoMode=t.stickySettings.allowLogoMode=!1),t.defaultSettings.allowScanMode=t.stickySettings.allowScanMode=e,Oe(),Te(),o&&gt.commitSticky(!0))}function Oe(){P.allow_scan_mode_checkbox.$().prop("checked",Le())}function Le(){return!t.stickySettings.onlyUsePhotoMode&&t.defaultSettings.allowScanMode}function ze(e,o){return(e=R.clamp(e,1,D.MaxMaxNumMegapixels))!=t.stickySettings.maxNumMegapixels&&(t.stickySettings.maxNumMegapixels=e,$e(),o&&gt.commitSticky(!0),ht.main.refreshAllViews(),!0)}function $e(){const e=p.s("{0} {0,plural,one{megapixel}other{megapixels}}",t.stickySettings.maxNumMegapixels||D.FactoryDefaults.maxNumMegapixels);P.MaxNumMegapixels.display.$().text(e),Vt(P.MaxNumMegapixels,t.stickySettings.maxNumMegapixels,1,D.MaxMaxNumMegapixels,4)}t.unhookBeforeunload=$t,t.hasUnsavedChanges=Ht,t.formatTargetSize=Wt,t.setBulkImagesRemaining=function(t,e,o,i){P.bulk_status_display.$().text(p.s("{0} / {1} left",i,t)).attr("title",t+" total, "+e+" done, "+i+" remaining, "+o+" skipped")},t.updateSettingsSummary=function(){let e=t.getCrop_o(),o=t.getCropTargetSize(),i=null;function s(t,e){return e?"<b>"+t+"</b>":t}function r(t,e){return s(t,null!=e&&t!=e)}function n(t,e){const o=255==Qt.fromCss(t.backgroundColor||D.TransparentColor).aInt()?p.s("opaque background"):p.s("transparent background");let i=To(e),s=i==D.JPEG?p.s("quality level {0}",t.jpegQuality):"",r=pi()+" "+p.s("color space"),n=t.outputDpi+" DPI";const a=p.s("not web optimized");let l=a;return i==D.PNG?t.pngMode==D.PngModeLossy?l=p.s("lossy optimization"):t.pngMode==D.PngModeLossless&&(l=p.s("lossless optimization")):t.jpegMode==D.JpegModeMoz&&(l=p.s("web optimized")),l!=a&&(r=p.s("default color space"),n=p.s("default DPI")),{opaque:o,fileFormat:i,qualityLevel:s,optimized:l,colorSpace:r,dpi:n}}i=t.settings.cropMode==D.CropTargetSize&&null!=o&&(t.settings.cropAllowEnlarging||o.w<e.width()||o.h<e.height())?Wt(o):Wt({w:e.width(),h:e.height()}),P.CmApp.CropApp.output_size_display.$().text(i);const a=n(t.defaultSettings,t.settings.backgroundColor),l=n(t.settings,t.settings.backgroundColor),c=r(l.fileFormat,a.fileFormat),u=0==l.qualityLevel.length?c:p.s("{0} ({1})",c,r(l.qualityLevel,a.qualityLevel));P.resultDialog.SettingsSummary.ExportOptions.Value.$().html(p.commaList([r(l.opaque,a.opaque),u,r(l.optimized,a.optimized),r(l.colorSpace,a.colorSpace),r(l.dpi,a.dpi)]));const h=0==t.settings.brightness&&0==t.settings.shadows&&0==t.settings.highlights&&0==t.settings.temperature&&0==t.settings.saturation,d=h?p.s("levels not adjusted"):p.s("levels adjusted"),g=p.s("white balance")+" "+(t.settings.whiteBalanceEnabled?p.s("enabled"):p.s("disabled")),m=p.s("color cast removal")+" "+(t.settings.removeColorCast?p.s("enabled"):p.s("disabled"));function f(t){let e=p.s("unconstrained");return t.cropMode==D.CropLockedAspectRatio?e=p.s("locked aspect ratio: {0}",R.formatAspectRatio($o())):t.cropMode==D.CropTargetSize&&(e=p.s("fixed size: {0}",Wt(Go()))),e}function S(t){return t.cropFitToResult?p.s("fit to result"):p.s("manual crop")}P.resultDialog.SettingsSummary.ColorsApp.Value.$().html(p.commaList([s(d,!h),s(g,t.settings.whiteBalanceEnabled),s(m,t.settings.removeColorCast)]));let w=[r(S(t.settings),S(t.defaultSettings)),r(f(t.settings),f(t.defaultSettings))];if(t.settings.cropFitToResult){const e=gt.Settings.Crop;t.settings.cropMarginUnits==D.CropMarginPercent?w.push(e.PaddingMils.getSummaryDisplay("margin")):w.push(e.PaddingPixels.getSummaryDisplay("margin")),w.push(e.ObjectSize.getSummaryDisplay("object")),w.push(e.VerticalAlignment.getSummaryDisplay("alignment")),w.push(e.Shadows.getSummaryDisplay("shadows"))}let C=t.settings.rotateAngleDeg+t.settings.straightenAngleDeg;w.push(s(p.s("rotated {0}&deg;",R.signedNumber(C)),0!=C)),P.resultDialog.SettingsSummary.CropApp.Value.$().html(p.commaList(w));const y=dt.getNumEllipseShadows();let b=p.s("no oval shadows");1==y?b=p.s("1 oval shadow"):y>1&&(b=y+" "+p.s("oval shadows")),b=s(b,0!=y);const v=gt.Settings.Shadows,A=dt.dropShadow,k=v.Drop;let M=k.Enabled.getSummaryEnabledDisplay("drop shadow");A.enabled&&(M+=" ("+p.commaList([k.BlurRadius.getSummaryDisplay("blur radius"),k.Opacity.getSummaryDisplay("opacity"),k.CropEnabled.getSummaryEnabledDisplay("clipping")])+")");const x=dt.mirrorShadow,T=v.Mirror;let _=T.Enabled.getSummaryEnabledDisplay("reflection");x.enabled&&(_+=" ("+p.commaList([T.Opacity.getSummaryDisplay("opacity"),T.Height.getSummaryDisplay("height"),T.OffsetY.getSummaryDisplay("offset")])+")");const E=dt.perspectiveShadow,F=v.Perspective;let I=F.Enabled.getSummaryEnabledDisplay("cast shadow");E.enabled&&(I+=" ("+p.commaList([F.Opacity.getSummaryDisplay("opacity"),F.OpacityScale.getSummaryDisplay("opacity scale"),F.BlurRadius.getSummaryDisplay("blur radius"),F.BlurRadiusScale.getSummaryDisplay("blur scale")])+")"),P.resultDialog.SettingsSummary.ShadowsApp.Value.$().html(p.commaList([b,M,_,I]))},t.checkSaveChanges=Jt,t.checkSaveDrawCommands=te,t.create=function(e,o,i,s,r){V.show(!(s&&s.userMask)),t.entryPoint=r?"create":"duplicate",t.hasImage=0,t.hasDrawCommands=0,W=!1,j=!1;let n=Date.now();if(B.checkForceClose(),k.uploadS3WithRetry(e,i.image,{url:window.Globals.s3_url,backupUrl:window.Globals.s3_backup_url,label:p.s("Uploading original image"),maxAge:31536e3,progress:t=>{P.lightState.progress.$().text(p.s("Uploading... {0}",p.percent(t))),V.uploadProgress(t)},success:()=>{t.hasImage=o.wasShrunk?2:1,Yt(),Ei(),R.gaTrack("StartupProgress","uploadedImage",void 0,Date.now()-n)}}),o.wasShrunk&&(t.stickySettings.preCropEnabled||(P.ImageResizeNotification.$().show().click((function(){$(this).hide()})),setTimeout((()=>{P.ImageResizeNotification.$().hide()}),2e4))),t.imageCategory={user:0,server:0},t.serverImageCategories={preferred:0,allowPhoto:!1,allowLogo:!1,allowScan:!1},"duplicate"==t.entryPoint&&s.duplicateState){let e=s.duplicateState;t.imageCategory.user=t.imageCategory.server=e.imageCategory,t.serverImageCategories=e.serverImageCategories}ue(o,i,s)},t.resume=function(e,o,i){V.alreadyUploaded(),V.show(!1,!0),X.strokeResume(),t.entryPoint="resume",Et.hasImage=t.hasImage=o.hasImage,Et.hasDrawCommands=t.hasDrawCommands=o.hasDrawCommands,t.imageCategory.user=t.imageCategory.server=o.userCategory,t.serverImageCategories=o.serverCategories,ie(),it=JSON.stringify(i),ue(e,o,i)},t.initializeFarbtastic=ne,t.bulkSetStickySettings=function(t){ce(t,!1),dt.clear(!1),fe(g,!1),ft.hasDrawCommands||ae()},t.setStickySettings=ce,t.tryUndo=function(){L.canUndo()&&fe(L.undo(),!0)},t.tryRedo=function(){L.canRedo()&&fe(L.redo(),!0)},t.getOriginalPixel=function(e,o){if(e=Math.floor(e),o=Math.floor(o),e>=0&&e<C&&e>=0&&o<y){let i=t.imageCanvas.context().getImageData(e,o,1,1).data;return(255&i[0])<<16|(255&i[1])<<8|255&i[2]}return null},t.drawSquare=function(t,e,o){let i=O.getActiveMode();L.schedulePush(),i.drawSquare(t,e,o),$i(D.DrawSquare,t,e,0,0,o)},t.drawLine=function(t,e,o){let i=O.getActiveMode();if(i.mask)if(L.schedulePush(),null==i.mask.lastX||null==i.mask.lastY)i.drawSquare(t,e,o),$i(D.DrawSquare,t,e,0,0,o);else{let s=i.mask.lastX,r=i.mask.lastY;i.drawLine(t,e,o),$i(D.DrawLine,s,r,t,e,o)}},t.clearAllEdits=function(){L.push(),Se(!1),Ho(!1),dt.clear(!1),wi(!1),fe(t.defaultSettings,!0)},t.clearUserMask=Se,t.setAutoClip=we,t.updateAutoClipDisplay=Ce,t.setBrushSize=ye,t.decrementBrushSize=function(){ye(t.settings.brushSize-1,!1)},t.incrementBrushSize=function(){ye(t.settings.brushSize+1,!1)},t.setEnableOneClickDownload=be,t.oneClickDownloadEnabledAndAllowed=Ae,t.toggleEnableOneClickDownload=function(){be(!t.defaultSettings.oneClickDownloadEnabled,!0)},t.setEnablePreCrop=ke,t.toggleEnablePreCrop=function(){ke(!t.stickySettings.preCropEnabled,!0)},t.setOnlyUsePhotoMode=xe,t.toggleOnlyUsePhotoMode=function(){xe(!t.stickySettings.onlyUsePhotoMode,!0)},t.setDefaultToAutoClip=_e,t.toggleDefaultToAutoClip=function(){_e(!t.defaultSettings.autoClip,!0)},t.setAllowAutoHair=Pe,t.toggleAllowAutoHair=function(){Pe(!t.defaultSettings.autoHair,!0)},t.setAllowLogoMode=Ee,t.toggleAllowLogoMode=function(){Ee(!Ie(),!0)},t.setAllowScanMode=Be,t.toggleAllowScanMode=function(){Be(!Le(),!0)},t.initializeMaxNumMegapixels=function(){ze(t.stickySettings.maxNumMegapixels||D.FactoryDefaults.maxNumMegapixels,!1)},t.setMaxNumMegapixels=ze,t.getMaxNumPixels=function(){return 1024*(t.stickySettings.maxNumMegapixels||D.FactoryDefaults.maxNumMegapixels)*1024},t.incrementMaxNumMegapixels=function(e){ze(t.stickySettings.maxNumMegapixels+e,!0)},t.resetMaxNumMegapixels=function(){ze(D.FactoryDefaults.maxNumMegapixels,!0)};let Ue="",Ge=0;function Ne(){if(""==Ue){Ye($(window).innerWidth()>768?t.stickySettings.viewPanesMode||D.ViewPanesSplit:D.ViewPanesSingle,!1)}}function He(){return Ue==D.ViewPanesSingle&&O.getActiveMode().isGrab()&&Ji.currentCenter_i.isNaN()}function Ve(){Ue==D.ViewPanesSingle&&We(!1)}function We(t){Xe(t!==He()?1:0),P.CmApp.Sidebar.preview.toggleClass(P.CmApp.Sidebar.selected,t)}function Xe(t){t!=Ge&&(Ge=t,qe())}function Ye(e,o=!0){Ue!=e&&(Ue=e,qe(),Ve(),o&&(t.stickySettings.viewPanesMode=e,gt.commitSticky(!0)))}function qe(){const t=ht.main;if(null!=t&&t.isInitialized()){at.ViewPanesGroup.update(Ue);let e=Ue==D.ViewPanesSplit;P.CmApp.Sidebar.preview.toggleClass(P.active,!e&&!He()),P.CmApp.Sidebar.marks.toggleClass(P.active,!e&&He()),e?V.showShadowPane():V.hideShadowPane(),t.setViewConfigs(nt.get(e,Ge))}}function Je(t){xt=!1,Mt.setColor(t),xt=!0,window.myLocalStorage.customColor=t;let e=Qt.fromCss(t);P.CmApp.BgColor.Custom.$().data("color",e.toInt()),P.CmApp.BgColor.Custom.anscestorOf(P.CmApp.BgColor.swatch).$().css("background-color",t),P.CmApp.Tools.ColorPicker.$().css("background-color",t)}function Qe(){return window.myLocalStorage.customColor||"#338855"}function je(e,o){e=e||D.TransparentColor;let i=Qt.fromCss(e).toInt(),s=$('.background-color-swatch-button[data-color="'+i+'"]'),r=P.CmApp.BgColor.Custom.$();return 0!=s.length&&r.data("color")!=i||(s=r,Je(e)),s.button("toggle"),P.CmApp.BgColor.CurrentColor.$().css("background-color",e),e!=t.settings.backgroundColor?(o&&L.push(),_t=t.settings.backgroundColor,t.settings.backgroundColor=e,o&&(zi(),ht.main.refreshAllViews()),Do(),!0):(Do(),!1)}function Ze(t,e,o,i,s,r,n){return e=R.clamp(R.roundTo(e,n),i,s),t.display.$().text(e+o),Vt(t,e,i,s,r),e}function Ke(e,o){return(e=Ze(P.CmApp.Edges.Smoothing,e,"",0,D.MaxSmoothingLevel,t.defaultSettings.globalSmoothingLevel,1))!=t.settings.globalSmoothingLevel&&(o&&L.push(),t.settings.globalSmoothingLevel=e,ro(),o&&zi(),!0)}function to(e,o){return(e=Ze(P.CmApp.Edges.FeatheringRadius,e,"px",0,D.MaxBlurLevel,t.defaultSettings.globalBlurLevel,1))!=t.settings.globalBlurLevel&&(o&&L.push(),t.settings.globalBlurLevel=e,ro(),o&&zi(),!0)}function eo(e,o){return(e=Ze(P.CmApp.Edges.Offset,e,"px",0,D.MaxOffset,t.defaultSettings.globalOffset,2))!=t.settings.globalOffset&&(o&&L.push(),t.settings.globalOffset=e,ro(),o&&zi(),!0)}function oo(e,o){return $("#use-corner-detection-button-"+e).button("toggle"),e!=t.settings.useCornerDetection&&(o&&L.push(),t.settings.useCornerDetection=e,o&&zi(),!0)}function io(e,o){return $("#CmApp-Edges-"+e).button("toggle"),e!=t.settings.blurMode&&(o&&L.push(),t.settings.blurMode=e,o&&zi(),!0)}function so(e,o){return $("#use-local-smoothing-button-"+e).button("toggle"),e!=t.settings.useLocalSmoothing&&(o&&L.push(),t.settings.useLocalSmoothing=e,o&&zi(),!0)}function ro(){let e=" "+t.settings.globalSmoothingLevel+", "+t.settings.globalBlurLevel+", "+t.settings.globalOffset;$("#blur-offset-smooth-button-label").text(e)}function no(){return(t.settings.cropRect_o.isEmpty()?I:t.settings.cropRect_o).dup()}function ao(e,o){if(null!=e||t.settings.cropRect_o.isEmpty()){if(null!=e&&!t.settings.cropRect_o.equals(e))return o&&L.push(),t.settings.cropRect_o.setFrom(e),Fo(),dt.updatePerspectiveShadowCanvas(),o&&zi(),!0}else o&&L.push(),t.settings.cropRect_o.set(0,0,0,0),Fo(),dt.updatePerspectiveShadowCanvas(),o&&zi();return!1}function lo(e,o){return e!=t.settings.cropMode&&(o&&L.push(),t.settings.cropMode=e,Fo(),o&&zi(),!0)}function co(e,o){return e!=t.settings.cropMarginUnits&&(o&&L.push(),t.settings.cropMarginUnits=e,Fo(),o&&zi(),!0)}function po(e,o){return e!=t.settings.cropObjectSize&&(o&&L.push(),t.settings.cropObjectSize=e,Fo(),o&&zi(),!0)}function uo(e,o){return e!=t.settings.cropVerticalAlignment&&(o&&L.push(),t.settings.cropVerticalAlignment=e,Fo(),o&&zi(),!0)}function ho(e,o){return e!=t.settings.cropShadows&&(o&&L.push(),t.settings.cropShadows=e,Fo(),o&&zi(),!0)}function go(e,o){return(e=Math.round(R.clamp(e,0,D.CropPaddingMilsMax)))!=t.settings.cropPaddingMils&&(o&&L.push(),t.settings.cropPaddingMils=e,mo(),Fo(),o&&zi(),!0)}function mo(){Vt(P.CmApp.CropApp.PaddingPercent,t.settings.cropPaddingMils,0,D.CropPaddingMilsMax,t.defaultSettings.cropPaddingMils),Vt(P.CmApp.CropApp.PaddingPixels,t.settings.cropPaddingPixels,0,D.CropPaddingPixelsMax,t.defaultSettings.cropPaddingPixels)}function fo(e){go(t.settings.cropPaddingMils+e,!1)}function So(e,o){return(e=Math.round(R.clamp(e,0,D.CropPaddingPixelsMax)))!=t.settings.cropPaddingPixels&&(o&&L.push(),t.settings.cropPaddingPixels=e,mo(),Fo(),o&&zi(),!0)}function wo(e){So(t.settings.cropPaddingPixels+e,!1)}function Co(e,o){return(e=Math.round(R.clamp(e,D.MinDpi,D.MaxDpi)))!=t.settings.outputDpi&&(o&&L.push(),t.settings.outputDpi=e,bo(),_o(),o&&zi(),!0)}function yo(e){Co(t.settings.outputDpi+e,!1)}function bo(){P.CmApp.CropApp.Dpi.display.$().text(t.settings.outputDpi+" DPI"),Vt(P.CmApp.CropApp.Dpi,t.settings.outputDpi,D.MinDpi,D.MaxDpi,t.defaultSettings.outputDpi)}function vo(e,o){return(e=Math.round(R.clamp(e,D.JpegQualityMin,D.JpegQualityMax)))!=t.settings.jpegQuality&&(o&&L.push(),t.settings.jpegQuality=e,_o(),o&&zi(),!0)}function Ao(e){vo(t.settings.jpegQuality+e,!1)}function ko(e,o){return e!=t.settings.opaqueFileFormat&&(o&&L.push(),t.settings.opaqueFileFormat=e,_o(),o&&zi(),!0)}function Mo(e,o){return e!=t.settings.pngMode&&(o&&L.push(),t.settings.pngMode=e,_o(),o&&zi(),!0)}function xo(e,o){return e!=t.settings.jpegMode&&(o&&L.push(),t.settings.jpegMode=e,_o(),o&&zi(),!0)}function To(e=t.settings.backgroundColor){return e!=D.TransparentColor&&null!=e?t.settings.opaqueFileFormat==D.OpaqueFileFormatPng?D.PNG:D.JPEG:D.PNG}function _o(){P.ExportOptions.JpgQuality.display.$().text(t.settings.jpegQuality),Vt(P.ExportOptions.JpgQuality,t.settings.jpegQuality,D.JpegQualityMin,D.JpegQualityMax,t.defaultSettings.jpegQuality),t.OpaqueFileFormatGroup.update(t.settings.opaqueFileFormat),t.PngModeGroup.update(t.settings.pngMode),t.JpegModeGroup.update(t.settings.jpegMode),Do()}function Do(){let e=t.settings.pngMode!=D.PngModeNone,o=t.settings.jpegMode!=D.JpegModeNone,i=e||o,s=P.ExportOptions.NoColorSpaceOrDpiInOptimizedOutput.emphasize.name(),r=t.settings.outputColorSpace!=D.ColorSpaceSrgb;P.ExportOptions.NoColorSpaceOrDpiInOptimizedOutput.Jpeg.comment.$().toggleClass(s,o),P.ExportOptions.NoColorSpaceOrDpiInOptimizedOutput.Png.comment.$().toggleClass(s,e),P.ExportOptions.NoColorSpaceOrDpiInOptimizedOutput.Dpi.comment.$().toggleClass(s,i),P.ExportOptions.NoColorSpaceOrDpiInOptimizedOutput.ColorSpace.comment.$().toggleClass(s,i&&r)}function Po(e,o){return Math.abs(e-o)<=1+t.settings.globalOffset}function Ro(){return Ft.fromCropRect(I)}function Eo(){let e=t.boundingRect;return null!=e?new Ft(e[0],e[1],e[2],e[3]):Ro()}function Fo(){if(!Z){var e=t.settings.cropRect_o.dup();if(t.settings.cropFitToResult&&t.boundingRect){var o=Ft.fromBoundingRect(t.boundingRect),i=Ft.fromBoundingRect(t.shadowsRect),s=Ft.empty();t.settings.cropShadows!=D.CropShadowsIgnore&&(s.left=Math.max(0,o.left-i.left),s.top=Math.max(0,o.top-i.top),s.right=Math.max(0,i.right-o.right),s.bottom=Math.max(0,i.bottom-o.bottom),t.settings.cropShadows==D.CropShadowsPad&&(s.left=s.right=Math.max(s.left,s.right))),s.left=Math.min(s.left,t.imageSize.w),s.top=Math.min(s.top,t.imageSize.h),s.right=Math.min(s.right,t.imageSize.w),s.bottom=Math.min(s.bottom,t.imageSize.h);var r=o.width(),n=o.height(),a=0,l=0;t.settings.cropMarginUnits==D.CropMarginPercent?(a=r*t.settings.cropPaddingMils*.001,l=n*t.settings.cropPaddingMils*.001):l=a=t.settings.cropPaddingPixels;var c=new Ft(Po(o.left,I.left0)?0:a,Po(o.top,I.top0)?0:l,Po(o.right,I.right0)?0:a,Po(o.bottom,I.bottom0)?0:l);c.left=Math.max(c.left,s.left),c.top=Math.max(c.top,s.top),c.right=Math.max(c.right,s.right),c.bottom=Math.max(c.bottom,s.bottom);var p=0,u=0;switch(t.settings.cropObjectSize){case D.CropSizeSmall:p=n*D.CropObjectSizePercentPadSmall,u=r*D.CropObjectSizePercentPadSmall*.5;break;case D.CropSizeMedium:p=n*D.CropObjectSizePercentPadMedium,u=r*D.CropObjectSizePercentPadMedium*.5;case D.CropSizeLarge:}switch(t.settings.cropVerticalAlignment){case D.CropAlignmentTop:c.left+=u,c.right+=u,c.bottom+=p;break;case D.CropAlignmentMiddle:c.left+=u,c.top+=.5*p,c.right+=u,c.bottom+=.5*p;break;case D.CropAlignmentBottom:c.left+=u,c.top+=p,c.right+=u}t.settings.cropRect_o.left0=o.left-c.left,t.settings.cropRect_o.right0=o.right+c.right,t.settings.cropRect_o.top0=o.top-c.top,t.settings.cropRect_o.bottom0=o.bottom+c.bottom}t.settings.cropMode==D.CropLockedAspectRatio?Bo($o()):t.settings.cropMode==D.CropTargetSize&&Bo(Go()),function(){let e=t.settings.cropMode==D.CropLockedAspectRatio?$o():t.settings.cropMode==D.CropTargetSize?Go():{w:t.settings.cropRect_o.width(),h:t.settings.cropRect_o.height()},o=e.w/e.h;t.settings.cropRect_o;if(t.settings.cropRect_o.width()>D.MaxOutputWidthOrHeight){let e=.5*(t.settings.cropRect_o.width()-D.MaxOutputWidthOrHeight),i=0;t.settings.cropMode!=D.CropUnconstrained&&(i=.5*(t.settings.cropRect_o.height()-D.MaxOutputWidthOrHeight/o)),Io(e,i)}if(t.settings.cropRect_o.height()>D.MaxOutputWidthOrHeight){let e=0;t.settings.cropMode!=D.CropUnconstrained&&(e=.5*(t.settings.cropRect_o.width()-D.MaxOutputWidthOrHeight*o)),Io(e,.5*(t.settings.cropRect_o.height()-D.MaxOutputWidthOrHeight))}if(t.settings.cropRect_o.area()>D.MaxOutputSize){let e=Math.sqrt(D.MaxOutputSize/t.settings.cropRect_o.area());Io(t.settings.cropRect_o.width()*(1-e)*.5,t.settings.cropRect_o.height()*(1-e)*.5)}}();var h=!e.softEquals(t.settings.cropRect_o,.001);!t.settings.cropFitToResult&&h&&(W=!0,qt(),Yt()),h&&dt.updatePerspectiveShadowCanvas(),Q.updateDisplay(),ht.refreshAllViews()}}function Io(e,o){if(0!=e&&(t.settings.cropRect_o.left0+=e,t.settings.cropRect_o.right0-=e),0!=o)switch(t.settings.cropVerticalAlignment){case D.CropAlignmentTop:t.settings.cropRect_o.bottom0-=2*o;break;case D.CropAlignmentMiddle:t.settings.cropRect_o.top0+=o,t.settings.cropRect_o.bottom0-=o;break;case D.CropAlignmentBottom:t.settings.cropRect_o.top0+=2*o}}function Bo(e){var o=e.w/e.h,i=t.settings.cropRect_o;i.isEmpty()&&(i.right0=t.imageSize.w,i.bottom0=t.imageSize.h);var s=i.width(),r=i.height();if(o>s/r){var n=(r*o-s)/2;t.settings.cropRect_o.left0-=n,t.settings.cropRect_o.right0+=n}else{var a=(s/o-r)/2;switch(t.settings.cropVerticalAlignment){case D.CropAlignmentTop:t.settings.cropRect_o.bottom0+=2*a;break;case D.CropAlignmentMiddle:t.settings.cropRect_o.top0-=a,t.settings.cropRect_o.bottom0+=a;break;case D.CropAlignmentBottom:t.settings.cropRect_o.top0-=2*a}}}function Oo(e,o){return e!=t.settings.cropFitToResult&&(o&&L.push(),t.settings.cropFitToResult=e,Fo(),o&&zi(),!0)}function Lo(e,o,i){return!!(e!=t.settings.cropAllowEnlarging||i&&t.settings.cropMode!=D.CropTargetSize)&&(o&&L.push(),t.settings.cropAllowEnlarging=e,i&&(t.settings.cropMode=D.CropTargetSize),Fo(),o&&zi(),!0)}function zo(t,e){return null==t?null==e:null!=e&&(t.h==e.h&&t.w==e.w)}function $o(){return null!=t.settings.cropAspectRatio?t.settings.cropAspectRatio:{w:t.imageAspectRatio.w,h:t.imageAspectRatio.h}}function Uo(e,o,i){return!(zo($o(),e)&&(!i||t.settings.cropMode==D.CropLockedAspectRatio))&&(o&&L.push(),t.settings.cropAspectRatio=e?{w:e.w,h:e.h}:null,i&&(t.settings.cropMode=D.CropLockedAspectRatio),Fo(),o&&zi(),!0)}function Go(){return null!=t.settings.cropTargetSize?t.settings.cropTargetSize:{w:C,h:y}}function No(e,o,i){return!(zo(Go(),e)&&(!i||t.settings.cropMode==D.CropTargetSize))&&(o&&L.push(),t.settings.cropTargetSize=e?{w:e.w,h:e.h}:null,i&&(t.settings.cropMode=D.CropTargetSize),Fo(),o&&zi(),!0)}function Ho(e=!0){var o=L.sourceFunction(),i=t.defaultSettings,s=Oo(i.cropFitToResult,!1),r=lo(i.cropMode,!1),n=Lo(i.cropAllowEnlarging,!1,!1),a=go(i.cropPaddingMils,!1),l=So(i.cropPaddingPixels,!1),c=!i.cropFitToResult&&ao(i.cropRect_o,!1),p=co(i.cropMarginUnits,!1),u=po(i.cropObjectSize,!1),h=uo(i.cropVerticalAlignment,!1),d=ho(i.cropShadows,!1);(s||r||n||a||l||c||p||u||h||d)&&(e&&L.push(o),zi())}function Vo(e,o){var i=jo();e=R.minMod(e,360),t.settings.rotateAngleDeg!=e&&(o&&L.push(),t.settings.rotateAngleDeg=e,Zo(i),o&&zi(),Fo(),ht.subViewPort.refreshAllViews())}function Wo(e){var o=jo();L.push(),t.settings.rotateAngleDeg=R.minMod(t.settings.rotateAngleDeg+e,360),Zo(o),t.settings.cropMode!=D.CropUnconstrained||t.settings.cropFitToResult||t.settings.cropRect_o.isEmpty()||(t.settings.cropRect_o.rotate(e,b,v),Fo()),zi()}function Xo(){return t.settings.rotateAngleDeg*Math.PI/180}function Yo(e){var o=jo();t.settings.straightenAngleDeg!=e&&(t.settings.straightenAngleDeg=parseFloat(e.toFixed(1)),Zo(o,!1))}function qo(e){Yo(R.clamp(t.settings.straightenAngleDeg+e,-45,45))}function Jo(){return t.settings.straightenAngleDeg*Math.PI/180}function Qo(){return(t.settings.rotateAngleDeg+t.settings.straightenAngleDeg)*Math.PI/180}function jo(){return-Qo()}function Zo(e,o=!0){var i=Jo(),s=C,r=y,n=y>C;n&&(r=C,s=y);var a=r/Math.sqrt(s*s+r*r),l=Math.acos(a)-Math.abs(i),c=Math.cos(l)/a,p=s*c,u=r*c,h=(s-p)/2,d=(r-u)/2,g=h,m=d,f=h+p,S=d+u;n&&(g=d,m=h,f=d+u,S=h+p);var w=Xo(),A=Math.sin(w),k=Math.cos(w),M=g-b,x=m-v,T=f-b,_=S-v,D=k*M-A*x+b,R=A*M+k*x+v,E=k*T-A*_+b,F=A*T+k*_+v;I.left0=Math.min(D,E),I.right0=Math.max(D,E),I.top0=Math.min(R,F),I.bottom0=Math.max(R,F),P.CmApp.CropApp.StraightenSpinner.reset.$().toggleClass("disabled",0==t.settings.straightenAngleDeg),P.CmApp.CropApp.RotateSpinner.reset.$().toggleClass("disabled",0==t.settings.rotateAngleDeg),P.CmApp.CropApp.StraightenSpinner.display.$().html(t.settings.straightenAngleDeg.toFixed(1)+"&deg;"),P.CmApp.CropApp.RotateSpinner.display.$().html(t.settings.rotateAngleDeg+"&deg;"),o&&dt.updateMirrorShadowCanvas(),ht.main.rotationCropUpdated(e,jo()),ht.subViewPort.rotationCropUpdated(e,jo()),ht.refreshAllViews()}function Ko(e){t.settings.brightness=Math.round(R.clamp(e,-100,100)),bi()}function ti(e){Ko(t.settings.brightness+e)}function ei(e){t.settings.shadows=Math.round(R.clamp(e,-100,100)),bi()}function oi(e){ei(t.settings.shadows+e)}function ii(e){t.settings.highlights=Math.round(R.clamp(e,-100,100)),bi()}function si(e){ii(t.settings.highlights+e)}function ri(e){t.settings.temperature=Math.round(R.clamp(e,-100,100)),bi()}function ni(e){ri(t.settings.temperature+e)}function ai(e){t.settings.saturation=Math.round(R.clamp(e,-100,100)),bi()}function li(e){ai(t.settings.saturation+e)}function ci(e,o){return t.settings.outputColorSpace!=e&&(o&&L.push(),t.settings.outputColorSpace=e,ui(),_o(),o&&zi(),!0)}function pi(){var e="sRGB";switch(t.settings.outputColorSpace){case D.ColorSpaceSrgb:e="sRGB";break;case D.ColorSpaceAdobeRgb:e="Adobe RGB (1998)";break;case D.ColorSpaceAppleRgb:e="Apple RGB";break;case D.ColorSpaceColorMatchRgb:e="ColorMatch RGB"}return e}function ui(){P.CmApp.ColorsApp.ColorSpace.display.$().text(pi())}function hi(e,o){t.settings.whiteBalanceEnabled!=e&&(o&&L.push(),t.settings.whiteBalanceEnabled=e,vi(),o&&zi())}function di(e,o,i=!1){t.settings.whiteBalanceGrayColor!=e&&(o&&L.push(),t.settings.whiteBalanceGrayColor=e,i&&!t.settings.whiteBalanceEnabled&&(t.settings.whiteBalanceEnabled=!0),vi(),o&&zi()),vi()}function gi(r,n){if(t.settings.removeColorCast!=r){if(n&&L.push(),t.settings.removeColorCast=r,r&&t.settings.castColor==D.FactoryDefaults.castColor&&t.userMask){for(var a=O.Background.colorBytesRgba,l=new se,c=t.userMask.context().getImageData(0,0,C,y).data,p=0,u=0;u<kt.length;u+=4)c[u+e]==a[e]&&c[u+o]==a[o]&&c[u+i]==a[i]&&c[u+s]==a[s]&&(l.add(kt[u+e],kt[u+o],kt[u+i]),p++);p>0&&mi(l.findMaxBinCenter(),!1)}vi(),n&&zi()}}function mi(e,o,i=!1){t.settings.castColor!=e&&(o&&L.push(),t.settings.castColor=e,i&&!t.settings.removeColorCast&&(t.settings.removeColorCast=!0),vi(),o&&zi()),vi()}function fi(e){t.settings.colorCastForegroundProtection=R.roundTo(R.clamp(e,0,r),1),bi()}function Si(e){fi(t.settings.colorCastForegroundProtection+e)}function wi(e=!0){0==t.settings.brightness&&0==t.settings.shadows&&0==t.settings.highlights&&0==t.settings.temperature&&0==t.settings.saturation&&t.settings.castColor==t.defaultSettings.castColor&&t.settings.colorCastForegroundProtection==t.defaultSettings.colorCastForegroundProtection&&t.settings.removeColorCast==t.defaultSettings.removeColorCast&&t.settings.whiteBalanceEnabled==t.defaultSettings.whiteBalanceEnabled&&t.settings.whiteBalanceGrayColor==t.defaultSettings.whiteBalanceGrayColor||(e&&L.push(),t.settings.brightness=0,t.settings.shadows=0,t.settings.highlights=0,t.settings.temperature=0,t.settings.saturation=0,t.settings.castColor=t.defaultSettings.castColor,t.settings.colorCastForegroundProtection=t.defaultSettings.colorCastForegroundProtection,t.settings.removeColorCast=t.defaultSettings.removeColorCast,t.settings.whiteBalanceEnabled=t.defaultSettings.whiteBalanceEnabled,t.settings.whiteBalanceGrayColor=t.defaultSettings.whiteBalanceGrayColor,vi(),zi())}function Ci(){null==Pt&&(Pt=U.run(kt,At.width,At.height)),t.settings.highlights==Pt.highlights&&t.settings.shadows==Pt.shadows||(L.push(),t.settings.shadows=Pt.shadows,t.settings.highlights=Pt.highlights,vi(),zi())}function yi(){return bt?Ct:wt}function bi(){function e(t,e,o,i,s){Vt(t,e,o,i,s),t.display.$().html(R.signedNumber(e))}!function(){var e=-t.settings.temperature/100,o=(e<0?6600+5100*e:6600+8400*e)/100;M=0!=t.settings.temperature,x=255,_=255,E=255,o<66?(_=R.clamp(99.4708025861*Math.log(o)-161.1195681661,0,255),E=o<=19?0:R.clamp(138.5177312231*Math.log(o-10)-305.0447927307,0,255)):o>66&&(x=R.clamp(329.698727446*Math.pow(o-60,-.1332047592),0,255),_=R.clamp(288.1221695283*Math.pow(o-60,-.0755148492),0,255));F=.5*t.settings.temperature}(),e(P.CmApp.ColorsApp.ColorLevels.brightness,t.settings.brightness,-100,100,0),e(P.CmApp.ColorsApp.ColorLevels.shadows,t.settings.shadows,-100,100,0),e(P.CmApp.ColorsApp.ColorLevels.highlights,t.settings.highlights,-100,100,0),e(P.CmApp.ColorsApp.ColorLevels.temperature,t.settings.temperature,-100,100,0),e(P.CmApp.ColorsApp.ColorLevels.saturation,t.settings.saturation,-100,100,0),e(P.CmApp.ColorsApp.ColorCast.ForegroundProtection,t.settings.colorCastForegroundProtection,0,r,t.defaultSettings.colorCastForegroundProtection),P.CmApp.ColorsApp.ColorLevels.temperature.swatch.$().css("background-color",Qt.fromInts(255,x,_,E).toRgbaCss()),P.CmApp.ColorsApp.ColorCast.RemovalEnabled.$().prop("checked",t.settings.removeColorCast),P.CmApp.ColorsApp.ColorCast.Swatch.$().css("background-color",Qt.fromInt(t.settings.castColor).toRgbCss()),P.CmApp.ColorsApp.ColorCast.controls.$().toggle(t.settings.removeColorCast),P.CmApp.ColorsApp.WhiteBalance.Enabled.$().prop("checked",t.settings.whiteBalanceEnabled),P.CmApp.ColorsApp.WhiteBalance.Swatch.$().css("background-color",Qt.fromInt(t.settings.whiteBalanceGrayColor).toRgbCss()),P.CmApp.ColorsApp.WhiteBalance.controls.$().toggle(t.settings.whiteBalanceEnabled);var o=0==t.settings.brightness,i=0==t.settings.shadows,s=0==t.settings.highlights,n=0==t.settings.temperature,a=0==t.settings.saturation,l=!t.settings.removeColorCast,c=!t.settings.whiteBalanceEnabled;bt=!(o&&i&&s&&n&&a&&l&&c),P.CmApp.ColorsApp.ColorLevels.reset.$().toggleClass("disabled",o&&i&&s&&n&&a)}function vi(){K||(bi(),bt&&yt==t.previewCanvasData&&(Ct=t.previewCanvas.context().getImageData(0,0,C,y),yt=Ct.data),vt=function(){for(var e=t.settings.brightness,o=1+t.settings.shadows/100,i=1+t.settings.highlights/100,s=-t.settings.saturation/100,r=t.settings.removeColorCast,n=t.settings.colorCastForegroundProtection,a=0;a<256;a++)Ai[a]=R.clamp(255-(255-(a+e)*i)*o,0,255);var l=null,c=t.settings.whiteBalanceEnabled;c&&(l=jt.buildWhiteBalancerFromGrayColorSampleBradford(Qt.fromInt(t.settings.whiteBalanceGrayColor)));var p=Qt.fromInt(t.settings.castColor),u=p.dup().desaturateEvenly().minusEquals(p).normalized(),h=new Qt,d=new Qt,g=new Qt,m=new Qt;return function(t,e,o,i,a){if(c&&(h.fromInts(e,o,i,a),l.matrixVectorMultiply(h,d),d.clamp(),o=d.rInt(),i=d.gInt(),a=d.bInt()),r){h.fromInts(e,o,i,a),g.setArgb(h).desaturateEvenly();var p=m.setArgb(g).minusEquals(h).normalize(),f=m.dot(u);if(f>0){var S=R.clamp(f,0,1)*R.clamp(1-n*p*p,0,1);g.mixWith(h,S),o=g.rInt(),i=g.gInt(),a=g.bInt()}}if(0!=s){var w=.299*o+.587*i+.114*a;o=ki(s*w+(1-s)*o),i=ki(s*w+(1-s)*i),a=ki(s*w+(1-s)*a)}if(o=Ai[o],i=Ai[i],a=Ai[a],M){let t=Mi(o,i,a),e=Mi(o=R.clamp(o+F,0,255),i,a=R.clamp(a-F,0,255)),s=e>0?t/e:1;o=R.clamp(o*s,0,255),i=R.clamp(i*s,0,255),a=R.clamp(a*s,0,255)}yt[t]=o,yt[t+1]=i,yt[t+2]=a,yt[t+3]=e}}(),Ri(),Di(),dt.updateMirrorShadowCanvas(),ht.refreshAllViews())}t.initializeViewPanesMode=Ne,t.checkUpdateTempPreviewPaneToggle=Ve,t.tempPreviewViewPaneToggle=We,t.tempViewOriginalToggle=function(t){Xe(t?2:He()?1:0),P.CmApp.Sidebar.viewOriginal.toggleClass(P.CmApp.Sidebar.selected,t)},t.tempViewMarksToggle=function(t){Xe(t?0:He()?1:0),P.CmApp.Sidebar.marks.toggleClass(P.CmApp.Sidebar.selected,t)},t.setViewPanesMode=Ye,t.updateViewPanesModeDisplay=qe,t.stepBackgroundColor=function(e){let o=Qt.fromCss(t.settings.backgroundColor),i=window.Globals.BackgroundColorInts.indexOf(o.toInt());if(i<0)je(window.Globals.BackgroundColors[e?1:2],!0);else if(1==i&&!e||2==i&&e)je(Qe(),!0);else{let t=window.Globals.BackgroundColors.length;i=e?(i+t-1)%t:(i+1)%t,je(window.Globals.BackgroundColors[i],!0)}},t.jumpToLastBackgroundColor=function(e){if(e){let e=Qt.fromCss(t.settings.backgroundColor),o=window.Globals.BackgroundColorInts.indexOf(e.toInt());je(window.Globals.BackgroundColors[0==o?1:0],!0)}else{je(_t||window.Globals.BackgroundColors[7],!0)}},t.setBackgroundColor=je,t.resetGlobalSmoothingLevel=function(){Ke(t.defaultSettings.globalSmoothingLevel,!0)},t.stepGlobalSmoothingLevel=function(e){Ke(t.settings.globalSmoothingLevel+e,!0)},t.setGlobalSmoothingLevel=Ke,t.resetGlobalBlurLevel=function(){to(t.defaultSettings.globalBlurLevel,!0)},t.stepGlobalBlurLevel=function(e){to(t.settings.globalBlurLevel+e,!0)},t.setGlobalBlurLevel=to,t.resetGlobalOffset=function(){eo(t.defaultSettings.globalOffset,!0)},t.stepGlobalOffset=function(e){eo(t.settings.globalOffset+e,!0)},t.setGlobalOffset=eo,t.setUseCornerDetection=oo,t.setBlurMode=io,t.setUseLocalSmoothing=so,t.getCrop_o=no,t.getViewCrop_o=function(){let e=I.dup();return t.settings.cropRect_o.isEmpty()||e.unionWith(t.settings.cropRect_o),e},t.setCrop_o=ao,t.setCropMode=lo,t.setCropMarginUnits=co,t.setCropObjectSize=po,t.setCropVerticalAlignment=uo,t.setCropShadows=ho,t.setCropPadding=go,t.updateCropPaddingResetEnabled=mo,t.cropPaddingDecrease=function(){fo(-1)},t.cropPaddingIncrease=function(){fo(1)},t.cropPaddingReset=function(){go(t.defaultSettings.cropPaddingMils,!1)},t.setCropPaddingPixels=So,t.cropPaddingPixelsDecrease=function(){wo(-1)},t.cropPaddingPixelsIncrease=function(){wo(1)},t.cropPaddingPixelsReset=function(){So(t.defaultSettings.cropPaddingPixels,!1)},t.setOutputDpi=Co,t.outputDpiDecrease=function(){yo(-1)},t.outputDpiIncrease=function(){yo(1)},t.outputDpiReset=function(){Co(t.defaultSettings.outputDpi,!1)},t.setJpegQuality=vo,t.jpegQualityDecrease=function(){Ao(-1)},t.jpegQualityIncrease=function(){Ao(1)},t.jpegQualityReset=function(){vo(t.defaultSettings.jpegQuality,!1)},t.OpaqueFileFormatGroup=new Kt([new Zt(P.ExportOptions.OpaqueFormat.jpg,D.OpaqueFileFormatJpeg),new Zt(P.ExportOptions.OpaqueFormat.png,D.OpaqueFileFormatPng)]),t.setOpaqueFileFormat=ko,t.PngModeGroup=new Kt([new Zt(P.ExportOptions.PngOptimization.none,D.PngModeNone),new Zt(P.ExportOptions.PngOptimization.lossless,D.PngModeLossless),new Zt(P.ExportOptions.PngOptimization.lossy,D.PngModeLossy)]),t.JpegModeGroup=new Kt([new Zt(P.ExportOptions.JpegOptimization.none,D.JpegModeNone),new Zt(P.ExportOptions.JpegOptimization.moz,D.JpegModeMoz)]),t.setPngMode=Mo,t.setJpegMode=xo,t.exportFileFormat=To,t.getRotationCrop_o=Ro,t.getBoundingRect_o=Eo,t.getBoundingQuad_i=function(t){return Eo().pad(t).toQuad().rotateInPlace(Qo(),A)},t.updateCrop=Fo,t.setCropFitToResult=Oo,t.setCropAllowEnlarging=Lo,t.getCropAspectRatio=$o,t.setCropAspectRatio=Uo,t.getCropTargetSize=Go,t.setCropTargetSize=No,t.resetCrop=Ho,t.setRotateAngleDeg=Vo,t.incrementRotateAngleDeg=Wo,t.rotateClockwise=function(){Wo(-90)},t.rotateCounterclockwise=function(){Wo(90)},t.rotateReset=function(){Vo(t.defaultSettings.rotateAngleDeg,!0)},t.rotateAngleRad=Xo,t.setStraightenAngleDeg=Yo,t.straightenClockwise=function(){qo(-.1)},t.straightenCounterclockwise=function(){qo(.1)},t.straightenReset=function(){0!=t.settings.straightenAngleDeg&&(L.push(),Yo(0),zi(),dt.updateMirrorShadowCanvas(),dt.updatePerspectiveShadowCanvas())},t.straightenAngleRad=Jo,t.straightenCommit=function(){dt.updateMirrorShadowCanvas(),dt.updatePerspectiveShadowCanvas(),t.sendSetGlobal()},t.totalRotationAngleRad_o2i=Qo,t.totalRotationAngleRad_i2o=jo,t.setBrightness=Ko,t.brightnessReset=function(){0!=t.settings.brightness&&(L.push(),Ko(0),vi(),zi())},t.brightnessDecrement=function(){ti(-1)},t.brightnessIncrement=function(){ti(1)},t.setShadows=ei,t.shadowsReset=function(){0!=t.settings.shadows&&(L.push(),ei(0),vi(),zi())},t.shadowsDecrement=function(){oi(-1)},t.shadowsIncrement=function(){oi(1)},t.setHighlights=ii,t.highlightsReset=function(){0!=t.settings.highlights&&(L.push(),ii(0),vi(),zi())},t.highlightsDecrement=function(){si(-1)},t.highlightsIncrement=function(){si(1)},t.setTemperature=ri,t.temperatureReset=function(){0!=t.settings.temperature&&(L.push(),ri(0),vi(),zi())},t.temperatureDecrement=function(){ni(-1)},t.temperatureIncrement=function(){ni(1)},t.setSaturation=ai,t.saturationReset=function(){0!=t.settings.saturation&&(L.push(),ai(0),vi(),zi())},t.saturationDecrement=function(){li(-1)},t.saturationIncrement=function(){li(1)},t.setOutputColorSpace=ci,t.setWhiteBalanceEnabled=hi,t.toggleWhiteBalanceEnabled=function(){hi(!t.settings.whiteBalanceEnabled,!0)},t.setWhiteBalanceGrayColor=di,t.whiteBalanceGrayColorReset=function(){t.settings.whiteBalanceGrayColor!=t.defaultSettings.whiteBalanceGrayColor&&di(t.defaultSettings.whiteBalanceGrayColor,!0)},t.setRemoveColorCast=gi,t.toggleColorCast=function(){gi(!t.settings.removeColorCast,!0)},t.setCastColor=mi,t.castColorReset=function(){t.settings.castColor!=t.defaultSettings.castColor&&mi(t.defaultSettings.castColor,!0)},t.setColorCastForegroundProtection=fi,t.colorCastForegroundProtectionReset=function(){t.settings.colorCastForegroundProtection!=t.defaultSettings.colorCastForegroundProtection&&(L.push(),fi(t.defaultSettings.colorCastForegroundProtection),vi(),zi())},t.colorCastForegroundProtectionDecrement=function(){Si(-.1)},t.colorCastForegroundProtectionIncrement=function(){Si(.1)},t.colorLevelsResetLevels=function(){0==t.settings.brightness&&0==t.settings.shadows&&0==t.settings.highlights&&0==t.settings.temperature&&0==t.settings.saturation||(L.push(),t.settings.brightness=0,t.settings.shadows=0,t.settings.highlights=0,t.settings.temperature=0,t.settings.saturation=0,vi(),zi())},t.colorLevelsResetAll=wi,t.colorLevelsAuto=Ci,t.previewCanvasImageDataSmart=yi,t.updateColorLevels=vi;var Ai=new Float32Array(256);function ki(t){return Math.floor(Math.max(0,Math.min(t,255)))}function Mi(t,e,o){return(Math.max(t,e,o)+Math.min(t,e,o))*a}function xi(e){switch(void 0!==e.rp&&(t.resultParity=e.rp),e.response){case D.ServerMaskReset:!function(){if(void 0===t.previewCanvasData.set)for(var e=0,o=kt.length;e<o;e++)t.previewCanvasData[e]=kt[e];else t.previewCanvasData.set(kt,0)}(),Ri();break;case D.ServerMask:"ControlByte"==(r=e).mode?Y.decode(r.arraybuffer,(function(e){!function(e,o){t.previewCanvasData[e+3]=o,bt&&(yt[e+3]=o)}(e,0)}),(function(t){Pi(t,255,kt[t],kt[t+1],kt[t+2])}),Pi):R.fatalErrorStr("Received unknown server response type: '"+r.mode+"'. ");break;case D.ServerMaskDone:dt.updateDropShadowCanvas(),dt.updateMirrorShadowCanvas(),dt.updatePerspectiveShadowCanvas(),Di();break;case D.BezierSet:!function(e){var o=new Dt(e.arraybuffer),i=(o.length()-10)/2+2,s=new Float32Array(i),r=o.readInt16(),n=o.readInt32()/r,a=o.readInt32()/r,l=0;0==w.length&&(t.bezierSetLength=0);for(s[l++]=n,s[l++]=a;l<i;l+=2)n=s[l]=o.readSignedInt16()/r+n,a=s[l+1]=o.readSignedInt16()/r+a;t.bezierSetLength+=i,w.push(s)}(e);break;case D.BezierSetDone:t.bezierSet=w,w=[],Ji.reset();break;case D.BoundingRect:var o=t.boundingRect;if(t.boundingRect=e.boundingRect,t.shadowsRect=e.shadowsRect,Fo(),o&&4==o.length&&t.boundingRect&&4==t.boundingRect.length){for(var i=0,s=0;s<t.boundingRect.length;s++)i=Math.max(i,Math.abs(t.boundingRect[s]-o[s]));i>.1&&(dt.updatePerspectiveShadowCanvas(),dt.initializeMirrorShadow(),dt.initializePerspectiveShadow())}else dt.updatePerspectiveShadowCanvas(),dt.initializeMirrorShadow(),dt.initializePerspectiveShadow();break;case D.UpdateComplete:ht.main.refreshAllViews();break;case D.EngineInitializing:V.initProgress(e.percent);break;case D.EngineInitialized:V.hide();break;case D.SetEngineMask:switch(e.imageCategory){case 0:case 2:break;case 1:f||(t.userMask.decode(e.engineMask,D.MaskVersion),ht.main.refreshAllViews(),Li(!0),f=!0);break;case 3:m||(t.userMask.decode(e.engineMask,D.MaskVersion),ht.main.refreshAllViews(),Li(!0),m=!0)}break;case D.SetActiveSwords:ot.setActiveSwords(e.activeSwords,e.index);break;case D.SetSwordIntersections:ot.setSwordIntersections(e.swordIntersections);break;case D.SetDetectedCorners:t.detectedCorners=e.detectedCorners;break;case D.ResultPending:T.App.resultPending(e.msg,e.percent);break;case D.ResultReady:St=!1,t.result.ready=!0,t.result.shown=!1,t.result.posted=!1,t.result.success=e.success,t.result.msg=e.msg,t.result.filename=e.resultFilename,Vi();break;case D.Meta:Et=e.meta,Lt();break;case D.ServerImageCategoriesKey:t.serverImageCategories=e.serverImageCategories;break;case D.ImageCategory:(0==t.imageCategory.user||t.imageCategory.user!=t.imageCategory.server&&t.imageCategory.user==e.imageCategory.user)&&(t.imageCategory.user=t.imageCategory.server=e.imageCategory.user),ie(),Lt();break;case D.ServerRgbHistogramResponse:t.hasServerRgbHistogramResponse=!0,e.dataUrl&&he(e.dataUrl);break;case D.Panic:R.gaTrack("ErrorShown","Panic",e.message),alert(p.s("Terribly sorry, but an unrecoverable server error has occurred:")+"\n\n"+e.message+"\n\n"+p.s("Please try again, or try another image.")),Gt();break;case D.Message:alert(e.message);break;case D.Highlighting:X.checkShowHighlighting();break;case D.UpdateImageSpec:if(e.userImageSpec){let t=e.userImageSpec;ft.drawCommands=t.drawCommands}break;case D.ColorCastEstimate:mi(e.castColor,!0);break;case D.WhiteBalanceEstimate:di(e.whiteBalanceGrayColor,!0);break;case D.Noop:e.dwm&&J.doApply();break;default:R.fatalErrorStr("Received unknown server response: '"+e.response+"'. ")}var r;e.hasOwnProperty("index")&&(mt=e.index),Yt()}function Ti(){j=!1,Oi(!0),zi(),Gi(),Ni(),Li(!1),Fi(),Ei(),Ii(),St&&Ui(),Yt(),j=!0}function _i(){return Yt(),ut!=mt||St||V.visible||!(Et.hasImage>=t.hasImage&&Et.hasDrawCommands>=t.hasDrawCommands)||t.imageCategory.user!=t.imageCategory.server}function Di(){t.previewCanvas.context().putImageData(yi(),0,0),ft.isPaid||J.checkApply(t.previewCanvas,t.boundingRect)}function Pi(e,o,i,s,r){t.previewCanvasData[e]=i,t.previewCanvasData[e+1]=s,t.previewCanvasData[e+2]=r,t.previewCanvasData[e+3]=o,bt&&vt(e,o,i,s,r)}function Ri(){if(bt){for(var e=0,o=t.previewCanvasData.length;e<o;e+=4){var i=t.previewCanvasData[e+3];0==i?yt[e+3]=0:vt(e,i,t.previewCanvasData[e],t.previewCanvasData[e+1],t.previewCanvasData[e+2])}dt.updateMirrorShadowCanvas()}}function Ei(){Wi({command:D.Meta,hasImage:t.hasImage,hasDrawCommands:t.hasDrawCommands,w:C,h:y})}function Fi(){Wi({command:D.ImageCategory,user:t.imageCategory.user})}function Ii(){if(!t.hasServerRgbHistogramResponse){for(var s=new se,r=0;r<kt.length;r+=4)s.add(kt[r+e],kt[r+o],kt[r+i]);Wi({command:D.SetClientRgbHistogram,data:s.encode()})}}t.sendImageHistogram=Ii;var Bi=null;function Oi(t=!1){var e=O.getActiveMode();(t||e.serverCares&&e!=Bi)&&(Bi=e,Wi({command:D.SetTool,toolMode:e.key})),Ue==D.ViewPanesSingle&&Ve()}function Li(e){Wi({command:D.SetUserMask,data:t.userMask.encode(),version:D.MaskVersion,isDirtying:e})}function zi(){Wi($.extend({command:D.SetGlobal,serverCropRect_o:no(),hasSavedMask:q.hasSavedMaskS3()},t.settings,{cropTargetSize:Go(),cropAspectRatio:$o()}))}function $i(t,e,o,i,s,r){Wi({command:t,x0:e,y0:o,x1:i,y1:s,d:r})}function Ui(){qi({command:D.GenerateResult});const e=oe()+"\nImCat:"+t.imageCategory.user;let o=!1;return e==It&&t.result.ready&&t.result.success?xi({response:D.ResultReady,success:!0,msg:null,resultFilename:t.result.filename}):(It=e,t.result.ready=!1,o=!0,zi(),Wi({command:D.GenerateResult})),te(),o}function Gi(){return Wi({command:D.SetSwords,swords:ot.cutSet.encodedPolyBezierSet()}),ut}function Ni(){return Wi({command:D.SetClientShadows,shadows:dt.encode()}),ut}function Hi(){return!ft.isPaid&&!window.GlobalsEx.hasCreditsLeft}function Vi(){var e=Ht();if(t.result.ready){t.result.posted||e||(t.result.posted=!0,qi({command:D.SavedAndResultReady,success:t.result.success,msg:t.result.msg}));const o=Hi(),i=!e;t.result.shown||!i&&o||(t.result.shown=!0,t.result.success?window.Globals.Bulk.isApi||(o?top.location.href=Xi():window.Globals.Bulk.isIframe||T.App.resultReady(t.result.success,t.result.msg)):T.App.resultReady(t.result.success,t.result.msg))}}function Wi(t){var e=!!D.DirtiesDrawCommandsSet.contains(t.command);e&&ut++,e&&j&&(t.command!=D.SetUserMask||t.isDirtying)&&(W=!0),t.index=ut,B.send(t),t.command==D.GenerateResult&&(St=!0),e&&(qt(),Yt())}function Xi(){return z.downloadUrl(ft.id,ft.secret)+(t.result.filename?"/"+t.result.filename:"")}function Yi(){let t="unknown",e=To().toLowerCase();return ft.originalFilename&&(t=R.dropExtension(ft.originalFilename)),t+"_clipped."+e}function qi(t){t.image={id:ft.id,secret:ft.secret},t.saved=!Ht(),window.checkPostMessage(t)}let Ji;t.sendSetTool=Oi,t.sendSetUserMask=Li,t.sendSetGlobal=zi,t.sendGenerateResult=Ui,t.skip=function(){qi({command:D.Skip}),te()},t.sendSaveServerMask=function(){Wi({command:D.SaveServerMask})},t.sendSetSword=Gi,t.sendSetShadows=Ni,t.isOutOfCredits=Hi,t.downloadUrl=Xi,t.updateResultParitySalt=function(){t.resultParitySalt=Date.now().toString()},t.downloadParityUrl=function(e,o=0,i){return i||(i=Yi()),z.downloadParityUrl(ft.id,ft.secret,e,o,t.resultParitySalt,i)},t.downloadAlphaGrayscaleUrl=function(){return z.downloadAlphaGrayscaleUrl(ft.id,ft.secret)},t.downloadSvgPathUrl=function(){return z.downloadSvgPathUrl(ft.id,ft.secret)},t.downloadTiffPathUrl=function(){return z.downloadTiffPathUrl(ft.id,ft.secret)},t.shareUrl=function(){return z.shareUrl(ft.id,ft.secret)},t.surveyUrl=function(){return z.surveyUrl(ft.id,ft.secret)},t.getFilename=function(){return ft.originalFilename||"Unknown Filename"},t.getResultFilename=Yi,t.savedMaskUpdated=function(){window.Globals.Bulk.isApi||(window.GlobalsEx.hasSavedMask=!0,q.checkFetch())},function(e){var o=-1,i=-1;e.currentCenter_i=Rt.nan();var s=new Nt(Rt.empty(),Rt.empty(),Rt.empty());function r(){var r=ht.main.getViewCenter_i();if(null!=r){var n=1e9;function a(t,s,a){!function(t,s,a){var l=r.distanceSqrTo(t);l<n&&(n=l,o=s,i=a,e.currentCenter_i.set(t))}(t.p0,s,a)}o=-1,i=-1;for(var l=0;l<t.bezierSet.length;l++){var c=t.bezierSet[l];if(c.length>=6){s.p2.setXy(c[0],c[1]);for(var p=0;p<c.length-5;p+=4)s.step(c[p+2],c[p+3],c[p+4],c[p+5]),a(s,l,p)}}-1!=o&&-1!=i&&ht.main.animateTo_i(e.currentCenter_i,4)}Ve()}e.start=r,e.reset=function(){o=-1,i=-1,e.currentCenter_i.setNan(),Ve()},e.back=function(){if(-1!=o&&-1!=i){var s=t.bezierSet[o];i>4?i-=4:(o=(o+t.bezierSet.length-1)%t.bezierSet.length,s=t.bezierSet[o],i=Math.max(0,s.length-2)),e.currentCenter_i.setXy(s[i],s[i+1]),ht.main.animateTo_i(e.currentCenter_i,4),Ve()}else r()},e.forward=function(){if(-1!=o&&-1!=i){var s=t.bezierSet[o];i<s.length-5?i+=4:(o=(o+1)%t.bezierSet.length,s=t.bezierSet[o],i=0),e.currentCenter_i.setXy(s[i],s[i+1]),ht.main.animateTo_i(e.currentCenter_i,4),Ve()}else r()}}(Ji=t.Review||(t.Review={}))}(lt||(lt={}));class ce{constructor(){this.ary=new Uint8Array(1024),this.pos=0}resize(t){for(var e=new Uint8Array(Math.max(t,2*this.ary.length)),o=0;o<this.pos;o++)e[o]=this.ary[o];this.ary=e}reset(){this.pos=0}push(t,e){this.ary.length<this.pos+4&&this.resize(this.pos+4);var o=7&t|(15&(e-=1))<<4;(e>>=4)<256?(this.ary[this.pos++]=o,this.ary[this.pos++]=e):(this.ary[this.pos++]=8|o,this.ary[this.pos++]=255&e,e>>=8,this.ary[this.pos++]=255&e,e>>=8,this.ary[this.pos++]=255&e)}toString(){return l.encode(this.ary,this.pos)}static decode(t,e){try{for(var o,i,s,r,n=l.decode(t),a=0;a<n.length;)i=7&(o=n[a++]),r=8&o,s=o>>4&15,s+=n[a++]<<4,0!=r&&(s+=n[a++]<<12,s+=n[a++]<<20),e(i,s+=1)}catch(t){}}}class pe{constructor(){this.ary=[]}reset(){this.ary.length=0}push(t,e){this.ary.push(t+":"+e)}toString(){return this.ary.join(";")}static decode(t,e){R.spliterate(t,";",(t=>{var o=t.split(":"),i=0|parseInt(o[0]),s=0|parseInt(o[1]);e(i,s)}))}}function ue(){class t{constructor(t,e,o,i,s){this.dataIn=t,this.wIn=e,this.hIn=o,this.wOut=i,this.hOut=s,this.dataOut=new Uint8ClampedArray(i*s*4),this.outToInX=this.wIn/this.wOut,this.outToInY=this.hIn/this.hOut;let r=t.length,n=!1;for(let e=3;e<r;e+=4){if(t[e]<255){n=!0;break}}this.hasTransparency=n,this.accumulate=this.hasTransparency?this.accumulateRgba:this.accumulateRgb}reset(){this.aSum=0,this.rSum=0,this.gSum=0,this.bSum=0,this.wSum=0}accumulateRgb(t,e,o){const i=4*(t+this.wIn*e);this.rSum+=this.dataIn[i+0]*o,this.gSum+=this.dataIn[i+1]*o,this.bSum+=this.dataIn[i+2]*o,this.wSum+=o}accumulateRgba(t,e,o){const i=4*(t+this.wIn*e);let s=(this.dataIn[i+3]/255+1e-12)*o;this.aSum+=s,this.rSum+=this.dataIn[i+0]*s,this.gSum+=this.dataIn[i+1]*s,this.bSum+=this.dataIn[i+2]*s,this.wSum+=o}populate(t,e){this.reset();const o=t*this.outToInX,i=e*this.outToInY,s=Math.min(o+this.outToInX,this.wIn),r=Math.min(i+this.outToInY,this.hIn),n=Math.floor(o),a=Math.floor(i),l=Math.ceil(s)-1,c=Math.ceil(r)-1,p=Math.ceil(o),u=Math.ceil(i),h=l,d=c,g=p-o,m=u-i,f=s-h,S=r-d;this.accumulate(n,a,g*m),this.accumulate(n,c,g*S);for(var w=p;w<h;w++)this.accumulate(w,a,m),this.accumulate(w,c,S);this.accumulate(l,a,f*m),this.accumulate(l,c,f*S);for(var C=u;C<d;C++){this.accumulate(n,C,g);for(w=p;w<h;w++)this.accumulate(w,C,1);this.accumulate(l,C,f)}const y=4*(t+e*this.wOut);this.hasTransparency?(this.dataOut[y+0]=this.rSum/this.aSum,this.dataOut[y+1]=this.gSum/this.aSum,this.dataOut[y+2]=this.bSum/this.aSum,this.dataOut[y+3]=this.aSum/this.wSum*255):(this.dataOut[y+0]=this.rSum/this.wSum,this.dataOut[y+1]=this.gSum/this.wSum,this.dataOut[y+2]=this.bSum/this.wSum,this.dataOut[y+3]=255)}shrink(){for(var t=0,e=0;t<this.hOut;t++)for(var o=0;o<this.wOut;o++,e++)this.populate(o,t);return this.dataOut}}var e=[];function o(o){e.push(Date.now());const i=(s=o.dataIn,r=o.wIn,n=o.hIn,a=o.wOut,l=o.hOut,new t(s,r,n,a,l).shrink());var s,r,n,a,l;return Date.now(),e.pop(),i}self.addEventListener("message",(t=>{try{var e=t.data;const i=o(e);ee({canvasId:e.canvasId,success:!0,wOut:e.wOut,hOut:e.hOut,dataOut:i},[i.buffer])}catch(t){ee({canvasId:e.canvasId,success:!1,wOut:0,hOut:0,dataOut:null})}}))}!function(t){let e;t.isMac=navigator.platform.toUpperCase().indexOf("MAC")>=0,t.zoomDelta=function(t,e=1.2,o=!0){let i=o?t.deltaY:t.deltaY*t.deltaFactor/100;return Math.pow(e,i)},function(t){t[t.CanvasEnter=0]="CanvasEnter",t[t.CanvasLeave=1]="CanvasLeave",t[t.Hover=2]="Hover",t[t.Tap=3]="Tap",t[t.ActionStart=4]="ActionStart",t[t.ActionMove=5]="ActionMove",t[t.ActionEnd=6]="ActionEnd",t[t.PanZoom=7]="PanZoom",t[t.DoubleClick=8]="DoubleClick",t[t.MomentumTranslate=9]="MomentumTranslate"}(e=t.InteractionType||(t.InteractionType={}));class o{constructor(t,e,o,i,s,r,n,a,l){this.type=t,this.interactionIdentifier=e,this.referenceInteraction=o,this.pageX=i,this.pageY=s,this.zoomTo=r,this.canvas=n,this.isTouch=a,this.isFirstPan=l,this.numTouches=0,o||(this.referenceInteraction=this),this.timestamp=Date.now()}dup(t){return new o(t,this.interactionIdentifier,this.referenceInteraction,this.pageX,this.pageY,this.zoomTo,this.canvas,this.isTouch,this.isFirstPan)}getReferenceBefore(t){let e=this.timestamp-t,o=this.referenceInteraction;for(;o.referenceInteraction.timestamp>e&&o!=o.referenceInteraction;)o=o.referenceInteraction;return o}getMostRecentTwoTouch(t){let e=this.timestamp-t,o=this.referenceInteraction;for(;o.numTouches<2&&o.referenceInteraction.timestamp>e&&o!=o.referenceInteraction;)o=o.referenceInteraction;return 2==o.numTouches?o:void 0}isMousePanEnd(){return this.type==e.ActionEnd&&this.referenceInteraction.type==e.ActionMove}shouldStopMouseMomentumPan(){return this.type==e.ActionStart||this.type==e.ActionMove||this.type==e.DoubleClick||this.type==e.Tap||this.type==e.PanZoom}isTouchPanEnd(){return!!!this.getMostRecentTwoTouch(500)&&this.type==e.CanvasLeave&&this.referenceInteraction.type==e.PanZoom}shouldStopTouchMomentumPan(){return this.type==e.ActionStart||this.type==e.ActionMove||this.type==e.DoubleClick||this.type==e.Tap||this.type==e.CanvasEnter}}t.Interaction=o;class i{constructor(t,e,o){this.identifier=t,this.pageX=e,this.pageY=o}static from(t){return new i(t.identifier,t.pageX,t.pageY)}find(t){for(let e=0;e<t.length;e++){const o=t.item(e);if(o.identifier==this.identifier)return o}return null}distanceSqrTo(t){const e=this.pageX-t.pageX,o=this.pageY-t.pageY;return e*e+o*o}distanceTo(t){return Math.max(1,Math.sqrt(this.distanceSqrTo(t)))}isNull(){return this==t.NullTouch}}t.YoTouch=i,t.TouchSpaceRadiusPx=10,t.TouchSpaceRadiusSqrPx=t.TouchSpaceRadiusPx*t.TouchSpaceRadiusPx,t.TouchTimeBoxMs=300,t.DoubleTapRadiusPx=20,t.DoubleTapTimeMs=300,t.NullTouch=new i(null,0,0);let s=!1;try{let t=Object.defineProperty({},"passive",{get:function(){s=!0}});window.addEventListener("test",null,t)}catch(t){}t.AddEventListenerThirdArgForTouch=!!s&&{passive:!1}}(ut||(ut={})),function(t){t.Mega=1048576;const e=10,o=20,i=100,s=20,r=6,n=s-2,a=r-2;t.initialized=!1;var l=null;t.lockAspectRatio=!1,t.maxNumMegapixels=4;var c=0,p=0;const u=Rt.empty();var h=1,d=null,g=null,m=0,f=0,w=0,C=0;const y=Ft.empty();var b=1,v=1,A=0,k=0;const M=Rt.empty(),x=Rt.empty(),T=Rt.empty(),_=Rt.empty();var D=!1;const E=Rt.empty(),F=Ft.empty(),I=Ft.empty();class B{constructor(t,e){this.key=t,this.anchor=e,this.oppositeAnchor=S.opposite(this.anchor)}}var O=null;const L=new B("resize-top",S.Top),z=new B("resize-top-right",S.TopRight),U=new B("resize-right",S.Right),G=new B("resize-bottom-right",S.BottomRight),N=new B("resize-bottom",S.Bottom),H=new B("resize-bottom-left",S.BottomLeft),V=new B("resize-left",S.Left),W=new B("resize-top-left",S.TopLeft),X=new B("resize-move",S.Center);let Y=!1;function q(e,o,i,s,r){i.$().text(e.toFixed(0)+" x "+o.toFixed(0)+" px"),s.$().text(R.formatAspectRatio(R.fuzzyAspectRatioEx({w:e,h:o},l.aspectRatios))),r.$().text((e*o/t.Mega).toFixed(1))}function J(){P.PreCrop.Sidebar.MaxNumMegapixels.display.$().text(t.maxNumMegapixels+" megapixels"),q(Math.round(I.width()),Math.round(I.height()),P.PreCrop.Sidebar.cropped_image_size_display,P.PreCrop.Sidebar.cropped_image_aspect_ratio_display,P.PreCrop.Sidebar.cropped_image_megapixels_display),P.PreCrop.Sidebar.lock_aspect_ratio_button.$().prop("checked",t.lockAspectRatio);const e=I.width()*I.height()/t.Mega>t.maxNumMegapixels;P.PreCrop.Sidebar.cropped_image_warning.$().toggle(e),P.PreCrop.Sidebar.cropped_image_success.$().toggle(!e),P.PreCrop.Sidebar.cropped_image_megapixels_display.$().attr("style",e?"color:red;":"")}function Q(){t.lockAspectRatio=!t.lockAspectRatio,ct(),J()}function j(){t.maxNumMegapixels=Math.min(t.maxNumMegapixels+1,l.maxMaxNumMegapixels),J()}function Z(){t.maxNumMegapixels=Math.max(1,t.maxNumMegapixels-1),J()}function K(){$(window).off("beforeunload"),location.reload()}function tt(){const t=I.width(),e=I.height();t>0&&e>0&&null!=l.completed&&(l.completed(I),P.PreCrop.App.$().hide(),Y||P.body.$().removeClass("modal-open"))}function et(t,e){if(null!=t&&null!=e){M.set(T),x.set(_);var o=$(g.element).offset();return T.setXy(t-o.left,e-o.top),i=T,_.setXy((i.x-y.left)*v,(i.y-y.top)*v),M.notEquals(T)||x.notEquals(_)}var i;return!1}function ot(){const t=o*v,e=Math.abs(_.x-I.left)<t,i=Math.abs(_.y-I.top)<t,s=Math.abs(_.x-I.right)<t,r=Math.abs(_.y-I.bottom)<t,n=I.center(),a=Math.abs(_.x-n.x)<t&&Math.abs(_.y-n.y)<t;var l=null;_.x>I.left-t&&_.x<I.right+t&&_.y>I.top-t&&_.y<I.bottom+t&&(e?l=i?W:r?H:V:s?l=i?z:r?G:U:i?l=L:r?l=N:a&&(l=X)),it(l)}function it(t){O=t,null==t?$(g.element).attr("class","canvas-view"):$(g.element).attr("class",O.key+"-tool canvas-view"),vt()}function st(t){const e=t.touches.item(0);lt(e.pageX,e.pageY),ht(e.pageX,e.pageY),t.preventDefault()}function rt(t){const e=t.touches.item(0);lt(e.pageX,e.pageY),t.preventDefault()}function nt(t){gt(-1e5,-1e5),t.preventDefault()}function at(t){lt(t.pageX,t.pageY)}function lt(t,e){const o=et(t,e);if(D){if(null!=O&&o){I.setFrom(F),I.moveAnchor(O.anchor,_.minus(E)),I.normalize(),I.left=Math.max(I.left,0),I.top=Math.max(I.top,0),I.right=Math.min(I.right,c),I.bottom=Math.min(I.bottom,p),I.round();Math.round(Math.max(0,i-I.width())),Math.round(Math.max(0,i-I.height()));I.moveAnchorToMinSize(O.anchor,i,i),I.round(),ct(),J(),vt()}}else ot()}function ct(){if(t.lockAspectRatio){var e=S.Center;if(null!=O&&(e=O.oppositeAnchor),I.forceAspectRatio(h,e),I.width()>c||I.height()>p)I.set(0,0,c,p);else{const t=Math.max(0,-I.left)+Math.min(0,c-I.right),e=Math.max(0,-I.top)+Math.min(0,p-I.bottom);I.translate(t,e)}I.round(),vt()}}function pt(t){ht(t.pageX,t.pageY),$(window).on("mouseup",dt),$(window).on("mousemove",at)}function ht(t,e){D=!0,E.set(_),F.setFrom(I),et(t,e)}function dt(t){gt(t.pageX,t.pageY),$(window).off("mouseup",dt),$(window).off("mousemove",at)}function gt(t,e){D=!1,$(window).off("mouseup",dt),$(window).off("mousemove",at),et(t,e),ot()}function mt(t){D||it(null)}function ft(t){D||(et(t.pageX,t.pageY),ot())}function St(){null!=d&&null!=g&&(m=d.outerWidth(),f=d.outerHeight(),g.width()==m&&g.height()==f||g.setSize(m,f),(C=f-2*e)/(w=m-2*e)>p/c?(y.left=e,k=p/c*(A=w),y.top=e+.5*(C-k)):(y.top=e,A=c/p*(k=C),y.left=e+.5*(w-A)),y.right=y.left+A,y.bottom=y.top+k,v=1/(b=A/c)),J(),vt()}function wt(t){return new Rt(y.left+t.x*b,y.top+t.y*b)}function Ct(t,e,o,i,l){const c=O==l,p=wt(e);t.setFillStyle("#ffffff"),t.fillRect(p.x+o,p.y+i,o*s,i*r),t.fillRect(p.x+o,p.y+i,o*r,i*s),t.setFillStyle(c?"#ff0000":"#000000"),t.fillRect(p.x+2*o,p.y+2*i,o*n,i*a),t.fillRect(p.x+2*o,p.y+2*i,o*a,i*n)}function yt(t,e,o,i){const l=O==i,c=wt(e);t.setFillStyle("#ffffff"),t.fillRect(c.x+o,c.y-s/2,o*r,s),t.setFillStyle(l?"#ff0000":"#000000"),t.fillRect(c.x+2*o,c.y-n/2,o*a,n)}function bt(t,e,o,i){const l=O==i,c=wt(e);t.setFillStyle("#ffffff"),t.fillRect(c.x-s/2,c.y+o,s,o*r),t.setFillStyle(l?"#ff0000":"#000000"),t.fillRect(c.x-n/2,c.y+2*o,n,o*a)}function vt(){if(null!=l.inputCanvas&&null!=g&&0!=m&&0!=f){const i=g.context();i.clearRect(0,0,m,f),i.drawCanvasEx2(l.inputCanvas,y.left,y.top,A,k),i.setStrokeStyle("#000000"),i.setGlobalAlpha(.4),i.setLineWidth(1);const s=Math.round((e=I.left,y.left+e*b))+.5,r=Math.round((t=I.top,y.top+t*b))+.5,n=Math.round(I.width()*b)-1,a=Math.round(I.height()*b)-1;i.strokeRect(s,r,n,a),i.setGlobalAlpha(1),Ct(i,I.topLeft(),1,1,W),Ct(i,I.topRight(),-1,1,z),Ct(i,I.bottomRight(),-1,-1,G),Ct(i,I.bottomLeft(),1,-1,H),yt(i,I.leftCenter(),1,V),yt(i,I.rightCenter(),-1,U),bt(i,I.topCenter(),1,L),bt(i,I.bottomCenter(),-1,N),function(t,e,i){var s=o/2,r=1.75*s,n=O==i?"#ff0000":"#000000";const a=wt(e);t.beginPath(),t.triangle(a.x,a.y-r,-Math.PI/2,2,5),t.triangle(a.x,a.y+r,Math.PI/2,2,5),t.triangle(a.x-r,a.y,Math.PI,2,5),t.triangle(a.x+r,a.y,0,2,5),t.strokeEx(2,"#FFF"),t.fillEx(n);var l=s+2;t.fillCircle(a.x,a.y,l,"#FFFFFF"),t.fillCircle(a.x,a.y,l-1,n)}(i,I.center(),X)}var t,e}t.show=function(e){c=(l=e).inputCanvas.width(),p=l.inputCanvas.height(),u.setXy(.5*c,.5*p),I.set(0,0,c,p),h=p/c,t.lockAspectRatio=!!l.lockAspectRatio,t.maxNumMegapixels=l.maxNumMegapixels,t.initialized||(t.initialized=!0,d=P.PreCrop.ViewContainer.$(),g=new Bt(d.outerWidth(),d.outerHeight()),d.append(g.element),$(g.element).mousedown(pt).mouseup(dt).mousemove(at).hover(ft,mt),g.element.addEventListener("touchstart",st,ut.AddEventListenerThirdArgForTouch),g.element.addEventListener("touchmove",rt,ut.AddEventListenerThirdArgForTouch),g.element.addEventListener("touchend",nt,ut.AddEventListenerThirdArgForTouch),P.PreCrop.Sidebar.crop_button.$().click(tt),P.PreCrop.Sidebar.cancel_button.$().click(K),P.PreCrop.Sidebar.lock_aspect_ratio_button.$().click(Q),l.maxMaxNumMegapixels?(P.PreCrop.Sidebar.MaxNumMegapixels.decrease.$().click(Z),P.PreCrop.Sidebar.MaxNumMegapixels.increase.$().click(j)):(P.PreCrop.Sidebar.MaxNumMegapixels.decrease.$().hide(),P.PreCrop.Sidebar.MaxNumMegapixels.increase.$().hide()),$(window).resize(St)),q(c,p,P.PreCrop.Sidebar.input_image_size_display,P.PreCrop.Sidebar.input_image_aspect_ratio_display,P.PreCrop.Sidebar.input_image_megapixels_display),J(),P.PreCrop.App.$().show(),Y=P.body.$().hasClass("modal-open"),Y||P.body.$().addClass("modal-open"),setTimeout(St,0)}}(ct||(ct={})),function(t){const e=new oe("Downsampler",null,ue);t.loadImageShrinkAndThumbnail=function(o,i,s,r,n){t.loadCheckRotateFlattenImage(i,s,(s=>{let a=lt.getMaxNumPixels();function l(o){F.process({inputCanvas:s,crop:o,maxNumPixels:a,thumbnailSize:{w:D.ThumbWidth,h:D.ThumbHeight},worker:n?e:void 0,completed:(e,o,s)=>{if(o||t.needsReencoding(i.type)){let o=t.recodeCanvasFile(i,e);r(o,e,s)}else r(i,e,s)}})}if(s.width()*s.height()>a&&lt.stickySettings.preCropEnabled&&!o){const t=D.MaxMaxNumMegapixels||D.FactoryDefaults.maxNumMegapixels;ct.show({inputFile:i,inputCanvas:s,lockAspectRatio:lt.stickySettings.preCropLockAspectRatio,maxNumMegapixels:lt.stickySettings.maxNumMegapixels||t,maxMaxNumMegapixels:t,aspectRatios:D.AspectRatios,completed:t=>{a=1024*ct.maxNumMegapixels*1024,l(t)}})}else l()}))}}(pt||(pt={}));class he extends Bt{constructor(t,e,o){super(t,e),this.levelToEndian32=o,this.endian32ToLevel=new Yt,this.maskEncoder=2==D.MaskVersion?new ce:new pe;for(var i=0;i<this.levelToEndian32.length;i++)this.endian32ToLevel.put(0|this.levelToEndian32[i],i);this.resetLast()}getLevelAt(t,e){let o=this.context().getImageData(t,e,1,1).data,i=0|new Uint32Array(o.buffer)[0];return 0|this.endian32ToLevel.get(i)}hasHairAt(t,e){return this.lastHairAtX==t&&this.lastHairAtY==e||(this.lastHairAtX=t,this.lastHairAtY=e,this.lastHairAt=3==this.getLevelAt(t,e)),this.lastHairAt}clearAll(){this.context().clearRect(0,0,this.width(),this.height()),this.encodeCache=null}clearSquare(t,e,o){this.clearSquarePrivate(t,e,o),this.setLast(t,e,o)}drawBrush(t,e,o,i){this.currentBrush=i,this.drawBrushPrivate(t,e,o),this.setLast(t,e,o)}drawSquare(t,e,o,i){this.context().setFillStyle(i),this.drawSquarePrivate(t,e,o),this.setLast(t,e,o)}drawLine(t,e,o,i){this.context().setFillStyle(i),this.drawOrClearLine(t,e,o,this.drawSquarePrivate),this.setLast(t,e,o)}drawBrushLine(t,e,o,i){this.currentBrush=i,this.drawOrClearLine(t,e,o,this.drawBrushPrivate),this.setLast(t,e,o)}clearLine(t,e,o){this.drawOrClearLine(t,e,o,this.clearSquarePrivate),this.setLast(t,e,o)}resetLast(){this.setLast(null,null,null)}putImageData(t){t&&t.width==this.width()&&t.height==this.height()&&(this.context().putImageData(t,0,0),this.encodeCache=null)}encodeEx(){return{data:this.encode(),version:D.MaskVersion}}encode(){if(null!=this.encodeCache)return this.encodeCache;var t=this.context().getImageData(0,0,this.width(),this.height()).data,e=new Int32Array(t.buffer),o=e[0],i=0|this.endian32ToLevel.get(o),s=1,r=t.length/4,n=1;this.maskEncoder.reset();for(var a=(t,r)=>{for(var n=t;n<r;n++){var a=e[n];if(o==a)s++;else{o=a;var l=0|this.endian32ToLevel.get(o);l==i?s++:(this.maskEncoder.push(i,s),s=1,i=l)}}};n<r-4+1;n+=4)o==e[n]&&o==e[n+1]&&o==e[n+2]&&o==e[n+3]?s+=4:a(n,n+4);return a(n,r),this.maskEncoder.push(i,s),this.encodeCache=this.maskEncoder.toString(),this.encodeCache}decodeFrom(t){t?this.decode(t.data,t.version):this.clearAll()}decode(t,e){t?2===e?this.decodeInner(t,ce.decode):this.decodeInner(t,pe.decode):this.clearAll()}decodeInner(t,e){var o=this.context().getImageData(0,0,this.width(),this.height()),i=o.data,s=new Uint32Array(i.buffer),r=0;let n=!1;e(t,((t,e)=>{for(var o=0|this.levelToEndian32[t],i=0;i<e&&r<s.length;i++,r++)s[r]=o,n=!0})),this.context().putImageData(o,0,0),this.encodeCache=null}patch(t,e,o){2===o?this.patchInner(t,e,ce.decode):this.patchInner(t,e,pe.decode)}patchInner(t,e,o){var i=this.context().getImageData(0,0,this.width(),this.height()),s=i.data,r=new Uint32Array(s.buffer),n=0;let a=!1;o(t,((t,o)=>{const i=0|e[t];for(let t=0;t<o&&n<r.length;t++,n++)0==r[n]&&(r[n]=i,a=!0)})),this.context().putImageData(i,0,0),this.encodeCache=null}setLast(t,e,o){this.lastX=t,this.lastY=e,this.lastD=o,this.encodeCache=null}clearSquarePrivate(t,e,o){var i=Math.floor(o/2);this.context().clearRect(t-i,e-i,o,o)}drawSquarePrivate(t,e,o){var i=Math.floor(o/2);this.context().fillRect(t-i,e-i,o,o)}drawBrushPrivate(t,e,o){const i=Math.floor(o/2),s=t-i,r=e-i;this.currentBrush.isOpaque||(this.context().context.globalCompositeOperation="destination-out",this.context().drawCanvasEx(this.currentBrush.mask,s,r),this.context().context.globalCompositeOperation="source-over"),this.context().drawCanvasEx(this.currentBrush.canvas,s,r)}drawOrClearLine(t,e,o,i){var s=null==this.lastX?t:this.lastX,r=null==this.lastY?e:this.lastY,n=t-s,a=e-r,l=Math.abs(n),c=Math.abs(a),p=Math.max(l,c);if(0==p)i.call(this,t,e,o);else for(var u=0;u<=p;u++){var h=Math.round(s+u*n/p),d=Math.round(r+u*a/p);i.call(this,h,d,o)}}}!function(t){t.lastUserInteractionWasTouch=i(),t.hasSeenTouchEvents=!1,t.hasSeenMouseEvents=!1,t.hasSeenWheelEvents=!1;class e{constructor(e,i){this.handler=e,this.canvases=i,this.interactionIdentifier=0,this.mouseIsDown=!1,this.isMiddleButtonGrab=!1,this.touchQueue=[],this.currentNumTouches=0,this.lastTouchStartAt=0,this.lastTapAt=0,this.lastTapOn=t.NullTouch,this.countWheelDeltaMod120IsZero=void 0,this.countDeltaYisNotInteger=void 0,this.isDiscreteDevice=!0,this.mightBeDiscreteDevice=!0,this.panAnimatorHandler=(e,o)=>{if(Number.isFinite(e)&&Number.isFinite(o))if(0==e&&0==o)ht.main.refreshAllViews();else{let i=new t.Interaction(t.InteractionType.MomentumTranslate,this.interactionIdentifier++,void 0,e,o,void 0,void 0,!1,!1);this.handler.pointerInteraction(i)}},this.mouseIn=e=>{this.fireMouse(t.InteractionType.CanvasEnter,e.currentTarget,e)},this.mouseOut=e=>{this.fireMouse(t.InteractionType.CanvasLeave,e.currentTarget,e)},this.mouseDown=e=>{this.mouseIsDown||0!=e.button&&1!=e.button||(this.mouseIsDown=!0,this.mouseButton=e.button,1==this.mouseButton&&O.isNot(O.Grab)&&(this.isMiddleButtonGrab=!0,O.setTempSelect(O.Grab)),O.mouseDown(),this.activeCanvas=e.currentTarget,P.$window.on("mouseup",this.mouseUp),P.$window.on("mousemove",this.mouseMoveWindow),this.fireMouse(t.InteractionType.Hover,this.activeCanvas,e),this.fireMouse(t.InteractionType.ActionStart,this.activeCanvas,e))},this.mouseMoveCanvas=t=>{null==this.activeCanvas&&this.mouseMoveWindow(t)},this.mouseMoveWindow=e=>{t.hasSeenMouseEvents=!0,this.mouseIsDown?this.fireMouse(t.InteractionType.ActionMove,this.activeCanvas,e):this.fireMouse(t.InteractionType.Hover,e.currentTarget,e)},this.mouseUp=e=>{this.mouseIsDown&&this.mouseButton==e.button&&(this.fireMouse(t.InteractionType.ActionMove,this.activeCanvas,e),this.mouseIsDown=!1,this.fireMouse(t.InteractionType.ActionEnd,this.activeCanvas,e),this.activeCanvas=null,P.$window.off("mouseup",this.mouseUp),P.$window.off("mousemove",this.mouseMoveWindow),this.isMiddleButtonGrab&&(this.isMiddleButtonGrab=!1,O.releaseTempSelect()),O.mouseUp())},this.mouseDblClick=e=>{this.fireMouse(t.InteractionType.DoubleClick,e.currentTarget,e)},this.mouseWheel=e=>{t.hasSeenWheelEvents=!0;let o=a.cast(e.originalEvent);if(this.updateIsDiscrete(o),!this.mouseIsDown){let o=1.2;e.shiftKey&&(o=Math.pow(o,1/4));let i=t.zoomDelta(e,o,this.isDiscreteDevice)*this.handler.getZoomScale();this.fireMouse(t.InteractionType.PanZoom,e.currentTarget,e,i),this.fireMouse(t.InteractionType.Hover,e.currentTarget,e)}},this.touchStart=e=>{switch(t.hasSeenTouchEvents=!0,e.preventDefault(),this.updateCurrentNumTouches(e),this.touchState){case 0:e.targetTouches.length>0&&(this.interactionIdentifier++,this.lastTouchStartAt=Date.now(),this.touchAt=Date.now(),this.touch0=t.YoTouch.from(e.targetTouches.item(0)),this.activeCanvas=e.currentTarget,this.fireTouch(t.InteractionType.CanvasEnter,this.touch0),this.isFirstPan=!0,e.targetTouches.length>1?this.touchCommitPinchZoom(e.targetTouches.item(1)):(this.fireTouch(t.InteractionType.Hover,this.touch0),O.is(O.Grab)?this.touchCommitPinchZoom(null):(this.touchState=1,this.touchTimer=setTimeout(this.touchTimeout,t.TouchTimeBoxMs))));break;case 1:this.touchCommitPinchZoom(e.changedTouches.item(0));break;case 2:break;case 3:this.touch1.isNull()&&(this.isFirstPan=!0,this.touchCommitPinchZoom(e.changedTouches.item(0)))}},this.touchMove=e=>{t.hasSeenTouchEvents=!0,e.preventDefault(),this.updateCurrentNumTouches(e);const o=this.touch0.find(e.touches);if(null!=o)switch(this.touchState){case 0:break;case 1:const i=this.touch0.distanceSqrTo(o);t.TouchSpaceRadiusSqrPx<=i?(this.touchCommitSwipe(),this.touchMove(e)):this.queueTouch(o);break;case 2:this.fireTouch(t.InteractionType.ActionMove,o);break;case 3:const s=this.touch1.find(e.touches);if(this.touch0=t.YoTouch.from(o),s){this.touch1=t.YoTouch.from(s);const e=this.touch0.distanceTo(this.touch1)/this.pinchInitialDistance,o=this.pinchInitialZoom*e;this.fireTouchEx(t.InteractionType.PanZoom,(this.touch0.pageX+this.touch1.pageX)/2,(this.touch0.pageY+this.touch1.pageY)/2,o)}else this.fireTouchEx(t.InteractionType.PanZoom,this.touch0.pageX,this.touch0.pageY,void 0)}},this.touchEnd=e=>{t.hasSeenTouchEvents=!0,e.preventDefault(),this.updateCurrentNumTouches(e);let o=e.changedTouches.item(0);switch(this.touchState){case 0:break;case 1:O.getActiveMode().needsHover?(this.touchCommitSwipe(),this.touchEnd(e)):(this.fireTouch(t.InteractionType.Tap,o),this.checkDoubleTap(o),this.touchClear(o));break;case 2:this.fireTouch(t.InteractionType.ActionEnd,o),this.touchClear(o);break;case 3:null!=this.touch1.find(e.changedTouches)&&(this.isFirstPan=!0,this.touch1=t.NullTouch),null!=this.touch0.find(e.changedTouches)&&(this.isFirstPan=!0,this.touch0=this.touch1,this.touch1=t.NullTouch),this.touch0.isNull()&&(this.checkDoubleTap(o),this.touchClear(o),O.releaseTempSelect())}},this.touchTimeout=()=>{this.touchTimer=void 0,1==this.touchState&&this.touchCommitSwipe()};for(let e of i)e.$element.mousedown(this.mouseDown).mouseup(this.mouseUp).mousemove(this.mouseMoveCanvas).hover(this.mouseIn,this.mouseOut).dblclick(this.mouseDblClick).mousewheel(this.mouseWheel),e.element.addEventListener("touchstart",this.touchStart,t.AddEventListenerThirdArgForTouch),e.element.addEventListener("touchmove",this.touchMove,t.AddEventListenerThirdArgForTouch),e.element.addEventListener("touchend",this.touchEnd,t.AddEventListenerThirdArgForTouch);this.touchClear(null),this.panAnimator=new o(this.panAnimatorHandler)}checkMousePanAnimator(){O.is(O.Grab)&&this.lastMouseAction.isMousePanEnd()?(ht.main.setIsZoomingOrPanning(!0),this.panAnimator.start(this.lastMouseAction)):this.lastMouseAction.shouldStopMouseMomentumPan()&&this.panAnimator.stop()}fireMouse(e,o,i,s=void 0){t.lastUserInteractionWasTouch=!1,e==t.InteractionType.Hover&&(this.lastMouseAction=void 0);this.lastMouseAction=new t.Interaction(e,this.interactionIdentifier++,this.lastMouseAction,i.pageX,i.pageY,s,o,!1,!0);this.checkMousePanAnimator(),this.handler.pointerInteraction(this.lastMouseAction)}updateIsDiscrete(o){let i=o.wheelDelta||o.wheelDeltaY||o.wheelDeltaX,s=o.deltaY||o.deltaX||o.deltaZ,r=o.deltaMode;if(void 0!==s){let t=!Number.isInteger(s);void 0===this.countDeltaYisNotInteger?this.countDeltaYisNotInteger=t?e.ThreshDeltaIsNotInteger:0:t?this.countDeltaYisNotInteger++:this.countDeltaYisNotInteger=0}if(void 0===i){let t=0===r;this.mightBeDiscreteDevice=this.isDiscreteDevice=!t}else{let o=Math.abs(i)%120==0;void 0===this.countWheelDeltaMod120IsZero?this.countWheelDeltaMod120IsZero=o?e.ThreshWheelDeltaMod120IsZero:0:o?this.countWheelDeltaMod120IsZero++:this.countWheelDeltaMod120IsZero=0,this.countWheelDeltaMod120IsZero>=e.ThreshWheelDeltaMod120IsZero?this.mightBeDiscreteDevice=this.isDiscreteDevice=!0:t.isMac?this.mightBeDiscreteDevice=this.isDiscreteDevice=this.countDeltaYisNotInteger>=e.ThreshDeltaIsNotInteger:(this.isDiscreteDevice=!1,this.mightBeDiscreteDevice=o)}}updateCurrentNumTouches(t){this.currentNumTouches=t.touches.length}fireTouch(t,e){this.fireTouchEx(t,e.pageX,e.pageY,void 0)}fireTouchEx(e,o,i,s){t.lastUserInteractionWasTouch=!0;let r=this.lastTouchAction=new t.Interaction(e,this.interactionIdentifier,this.lastTouchAction,o,i,s,this.activeCanvas,!0,this.isFirstPan);r.numTouches=this.currentNumTouches,e==t.InteractionType.PanZoom&&(this.isFirstPan=!1),this.checkTouchPanAnimator(),this.handler.pointerInteraction(r)}checkTouchPanAnimator(){this.lastTouchAction.numTouches>1?this.panAnimator.stop():O.is(O.Grab)&&this.lastTouchAction.isTouchPanEnd()&&1==this.lastTouchAction.referenceInteraction.numTouches?(ht.main.setIsZoomingOrPanning(!0),this.panAnimator.start(this.lastTouchAction)):this.lastTouchAction.shouldStopTouchMomentumPan()&&this.panAnimator.stop()}queueTouch(e){this.touchQueue.push(t.YoTouch.from(e))}checkDoubleTap(e){Date.now()<this.lastTapAt+t.DoubleTapTimeMs&&this.lastTapOn.distanceTo(e)<t.DoubleTapRadiusPx?(this.fireTouch(t.InteractionType.DoubleClick,e),this.clearDoubleTap()):(this.lastTapAt=this.lastTouchStartAt,this.lastTapOn=t.YoTouch.from(e))}clearDoubleTap(){this.lastTapAt=0}touchCommitPinchZoom(e){clearTimeout(this.touchTimer),O.setTempSelect(O.Grab),this.touchQueue.length>0&&(this.touch0=this.touchQueue[this.touchQueue.length-1],this.touchQueue.length=0),this.touchState=3,e&&(this.touch1=t.YoTouch.from(e),this.pinchInitialDistance=this.touch0.distanceTo(this.touch1),this.pinchInitialZoom=this.handler.getZoomScale(),this.clearDoubleTap())}touchCommitSwipe(){clearTimeout(this.touchTimer),this.touchState=2,this.fireTouch(t.InteractionType.ActionStart,this.touch0);for(let e of this.touchQueue)this.fireTouch(t.InteractionType.ActionMove,e);this.touchQueue.length=0}touchClear(e){e&&this.fireTouch(t.InteractionType.CanvasLeave,e),clearTimeout(this.touchTimer),this.touchState=0,this.touchAt=0,this.touchTimer=0,this.touch0=t.NullTouch,this.touch1=t.NullTouch,this.pinchInitialDistance=1,this.pinchInitialZoom=1,this.touchQueue.length=0,this.isFirstPan=!1,this.currentNumTouches=0}}e.ThreshWheelDeltaMod120IsZero=3,e.ThreshDeltaIsNotInteger=3,t.Manager=e;class o{constructor(t){this.callback=t,this.panPxPerMs=Rt.zero(),this.frame=()=>{if(!this.hasSpeed())return;this.timerId=void 0;let t=Date.now(),e=t-this.lastPanFrameAt;if(this.lastPanFrameAt=t,this.callback(this.panPxPerMs.x*e,this.panPxPerMs.y*e),t-this.lastPanInteraction.timestamp>150){let t=.003*e/this.panPxPerMs.length();t>=1?(this.panPxPerMs.setXy(0,0),this.sendDone()):(this.panPxPerMs.plusEqualsScaled(-t,this.panPxPerMs),this.trigger())}else this.trigger()}}start(t){this.lastPanInteraction=t;let e=t.getReferenceBefore(100),o=Math.max(10,t.timestamp-e.timestamp),i=Math.sqrt(window.devicePixelRatio||1);this.panPxPerMs.setXy((t.pageX-e.pageX)/o,(t.pageY-e.pageY)/o).capLength(1.75*Math.sqrt(i)),this.hasSpeed()&&(this.lastPanFrameAt=Date.now(),this.trigger())}stop(){this.timerId&&(clearTimeout(this.timerId),this.timerId=void 0,this.lastPanFrameAt=void 0,this.panPxPerMs.setXy(0,0),this.lastPanInteraction=void 0,this.sendDone())}isAnimating(){return this.hasSpeed()}sendDone(){this.callback(0,0)}trigger(){this.timerId||(this.timerId=setTimeout(this.frame,10))}hasSpeed(){return 0!=this.panPxPerMs.lengthSqr()}}function i(){return"ontouchstart"in document.documentElement}t.deviceHasTouch=i}(ut||(ut={}));class de{constructor(){this.startOffsetX=null,this.startOffsetY=null,this.startZoom=null,this.targetOffsetX=null,this.targetOffsetY=null,this.targetZoom=null,this.startTime=null,this.id=null,this.ignoreClear=!1}}class ge extends Bt{constructor(t,e,o){super(t,e,o),this.isVisible=!0,this.borderRight=!1,this.borderLeft=!1}}class me{constructor(t){this.name=t,this.highDpiRatio=1,this.uiIsInitialized=!1,this.opts=null,this.canvasContainers=[],this.canvases=[],this.imageWidth=null,this.imageHeight=null,this.imageCenterX_i=0,this.imageCenterY_i=0,this.imageCenter_i=new Rt(0,0),this.imageCenterX_o=null,this.imageCenterY_o=null,this.zoomScale=null,this.animation=new de,this.mouseX_i=me.OffScreen,this.mouseY_i=me.OffScreen,this.mouseX_ii=me.OffScreen,this.mouseY_ii=me.OffScreen,this.mouseX_c=0,this.mouseY_c=0,this.mouseX_o=0,this.mouseY_o=0,this.imageLeft_c=0,this.imageTop_c=0,this.imageWidth_c=0,this.imageHeight_c=0,this.imageCenterX_c=0,this.imageCenterY_c=0,this.crop_c=new Xt,this.mouseIsDown=!1,this.mouseButton=null,this.shiftIsDown=!1,this.overPanCanvas=!1,this.isZoomingOrPanning=!1,this.isZoomingOrPanningTimeoutId=-1,this.isTinyHairBrush=!1,this.clickX_c=null,this.clickY_c=null,this.clickX_o=null,this.clickY_o=null,this.clickImageCenterX_o=null,this.clickImageCenterY_o=null,this.pinchIsActive=!1,this.pinchInitialDistance=1,this.pinchInitialZoom=1,this.currentApp=null,this.activeCanvas=null,this.hoveredCanvas=null,this.pointerManager=null,this.repeaterDelay=me.animationDuration/2,this.showing=!1,this.contextMenuHandler=t=>this.canvases[0].config&&this.canvases[0].config.contextMenuHandler?this.canvases[0].config.contextMenuHandler(t):(t.preventDefault(),!1),this.keyDownHandler=t=>{switch(t.keyCode){case 16:return this.shiftIsDown||(this.shiftIsDown=!0,this.updatePanTempSelect()),!0;case 37:return this.moveLeft(t.shiftKey),!0;case 38:return this.moveUp(t.shiftKey),!0;case 39:return this.moveRight(t.shiftKey),!0;case 40:return this.moveDown(t.shiftKey),!0;case 33:return this.animateZoomInAboutCenter(),!0;case 34:return this.animateZoomOutAboutCenter(),!0;case 36:return this.animateZoomToFit(),!0;case 89:return T.M.tryRedo(),!0;case 90:return t.shiftKey?T.M.tryRedo():T.M.tryUndo(),!0;case 79:return!0;case 80:if(D.ScreenshotMode){var e=this.opts.canvasDiv;const t=e.css("width"),i=["1350px","1350px","auto"],s=["675px","450px","auto"];var o=(i.indexOf(t)+1)%i.length;return e.css({width:i[o],height:s[o]}),this.updateSize(),!0}return!1}return!1},this.keyUpHandler=t=>16===t.keyCode&&(this.shiftIsDown&&(this.shiftIsDown=!1,this.updatePanTempSelect()),!0),this.lastRefreshAt=-1,this.refreshIntervalId=-1,this.refreshAllViewsImpl=()=>{if(this.canvases)for(let t=0;t<this.canvases.length;t++)this.canvases[t].isVisible&&this.refreshView(this.canvases[t]);const t=Date.now();this.lastRefreshAt=t,this.refreshIntervalId=-1},this.refreshAllViews=()=>{this.refreshAllViewsImpl()},this.animateZoomInAboutCenter=()=>{this.animate(0,0,me.zoomStep)},this.animateZoomOutAboutCenter=()=>{this.animate(0,0,me.inverseZoomStep)},this._isHorizontal=!0,this.updateSize=()=>{if(this.opts){this.highDpiRatio=window.devicePixelRatio||1;const e=this.isHorizontalSideBySide(!0);this.canvases.length>1&&P.body.$().toggleClass(P.viewport_vertical.name(),!e);var t=!1;let o=this.hoveredCanvas;for(let e=0;e<this.canvases.length;e++){let i=this.canvasContainers[e],s=this.canvases[e];if(s.isVisible){let e=i.clientWidth,o=i.clientHeight;t=!0,s.setSize(e,o,this.highDpiRatio),s.left=i.offsetLeft,s.top=i.offsetTop}o!=s.element&&this.updateCoords(null,null,s.element)}return null!=o&&this.updateCoords(null,null,o),this.refreshAllViews(),t}return!1},window.Globals.isDev||setInterval((()=>{this.updateSize()}),2e3)}isInitialized(){return this.uiIsInitialized}initialize(t){if(this.opts=t,this.imageWidth=this.opts.image.width(),this.imageHeight=this.opts.image.height(),this.imageCenterX_i=this.imageWidth/2,this.imageCenterY_i=this.imageHeight/2,this.imageCenter_i.setXy(this.imageCenterX_i,this.imageCenterY_i),this.imageCenterX_o=this.imageWidth/2,this.imageCenterY_o=this.imageHeight/2,this.currentApp=this.opts.app,this.zoomScale=1,!this.uiIsInitialized){this.uiIsInitialized=!0;for(let t=0;t<this.opts.viewConfigs.length;t++){let e=document.createElement("div");e.style.width="100%",e.style.height="100%",e.style.flexGrow="1",e.style.position="relative";let o=new ge(1,1,this.highDpiRatio);o.config=this.opts.viewConfigs[t],o.element.style.left="0",o.element.style.top="0",o.left=0,o.top=0,o.highDpiRatio=this.highDpiRatio,this.canvasContainers[t]=e,this.canvases[t]=o,e.appendChild(o.element),this.opts.canvasDiv.append(e)}this.updateBorders(),this.pointerManager=new ut.Manager(this,this.canvases),this.hoveredCanvas=this.canvases[0].element;for(let t of this.canvases)t.element.toDataURL=t=>document.createElement("canvas").toDataURL(t),t.element.toBlob=(t,e,...o)=>{document.createElement("canvas").toBlob(t,e,...o)};for(var e=0;e<this.opts.viewConfigs.length;e++)$(this.canvases[e].element).on("contextmenu",this.contextMenuHandler);$(window).resize((()=>{this.updateSize()}))}}setViewConfigs(t){this.canvases[0].config=t[0];let e=!!t[1];e&&(this.canvases[1].config=t[1]),this.setVisible(1,e),this.updateSize(),this.refreshAllViews()}setViewConfigAndShow(t,e){this.currentApp=e,this.canvases[0].config=t,this.updateSize(),this.zoomToFit(!0),this.showing=!0,this.refreshAllViews()}viewportCanvasFromCanvasElement(t){return R.find(this.canvases,(e=>e.element==t))}pointerInteraction(t){let e=e=>{let o=this.viewportCanvasFromCanvasElement(t.canvas);null!=o&&o.config.panModeOnly&&this.overPanCanvas!==e&&(this.overPanCanvas=e,this.updatePanTempSelect())};switch(t.type){case ut.InteractionType.CanvasEnter:this.currentApp.pointerInteraction(t),e(!0);break;case ut.InteractionType.CanvasLeave:this.currentApp.pointerInteraction(t),e(!1),this.mouseX_c=this.mouseX_c=this.mouseX_i=this.mouseY_i=this.mouseX_ii=this.mouseY_ii=me.OffScreen,this.refreshAllViews();break;case ut.InteractionType.Hover:this.updateCoords(t.pageX,t.pageY,t.canvas),this.currentApp.pointerInteraction(t),this.refreshAllViews();break;case ut.InteractionType.Tap:this.currentApp.pointerInteraction(t);break;case ut.InteractionType.ActionStart:T.App.toggleAllCanvasViewsClass("drag",!0),this.clearAnimation(),this.clickX_c=t.pageX,this.clickY_c=t.pageY,this.clickImageCenterX_o=this.imageCenterX_o,this.clickImageCenterY_o=this.imageCenterY_o,this.updateCoords(t.pageX,t.pageY,this.activeCanvas),this.currentApp.pointerInteraction(t),this.refreshAllViews();break;case ut.InteractionType.ActionMove:if(this.clearAnimation(),this.updateCoords(t.pageX,t.pageY,t.canvas),this.currentApp.pointerInteraction(t),O.is(O.Grab)){this.setIsZoomingOrPanning(!0);let e=this.clickImageCenterX_o-(t.pageX-this.clickX_c)/this.zoomScale,o=this.clickImageCenterY_o-(t.pageY-this.clickY_c)/this.zoomScale;this.setView(e,o,null,!0),T.M.Review.reset()}this.refreshAllViews();break;case ut.InteractionType.MomentumTranslate:this.setIsZoomingOrPanning(!0),this.clearAnimation();let o=this.imageCenterX_o-t.pageX/this.zoomScale,i=this.imageCenterY_o-t.pageY/this.zoomScale;this.setView(o,i,null,!0),this.refreshAllViews();break;case ut.InteractionType.ActionEnd:T.App.toggleAllCanvasViewsClass("drag",!1),this.clearAnimation(),this.currentApp.pointerInteraction(t);break;case ut.InteractionType.PanZoom:this.setIsZoomingOrPanning(!0),this.clearAnimation(),this.updateCoords(t.pageX,t.pageY,t.canvas),t.isFirstPan&&(this.clickX_o=this.mouseX_o,this.clickY_o=this.mouseY_o);let s=R.clamp(t.zoomTo||this.zoomScale,me.minZoomScale,me.maxZoomScale),r=this.mouseX_c-this.canvas0LogicalWidth()/2,n=this.mouseY_c-this.canvas0LogicalHeight()/2,a=this.imageCenterX_o+r/this.zoomScale-r/s-(this.mouseX_o-this.clickX_o),l=this.imageCenterY_o+n/this.zoomScale-n/s-(this.mouseY_o-this.clickY_o);this.setView(a,l,s,!0),this.updateCoords(t.pageX,t.pageY,t.canvas),this.currentApp.pointerInteraction(t),T.M.Review.reset(),this.refreshAllViews();break;case ut.InteractionType.DoubleClick:O.is(O.Grab)?this.animateZoomToFit():this.currentApp.pointerInteraction(t)}}setIsZoomingOrPanning(t){this.isZoomingOrPanning=t,-1!=this.isZoomingOrPanningTimeoutId&&clearTimeout(this.isZoomingOrPanningTimeoutId),t?this.isZoomingOrPanningTimeoutId=setTimeout((()=>this.setIsZoomingOrPanning(!1)),100):this.refreshAllViews()}updatePanTempSelect(){this.shiftIsDown||this.overPanCanvas?O.setTempSelect(O.Grab):O.releaseTempSelect()}updateIsTinyHairBrush(){const t=O.getVisibleMode(),e=t.isFgOrBg()&&t.mask.hasHairAt(this.mouseX_ii,this.mouseY_ii);this.isTinyHairBrush;this.pointerManager.mouseIsDown||(this.isTinyHairBrush=e)}o2cX(t){return this.imageLeft_c+t*this.zoomScale}o2cY(t){return this.imageTop_c+t*this.zoomScale}o2c(t){return new Rt(this.o2cX(t.x),this.o2cY(t.y))}c2oX(t){return(t-this.imageLeft_c)/this.zoomScale}c2oY(t){return(t-this.imageTop_c)/this.zoomScale}c2o(t){return new Rt(this.c2oX(t.x),this.c2oY(t.y))}getViewPortCanvasExFor(t){for(let e of this.canvases)if(e.element==t)return e;return null}updateCoords(t,e,o){if(null==o)return;let i=this.getViewPortCanvasExFor(o);if(null!=i){var s=T.M.totalRotationAngleRad_o2i();if(null!=t&&null!=e){var r=$(o).offset();this.mouseX_c=t-r.left,this.mouseY_c=e-r.top}this.mouseX_o=(this.mouseX_c-i.logicalWidth()/2)/this.zoomScale+this.imageCenterX_o,this.mouseY_o=(this.mouseY_c-i.logicalHeight()/2)/this.zoomScale+this.imageCenterY_o;var n=this.mouseX_o-this.imageCenterX_i,a=this.mouseY_o-this.imageCenterY_i;this.mouseX_i=n*Math.cos(s)-a*Math.sin(s)+this.imageCenterX_i,this.mouseY_i=n*Math.sin(s)+a*Math.cos(s)+this.imageCenterY_i,this.mouseX_ii=Math.floor(this.mouseX_i),this.mouseY_ii=Math.floor(this.mouseY_i),this.updateCanvasCoords(i),this.hoveredCanvas=o,this.updateIsTinyHairBrush()}}tx_i2o(t,e){var o=T.M.totalRotationAngleRad_i2o();t.rotateInto(Math.cos(o),Math.sin(o),this.imageCenterX_i,this.imageCenterY_i,e)}getViewCenter_i(){if(null!=this.imageCenterX_o){var t=this.imageCenterX_o-this.imageCenterX_i,e=this.imageCenterY_o-this.imageCenterY_i,o=T.M.totalRotationAngleRad_o2i(),i=t*Math.cos(o)-e*Math.sin(o)+this.imageCenterX_i,s=t*Math.sin(o)+e*Math.cos(o)+this.imageCenterY_i;return new Rt(i,s)}return null}updateCanvasCoords(t){this.imageLeft_c=t.logicalWidth()/2-this.imageCenterX_o*this.zoomScale,this.imageTop_c=t.logicalHeight()/2-this.imageCenterY_o*this.zoomScale,this.imageWidth_c=this.imageWidth*this.zoomScale,this.imageHeight_c=this.imageHeight*this.zoomScale,this.imageCenterX_c=this.imageLeft_c+this.imageWidth_c/2,this.imageCenterY_c=this.imageTop_c+this.imageHeight_c/2;var e=T.M.getCrop_o();this.crop_c.left0=Math.floor(this.o2cX(e.left0)),this.crop_c.right0=Math.ceil(this.o2cX(e.right0)),this.crop_c.top0=Math.floor(this.o2cY(e.top0)),this.crop_c.bottom0=Math.ceil(this.o2cY(e.bottom0))}getCrop_c(){return this.crop_c}getMouse_c(){return new Rt(this.mouseX_c,this.mouseY_c)}getClick_c(){return new Rt(this.clickX_c,this.clickY_c)}getMouse_i(){return new Rt(this.mouseX_i,this.mouseY_i)}getMouse_ii(){return new Rt(this.mouseX_ii,this.mouseY_ii)}getImageCenter_c(){return new Rt(this.imageCenterX_c,this.imageCenterY_c)}getImageCenter_i(){return new Rt(this.imageCenterX_i,this.imageCenterY_i)}getMouseIsDown(){return this.mouseIsDown}getZoomScale(){return this.zoomScale}getShiftIsDown(){return this.shiftIsDown}isStroking(){return this.pointerManager.mouseIsDown&&O.getActiveMode().needsHover}diameter(){const t=O.getVisibleMode();return this.isTinyHairBrush?1:R.clamp(Math.floor(t.diameterScale*T.M.settings.brushSize/this.zoomScale),t.minDiameter,D.MaxBrushDiameter)}rotationCropUpdated(t,e){var o=new Rt(this.imageCenterX_o,this.imageCenterY_o);o.rotateInPlace(e-t,this.imageCenter_i),this.setView(o.x,o.y,this.zoomScale,!0)}setView(t,e,o,i=!1,s=!1){null==o&&(o=this.zoomScale);var r=T.M.getViewCrop_o(),n=R.clamp(t,r.left0,r.right0),a=R.clamp(e,r.top0,r.bottom0),l=R.clamp(o,me.minZoomScale,me.maxZoomScale);n==this.imageCenterX_o&&a==this.imageCenterY_o&&l==this.zoomScale||(this.imageCenterX_o=n,this.imageCenterY_o=a,this.zoomScale=l,s||this.updateCoords(null,null,this.hoveredCanvas),i||this.refreshAllViews(),D.ScreenshotMode&&$("#viewport-setting").val(this.toString()))}toString(){return this.imageCenterX_o+","+this.imageCenterY_o+","+this.zoomScale}fromString(t){try{var e=t.split(",");this.setView(parseFloat(e[0]),parseFloat(e[1]),parseFloat(e[2]))}catch(t){}}moveLeft(t){this.animate(-(t?1:me.moveStep)/this.zoomScale,0,1)}moveRight(t){this.animate((t?1:me.moveStep)/this.zoomScale,0,1)}moveUp(t){this.animate(0,-(t?1:me.moveStep)/this.zoomScale,1)}moveDown(t){this.animate(0,(t?1:me.moveStep)/this.zoomScale,1)}canvas0LogicalWidth(){return this.canvases[0].logicalWidth()}canvas0LogicalHeight(){return this.canvases[0].logicalHeight()}animateZoomToFit(){this.clearAnimation(),this.animation.ignoreClear=!0;var t=T.M.getCrop_o(),e=Math.min(this.canvas0LogicalWidth()/t.width(),(this.canvas0LogicalHeight()-72)/t.height())*me.zoomToFitBackOff/this.zoomScale;this.animate(t.centerX()-this.imageCenterX_o,t.centerY()-this.imageCenterY_o,e)}zoomAboutBy(t,e,o){this.zoomAboutTo_c(t,e,this.zoomScale*o)}zoomToFit(t=!0){if(this.uiIsInitialized){var e=T.M.getCrop_o(),o=Math.min(this.canvas0LogicalWidth()/e.width(),this.canvas0LogicalHeight()/e.height())*me.zoomToFitBackOff;this.setView(e.centerX(),e.centerY(),o),t&&this.refreshAllViews()}}zoomToFitTight(t=!0){var e=T.M.getCrop_o(),o=Math.max(this.canvas0LogicalWidth()/e.width(),this.canvas0LogicalHeight()/e.height());this.setView(e.centerX(),e.centerY(),o),t&&this.refreshAllViews()}isHorizontalSideBySide(t){function e(t){return Math.min(8e3,Math.max(100,0|t))}if(t){let t=e(this.opts.canvasDiv.outerHeight()-88),o=e(this.opts.canvasDiv.outerWidth()),i=o/2/t,s=o/(t/2),r=e(this.imageHeight),n=e(this.imageWidth)/r,a=Math.abs(n-i),l=Math.abs(n-s);this._isHorizontal=a<=l}return this._isHorizontal}numVisibleCanvases(){for(var t=0,e=0;e<this.canvases.length;e++)this.canvases[e].isVisible&&t++;return t}setVisible(t,e){if(t>=0&&t<this.canvases.length){this.canvasContainers[t].style.display=e?"block":"none";this.canvases[t].isVisible=e,this.updateBorders()}}updateBorders(){let t=this.canvases.filter((function(t){return t.isVisible}));for(let e=0;e<t.length;e++)t[e].borderLeft=e>0,t[e].borderRight=e<t.length-1}zoomAboutTo_c(t,e,o){if(o!==this.zoomScale){o=R.clamp(o,me.minZoomScale,me.maxZoomScale);let i=t-this.canvas0LogicalWidth()/2,s=e-this.canvas0LogicalHeight()/2,r=this.imageCenterX_o+i/this.zoomScale-i/o,n=this.imageCenterY_o+s/this.zoomScale-s/o;this.setView(r,n,o)}}zoomAboutTo_o(t,e,o){let i=this.o2cX(t),s=this.o2cY(e);this.zoomAboutTo_c(i,s,o)}animate(t,e,o){var i=this,s=i.animation;s.startOffsetX=i.imageCenterX_o,s.startOffsetY=i.imageCenterY_o,s.startZoom=i.zoomScale,s.startTime=Date.now(),null==s.id&&(s.targetOffsetX=i.imageCenterX_o,s.targetOffsetY=i.imageCenterY_o,s.targetZoom=i.zoomScale,s.id=setInterval((()=>{i.offsetAnimationStep()}),me.animationInterval)),s.targetOffsetX+=t,s.targetOffsetY+=e,s.targetZoom*=o,T.M.Review.reset()}animateTo_o(t,e,o){var i=this,s=i.animation;s.startOffsetX=i.imageCenterX_o,s.startOffsetY=i.imageCenterY_o,s.startZoom=i.zoomScale,s.startTime=Date.now(),null==s.id&&(s.targetOffsetX=i.imageCenterX_o,s.targetOffsetY=i.imageCenterY_o,s.targetZoom=i.zoomScale,s.id=setInterval((()=>{i.offsetAnimationStep()}),me.animationInterval)),s.targetOffsetX=t,s.targetOffsetY=e,s.targetZoom=o}animateTo_i(t,e){var o=Rt.empty();this.tx_i2o(t,o),this.animateTo_o(o.x,o.y,Math.max(e,this.zoomScale))}offsetAnimationStep(){var t=this,e=t.animation,o=(Date.now()-e.startTime)/me.animationDuration,i=R.clamp(o,0,1),s=e.startOffsetX+i*(e.targetOffsetX-e.startOffsetX),r=e.startOffsetY+i*(e.targetOffsetY-e.startOffsetY),n=Math.exp(Math.log(e.startZoom)+i*(Math.log(e.targetZoom)-Math.log(e.startZoom)));i>=1&&t.clearAnimation(!0),t.setView(s,r,n,!1,t.mouseX_ii==me.OffScreen)}clearAnimation(t=!1){var e=this.animation;!t&&e.ignoreClear||(e.id&&clearInterval(e.id),e.startOffsetX=null,e.startOffsetY=null,e.startZoom=null,e.targetOffsetX=null,e.targetOffsetY=null,e.targetZoom=null,e.startTime=null,e.id=null,e.ignoreClear=!1)}refreshView(t){if(t&&this.showing){this.updateIsTinyHairBrush();var e=t.context(),o=t.config;if(e.setGlobalAlpha(1),e.clearRect(0,0,t.width(),t.height()),R.imageIsReady(this.opts.image)){this.updateCanvasCoords(t),e.setGlobalAlpha(1),o.showBackground&&T.M.settings.backgroundColor&&""!=T.M.settings.backgroundColor&&T.M.settings.backgroundColor!=window.Globals.BackgroundColors[0]&&(e.setFillStyle(T.M.settings.backgroundColor),e.fillRect(this.crop_c.left0,this.crop_c.top0,this.crop_c.width(),this.crop_c.height()));var i=this.getCrop_c();if(e.clipBlock(o.clip,i.left0,i.top0,i.right0,i.bottom0,(()=>{this.drawClipped(t,e,o)})),!o.showFrame&&0==T.M.settings.straightenAngleDeg||D.ScreenshotMode||(e.setStrokeStyle("#000000"),e.setGlobalAlpha(.4),e.setLineWidth(1),e.strokeRect(this.crop_c.left0+.5,this.crop_c.top0+.5,this.crop_c.width()-1,this.crop_c.height()-1),e.setGlobalAlpha(1)),this.currentApp.drawOver_c(t,e),D.ScreenshotMode||(o.title&&e.drawCenteredText(o.title,81),o.filename&&e.drawCenteredText(o.filename,t.logicalHeight()-63),o.showSize&&e.drawCenteredText(Q.outputSizeS(),t.logicalHeight()-63)),this.opts.showGrid&&this.opts.showGrid()){e.setGlobalAlpha(.2),e.setStrokeStyle("#000000"),e.setLineWidth(1);for(var s=t.logicalWidth(),r=t.logicalHeight(),n=0;n<s/2;n+=100)c(s/2+n,0,s/2+n,r),c(s/2-n,0,s/2-n,r);for(var a=0;a<r/2;a+=100)c(0,r/2+a,s,r/2+a),c(0,r/2-a,s,r/2-a)}if(!D.ScreenshotMode){let o=t.height(),i=t.width(),s="#222",r="#777",n="#bbb",a=1,l=1;if(e.setGlobalAlpha(1),this.isHorizontalSideBySide(!1)){if(t.borderLeft&&(e.setFillStyle(r),e.fillRect(0,0,l,o),e.setFillStyle(s),e.fillRect(l,0,a,o)),t.borderRight){let i=t.width()-a-l;e.setFillStyle(r),e.fillRect(i+a,0,l,o),e.setFillStyle(n),e.fillRect(i,0,a,o)}}else if(t.borderLeft&&(e.setFillStyle(r),e.fillRect(0,0,i,l),e.setFillStyle(s),e.fillRect(0,l,i,a)),t.borderRight){let o=t.height()-a-l;e.setFillStyle(r),e.fillRect(0,o+a,i,l),e.setFillStyle(n),e.fillRect(0,o,i,a)}}if(D.ScreenshotMode&&(o.showHoverTool||1==this.canvases.length)){var l=O.getActiveMode().getCursor();l&&(e.setGlobalAlpha(1),e.drawImage(l.img,this.mouseX_c-l.x,this.mouseY_c-l.y))}}}function c(t,o,i,s){e.beginPath(),e.moveTo(Math.floor(t)+.5,Math.floor(o)+.5),e.lineTo(Math.floor(i)+.5,Math.floor(s)+.5),e.stroke()}}drawClipped(t,e,o){var i=this;o.showPreview&&ht.ShadowApp&&ht.ShadowApp.drawUnder_c(t,e,this,(function(t,o,s,r){if(t){e.setGlobalAlpha(o);var n=t.width(),a=t.height();e.drawCanvasEx3(t,0,0,n,a,i.imageLeft_c+s*i.zoomScale,i.imageTop_c+r*i.zoomScale,n*i.zoomScale,a*i.zoomScale)}})),e.rotatedFrame(-T.M.totalRotationAngleRad_o2i(),this.getImageCenter_c(),(()=>{i.drawRotated(t,e,o)}))}drawRotated(t,e,o){var i=this;function s(t,o,s){e.setGlobalAlpha(o),e.drawCanvasEx3(t,0,0,i.imageWidth,i.imageHeight,i.imageLeft_c,i.imageTop_c,i.imageWidth_c,i.imageHeight_c)}function r(t,o){e.setStrokeStyle(t),e.setLineWidth(o),e.stroke()}if(o.showPreview&&ht.ShadowApp&&ht.ShadowApp.drawUnder_i(t,e,this,(function(t,o,s,r){if(t){e.setGlobalAlpha(o);var n=t.width(),a=t.height();e.drawCanvasEx3(t,0,0,n,a,i.imageLeft_c+s*i.zoomScale,i.imageTop_c+r*i.zoomScale,n*i.zoomScale,a*i.zoomScale)}})),o.showOriginal&&s(i.opts.image,1),o.showPreview&&s(T.M.previewCanvas,1),o.showUserMask&&s(T.M.userMask,1),o.showBeziers){let t=!0;if((3==T.M.imageCategory.user||this.isZoomingOrPanning&&T.M.bezierSetLength>D.MaxBezierSetLengthForDrawingWhilePanningOrZooming||this.isStroking()&&T.M.bezierSetLength>D.MaxBezierSetLengthForDrawingWhileStroking)&&(t=!1),t){e.setGlobalAlpha(1),e.setLineJoin("bevel"),e.beginPath();for(let t of T.M.bezierSet){e.moveTo(i.o2cX(t[0]),i.o2cY(t[1]));for(let o=2;o<t.length;o+=4)e.quadraticCurveTo(i.o2cX(t[o]),i.o2cY(t[o+1]),i.o2cX(t[o+2]),i.o2cY(t[o+3]))}e.setLineDash([]),r("#000000",D.LineOuterWidth),e.setLineDash([7,3]),r("#FFFF66",D.LineInnerWidth),e.setLineDash([]),e.setFillStyle("#000");for(var n=0;n<T.M.detectedCorners.length;n++){var a=T.M.detectedCorners[n];e.fillCircle(i.o2cX(a.x),i.o2cY(a.y),D.LineOuterWidth/2)}}}if(o.showSword&&3!=T.M.imageCategory.user&&ot.cutSet.draw(i,e),o.showReviewCursor){var l=T.M.Review.currentCenter_i;if(isFinite(l.x)&&isFinite(l.y)){var c=i.o2cX(l.x),p=i.o2cY(l.y);e.fillCircle(c,p,D.LineOuterWidth,"#F00")}}if(o.showEyeDropperLoupe&&O.getActiveMode().isEyeDropper&&i.hoveredCanvas==t.element){e.setGlobalAlpha(1);let t=Math.round(D.LoupeRadius/i.zoomScale),o=Math.max(0,i.mouseX_ii-t),s=Math.min(i.imageWidth,i.mouseX_ii+t)-o,n=Math.max(0,i.mouseY_ii-t),a=Math.min(i.imageHeight,i.mouseY_ii+t)-n;a>0&&s>0&&(e.drawCanvasEx3(i.opts.image,o,n,s,a,i.o2cX(o),i.o2cY(n),s*i.zoomScale,a*i.zoomScale),e.beginPath(),e.rect(i.o2cX(o),i.o2cY(n),s*i.zoomScale,a*i.zoomScale),r("#FFFF66",2))}let u=o.showHairLoupe&&this.isTinyHairBrush;if(u){e.setGlobalAlpha(1);let t=Math.max(i.zoomScale,8),o=Math.round(D.LoupeRadius/t),s=Math.max(0,i.mouseX_ii-o),n=Math.max(0,i.mouseY_ii-o),a=Math.min(i.imageWidth,i.mouseX_ii+o)-s,l=Math.min(i.imageHeight,i.mouseY_ii+o)-n,c=a*t,p=l*t,u=i.o2cX(i.mouseX_ii)-.5*c,d=i.o2cY(i.mouseY_ii)-.5*p;if(l>0&&a>0)if(e.drawCanvasEx3(i.opts.image,s,n,a,l,u,d,c,p),e.beginPath(),e.rect(u,d,c,p),r("#FFFF66",2),(h=O.getActiveMode()).needsHover){e.setGlobalAlpha(.5),e.setFillStyle(h.cssColor);let o=i.o2cX(i.mouseX_ii),s=i.o2cY(i.mouseY_ii);e.fillRect(o,s,t,t)}}var h;if(O.isNot(O.Grab)&&o.showHoverTool&&!u&&(h=O.getActiveMode()).needsHover){e.setGlobalAlpha(.5),e.setFillStyle(h.cssColor);let t=i.diameter(),o=Math.floor(t/2),s=t-o,r=Math.round(i.imageLeft_c+(i.mouseX_ii-o)*i.zoomScale),n=Math.round(i.imageTop_c+(i.mouseY_ii-o)*i.zoomScale),a=Math.round(i.imageLeft_c+(i.mouseX_ii+s)*i.zoomScale),l=Math.round(i.imageTop_c+(i.mouseY_ii+s)*i.zoomScale);if(h.isEraser)e.fillRect(r,n,a-r,l-n);else{var d=h.getBrush(t);e.drawCanvasEx2(d.opaqueCanvas,r,n,a-r,l-n)}}if(!window.Globals.Bulk.isApi&&o.showUserMask&&q.pasteButtonIsHovered){var g=q.getMask();null!=g&&(e.setGlobalAlpha(.5*D.ClientMaskAlphaFloat),e.drawCanvasEx3(g,0,0,g.width(),g.height(),i.imageLeft_c,i.imageTop_c,i.imageWidth_c,i.imageHeight_c))}i.currentApp.drawOver_i(t,e)}}function fe(){const t=225;var e=!1,o=null,i=null;function s(t,e,o,i){var s=i;const r=t.length;for(var n=0;n<r;n++){var a=t[n],l=t[(n+1)%r];(l.y<o&&a.y>=o||a.y<o&&l.y>=o)&&l.x+(o-l.y)/(a.y-l.y)*(a.x-l.x)<e&&(s=!s)}return s}function r(t,e,o){for(var i=!1,r=0;r<t.length;r++)i=s(t[r],e,o,i);return i}function n(t,e,o,i,s,r){for(var n,a,l=0;l<3;l++){n=0;for(var c=0;c<s;c++)n+=t[c];for(var p=0;p<i;p++)e[p+o]=n*r,n-=t[p],n+=t[p+s];a=t,t=e,e=a}return t}self.addEventListener("message",(s=>{try{var a=s.data;!function(t,s){if(!e){var r=Math.max(t,s)+450;o=new Uint8Array(r),i=new Uint8Array(r),e=!0}}(a.w,a.h),function(t){for(var e=0;e<t.length;e++)t[e]=0}(a.alphas);var l=a.w-450,c=a.h-450;!function(e,o,i,s,n,a,l){if(l.length>0)for(var c=0,p=3;c<s;c++)for(var u=0;u<i;u++,p+=4)r(l,u+.5,c+.5)&&(e[(c+t)*n+u+t]=o[p]);else for(c=0,p=3;c<s;c++)for(u=0;u<i;u++,p+=4)e[(c+t)*n+u+t]=o[p]}(a.alphas,a.result,l,c,a.w,a.h,a.polygonPoints),function(t,e,o,i,s,r){for(var a,l=0|o,c=2*l+1|0,p=1/c,u=t+l|0,h=e+l|0,d=0;d<l;d++)s[d]=0,s[t+l+d]=0,r[d]=0,r[t+l+d]=0;for(var g=0;g<e;g++){for(var m=0,f=(d=l,g*t);d<u;d++,f++)m+=C=i[f],s[d]=C;a=m>0?n(s,r,l,t,c,p):s;for(d=l,f=g*t;d<t;d++,f++)i[f]=a[d]}for(var S=0;S<l;S++)s[S]=0,s[e+l+S]=0,r[S]=0,r[e+l+S]=0;for(var w=0;w<t;w++){for(m=0,S=l,f=w;S<h;S++,f+=t){var C=i[f];m+=C,s[S]=C}a=m>0?n(s,r,l,e,c,p):s;for(S=l,f=w;S<h;S++,f+=t)i[f]=a[S]}}(a.w,a.h,a.blurRadius,a.alphas,o,i),ee({alphas:a.alphas,blurRadius:a.blurRadius},[a.alphas.buffer]),a.alphas=null}catch(s){ee({alphas:null,blurRadius:null,exception:s})}}))}function Se(){self.addEventListener("message",(p=>{try{var u=p.data;!function(t){s=t.bufferSize.w,r=t.bufferSize.h,n=new Uint8ClampedArray(s*r*4),(!a||a.length<s)&&(a=new Float32Array(2*s))}(u),function(t){for(var e=0,o=t.points,i=o[0],s=o[o.length-1],r=0;r<t.bufferSize.w;r++){var n=t.bounds_o.left+r+.5,l=0;if(n<=i.x)l=i.y;else if(n>=s.x)l=s.y;else{for(;e<o.length-1&&n>o[e+1].x;)e++;var c=o[e],p=o[e+1],u=(n-c.x)/(p.x-c.x);l=c.y+u*(p.y-c.y)}a[r]=l}}(u),function(p){var u=p.imageCenter,h=p.angleRad,d=Math.sin(h),g=Math.cos(h),m=p.result,f=p.bounds_o,S=p.imageSize.w,w=p.imageSize.h,C=p.height;function y(t){return Math.max(0,Math.min(t,S-1))}function b(t){return Math.max(0,Math.min(t,w-1))}for(var v=0,A=0;v<r;v++)for(var k=f.top+v+.5,M=0;M<s;M++,A+=4){var x=a[M];if(k>x){var T=f.left+M+.5-u.x,_=2*x-k-u.y,D=u.x+g*T-d*_,P=u.y+d*T+g*_,R=Math.floor(D-.5),E=Math.floor(P-.5);if(D>=0&&D<S&&P>=0&&P<w){var F=255-l(255*(k-x)/C,0,255),I=4*(b(E)*S+y(R)),B=4*(b(E)*S+y(R+1)),O=4*(b(E+1)*S+y(R)),L=4*(b(E+1)*S+y(R+1)),z=D-(R+.5),$=P-(E+.5);n[A+t]=c(z,$,m,I,B,O,L,t),n[A+e]=c(z,$,m,I,B,O,L,e),n[A+o]=c(z,$,m,I,B,O,L,o),n[A+i]=F*(c(z,$,m,I,B,O,L,i)/255)}else n[A+i]=0}else n[A+i]=0}}(u),ee(h={buffer:n,bufferSize:u.bufferSize,index:u.index},[h.buffer.buffer])}catch(p){var h;ee(h={buffer:null,bufferSize:null,index:null,exception:p})}}));const t=0,e=1,o=2,i=3;var s=0,r=0,n=null,a=null;function l(t,e,o){return Math.max(e,Math.min(o,t))}function c(t,e,o,i,s,r,n,a){return o[i+a]*((1-t)*(1-e))+o[s+a]*(t*(1-e))+o[r+a]*((1-t)*e)+o[n+a]*(t*e)}}me.OffScreen=-1e4,me.animationInterval=10,me.animationDuration=100,me.moveStep=50,me.zoomStep=1.2,me.inverseZoomStep=1/me.zoomStep,me.zoomToFitBackOff=.95,me.maxZoomScale=64,me.minZoomScale=1/16,me.TargetIntervalMs=1e3/60,function(t){t.SwordActiveRed="#cc0000",t.SwordInactiveRed="rgb(120,60,60)",t.checkerPng=new Image,t.checkerPng.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQAQMAAAAlPW0iAAAABlBMVEX////19fVC0XEuAAAAAHRSTlM2uXDMAAAAEElEQVR42mNg+M+AFeEQBgB+vw/xeaW7jwAAAABJRU5ErkJggg==",t.main=new me("main"),t.subViewPort=new me("subapp"),t.ShadowApp=null,t.refreshAllViews=function(){t.main.refreshAllViews(),t.subViewPort.refreshAllViews()}}(ht||(ht={})),function(t){const e=.999,o="#F80",i="#0FF",s="#F0F",r="#0F0",n="#080",l=6,c=Math.SQRT2,u=l,h=l,d=14,g=60,m=3*l+u+l,f=4*l+l,S=h+d+l,w=l+l,C=D.MaxBlurRadius,y=3*C,b=D.MaxMirrorShadowHeight,v=D.MaxMirrorShadowOffset,A=1.2,k=20,M=2*C,x=1e3;class _{constructor(){this.handles=[],this.xr=0,this.yr=0}updateLocalCoords(t){this.xr=t.x,this.yr=t.y}autoHideControls(){return!1}hitShadow(t){return this.updateLocalCoords(t),!0}hitHandle(){let t=null;for(var e=0;e<this.handles.length;e++)this.handles[e].hitTest()&&(t||(t=this.handles[e]));return t}drawHandles(t){if(!this.autoHideControls()||H&&H.shadows&&H.shadows.indexOf(this)>=0)for(var e=H.handle,o=this.handles.length-1;o>=0;o--){var i=this.handles[o];i.drawWrapper(t,i==e)}}drawShadow(t,e){}drawControls(t){}}class E extends _{constructor(){super(),this.handles.push(new se(this))}drawControls(t){this.drawHandles(t)}}class F extends _{constructor(t){super();for(var e=0;e<t.length;e++)this.handles.push(new re(Rt.from(t[e]),this))}static fromRect(t){return new F([new Rt(t.left0,t.top0),new Rt(t.right0,t.top0),new Rt(t.right0,t.bottom0),new Rt(t.left0,t.bottom0)])}static decode(t){return new F(t.points)}getPolyLoop(){return new Gt(this.handles.map(((t,e,o)=>t.getV())))}drawControls(t){t.setGlobalAlpha(1),t.setLineWidth(4),t.setStrokeStyle("#000"),t.beginPath(),t.moveTo(Xt(this.handles[0].getX()),Xt(this.handles[0].getY())),this.handles.forEach(((e,o,i)=>t.lineTo(Xt(e.getX()),Xt(e.getY())))),t.closePath(),t.stroke(),t.setLineWidth(2),t.setStrokeStyle(i),t.stroke(),this.drawHandles(t)}encode(){return{points:this.getPolyLoop().points}}}var I={title:"",showPreview:!0,showFrame:!0,showBackground:!0,clip:!1,contextMenuHandler:j.showShadowApp};ht.ShadowApp=t;var B=null,z=[],U=null,G=new class{constructor(){this.loops=[]}nonEmpty(){return this.loops.length>0}isEmpty(){return 0==this.loops.length}clear(){this.loops.length=0}fromRect(t){this.clear(),this.loops.push(new F([new Rt(t.left0,t.top0),new Rt(t.right0,t.top0),new Rt(t.right0,t.bottom0),new Rt(t.left0,t.bottom0)]))}decode(t){this.clear(),t&&t.loops&&t.loops.forEach((t=>this.loops.push(new F(t.points))))}getPolygon(){return new Ut(this.loops.map(((t,e,o)=>t.getPolyLoop())))}getPolygonPoints(){return this.loops.map(((t,e,o)=>t.getPolyLoop().points))}encode(){return{loops:this.loops.map((t=>t.encode()))}}},N={v0:null,v2:null,downState:null,firstMove:!1};let H={shadows:[],shadow:null,handle:null,ellipse:null,interactionIdentifier:void 0},V=H;function W(){return T.M.defaultSettings.ellipseShadow}function X(){return T.M.defaultSettings.dropShadow}function Y(){return T.M.defaultSettings.mirrorShadow}function q(){return T.M.defaultSettings.perspectiveShadow}t.getNumEllipseShadows=function(){return z.length},t.getSelectedEllipseShadow=function(){return null==B?$.extend({},W()):B};class J{constructor(t){this.indicatorId=t,this.indexSent=0,this.indexReceived=0,this.calledFor=!1}incrementIndexSentAndShowIndicator(){this.indexSent++,this.indicatorId.$().show()}setIndexReceived(t){this.indexReceived=t,this.indicatorId.$().hide()}readyToResubmit(){return this.inSync()&&this.calledFor}inSync(){return this.indexSent==this.indexReceived}outOfSync(){return!this.inSync()}callFor(){this.calledFor=!0}resetCalledFor(){this.calledFor=!1}}let Q=null;t.dropShadow=null;let Z=-1,K=-1,tt=-1,et=null,ot=null,it=null,st=null,rt=null,nt=null;t.mirrorShadow=null;let at=null,lt=null,ct=null,pt=new J(P.CmApp.ShadowApp.MirrorShadow.UpdatingIndicator),dt=null,mt=null;t.perspectiveShadow=null;let ft=-1,St=-1,wt=null,Ct=Ft.empty(),yt=new J(P.CmApp.ShadowApp.PerspectiveShadow.UpdatingIndicator),bt=!1,vt=!1,At=-1,kt=-1,Mt=-1,xt=!1,Tt=null,_t=!1,Dt=0,Pt=0,It=0,Ot=0,zt=0,Nt=0,Ht=0,Vt=0,Wt=0;function Xt(t){return t*ht.subViewPort.getZoomScale()}function qt(t){return t/ht.subViewPort.getZoomScale()}t.onhide=R.empty;class Jt extends _{constructor(t,e,o,i,s,r){super(),this.sin=0,this.cos=1,this.shadowType="ellipse",this.center=t.dup(),this.radiusX_i=Math.abs(e),this.radiusY_i=Math.abs(o),this.angleRad=i,this.strength=s,this.core=0===r||r?r:W().core,this.sin=Math.sin(this.angleRad),this.cos=Math.cos(this.angleRad),this.topLeft=new ae(this,"topLeft",-1,-1),this.topRight=new ae(this,"topRight",1,-1),this.bottomRight=new ae(this,"bottomRight",1,1),this.bottomLeft=new ae(this,"bottomLeft",-1,1),this.sliderCore=new le(this),this.move=new ce(this),this.remove=new pe(this),this.rotator=new ue(this),this.sliderStrength=new he(this),this.handles=[this.topLeft,this.topRight,this.bottomRight,this.bottomLeft,this.sliderCore,this.move,this.remove,this.sliderStrength,this.rotator]}color(){return B==this?"#FB0":H.ellipse==this?"#FD0":"#FF0"}oppositeCorner(t){switch(t.name){case"topLeft":return this.bottomRight;case"topRight":return this.bottomLeft;case"bottomRight":return this.topLeft;case"bottomLeft":return this.topRight}return null}radiusX_c(){return Xt(this.radiusX_i)}radiusY_c(){return Xt(this.radiusY_i)}angleDeg(){return 180*this.angleRad/Math.PI}rotateX(t,e){return t*this.cos+e*this.sin}rotateY(t,e){return-t*this.sin+e*this.cos}derotateX(t,e){return t*this.cos-e*this.sin}derotateY(t,e){return t*this.sin+e*this.cos}setAngleRad(t){this.angleRad=t,this.sin=Math.sin(t),this.cos=Math.cos(t)}autoHideControls(){return!0}hitCircle(t,e,o){return R.sqr(this.xr-t)+R.sqr(this.yr-e)<o*o}setRect(t,e){this.center.x=(t.x+e.x)/2,this.center.y=(t.y+e.y)/2;let o=(e.x-t.x)/2,i=(e.y-t.y)/2;this.radiusX_i=Math.max(10,Math.abs(this.rotateX(o,i))),this.radiusY_i=Math.max(10,Math.abs(this.rotateY(o,i)))}updateLocalCoords(t){let e=t.x-this.center.x,o=t.y-this.center.y;this.xr=this.rotateX(e,o),this.yr=this.rotateY(e,o)}hitShadow(t){this.updateLocalCoords(t);let e=-this.radiusX_i-Wt,o=+this.radiusX_i+Ht,i=-this.radiusY_i-Nt,s=+this.radiusY_i+Vt;return e<=this.xr&&this.xr<=o&&i<=this.yr&&this.yr<=s}drawShadow(t,e){if(this.radiusX_i>0&&this.radiusY_i>0){let o=1,i=this.radiusY_i/this.radiusX_i,s=e.getZoomScale()*this.radiusX_i,r=t.createRadialGradient(0,0,0,0,0,s);r.addColorStop(0,"rgba(0,0,0,"+this.strength.toFixed(3)+")"),r.addColorStop(this.core,"rgba(0,0,0,"+this.strength.toFixed(3)+")");for(let t=0;t<=10;t++){let e=t/10,o=1-e,i=R.clamp(this.strength*(-2*o*o*o+3*o*o),0,1);r.addColorStop(this.core+e*(1-this.core),"rgba(0,0,0,"+i.toFixed(3)+")")}t.setGlobalAlpha(1),t.setFillStyle(r),t.scale(o,i),t.fillCircle(0,0,s)}}drawControls(t){t.setGlobalAlpha(1),t.setLineWidth(4),t.setStrokeStyle("#000"),t.strokeRect(-Xt(this.radiusX_i),-Xt(this.radiusY_i),Xt(2*this.radiusX_i),Xt(2*this.radiusY_i)),t.setLineWidth(2),t.setStrokeStyle(this.color()),t.strokeRect(-Xt(this.radiusX_i),-Xt(this.radiusY_i),Xt(2*this.radiusX_i),Xt(2*this.radiusY_i)),this.drawHandles(t)}encode(){return{centerX_i:this.center.x,centerY_i:this.center.y,radiusX_i:this.radiusX_i,radiusY_i:this.radiusY_i,angleRad:this.angleRad,strength:this.strength,core:this.core}}}class Qt{constructor(t,e=1){this.container=t,this.handleRadiusScale=e,this.isVisible=!0}getToolMode(){return O.ShadowArrow}getX(){return 0}getY(){return 0}getV(){return new Rt(this.getX(),this.getY())}getHitRadius_i(){return this.handleRadiusScale*Dt*1.5}mayGrabWhenInvisible(){return!1}hitTest(){let t=this.getHitRadius_i();return R.sqr(this.container.xr-this.getX())+R.sqr(this.container.yr-this.getY())<t*t}drawWrapper(t,e){this.isVisible&&this.draw(t,e,this.getX(),this.getY())}draw(t,e,o,i){}drawTranslateHandle(t,e,o,i,s,r){let n=Xt(o),a=Xt(i),c=1.75*l;t.beginPath(),t.triangle(n,a-c,-Math.PI/2,2,5),t.triangle(n,a+c,Math.PI/2,2,5),t.triangle(n-c,a,Math.PI,2,5),t.triangle(n+c,a,0,2,5),t.strokeEx(2,"#000"),t.fillEx(e?r:s),de(t,e,o,i,s,r,1)}mouseDrag(t){}mouseDown(t){}mouseUp(t){}}class jt extends Qt{constructor(t,e,o=1){super(e,o),this.p_i=t,this.dp_i=new Rt(0,0)}getX(){return this.p_i.x}getY(){return this.p_i.y}mayGrabWhenInvisible(){return!0}mouseDrag(t){this.p_i.set(t).plusEquals(this.dp_i)}mouseDown(t){this.mouseDownPos_i=t.dup(),this.mouseDownTime=Date.now(),this.dp_i=this.p_i.minus(t)}}class Zt extends _{constructor(){super(),this.isInitialized=!1,this.geometryIsValid=!1,this.c1=new Kt(new Rt(10,0),this,!0,[],.7),this.p1=new Kt(new Rt(0,0),this,!1,[this.c1]),this.c0=new Kt(new Rt(0,0),this,!0,[],.7),this.p0=new Kt(new Rt(10,0),this,!1,[this.p1,this.c0]),this.quadDst_i=Et.empty(),this.quadSrc_o=Et.empty(),this.quadDst_o=Et.empty(),this.quadSrcClip_i=Et.empty(),this.quadSrcClip_o=Et.empty(),this.quadDstClip_o=Et.empty(),this.transformSrcToDst_o=new Lt,this.transformDstToSrc_o=new Lt,this.transformDstToSrc_o2i=new Lt,this.clipBoundsSrc_o=Ft.empty(),this.clipBoundsSrcPad_o=Ft.empty(),this.clipBoundsDstPad_o=Ft.empty(),this.canvasRect_o=Ft.empty(),this.cropRect_o=Ft.empty(),this.handles.push(this.p0,this.c0,this.p1,this.c1)}clear(){this.initialize(!0)}initialize(e=!1){if(!t.perspectiveShadow.mutated||!this.isInitialized||e){this.isInitialized=!0;let t=T.M.getBoundingRect_o(),e=T.M.totalRotationAngleRad_o2i(),o=ht.main.getImageCenter_i();t&&(this.p0.p_i.set(t.bottomLeft().rotateInPlace(e,o)),this.c0.p_i.set(t.bottomRight().rotateInPlace(e,o)),this.p1.p_i.set(t.interpolate(1,.4).rotateInPlace(e,o)),this.c1.p_i.set(t.interpolate(1.75,.4).rotateInPlace(e,o)),this.updateGeometry())}}computeQuadsRayShoot(t,e,o){let i=T.M.getBoundingRect_o().pad(t),s=T.M.totalRotationAngleRad_i2o(),r=ht.main.getImageCenter_i(),n=this.p0.p_i.rotate(s,r),a=this.c0.p_i.rotate(s,r),l=this.p1.p_i.rotate(s,r),c=this.c1.p_i.rotate(s,r),p=(a.y-n.y)/(a.x-n.x),u=n.y+p*(i.left-n.x),h=n.y+p*(i.right-n.x);e.p0.setXy(i.left,i.top),e.p1.setXy(i.right,i.top),e.p2.setXy(i.right,h),e.p3.setXy(i.left,u),o&&(o.p0.set(l),o.p1.set(c),o.p2.setXy(i.right,h),o.p3.setXy(i.left,u))}computeQuads(t,e,o){let i=T.M.getBoundingRect_o().pad(t),s=T.M.totalRotationAngleRad_i2o(),r=ht.main.getImageCenter_i(),n=this.p0.p_i.rotate(s,r),a=this.c0.p_i.rotate(s,r),l=this.p1.p_i.rotate(s,r),c=this.c1.p_i.rotate(s,r);e.p0.setXy(n.x,i.top),e.p1.setXy(a.x,i.top),e.p2.set(a),e.p3.set(n),o.p0.set(l),o.p1.set(c),o.p2.set(a),o.p3.set(n)}isValid(){return this.quadDst_i.p0.set(this.p1.p_i),this.quadDst_i.p1.set(this.c1.p_i),this.quadDst_i.p2.set(this.c0.p_i),this.quadDst_i.p3.set(this.p0.p_i),this.quadDst_i.isConvex()&&this.cropRect_o.width()>0&&this.cropRect_o.height()>0}updateGeometry(){if(this.isInitialized){this.computeQuads(0,this.quadSrc_o,this.quadDst_o),this.computeQuadsRayShoot(0,this.quadSrcClip_o,null),this.quadSrcClip_i.set(this.quadSrcClip_o).rotateInPlace(T.M.totalRotationAngleRad_o2i(),ht.main.getImageCenter_i()),this.transformSrcToDst_o.setQuadrilateralToQuadrilateral(this.quadSrc_o,this.quadDst_o),this.transformDstToSrc_o.setQuadrilateralToQuadrilateral(this.quadDst_o,this.quadSrc_o),this.transformDstToSrc_o2i.setRotationAbout(T.M.totalRotationAngleRad_o2i(),ht.main.getImageCenter_i()),this.transformDstToSrc_o2i.timesEquals(this.transformDstToSrc_o),this.transformSrcToDst_o.applyToQuad(this.quadSrcClip_o,this.quadDstClip_o),this.clipBoundsSrc_o.setFrom(Ft.fromQuad(this.quadSrcClip_o)),this.clipBoundsSrcPad_o.setFrom(this.clipBoundsSrc_o).pad(M),this.clipBoundsDstPad_o.setNull();let t=this.clipBoundsSrcPad_o.sampleGrid(10,10),e=Rt.empty();for(let o=0;o<t.length;o++)this.transformSrcToDst_o.applyWithGuard(t[o],e)&&this.clipBoundsDstPad_o.addPointSafe(e);this.cropRect_o.fromCropRect(T.M.getCrop_o()).snap(),this.canvasRect_o.setFrom(this.cropRect_o).pad(200).intersectionWith(this.clipBoundsDstPad_o).snap(),this.geometryIsValid=this.isValid()}}drawControls(t){let e=ht.main.getImageCenter_i(),o=T.M.totalRotationAngleRad_o2i();!function(e,o="#0f0"){t.setStrokeStyle(o),t.setGlobalAlpha(1),t.setLineWidth(.25),t.beginPath(),t.moveTo(Xt(e.p0.x),Xt(e.p0.y)),t.lineTo(Xt(e.p1.x),Xt(e.p1.y)),t.lineTo(Xt(e.p2.x),Xt(e.p2.y)),t.lineTo(Xt(e.p3.x),Xt(e.p3.y)),t.closePath(),t.stroke()}(this.quadDstClip_o.rotate(o,e),"#0f0");t.beginPath();this.p0.p_i.interpolate(this.c0.p_i,.5),this.p1.p_i.interpolate(this.c1.p_i,.5);t.moveTo(Xt(this.p0.p_i.x),Xt(this.p0.p_i.y)),t.lineTo(Xt(this.c0.p_i.x),Xt(this.c0.p_i.y)),t.moveTo(Xt(this.p1.p_i.x),Xt(this.p1.p_i.y)),t.lineTo(Xt(this.c1.p_i.x),Xt(this.c1.p_i.y)),t.setGlobalAlpha(1),t.setLineWidth(4),t.setStrokeStyle("#000"),t.stroke(),t.setLineWidth(2),t.setStrokeStyle(this.geometryIsValid?r:"#F00"),t.stroke();this.drawHandles(t)}decode(t){t&&(t.p0&&this.p0.p_i.set(t.p0),t.c0&&this.c0.p_i.set(t.c0),t.p1&&this.p1.p_i.set(t.p1),t.c1&&this.c1.p_i.set(t.c1),t.isInitialized&&(this.isInitialized=!0),this.updateGeometry())}encode(){return{isInitialized:this.isInitialized,p0:this.p0.p_i.dup(),c0:this.c0.p_i.dup(),p1:this.p1.p_i.dup(),c1:this.c1.p_i.dup()}}}class Kt extends jt{constructor(t,e,o,i,s=1){super(t,e,s),this.p_i=t,this.perspective=e,this.isControlPoint=o,this.children=i}draw(t,e,o,i){this.isControlPoint?function(t,e,o,i,s,r,n){let a=Xt(o),c=Xt(i);t.fillSquare(a,c,n*l,"#000"),t.fillSquare(a,c,n*l-1,e?r:s)}(t,e,this.getX(),this.getY(),r,n,this.handleRadiusScale):de(t,e,this.getX(),this.getY(),r,n,this.handleRadiusScale)}translate(e){t.perspectiveShadow.mutated=!0,this.p_i.plusEquals(e);for(let t=0;t<this.children.length;t++)this.children[t].translate(e);this.perspective.updateGeometry()}mouseDrag(t){this.translate(t.dup().plusEquals(this.dp_i).minus(this.p_i))}}class te extends _{constructor(){super(...arguments),this.polyLine=new $t([]),this.candidatePoint=null}getPolyLine_o(t){return this.polyLine.rotateAndOffsetY(-T.M.totalRotationAngleRad_o2i(),ht.main.getImageCenter_i(),.5*t)}isEmpty(){return 0==this.handles.length}nonEmpty(){return this.handles.length>0}clear(){this.handles.length=0,this.updatePolyLine()}hitShadow(t){this.updateLocalCoords(t);let e=this.polyLine.snapTo(t);return null!=e&&(this.candidatePoint=Xt(e.distance)<te.MaxDistance_c?e:null),!0}add(t){let e=new ee(t,this);return this.handles.push(e,e.deleteHandle),this.updatePolyLine(),fo(),e}remove(t){let e=this.handles.indexOf(t);-1!=e&&(L.push(),this.handles.splice(e,2)),this.isEmpty()&&Ze(!1,!0),this.updatePolyLine(),fo()}getMirrorHandles(){return this.handles.filter((t=>t instanceof ee))}updatePolyLine(){if(this.handles.length>0){let t=-T.M.totalRotationAngleRad_o2i(),e=ht.subViewPort.getImageCenter_i(),o=Math.sin(t),i=Math.cos(t),s=new Yt,r=[];this.getMirrorHandles().forEach((t=>{let e=t.getV();s.contains(e.x)||(r.push(e),s.put(e.x,e))})),r.sort((function(t,e){return i*t.x-o*t.y-(i*e.x-o*e.y)}));let n=T.M.getCrop_o(),a=r[0],l=r[r.length-1],c=a.rotate(t,e),p=l.rotate(t,e);c.x=n.left0,p.x=n.right0,r.unshift(c.rotate(-t,e)),r.push(p.rotate(-t,e)),this.polyLine.points=r}else this.polyLine.points=[]}drawControls(t){if(this.polyLine.nonEmpty()){t.setGlobalAlpha(1),t.setLineWidth(4),t.setStrokeStyle("#000"),t.beginPath();let e=this.polyLine.head();t.moveTo(Xt(e.x),Xt(e.y)),this.polyLine.points.forEach((e=>t.lineTo(Xt(e.x),Xt(e.y)))),t.stroke(),t.setLineWidth(2),t.setStrokeStyle(s),t.stroke()}if(this.drawHandles(t),null==H.handle&&null!=this.candidatePoint){let e=this.candidatePoint;t.setGlobalAlpha(.4),de(t,!1,e.pp.x,e.pp.y,s,s,1),t.setGlobalAlpha(1)}}decode(t){this.clear(),t&&t.forEach((t=>this.add(Rt.from(t))))}encode(){return this.getMirrorHandles().map((t=>t.getV()))}}te.MaxDistance_c=6;class ee extends jt{constructor(t,e,o=1){super(t,e,o),this.p_i=t,this.mirror=e,this.deleteHandle=new ie(this)}hitTest(){let t=this.getHitRadius_i(),e=Math.sqrt(R.sqr(this.container.xr-this.getX())+R.sqr(this.container.yr-this.getY()));return this.deleteHandle.isVisible=e<3.5*t,e<t}draw(t,e,o,i){de(t,e,this.getX(),this.getY(),s,"#80F",this.handleRadiusScale)}mouseDrag(e){super.mouseDrag(e),t.mirrorShadow.mutated=!0,this.mirror.updatePolyLine()}}class ie extends Qt{constructor(t,e=1){super(t.container,e),this.parentHandle=t,this.isVisible=!1}getX(){return this.parentHandle.getX()+c*this.getHitRadius_i()}getY(){return this.parentHandle.getY()-c*this.getHitRadius_i()}draw(t,e,o,i){let s=Xt(this.getX()),r=Xt(this.getY());t.fillCircle(s,r,l,e?ht.SwordActiveRed:ht.SwordInactiveRed);let n=.8*l/Math.sqrt(2);t.strokeLine(s-n,r-n,s+n,r+n,1,e?"#FFF":"#DDD"),t.strokeLine(s+n,r-n,s-n,r+n)}mouseUp(t){this.hitTest()&&this.parentHandle.mirror.remove(this.parentHandle)}}class se extends Qt{constructor(t,e=2){super(t,e),this.dp_i=new Rt(0,0)}getX(){return At/2+t.dropShadow.offsetX}getY(){return kt/2+t.dropShadow.offsetY}mouseDrag(t){let e=new Rt(t.x-At/2,t.y-kt/2).plusEquals(this.dp_i);Xe(e.x,e.y)}mouseDown(t){this.mouseDownPos_i=t.dup(),this.mouseDownTime=Date.now(),this.dp_i=this.getV().minus(t)}draw(t,e,o,i){this.drawTranslateHandle(t,e,o,i,"#0FF","#08F")}}class re extends jt{constructor(t,e,o=1){super(t,e,o),this.p_i=t,this.polygon=e}draw(t,e,o,s){de(t,e,this.getX(),this.getY(),i,"#08F",this.handleRadiusScale)}}class ne extends Qt{constructor(t,e,o=1){super(t,o),this.ellipse=t,this.name=e,this.dp_i=new Rt(0,0)}getV(){let t=this.getX(),e=this.getY();return new Rt(this.ellipse.center.x+this.ellipse.derotateX(t,e),this.ellipse.center.y+this.ellipse.derotateY(t,e))}hitTest(){return this.ellipse.hitCircle(this.getX(),this.getY(),this.getHitRadius_i())}mouseDown(t){Qo(this.ellipse),this.dp_i=this.getV().minus(t)}}class ae extends ne{constructor(t,e,o,i){super(t,e,1),this.sx=o,this.sy=i}getX(){return this.sx*this.ellipse.radiusX_i}getY(){return this.sy*this.ellipse.radiusY_i}mayGrabWhenInvisible(){return!0}draw(t,e,i,s){de(t,e,this.getX(),this.getY(),this.ellipse.color(),o,this.handleRadiusScale)}mouseDrag(t){this.ellipse.setRect(t.plus(this.dp_i),this.ellipse.oppositeCorner(this).getV())}}class le extends ne{constructor(t){super(t,"sliderCore",1)}getX(){return this.ellipse.radiusX_i*this.ellipse.core}getY(){return 0}hitTest(){let t=this.getX()-Dt,e=t+2*Dt,o=1.5*-Dt,i=1.5*+Dt;return t<=this.ellipse.xr&&this.ellipse.xr<=e&&o<=this.ellipse.yr&&this.ellipse.yr<=i}draw(t,i,s,r){t.setGlobalAlpha(1),t.strokeLine(0,0,this.ellipse.radiusX_c()*e,0,4,"#000"),t.strokeLine(1,0,this.ellipse.radiusX_c()*e-1,0,2,"#FFF");let n=Xt(this.getX())-l,a=2*l,c=1.5*-l,p=2*l*1.5;t.setFillStyle("#000"),t.fillRect(n,c,a,p),t.setFillStyle(i?o:this.ellipse.color()),t.fillRect(n+1,c+1,a-2,p-2)}mouseDrag(t){if(this.ellipse.radiusX_i>0){let o=t.plus(this.dp_i),i=this.ellipse.rotateX(o.x-this.ellipse.center.x,o.y-this.ellipse.center.y);this.ellipse.core=R.clamp(R.roundTo(i/this.ellipse.radiusX_i,2),0,e),Zo()}}}class ce extends ne{constructor(t){super(t,"move",2)}getX(){return 0}getY(){return-this.ellipse.radiusY_i-(Pt+Dt)}draw(t,e,i,s){this.drawTranslateHandle(t,e,i,s,this.ellipse.color(),o)}mouseDrag(t){let e=this.getV(),o=t.plus(this.dp_i);this.ellipse.center.x+=o.x-e.x,this.ellipse.center.y+=o.y-e.y}}class pe extends ne{constructor(t){super(t,"remove",1)}getX(){return+this.ellipse.radiusX_i+c*this.getHitRadius_i()}getY(){return-this.ellipse.radiusY_i-c*this.getHitRadius_i()}draw(t,e,o,i){let s=Xt(o),r=Xt(i);t.fillCircle(s,r,l,e?ht.SwordActiveRed:ht.SwordInactiveRed);let n=.8*l/Math.sqrt(2);t.strokeLine(s-n,r-n,s+n,r+n,1,e?"#FFF":"#DDD"),t.strokeLine(s+n,r-n,s-n,r+n)}mouseUp(t){if(this.hitTest()){let t=z.indexOf(this.ellipse);t>=0&&(L.push(),B==this.ellipse&&Qo(null),z.splice(t,1),Xo(),ii())}}}class ue extends ne{constructor(t){super(t,"rotator",2)}getX(){return this.ellipse.radiusX_i+(Pt+Dt)}getY(){return 0}draw(t,e,i,s){let r=e?o:this.ellipse.color(),n=Xt(i),a=Xt(s),c=2*l,p=Math.PI/3;t.beginPath(),t.arc(n,a,c,-p,p),t.strokeEx(4,"#000"),t.beginPath();let u=n+c*Math.cos(p),h=c*Math.sin(p);t.triangle(u,a+h,p+Math.PI/2,4,4),t.triangle(u,a-h,-p-Math.PI/2,4,4),t.strokeEx(2,"#000"),t.fillEx(r),t.beginPath(),t.arc(n,a,c,-p,p),t.strokeEx(2,r),de(t,e,i,s,this.ellipse.color(),o,1)}mouseDrag(t){let e=t.plus(this.dp_i);this.ellipse.setAngleRad(Math.atan2(e.y-this.ellipse.center.y,e.x-this.ellipse.center.x))}}class he extends ne{constructor(t){super(t,"sliderStrength",1)}hitTest(){let t=this.minX_i(),e=t+zt,o=this.ellipse.radiusY_i+Pt,i=o+Ot;return t<=this.ellipse.xr&&e>=this.ellipse.xr&&o<=this.ellipse.yr&&i>=this.ellipse.yr}minX_i(){return this.ellipse.radiusX_i-zt-Dt}minX_c(){return this.ellipse.radiusX_c()-g-l}draw(t,e,o,i){let s=this.minX_c(),r=this.ellipse.radiusY_c()+u;t.setFillStyle("#000"),t.setGlobalAlpha(1),t.fillRect(s-1,r-1,g+2,d+2);let n=t.createLinearGradient(s,0,s+g,0);n.addColorStop(0,"#FFF"),n.addColorStop(1,"#000"),t.setFillStyle(n),t.fillRect(s,r,g,d);let a=s+g*this.ellipse.strength;t.strokeLine(a,r-2,a,r+d+2,2,"#C00")}mouseDrag(t){this.ellipse.updateLocalCoords(t),this.ellipse.strength=R.clamp(R.roundTo((this.ellipse.xr-this.minX_i())/zt,2),0,1),Zo(),Xo()}mouseDown(t){Qo(this.ellipse),this.mouseDrag(t)}}function de(t,e,o,i,s,r,n){let a=Xt(o),c=Xt(i);t.fillCircle(a,c,n*l,"#000"),t.fillCircle(a,c,n*l-1,e?r:s)}function ge(){if(!bt){bt=!0,rt=P.CmApp.ShadowApp.DropShadow.UpdatingIndicator.$(),P.CmApp.ShadowApp.close_button.$().click(Wo),P.CmApp.ShadowApp.ResetButton.$().click(li),R.hoverHelper(P.CmApp.ShadowApp.PreviewButton.$(),(t=>{xt=t,ht.subViewPort.refreshAllViews()})),P.CmApp.ShadowApp.PreviewButton.$().hide();let i=50;function e(t,e,o,s,r=null){R.mouseDownRepeater(t.$(),o,i,5,L.push,(()=>{r&&r(),ci()})),R.mouseDownRepeater(e.$(),s,i,5,L.push,(()=>{r&&r(),ci()}))}function o(t,o,i,s,r=null){e(t.decrease,t.increase,i,s,r),o&&t.reset.$().click(o)}o(P.CmApp.ShadowApp.EllipseShadow.Core,Ae,ke,Me),o(P.CmApp.ShadowApp.EllipseShadow.Strength,Ce,ye,be),o(P.CmApp.ShadowApp.DropShadow.Opacity,Pe,Re,Ee),o(P.CmApp.ShadowApp.DropShadow.BlurRadius,Be,Oe,Le,qe),P.CmApp.ShadowApp.DropShadow.Enabled.$().click((()=>{xe(!t.dropShadow.enabled,!0)})),P.CmApp.ShadowApp.DropShadow.offset_down_left.$().click((()=>{Xe(-2*t.dropShadow.blurRadius,2*t.dropShadow.blurRadius),ci(),ht.refreshAllViews()})),P.CmApp.ShadowApp.DropShadow.offset_down.$().click((()=>{Xe(0,2*t.dropShadow.blurRadius),ci(),ht.refreshAllViews()})),P.CmApp.ShadowApp.DropShadow.offset_down_right.$().click((()=>{Xe(2*t.dropShadow.blurRadius,2*t.dropShadow.blurRadius),ci(),ht.refreshAllViews()})),P.CmApp.ShadowApp.DropShadow.ArrowControl.zero.$().click((()=>{Xe(0,0),ci(),ht.refreshAllViews()})),e(P.CmApp.ShadowApp.DropShadow.ArrowControl.up,P.CmApp.ShadowApp.DropShadow.ArrowControl.down,Ve,We),e(P.CmApp.ShadowApp.DropShadow.ArrowControl.left,P.CmApp.ShadowApp.DropShadow.ArrowControl.right,Ue,Ge),P.CmApp.ShadowApp.DropShadow.crop_enabled.$().click((()=>(Te(!t.dropShadow.cropEnabled,!0),!1))),o(P.CmApp.ShadowApp.MirrorShadow.Opacity,eo,oo,io),o(P.CmApp.ShadowApp.MirrorShadow.Height,no,ao,lo,fo),o(P.CmApp.ShadowApp.MirrorShadow.OffsetY,uo,ho,go,fo),P.CmApp.ShadowApp.MirrorShadow.Enabled.$().click((()=>{Ze(!t.mirrorShadow.enabled,!0)})),o(P.CmApp.ShadowApp.PerspectiveShadow.ShadowOpacity,Ao,ko,Mo),o(P.CmApp.ShadowApp.PerspectiveShadow.OpacityScale,_o,Do,Po,No),o(P.CmApp.ShadowApp.PerspectiveShadow.BlurRadius,Fo,Io,Bo,No),o(P.CmApp.ShadowApp.PerspectiveShadow.BlurRadiusScale,zo,$o,Uo,No),P.CmApp.ShadowApp.PerspectiveShadow.Enabled.$().click((()=>{yo(!t.perspectiveShadow.enabled,!0)}))}}function me(){let t=qo();P.CmApp.ShadowApp.PreviewButton.$().toggle(t.length>0)}function we(t,e){return t=R.clamp(parseFloat(t.toFixed(2)),0,1),null!=B&&t!=B.strength&&(e&&L.push(),B.strength=t,Xo(),Zo(),ht.subViewPort.refreshAllViews(),e&&ci(),!0)}function Ce(){we(W().strength,!0)}function ye(){null!=B&&we(B.strength-.01,!1)}function be(){null!=B&&we(B.strength+.01,!1)}function ve(t,e){return t=R.clamp(parseFloat(t.toFixed(2)),0,1),null!=B&&t!=B.core&&(e&&L.push(),B.core=t,Xo(),Zo(),e&&ci(),ht.subViewPort.refreshAllViews(),!0)}function Ae(){ve(W().core,!0)}function ke(){null!=B&&ve(B.core-.01,!1)}function Me(){null!=B&&ve(B.core+.01,!1)}function xe(e,o){return e!=t.dropShadow.enabled&&(o&&L.push(),t.dropShadow.enabled=e,Xo(),Ye(),qe(),o&&ci(),!0)}function Te(e,o){return e!=t.dropShadow.cropEnabled&&(o&&L.push(),t.dropShadow.cropEnabled=e,e&&(G.isEmpty()&&G.fromRect(T.M.getCrop_o()),t.dropShadow.enabled||(t.dropShadow.enabled=!0),O.Grab.pick()),Xo(),Ye(),qe(),o&&ci(),!0)}function _e(e,o){let i=Math.round(R.clamp(e,0,100));return i!=t.dropShadow.opacity&&(o&&L.push(),t.dropShadow.opacity=i,Xo(),Ye(),o&&ci(),!0)}function De(e){_e(t.dropShadow.opacity+e|0,!1),ht.subViewPort.refreshAllViews()}function Pe(){const e=X();t.dropShadow.opacity!=e.opacity&&(_e(e.opacity,!0),ht.subViewPort.refreshAllViews())}function Re(){De(-1)}function Ee(){De(1)}function Fe(e,o){let i=Math.round(R.clamp(e,0,C));return i!=t.dropShadow.blurRadius&&(o&&L.push(),t.dropShadow.blurRadius=i,Xo(),Ye(),o&&(qe(),ci()),!0)}function Ie(e){Fe(t.dropShadow.blurRadius+e|0,!1)}function Be(){const e=X();t.dropShadow.blurRadius!=e.blurRadius&&Fe(e.blurRadius,!0)}function Oe(){Ie(-1)}function Le(){Ie(1)}function ze(e,o){let i=Math.round(e);return i!=t.dropShadow.offsetX&&(o&&L.push(),t.dropShadow.offsetX=i,Xo(),Ye(),o&&ci(),!0)}function $e(e){ze(t.dropShadow.offsetX+e|0,!1),ht.refreshAllViews()}function Ue(){$e(-1)}function Ge(){$e(1)}function Ne(e,o){let i=Math.round(e);return i!=t.dropShadow.offsetY&&(o&&L.push(),t.dropShadow.offsetY=i,Xo(),Ye(),o&&ci(),!0)}function He(e){Ne(t.dropShadow.offsetY+e|0,!1),ht.refreshAllViews()}function Ve(){He(-1)}function We(){He(1)}function Xe(e,o){o|=0,(e|=0)==t.dropShadow.offsetX&&o==t.dropShadow.offsetY||(t.dropShadow.offsetX=e,t.dropShadow.offsetY=o,Xo(),Ye())}function Ye(){const e=X();P.CmApp.ShadowApp.DropShadow.Enabled.$().prop("checked",t.dropShadow.enabled),P.CmApp.ShadowApp.DropShadow.CropEnabled.$().html(t.dropShadow.cropEnabled?p.s("Disable"):p.s("Enable")),P.CmApp.ShadowApp.DropShadow.controls.$().toggle(t.dropShadow.enabled),P.CmApp.ShadowApp.DropShadow.crop_enabled_display.$().html(t.dropShadow.cropEnabled?p.s("On"):p.s("Off"));let o=t.dropShadow.opacity==e.opacity;P.CmApp.ShadowApp.DropShadow.Opacity.display.$().html(t.dropShadow.opacity+"%"),P.CmApp.ShadowApp.DropShadow.Opacity.reset.$().toggleClass("disabled",o);let i=t.dropShadow.blurRadius==e.blurRadius;P.CmApp.ShadowApp.DropShadow.BlurRadius.display.$().html(t.dropShadow.blurRadius+"px"),P.CmApp.ShadowApp.DropShadow.BlurRadius.reset.$().toggleClass("disabled",i),P.CmApp.ShadowApp.DropShadow.offset_display.$().html(R.signedNumber(0|t.dropShadow.offsetX)+", "+R.signedNumber(0|t.dropShadow.offsetY)),me()}function qe(){-1!=At&&(t.dropShadow.enabled?(et||-1==At||(Q=new oe("DropShadow",null,fe,Qe),Z=At+2*y,K=kt+2*y,tt=Z*K,et=new Bt(Z,K),ot=et.context().getImageData(0,0,Z,K),it=ot.data,st=new Uint8Array(tt)),Je()):et&&(et.clearAll(),ht.refreshAllViews()))}function Je(){if(st){rt.show();let e=new Uint8ClampedArray(T.M.previewCanvasData),o={w:Z,h:K,blurRadius:t.dropShadow.blurRadius,result:e,alphas:st,polygonPoints:t.dropShadow.cropEnabled?G.getPolygonPoints():[]};try{Q.postMessage(o,[st.buffer,e.buffer])}catch(t){Q.postMessage(o)}st=null,e=null}}function Qe(e){let o=e.data;if(o.exception)throw o.exception;if(st=o.alphas,st){for(let t=0,e=3;t<tt;t++,e+=4)it[e]=st[t];et.context().putImageData(ot,0,0)}rt.hide(),ht.refreshAllViews(),o.blurRadius!=t.dropShadow.blurRadius&&Je()}function je(e=!1){if(t.mirrorShadow.enabled&&(!t.mirrorShadow.mutated||nt.isEmpty()||e)){let t=T.M.getBoundingRect_o(),e=new Rt((t.left+t.right)/2,t.bottom);e.rotateInPlace(T.M.totalRotationAngleRad_o2i(),ht.main.getImageCenter_i()),nt.clear(),nt.add(e),Xo(),ci()}}function Ze(e,o){return e!=t.mirrorShadow.enabled&&(o&&L.push(),t.mirrorShadow.enabled=e,je(),Xo(),mo(),fo(),o&&ci(),!0)}function Ke(e,o){let i=Math.round(R.clamp(e,0,100));return i!=t.mirrorShadow.opacity&&(o&&L.push(),t.mirrorShadow.opacity=i,Xo(),mo(),o&&ci(),!0)}function to(e){Ke(t.mirrorShadow.opacity+e|0,!1),ht.subViewPort.refreshAllViews()}function eo(){const e=Y();t.mirrorShadow.opacity!=e.opacity&&(Ke(e.opacity,!0),ht.subViewPort.refreshAllViews())}function oo(){to(-1)}function io(){to(1)}function so(e,o){let i=Math.round(R.clamp(e,0,b));return i!=t.mirrorShadow.height&&(o&&L.push(),t.mirrorShadow.height=i,Xo(),mo(),o&&ci(),!0)}function ro(e){so(t.mirrorShadow.height+e|0,!1)}function no(){const e=Y();t.mirrorShadow.height!=e.height&&(so(e.height,!0),fo())}function ao(){ro(-1)}function lo(){ro(1)}function co(e,o){let i=Math.round(R.clamp(e,0,v));return i!=t.mirrorShadow.offsetY&&(o&&L.push(),t.mirrorShadow.offsetY=i,Xo(),mo(),o&&ci(),!0)}function po(e){co(t.mirrorShadow.offsetY+e|0,!1)}function uo(){const e=Y();t.mirrorShadow.offsetY!=e.offsetY&&(co(e.offsetY,!0),fo())}function ho(){po(-1)}function go(){po(1)}function mo(){const e=Y();nt.updatePolyLine(),P.CmApp.ShadowApp.MirrorShadow.Enabled.$().prop("checked",t.mirrorShadow.enabled),P.CmApp.ShadowApp.MirrorShadow.controls.$().toggle(t.mirrorShadow.enabled);let o=t.mirrorShadow.opacity==e.opacity;P.CmApp.ShadowApp.MirrorShadow.Opacity.display.$().html(t.mirrorShadow.opacity+"%"),P.CmApp.ShadowApp.MirrorShadow.Opacity.reset.$().toggleClass("disabled",o);let i=t.mirrorShadow.height==e.height;P.CmApp.ShadowApp.MirrorShadow.Height.display.$().html(t.mirrorShadow.height+"px"),P.CmApp.ShadowApp.MirrorShadow.Height.reset.$().toggleClass("disabled",i);let s=t.mirrorShadow.offsetY==e.offsetY;P.CmApp.ShadowApp.MirrorShadow.OffsetY.display.$().html(t.mirrorShadow.offsetY+"px"),P.CmApp.ShadowApp.MirrorShadow.OffsetY.reset.$().toggleClass("disabled",s),me()}function fo(){-1!=At&&(t.mirrorShadow.enabled&&nt.nonEmpty()?(!function(){at||-1==At||(at=new oe("MirrorShadow",null,Se,wo)),nt.updatePolyLine();let e=T.M.getRotationCrop_o().pad(k),o=nt.getPolyLine_o(t.mirrorShadow.offsetY).bounds().padBottom(t.mirrorShadow.height);if(lt=o.dup().setHorizontal(e).snap(),!ct||ct.width()<lt.width()||ct.height()<lt.height()){let t=Math.ceil(lt.width()*A),e=Math.ceil(lt.height()*A);ct=new Bt(t,e)}}(),So()):ct&&(ct.clearAll(),ht.refreshAllViews()))}function So(){if(ct&&nt&&nt.nonEmpty())if(pt.outOfSync())pt.callFor();else{pt.incrementIndexSentAndShowIndicator();let e=nt.getPolyLine_o(t.mirrorShadow.offsetY),o={w:lt.width(),h:lt.height()},i={imageSize:{w:At,h:kt},imageCenter:{x:At/2,y:kt/2},bufferSize:o,result:new Uint8ClampedArray(T.M.previewCanvasImageDataSmart().data),bounds_o:lt,points:e.points,angleRad:T.M.totalRotationAngleRad_o2i(),height:t.mirrorShadow.height,index:pt.indexSent};try{at.postMessage(i,[i.result.buffer])}catch(t){at.postMessage(i)}}}function wo(t){let e=t.data;if(e.exception)throw e.exception;{pt.setIndexReceived(e.index);let t=ct.context().createImageData(e.bufferSize.w,e.bufferSize.h);for(let o=0;o<e.buffer.length;o++)t.data[o]=e.buffer[o];ct.clearAll(),ct.context().putImageData(t,0,0),ht.refreshAllViews(),pt.readyToResubmit()&&(pt.resetCalledFor(),So())}}function Co(e=!1){!t.perspectiveShadow.enabled||t.perspectiveShadow.mutated&&mt.isInitialized&&!e||(mt.initialize(e),Xo(),ci())}function yo(e,o){return e!=t.perspectiveShadow.enabled&&(o&&L.push(),t.perspectiveShadow.enabled=e,Co(),Xo(),Go(),No(),o&&ci(),!0)}function bo(e,o){let i=Math.round(R.clamp(e,0,100));return i!=t.perspectiveShadow.opacity&&(o&&L.push(),t.perspectiveShadow.opacity=i,Xo(),Go(),o&&ci(),!0)}function vo(e){bo(t.perspectiveShadow.opacity+e|0,!1)}function Ao(){bo(q().opacity,!0)}function ko(){vo(-1)}function Mo(){vo(1)}function xo(e,o){let i=Math.round(R.clamp(e,0,100));return i!=t.perspectiveShadow.opacityScale&&(o&&L.push(),t.perspectiveShadow.opacityScale=i,Xo(),Go(),o&&(ci(),No()),!0)}function To(e){xo(t.perspectiveShadow.opacityScale+e|0,!1),ht.subViewPort.refreshAllViews()}function _o(){xo(q().opacityScale,!0)}function Do(){To(-1)}function Po(){To(1)}function Ro(e,o){let i=Math.round(R.clamp(e,0,C));return i!=t.perspectiveShadow.blurRadius&&(o&&L.push(),t.perspectiveShadow.blurRadius=i,Xo(),Go(),o&&(ci(),No()),!0)}function Eo(e){Ro(t.perspectiveShadow.blurRadius+e|0,!1),ht.subViewPort.refreshAllViews()}function Fo(){Ro(q().blurRadius,!0)}function Io(){Eo(-1)}function Bo(){Eo(1)}function Oo(e,o){let i=Math.round(R.clamp(e,0,x));return i!=t.perspectiveShadow.blurRadiusScale&&(o&&L.push(),t.perspectiveShadow.blurRadiusScale=i,Xo(),Go(),o&&(ci(),No()),!0)}function Lo(e){Oo(t.perspectiveShadow.blurRadiusScale+e|0,!1),ht.subViewPort.refreshAllViews()}function zo(){Oo(q().blurRadiusScale,!0)}function $o(){Lo(-10)}function Uo(){Lo(10)}function Go(){const e=q();mt.updateGeometry(),P.CmApp.ShadowApp.PerspectiveShadow.Enabled.$().prop("checked",t.perspectiveShadow.enabled),P.CmApp.ShadowApp.PerspectiveShadow.controls.$().toggle(t.perspectiveShadow.enabled);let o=t.perspectiveShadow.opacity==e.opacity;P.CmApp.ShadowApp.PerspectiveShadow.ShadowOpacity.display.$().html(t.perspectiveShadow.opacity+"%"),P.CmApp.ShadowApp.PerspectiveShadow.ShadowOpacity.reset.$().toggleClass("disabled",o);let i=t.perspectiveShadow.opacityScale==e.opacityScale;P.CmApp.ShadowApp.PerspectiveShadow.OpacityScale.display.$().html(t.perspectiveShadow.opacityScale+"%"),P.CmApp.ShadowApp.PerspectiveShadow.OpacityScale.reset.$().toggleClass("disabled",i);let s=t.perspectiveShadow.blurRadius==e.blurRadius;P.CmApp.ShadowApp.PerspectiveShadow.BlurRadius.display.$().html(t.perspectiveShadow.blurRadius+"px"),P.CmApp.ShadowApp.PerspectiveShadow.BlurRadius.reset.$().toggleClass("disabled",s);let r=t.perspectiveShadow.blurRadiusScale==e.blurRadiusScale;P.CmApp.ShadowApp.PerspectiveShadow.BlurRadiusScale.display.$().html(t.perspectiveShadow.blurRadiusScale+"%"),P.CmApp.ShadowApp.PerspectiveShadow.BlurRadiusScale.reset.$().toggleClass("disabled",r),me()}function No(){t.perspectiveShadow.enabled&&mt&&mt.geometryIsValid?(mt.updateGeometry(),function(){dt||-1==At||(dt=new oe("PerspectiveShadow",[window.Globals.webWorkers.perspectiveshadow_js],null,Vo),ft=At+2*y,St=kt+2*y);let t=mt.canvasRect_o;(!wt||wt.width()<t.width()||wt.height()<t.height())&&(wt=new Bt(t.width()+100,t.height()+100))}(),Ho(),ht.subViewPort.refreshAllViews()):wt&&(wt.clearAll(),ht.subViewPort.refreshAllViews())}function Ho(){if(dt&&mt)if(yt.outOfSync())yt.callFor();else{yt.incrementIndexSentAndShowIndicator();let e=new Uint8ClampedArray(T.M.previewCanvasData),o={w_i:At,h_i:kt,angleRad_i2o:T.M.totalRotationAngleRad_i2o(),cropRect_o:mt.cropRect_o,canvasRect_o:mt.canvasRect_o,transformDstToSrc_o:mt.transformDstToSrc_o,blurRadiusStart:t.perspectiveShadow.blurRadius,blurRadiusEnd:Math.min(t.perspectiveShadow.blurRadius*t.perspectiveShadow.blurRadiusScale/100,C),opacityEnd:t.perspectiveShadow.opacityScale/100,result:e,clipPoints_i:mt.quadSrcClip_i.points,clipRect_o:mt.clipBoundsSrc_o,index:yt.indexSent};try{dt.postMessage(o,[o.result.buffer])}catch(t){dt.postMessage(o)}e=null}}function Vo(t){let e=t.data;if(e.exception)throw e.exception;if(yt.setIndexReceived(e.index),Ct.setFrom(e.dstRect),0!=Ct.width()&&0!=Ct.height()){wt.clearAll();let t=wt.context().createImageData(Ct.width(),Ct.height());for(let o=0,i=3;o<e.alphas.length;o++,i+=4)t.data[i]=e.alphas[o];wt.context().putImageData(t,0,0)}ht.refreshAllViews(),yt.readyToResubmit()&&(yt.resetCalledFor(),Ho())}function Wo(){P.CmApp.ShadowApp.Sidebar.$().hide(),P.SubappLightbox.$().modal("hide"),vt=ht.subViewPort.showing=!1,t.onhide(),T.App.subAppHidden()}function Xo(){Tt=null,_t=!0}function Yo(){vt&&(Ye(),mo(),Go(),Zo(),me())}function qo(){let e=[].concat(z);return t.dropShadow.enabled&&(e=e.concat(G.loops),e.push(U)),t.perspectiveShadow.enabled&&e.push(mt),t.mirrorShadow.enabled&&e.push(nt),e}function Jo(t){Dt=qt(l),Pt=qt(u),It=qt(h),Ot=qt(d),zt=qt(g),Nt=qt(m),Ht=qt(f),Vt=qt(S),Wt=qt(w);let e=ht.subViewPort.getMouse_i();if(O.getSelectedMode()==O.Grab){let o=[],i=qo();for(let t=0;t<i.length;t++){let s=i[t];s.hitShadow(e)&&o.push(s)}let s=null,r=null;for(let t=0;t<o.length;t++){let e=o[t];if(r=e.hitHandle(),r){s=e;break}}let n=o.filter((t=>t instanceof Jt)).reverse();return Ko(o,s,r,n.length>0?a.cast(n[0]):null,t),r||null==nt.candidatePoint?r?r.getToolMode():null:O.ShadowMirror}return ti(),null}function Qo(t){B=t,Zo()}function jo(t,e,o,i,s){t.decrease.$().toggleClass("disabled",e==i),t.increase.$().toggleClass("disabled",e==s),t.reset.$().toggleClass("disabled",e==o)}function Zo(){let t=W(),e=B,o=null!=e;P.CmApp.ShadowApp.EllipseShadow.Container.$().toggle(o),o&&(jo(P.CmApp.ShadowApp.EllipseShadow.Strength,e.strength,t.strength,0,1),jo(P.CmApp.ShadowApp.EllipseShadow.Core,e.core,t.core,0,1),P.CmApp.ShadowApp.EllipseShadow.Strength.display.$().text((100*e.strength).toFixed(0)+"%"),P.CmApp.ShadowApp.EllipseShadow.Core.display.$().text((100*e.core).toFixed(0)+"%"))}function Ko(t,e,o,i,s){V=H,H={shadows:t,shadow:e,handle:o,ellipse:i,interactionIdentifier:s}}function ti(){Ko([],null,null,null,void 0)}function ei(){N.downState=$.extend({},H),N.downState.toolMode=O.getActiveMode()}function oi(t,e,o){let i=ht.subViewPort.getMouse_i();if(ht.subViewPort.getMouseIsDown()){if(O.is(O.ShadowEllipse)){N.firstMove&&L.push();let t=new Jt(new Rt(0,0),0,0,T.M.totalRotationAngleRad_o2i(),W().strength,W().core);t.setRect(N.v0,i),z.push(t),Qo(t),Xo(),O.forceSelection(O.Grab,O.ShadowArrow,null),Ko([t],t,t.bottomRight,t,void 0),ei()}else if(N.downState&&N.downState.handle&&O.is(N.downState.handle.getToolMode())){N.firstMove&&L.push(),N.downState.handle.mouseDrag(i),Xo()}N.firstMove=!1}else if(!ht.subViewPort.getShiftIsDown()){let t=Jo(void 0);O.setTempSelect(t)}ht.subViewPort.refreshAllViews()}function ii(){N.v0=null,N.v2=null,N.downState=null,N.firstMove=!0}function si(t){return t&&(t.container instanceof E||t.container instanceof F||t.container instanceof Zt||t.container instanceof Jt&&V.shadows.indexOf(t.container)>=0||t instanceof ie&&(t.parentHandle==V.handle||t==V.handle))}function ri(t){return si(t)||t&&t.mayGrabWhenInvisible()}function ni(e,o,i){function s(t,i,s,r){e.save(),e.translate(o.o2cX(i),o.o2cY(s)),e.rotate(t),r(),e.restore()}let r=O.getSelectedMode();if(r==O.Grab||r==O.ShadowEllipse){t.mirrorShadow.enabled&&s(0,0,0,(function(){i(nt)})),t.perspectiveShadow.enabled&&s(0,0,0,(function(){i(mt)}));for(let t=0;t<z.length;t++){let e=z[t];s(e.angleRad,e.center.x,e.center.y,(function(){i(e)}))}if(t.dropShadow.enabled&&(s(0,0,0,(function(){i(U)})),t.dropShadow.cropEnabled))for(let t=0;t<G.loops.length;t++){let e=G.loops[t];s(0,0,0,(function(){i(e)}))}}}function ai(t,e){return null==t?e:t}function li(e=!0){const o=X(),i=Y(),s=q();let r=z.length>0||t.dropShadow.offsetX!=o.offsetX||t.dropShadow.offsetY!=o.offsetY||t.dropShadow.opacity!=o.opacity||t.dropShadow.blurRadius!=o.blurRadius||t.dropShadow.enabled!=o.enabled||t.dropShadow.cropEnabled!=o.cropEnabled||t.mirrorShadow.enabled!=i.enabled||t.mirrorShadow.opacity!=i.opacity||t.mirrorShadow.height!=i.height||t.mirrorShadow.offsetY!=i.offsetY||nt.nonEmpty()||t.perspectiveShadow.enabled!=s.enabled||t.perspectiveShadow.opacity!=s.opacity||t.perspectiveShadow.opacityScale!=s.opacityScale||t.perspectiveShadow.blurRadius!=s.blurRadius||t.perspectiveShadow.blurRadiusScale!=s.blurRadiusScale;r&&e&&L.push(),z.length>0&&(z.length=0),t.dropShadow.offsetX=o.offsetX,t.dropShadow.offsetY=o.offsetY,t.dropShadow.opacity=o.opacity,t.dropShadow.blurRadius=o.blurRadius,t.dropShadow.enabled=o.enabled,t.dropShadow.cropEnabled=o.cropEnabled,G.clear(),t.mirrorShadow.enabled=i.enabled,t.mirrorShadow.opacity=i.opacity,t.mirrorShadow.height=i.height,t.mirrorShadow.offsetY=i.offsetY,t.mirrorShadow.mutated=!1,nt.clear(),t.perspectiveShadow.enabled=s.enabled,t.perspectiveShadow.opacity=s.opacity,t.perspectiveShadow.opacityScale=s.opacityScale,t.perspectiveShadow.blurRadius=s.blurRadius,t.perspectiveShadow.blurRadiusScale=s.blurRadiusScale,t.perspectiveShadow.mutated=!1,mt.clear(),r&&(Xo(),ci(),Ye(),mo(),Go(),qe(),fo(),No()),t.mirrorShadow.enabled&&je(!0),t.perspectiveShadow.enabled&&Co(!0),O.Grab.pick()}function ci(){_t&&(_t=!1,T.M.sendSetShadows())}t.updateImage=function(){At=0|T.M.imageSize.w,kt=0|T.M.imageSize.h,Mt=At*kt,z.length=0,t.dropShadow=$.extend(!0,{},X()),t.mirrorShadow=$.extend(!0,{},Y()),t.perspectiveShadow=$.extend(!0,{},q()),et=null,nt=new te,mt=new Zt,U=new E,ge(),je(),Co(),qe(),fo(),No()},t.checkInitializeUi=ge,t.show=function(){O.Grab.pick(),P.subapp_sidebar.$().hide(),P.CmApp.ShadowApp.Sidebar.$().show(),P.CmApp.SubApps.tab.$().removeClass("active"),P.CmApp.ShadowApp.Tab.$().addClass("active"),R.modal(P.SubappLightbox.css()),ht.subViewPort.setViewConfigAndShow(I,t),vt=!0,Yo(),ht.refreshAllViews()},t.setEllipseShadowStrength=we,t.setEllipseShadowCore=ve,t.setDropShadowEnabled=xe,t.setDropShadowCropEnabled=Te,t.setDropShadowOpacity=_e,t.dropShadowOpacityReset=Pe,t.dropShadowOpacityDecrement=Re,t.dropShadowOpacityIncrement=Ee,t.setDropShadowBlurRadius=Fe,t.dropShadowBlurRadiusReset=Be,t.dropShadowBlurRadiusDecrement=Oe,t.dropShadowBlurRadiusIncrement=Le,t.setDropShadowOffsetX=ze,t.dropShadowOffsetXReset=function(){const e=X();t.dropShadow.offsetX!=e.offsetX&&ze(e.offsetX,!0)},t.dropShadowOffsetXDecrement=Ue,t.dropShadowOffsetXIncrement=Ge,t.setDropShadowOffsetY=Ne,t.dropShadowOffsetYReset=function(){const e=X();t.dropShadow.offsetY!=e.offsetY&&Ne(e.offsetY,!0)},t.dropShadowOffsetYDecrement=Ve,t.dropShadowOffsetYIncrement=We,t.setDropShadowOffset=Xe,t.dropShadowOffsetReset=function(){const e=X();t.dropShadow.offsetX==e.offsetX&&t.dropShadow.offsetY==e.offsetY||(L.push(),Xe(e.offsetX,e.offsetY),ci())},t.updateDropShadowCanvas=qe,t.initializeMirrorShadow=je,t.setMirrorShadowEnabled=Ze,t.setMirrorShadowOpacity=Ke,t.mirrorShadowOpacityReset=eo,t.mirrorShadowOpacityDecrement=oo,t.mirrorShadowOpacityIncrement=io,t.setMirrorShadowHeight=so,t.mirrorShadowHeightReset=no,t.mirrorShadowHeightDecrement=ao,t.mirrorShadowHeightIncrement=lo,t.setMirrorShadowOffsetY=co,t.mirrorShadowOffsetYReset=uo,t.mirrorShadowOffsetYDecrement=ho,t.mirrorShadowOffsetYIncrement=go,t.updateMirrorShadowCanvas=fo,t.initializePerspectiveShadow=Co,t.setPerspectiveShadowEnabled=yo,t.setPerspectiveShadowOpacity=bo,t.perspectiveShadowOpacityReset=Ao,t.perspectiveShadowOpacityDecrement=ko,t.perspectiveShadowOpacityIncrement=Mo,t.setPerspectiveShadowOpacityScale=xo,t.perspectiveShadowOpacityScaleReset=_o,t.perspectiveShadowOpacityScaleDecrement=Do,t.perspectiveShadowOpacityScaleIncrement=Po,t.setPerspectiveShadowBlurRadius=Ro,t.perspectiveShadowBlurRadiusReset=Fo,t.perspectiveShadowBlurRadiusDecrement=Io,t.perspectiveShadowBlurRadiusIncrement=Bo,t.setPerspectiveShadowBlurRadiusScale=Oo,t.perspectiveShadowBlurRadiusScaleReset=zo,t.perspectiveShadowBlurRadiusScaleDecrement=$o,t.perspectiveShadowBlurRadiusScaleIncrement=Uo,t.updatePerspectiveShadowCanvas=No,t.hide=Wo,t.keyDownHandler=function(t){if(t.ctrlKey||t.altKey||t.metaKey)return!1;switch(t.keyCode){case 27:if(gt.hide())break;Wo();break;case 69:O.select(O.ShadowEllipse)}return!0},t.keyUpHandler=function(t){return!(t.ctrlKey||t.altKey||t.metaKey)&&(t.keyCode,!0)},t.updateDisplay=Yo,t.mouseDownHandler=function(e){let o=ht.subViewPort.getMouse_i();if(ii(),O.isNot(O.Grab)&&0==e)if(N.v0=o,ei(),N.downState&&N.downState.handle)N.downState.handle.mouseDown(o);else if(null!=nt.candidatePoint){let e=nt.add(o);t.mirrorShadow.mutated=!0,N.downState.handle=e,N.downState.toolMode=O.ShadowArrow,O.forceSelection(O.Grab,O.ShadowArrow,null),nt.candidatePoint=null,H.handle=e,e.mouseDown(o)}O.is(O.Grab)&&Qo(H.ellipse)},t.mouseMoveHandler=oi,t.mouseUpHandler=function(t){let e=ht.subViewPort.getMouse_i();N.downState&&N.downState.handle instanceof re&&qe(),N.downState&&N.downState.handle instanceof ee&&fo(),N.downState&&N.downState.handle instanceof Kt&&No(),N.downState&&N.downState.handle&&N.downState.handle.mouseUp(e),ii(),ci()},t.mouseDoubleClickHandler=function(t){},t.touchEndHandler=function(){O.setTempSelect(Jo(void 0))},t.mouseWheelHandler=function(t){oi(t.pageX,t.pageY,t.button)},t.pointerInteraction=function(e){let o=ht.subViewPort.getMouse_i();switch(e.type){case ut.InteractionType.CanvasLeave:O.releaseTempSelect();break;case ut.InteractionType.Hover:if(!ht.subViewPort.getShiftIsDown()){let t=Jo(e.interactionIdentifier);O.setTempSelect(t),e.isTouch&&O.is(O.Grab)&&Qo(H.ellipse)}ht.subViewPort.refreshAllViews();break;case ut.InteractionType.Tap:si(H.handle)&&(H.handle.mouseDown(o),H.handle.mouseUp(o));break;case ut.InteractionType.ActionStart:if(ii(),O.isNot(O.Grab))if(N.v0=o,ri(H.handle))ei(),N.downState&&N.downState.handle&&N.downState.handle.mouseDown(o);else if(null!=nt.candidatePoint){ei();let e=nt.add(o);t.mirrorShadow.mutated=!0,N.downState.handle=e,N.downState.toolMode=O.ShadowArrow,O.forceSelection(O.Grab,O.ShadowArrow,null),nt.candidatePoint=null,H.handle=e,e.mouseDown(o)}O.is(O.Grab)&&Qo(H.ellipse);break;case ut.InteractionType.ActionMove:if(O.is(O.ShadowEllipse)){N.firstMove&&L.push();let t=new Jt(new Rt(0,0),0,0,T.M.totalRotationAngleRad_o2i(),W().strength,W().core);t.setRect(N.v0,o),z.push(t),Qo(t),Xo(),O.forceSelection(O.Grab,O.ShadowArrow,null),Ko([t],t,t.bottomRight,t,e.interactionIdentifier),ei()}else if(N.downState&&N.downState.handle&&O.is(N.downState.handle.getToolMode())){N.firstMove&&L.push(),N.downState.handle.mouseDrag(o),Xo()}N.firstMove=!1,ht.subViewPort.refreshAllViews();break;case ut.InteractionType.ActionEnd:N.downState&&N.downState.handle instanceof re&&qe(),N.downState&&N.downState.handle instanceof ee&&fo(),N.downState&&N.downState.handle instanceof Kt&&No(),N.downState&&N.downState.handle&&ri(N.downState.handle)&&(Jo(e.interactionIdentifier),N.downState.handle.mouseUp(o)),ii(),ci();break;case ut.InteractionType.PanZoom:ti()}},t.drawUnder_c=function(e,o,i,s){t.mirrorShadow.enabled&&ct&&lt&&pt.inSync()&&s(ct,t.mirrorShadow.opacity/100,lt.left,lt.top),mt&&t.perspectiveShadow.enabled&&s(wt,t.perspectiveShadow.opacity/100,Ct.left,Ct.top)},t.drawOver_c=function(t,e){},t.drawUnder_i=function(e,o,i,s){ni(o,i,(function(t){t.drawShadow(o,i)})),t.dropShadow.enabled&&s(et,t.dropShadow.opacity/100,t.dropShadow.offsetX-y,t.dropShadow.offsetY-y)},t.drawOver_i=function(t,e){xt||ni(e,ht.subViewPort,(function(t){t.drawControls(e)}))},t.encode=function(){if(null!=Tt)return Tt;let e=[];for(let t=0;t<z.length;t++)e[t]=z[t].encode();let o=G.encode();return Tt={ellipses:e,dropShadow:{offsetX:t.dropShadow.offsetX,offsetY:t.dropShadow.offsetY,opacity:0|t.dropShadow.opacity,blurRadius:0|t.dropShadow.blurRadius,enabled:t.dropShadow.enabled,cropEnabled:t.dropShadow.cropEnabled,dropShadowClipPolygon:o},mirrorShadow:{enabled:t.mirrorShadow.enabled,opacity:t.mirrorShadow.opacity,height:t.mirrorShadow.height,offsetY:t.mirrorShadow.offsetY,mutated:t.mirrorShadow.mutated,points:nt.encode()},perspectiveShadow:{enabled:t.perspectiveShadow.enabled,opacity:t.perspectiveShadow.opacity,opacityScale:t.perspectiveShadow.opacityScale,blurRadius:t.perspectiveShadow.blurRadius,blurRadiusScale:t.perspectiveShadow.blurRadiusScale,mutated:t.perspectiveShadow.mutated,geometry:mt.encode()}},Tt},t.decode=function(e){const o=X(),i=Y(),s=q();Tt=e,z.length=0;try{if(e){if(e.ellipses){for(let t=0;t<e.ellipses.length;t++){let o=e.ellipses[t];z.push(new Jt(new Rt(o.centerX_i,o.centerY_i),o.radiusX_i,o.radiusY_i,o.angleRad,o.strength,o.core))}Qo(null),Zo()}if(e.dropShadow){let i=e.dropShadow,s=t.dropShadow.blurRadius,r=t.dropShadow.cropEnabled;t.dropShadow.offsetX=ai(i.offsetX,o.offsetX),t.dropShadow.offsetY=ai(i.offsetY,o.offsetY),t.dropShadow.opacity=ai(i.opacity,o.opacity),t.dropShadow.blurRadius=ai(i.blurRadius,o.blurRadius),t.dropShadow.enabled=ai(i.enabled,o.enabled),t.dropShadow.cropEnabled=ai(i.cropEnabled,o.cropEnabled),i.dropShadowClipPolygon&&G.decode(i.dropShadowClipPolygon),Ye(),s==i.blurRadius&&r==i.cropEnabled||qe()}if(e.mirrorShadow){let o=e.mirrorShadow;t.mirrorShadow.enabled=ai(o.enabled,i.enabled),t.mirrorShadow.opacity=ai(o.opacity,i.opacity),t.mirrorShadow.height=ai(o.height,i.height),t.mirrorShadow.offsetY=ai(o.offsetY,i.offsetY),t.mirrorShadow.mutated=ai(o.mutated,t.mirrorShadow.enabled),nt.decode(o.points)}if(mo(),fo(),e.perspectiveShadow){let o=e.perspectiveShadow;t.perspectiveShadow.enabled=ai(o.enabled,s.enabled),t.perspectiveShadow.opacity=ai(o.opacity,s.opacity),t.perspectiveShadow.opacityScale=ai(o.opacityScale,s.opacityScale),t.perspectiveShadow.blurRadius=ai(o.blurRadius,s.blurRadius),t.perspectiveShadow.blurRadiusScale=ai(o.blurRadiusScale,s.blurRadiusScale),t.perspectiveShadow.mutated=ai(o.mutated,t.perspectiveShadow.enabled),mt.decode(o.geometry)}Go(),No()}}catch(t){}ti()},t.clear=li}(dt||(dt={})),function(t){T.StickySettings=t;var e=!1;function o(t){return'<div class="background-color-swatch-container"><span class="background-color-swatch swatch popover-button-label checker-svg" style="position:absolute;"></span><span class="background-color-swatch swatch popover-button-label" id="background-color-current-swatch" style="position: relative; background-color: '+t+';"></span></div>'}t.backgroundSwatch=o;class i{constructor(t,e,o=0,i,s=[],r=!1,n=0){this.key=t,this.css=e,this.format=o,this.setter=i,this.translateEnum=r,this.settingsContainer=n,this.cachedCurrent=null,this.cachedSticky=null,this.cachedFactory=null,this.currentEqualSticky=!1,this.currentEqualFactory=!1,this.currentEqualDefault=!1,this.stickyEqualFactory=!1,this.defaultEqualFactory=!1,this.hash=Yt.from(s)}main(){switch(this.settingsContainer){case 0:return lt.settings;case 1:return dt.getSelectedEllipseShadow();case 2:return dt.dropShadow;case 3:return dt.mirrorShadow;case 4:return dt.perspectiveShadow}}consolidated(t){switch(this.settingsContainer){case 0:return t;case 1:return t.ellipseShadow;case 2:return t.dropShadow;case 3:return t.mirrorShadow;case 4:return t.perspectiveShadow}}default(){return this.consolidated(lt.defaultSettings)}sticky(){return this.consolidated(lt.stickySettings)}factory(){return this.consolidated(D.FactoryDefaults)}display(t){return null==t||null==t?9==this.format||8==this.format?p.s("Unchanged"):10==this.format?this.displayInner(t):"":this.displayInner(t)}displayInner(t){switch(this.format){case 0:default:return""+t;case 1:return t+"px";case 2:return t+" megapixels";case 12:return t+" DPI";case 3:return t?p.s("On"):p.s("Off");case 4:return t?p.s("Smart"):p.s("Fixed");case 11:return(100*a.cast(t)).toFixed(0)+"%";case 5:return t+"%";case 6:return parseInt(""+t)/10+"%";case 7:let s=this.hash.getOrElse(t,"");return this.translateEnum&&(s=p.s(s)),s;case 8:var e=a.cast(t);return R.toFixed(e.w,3)+":"+R.toFixed(e.h,3);case 9:var i=a.cast(t);return i.w.toFixed(0)+" x "+i.h.toFixed(0)+"px";case 10:return o(t?t.toString():D.TransparentColor)}}getCurrentDisplay(){return this.display(this.getCurrent())}getDefaultDisplay(){return this.display(this.getDefault())}getDisplay(t){return t?this.getDefaultDisplay():this.getCurrentDisplay()}getSummaryEnabledDisplay(t){const e=this.getCurrent(),o=this.getDefault(),i=e?p.s("{0} enabled",t):p.s("{0} disabled",t);return e!=o?`<b>${i}</b>`:i}getSummaryDisplay(t=""){const e=this.getDisplay(!1).toLowerCase(),o=this.getDisplay(!0).toLowerCase(),i=0==t.length?e:p.s("{0} "+t,e);return e!=o?`<b>${i}</b>`:i}getFrom(t){return a.get(t,this.key)}getCurrent(){return this.getFrom(this.main())}getDefault(){return this.getFrom(this.default())}getSticky(){return this.getFrom(this.sticky())}getFactory(){return this.getFrom(this.factory())}setIn(t,e){a.set(t,this.key,e)}setCurrent(t,e){return t!=this.getCurrent()&&(this.setCurrentInner(t,e),w(),!0)}setCurrentInner(t,e){null!=this.setter&&this.setter(t,e)}setStickyFromCurrent(t){this.setSticky(this.getCurrent(),t)}setSticky(t,e){null!=t&&this.getFactory()==t?this.clearSticky(e):(this.setIn(this.sticky(),t),f(e)),w()}clearSticky(t){this.setSticky(void 0,t)}setCurrentAndStickyToFactory(t){this.setCurrent(this.getFactory(),t),this.clearSticky(t)}setCurrentAndStickyTo(t,e){this.setCurrent(t,e),this.setSticky(t,e)}}class s{constructor(t,e){this.css=t,this.children=e}setStickyToCurrent(){S=!0;for(var t=0;t<this.children.length;t++){var e=this.children[t];e.setSticky(e.getCurrent(),!1)}S=!1,f(!0)}setCurrentToDefault(){S=!0,L.push();for(var t=0;t<this.children.length;t++){var e=this.children[t];e.setCurrent(e.getDefault(),!1)}S=!1,f(!0),lt.sendSetGlobal(),lt.sendSetShadows()}setCurrentAndStickyToFactory(){S=!0,L.push();for(var t=0;t<this.children.length;t++){var e=this.children[t];e.clearSticky(!1),e.setCurrent(e.getDefault(),!1)}S=!1,f(!0),lt.sendSetGlobal(),lt.sendSetShadows()}}class r extends i{constructor(){super("autoLevels",P.Settings.Colors.AutoLevels,3,null)}getCurrent(){return!0}getSticky(){let t=super.getSticky();return null==t?this.getFactory():t}}let n,l;!function(t){let e,o,s,n,a,l;t.BrushSize=new i("brushSize",P.Settings.BrushSize,1,lt.setBrushSize),t.MaxNumMegapixels=new i("maxNumMegapixels",P.Settings.MaxNumMegapixels,2,lt.setMaxNumMegapixels),t.BackgroundColor=new i("backgroundColor",P.Settings.BackgroundColor,10,lt.setBackgroundColor),function(t){t.AutoLevels=new r,t.OutputColorSpace=new i("outputColorSpace",P.Settings.Colors.ColorSpace,7,lt.setOutputColorSpace,[[D.ColorSpaceSrgb,"sRGB"],[D.ColorSpaceAdobeRgb,"Adobe RGB (1998)"],[D.ColorSpaceAppleRgb,"Apple RGB"],[D.ColorSpaceColorMatchRgb,"ColorMatch RGB"]])}(e=t.Colors||(t.Colors={})),function(t){t.JpegQuality=new i("jpegQuality",P.Settings.ExportOptions.JpegQuality,0,lt.setJpegQuality),t.OpaqueFileFormat=new i("opaqueFileFormat",P.Settings.ExportOptions.OpaqueFileFormat,7,lt.setOpaqueFileFormat,[[D.OpaqueFileFormatJpeg,"JPEG"],[D.OpaqueFileFormatPng,"PNG"]]),t.PngMode=new i("pngMode",P.Settings.ExportOptions.PngMode,7,lt.setPngMode,[[D.PngModeNone,"None"],[D.PngModeLossless,"Lossless"],[D.PngModeLossy,"Lossy"]],!0),t.JpegMode=new i("jpegMode",P.Settings.ExportOptions.JpegMode,7,lt.setJpegMode,[[D.JpegModeNone,"None"],[D.JpegModeMoz,"Enabled"]],!0)}(o=t.ExportOptions||(t.ExportOptions={})),function(t){t.Mode=new i("cropMode",P.Settings.Crop.Mode,7,lt.setCropMode,[[D.CropUnconstrained,"Unconstrained"],[D.CropLockedAspectRatio,"Aspect Ratio"],[D.CropTargetSize,"Target Size"]],!0),t.AspectRatio=new i("cropAspectRatio",P.Settings.Crop.AspectRatio,8,lt.setCropAspectRatio),t.TargetSize=new i("cropTargetSize",P.Settings.Crop.TargetSize,9,lt.setCropTargetSize),t.AllowEnlarging=new i("cropAllowEnlarging",P.Settings.Crop.AllowEnlarging,3,lt.setCropAllowEnlarging),t.FitToResult=new i("cropFitToResult",P.Settings.Crop.FitToResult,3,lt.setCropFitToResult),t.PaddingMils=new i("cropPaddingMils",P.Settings.Crop.PaddingMils,6,lt.setCropPadding),t.PaddingPixels=new i("cropPaddingPixels",P.Settings.Crop.PaddingPixels,1,lt.setCropPaddingPixels),t.MarginUnits=new i("cropMarginUnits",P.Settings.Crop.MarginUnits,7,lt.setCropMarginUnits,[[D.CropMarginPixels,"Pixels"],[D.CropMarginPercent,"Percent"]],!0),t.ObjectSize=new i("cropObjectSize",P.Settings.Crop.ObjectSize,7,lt.setCropObjectSize,[[D.CropSizeLarge,"Large"],[D.CropSizeMedium,"Medium"],[D.CropSizeSmall,"Small"]],!0),t.VerticalAlignment=new i("cropVerticalAlignment",P.Settings.Crop.VerticalAlignment,7,lt.setCropVerticalAlignment,[[D.CropAlignmentTop,"Top"],[D.CropAlignmentMiddle,"Middle"],[D.CropAlignmentBottom,"Bottom"]],!0),t.Shadows=new i("cropShadows",P.Settings.Crop.Shadows,7,lt.setCropShadows,[[D.CropShadowsIgnore,"Ignore"],[D.CropShadowsPad,"Pad"],[D.CropShadowsTight,"Tight"]],!0),t.OutputDpi=new i("outputDpi",P.Settings.Crop.Dpi,12,lt.setOutputDpi)}(s=t.Crop||(t.Crop={})),function(t){t.BlurLevel=new i("globalBlurLevel",P.Settings.Edge.BlurLevel,1,lt.setGlobalBlurLevel),t.SmoothingLevel=new i("globalSmoothingLevel",P.Settings.Edge.SmoothingLevel,0,lt.setGlobalSmoothingLevel),t.Offset=new i("globalOffset",P.Settings.Edge.Offset,1,lt.setGlobalOffset),t.UseCornerDetection=new i("useCornerDetection",P.Settings.Edge.UseCornerDetection,3,lt.setUseCornerDetection),t.BlurMode=new i("blurMode",P.Settings.Edge.BlurMode,7,lt.setBlurMode,[[D.BlurModeFixed,"Fixed"],[D.BlurModeAuto,"Auto"],[D.BlurModeLocal,"Local"]],!0),t.UseLocalSmoothing=new i("useLocalSmoothing",P.Settings.Edge.UseLocalSmoothing,4,lt.setUseLocalSmoothing)}(n=t.Edge||(t.Edge={})),function(t){let e,o,s,r;!function(t){t.Strength=new i("strength",P.Settings.Shadows.Ellipse.Strength,11,dt.setEllipseShadowStrength,[],!1,1),t.Core=new i("core",P.Settings.Shadows.Ellipse.Core,11,dt.setEllipseShadowCore,[],!1,1)}(e=t.Ellipse||(t.Ellipse={})),function(t){t.Enabled=new i("enabled",P.Settings.Shadows.Drop.Enabled,3,dt.setDropShadowEnabled,[],!1,2),t.CropEnabled=new i("cropEnabled",P.Settings.Shadows.Drop.CropEnabled,3,dt.setDropShadowCropEnabled,[],!1,2),t.Opacity=new i("opacity",P.Settings.Shadows.Drop.Opacity,5,dt.setDropShadowOpacity,[],!1,2),t.BlurRadius=new i("blurRadius",P.Settings.Shadows.Drop.BlurRadius,1,dt.setDropShadowBlurRadius,[],!1,2),t.OffsetX=new i("offsetX",P.Settings.Shadows.Drop.OffsetX,1,dt.setDropShadowOffsetX,[],!1,2),t.OffsetY=new i("offsetY",P.Settings.Shadows.Drop.OffsetY,1,dt.setDropShadowOffsetY,[],!1,2)}(o=t.Drop||(t.Drop={})),function(t){t.Enabled=new i("enabled",P.Settings.Shadows.Mirror.Enabled,3,dt.setMirrorShadowEnabled,[],!1,3),t.Opacity=new i("opacity",P.Settings.Shadows.Mirror.Opacity,5,dt.setMirrorShadowOpacity,[],!1,3),t.Height=new i("height",P.Settings.Shadows.Mirror.Height,1,dt.setMirrorShadowHeight,[],!1,3),t.OffsetY=new i("offsetY",P.Settings.Shadows.Mirror.OffsetY,1,dt.setMirrorShadowOffsetY,[],!1,3)}(s=t.Mirror||(t.Mirror={})),function(t){t.Enabled=new i("enabled",P.Settings.Shadows.Perspective.Enabled,3,dt.setPerspectiveShadowEnabled,[],!1,4),t.Opacity=new i("opacity",P.Settings.Shadows.Perspective.Opacity,5,dt.setPerspectiveShadowOpacity,[],!1,4),t.OpacityScale=new i("opacityScale",P.Settings.Shadows.Perspective.OpacityScale,5,dt.setPerspectiveShadowOpacityScale,[],!1,4),t.BlurRadius=new i("blurRadius",P.Settings.Shadows.Perspective.BlurRadius,1,dt.setPerspectiveShadowBlurRadius,[],!1,4),t.BlurRadiusScale=new i("blurRadiusScale",P.Settings.Shadows.Perspective.BlurRadiusScale,5,dt.setPerspectiveShadowBlurRadiusScale,[],!1,4)}(r=t.Perspective||(t.Perspective={}))}(a=t.Shadows||(t.Shadows={})),function(e){e.set=function(){t.BackgroundColor.setCurrentAndStickyTo("rgba(255,255,255,1.000000)",!1),s.FitToResult.setCurrentAndStickyTo(!0,!1),s.MarginUnits.setCurrentAndStickyTo(D.CropMarginPercent,!1),s.PaddingMils.setCurrentAndStickyTo(50,!1),s.ObjectSize.setCurrentAndStickyTo(D.CropSizeLarge,!1),f(!0),lt.sendSetGlobal(),ht.main.animateZoomToFit()},e.revert=function(){t.BackgroundColor.setCurrentAndStickyToFactory(!1),s.FitToResult.setCurrentAndStickyToFactory(!1),lt.setCrop_o(lt.defaultSettings.cropRect_o,!1),f(!0),lt.sendSetGlobal(),ht.main.animateZoomToFit()}}(l=t.Ecommerce||(t.Ecommerce={}))}(n=t.Settings||(t.Settings={})),function(t){let e;t.BrushSize=new s(P.SettingsGroups.BrushSize,[n.BrushSize]),t.MaxNumMegapixels=new s(P.SettingsGroups.MaxNumMegapixels,[n.MaxNumMegapixels]),t.BackgroundColor=new s(P.SettingsGroups.BackgroundColor,[n.BackgroundColor]),t.CropMode=new s(P.SettingsGroups.Crop.Mode,[n.Crop.Mode,n.Crop.AspectRatio,n.Crop.TargetSize,n.Crop.AllowEnlarging]),t.CropFitToResult=new s(P.SettingsGroups.Crop.FitToResult,[n.Crop.FitToResult,n.Crop.PaddingMils,n.Crop.PaddingPixels,n.Crop.MarginUnits,n.Crop.ObjectSize,n.Crop.VerticalAlignment,n.Crop.Shadows]),t.OutputDpi=new s(P.SettingsGroups.Crop.Dpi,[n.Crop.OutputDpi]),t.Colors=new s(P.SettingsGroups.Colors.AutoLevels,[n.Colors.AutoLevels]),t.OutputColorSpace=new s(P.SettingsGroups.Colors.ColorSpace,[n.Colors.OutputColorSpace]),t.JpegQuality=new s(P.SettingsGroups.ExportOptions.JpegQuality,[n.ExportOptions.JpegQuality]),t.OpaqueFileFormat=new s(P.SettingsGroups.ExportOptions.OpaqueFileFormat,[n.ExportOptions.OpaqueFileFormat]),t.PngMode=new s(P.SettingsGroups.ExportOptions.PngMode,[n.ExportOptions.PngMode]),t.JpegMode=new s(P.SettingsGroups.ExportOptions.JpegMode,[n.ExportOptions.JpegMode]),t.Edges=new s(P.SettingsGroups.Edges,[n.Edge.BlurLevel,n.Edge.SmoothingLevel,n.Edge.Offset,n.Edge.UseCornerDetection,n.Edge.BlurMode,n.Edge.UseLocalSmoothing]),function(t){t.Ellipse=new s(P.SettingsGroups.Shadows.Ellipse,[n.Shadows.Ellipse.Strength,n.Shadows.Ellipse.Core]),t.Drop=new s(P.SettingsGroups.Shadows.Drop,[n.Shadows.Drop.Enabled,n.Shadows.Drop.CropEnabled,n.Shadows.Drop.Opacity,n.Shadows.Drop.BlurRadius,n.Shadows.Drop.OffsetX,n.Shadows.Drop.OffsetY]),t.Mirror=new s(P.SettingsGroups.Shadows.Mirror,[n.Shadows.Mirror.Enabled,n.Shadows.Mirror.Opacity,n.Shadows.Mirror.Height,n.Shadows.Mirror.OffsetY]),t.Perspective=new s(P.SettingsGroups.Shadows.Perspective,[n.Shadows.Perspective.Enabled,n.Shadows.Perspective.Opacity,n.Shadows.Perspective.OpacityScale,n.Shadows.Perspective.BlurRadius,n.Shadows.Perspective.BlurRadiusScale])}(e=t.Shadows||(t.Shadows={})),t.List=[t.BrushSize,t.MaxNumMegapixels,t.BackgroundColor,t.CropMode,t.CropFitToResult,t.OutputDpi,t.JpegQuality,t.OpaqueFileFormat,t.PngMode,t.JpegMode,t.Colors,t.OutputColorSpace,t.Edges,e.Ellipse,e.Drop,e.Mirror,e.Perspective];var o=[];t.List.forEach((t=>o=o.concat(t.children))),t.All=new s(P.SettingsGroups.All,o),t.List.push(t.All)}(l=t.Groups||(t.Groups={}));const c=[];for(var u=0;u<l.All.children.length;u++)c.push(l.All.children[u]);function h(){if(!e){P.PreferencesDialog.DefaultSettingsTab.$().on("show.bs.tab",w);for(var t=0;t<l.List.length;t++)g(l.List[t]);for(t=0;t<c.length;t++)m(c[t]);w(),e=!0}}function d(t,e){var o=t.$(),i=o.parent();o.click((()=>{i.hasClass("disabled")||e()}))}function g(t){d(t.css.setStickyToCurrent,(()=>t.setStickyToCurrent())),d(t.css.setCurrentToDefault,(()=>t.setCurrentToDefault())),d(t.css.setCurrentAndStickyToFactory,(()=>t.setCurrentAndStickyToFactory())),t.css.button.$().click((()=>{w()})),t.css.button.$().hover((()=>{t.css.outline.$().addClass(P.sticky_outline_active.name())}),(()=>{t.css.outline.$().removeClass(P.sticky_outline_active.name())})),lt.hasUser()||(t.css.setCurrentAndStickyToFactory.$().toggleClass("disabled",!0),t.css.setCurrentToDefault.$().toggleClass("disabled",!0),t.css.setStickyToCurrent.$().toggleClass("disabled",!0))}function m(t){t.css.setStickyToCurrent.$().click((()=>t.setSticky(t.getCurrent(),!0))),t.css.setCurrentToDefault.$().click((()=>t.setCurrent(t.getDefault(),!0))),t.css.setCurrentAndStickyToFactory.$().click((()=>t.setCurrentAndStickyToFactory(!0)))}function f(t){lt.hasUser()&&lt.setStickySettings($.extend({},lt.stickySettings),t),t&&w()}t.ensureInitialized=h,t.commitSticky=f;var S=!1;function w(){if(S)return;var t=!1,e=!1;const o=!lt.hasUser();for(var i=0;i<c.length;i++){let l=c[i];var s=l.getCurrent(),r=l.getSticky(),n=l.getDefault(),a=l.getFactory(),p=l.display(s),u=l.display(a),h=l.display(r),d=l.display(n);l.currentEqualFactory=p==u,l.currentEqualSticky=p==h,l.stickyEqualFactory=h==u,l.defaultEqualFactory=d==u,l.currentEqualDefault=p==d,l.cachedCurrent!=p&&l.css.displayCurrent.$().html(p),l.cachedSticky!=h&&l.css.displayDefault.$().html(d),l.cachedFactory!=u&&l.css.displayFactory.$().html(u),l.cachedCurrent=p,l.cachedSticky=h,l.cachedFactory=u;var g=l.currentEqualDefault||o,m=l.currentEqualFactory&&l.defaultEqualFactory||o;t=t||!g,e=e||!m,l.css.setStickyToCurrent.$().toggleClass("disabled",g),l.css.setCurrentToDefault.$().toggleClass("disabled",g),l.css.displayCurrent.$().toggleClass("disabled",g),"autoLevels"==l.key?l.css.setCurrentAndStickyToFactory.$().toggleClass("disabled",l.defaultEqualFactory||o):l.css.setCurrentAndStickyToFactory.$().toggleClass("disabled",m),l.css.displayFactory.$().toggleClass("disabled",m)}for(i=0;i<l.List.length;i++){var f=l.List[i];if(f==l.All)f.css.setCurrentAndStickyToFactory.$().parent().toggleClass("disabled",o);else{for(var w=!0,C=!0,y=!0,b=!0,v=!0,A=!0,k=0;k<f.children.length;k++){let t=f.children[k];w=w&&t.currentEqualFactory,C=C&&t.currentEqualSticky,y=y&&t.stickyEqualFactory,b=b&&t.defaultEqualFactory,v=v&&t.currentEqualDefault,A=A&&""==t.cachedSticky}f==l.Colors?f.css.setCurrentAndStickyToFactory.$().parent().toggleClass("disabled",b||o):f.css.setCurrentAndStickyToFactory.$().parent().toggleClass("disabled",w&&b||o),f.css.setCurrentToDefault.$().parent().toggleClass("disabled",v||o),f.css.setStickyToCurrent.$().parent().toggleClass("disabled",v||o)}}}t.updateDisplay=w;var C=!1;t.isVisible=function(){return C},t.show=function(t=P.PreferencesDialog.DefaultSettingsTab){return C=!0,Z.initialize(),Q.initialize(),h(),w(),R.modal(P.StickySettingsLightbox.css(),!0),null!=t&&t.$().tab("show"),!1},t.hide=function(){return!!C&&(C=!1,P.StickySettingsLightbox.$().modal("hide"),!0)}}(gt||(gt={})),function(t){var e=!1,o=3,i=[],s=[],r=new qt,n=null,a=-1;function l(){return i.length>0||s.length>0?"Uploads still in progress - closing the page will abort them.":void 0}function c(t){var e=$(document.createElement("tr")),o=$(document.createElement("td")),i=$(document.createElement("div"));i.attr({style:"margin-bottom: 0;",class:"progress"}),o.append(i);var s=$(document.createElement("div"));s.attr({style:"width: 0;",class:"progress-bar"}),i.append(s);var r=$(document.createElement("td"));return e.append($(document.createElement("td")).text(t.name)),e.append(o),e.append(r),P.Bulk.Upload.DialogBody.$().append(e),r.attr("class","pending").text(p.s("Pending...")),{file:t,tr:e,progressContainerEl:o,progressEl:s,statusEl:r}}function u(){if(s.length>0&&i.length<o){var t=s.shift();i.push(t),function(t){function e(e){d(t,e,!0)}t.statusEl.attr("class","uploading").text(p.s("Uploading..."));var o=t.file;pt.loadImageShrinkAndThumbnail(!0,o,(e=>{d(t,e.message||p.s("Couldn't read the file"),!1)}),((o,i,s)=>{G.createUserImageSpec(o,i,e,(r=>{i=null,a<0&&(a=r.id+1),r.id<a&&(a=r.id,P.Bulk.Upload.StartClippingButton.$().attr("href",n+"?minId="+a));var l=0,c=0,u=0,h=0;function d(){var e=Math.ceil(.9*u+.1*h);t.progressEl.attr("style","width: "+e+"%;")}function m(){if(0!=l&&0!=c){var o={hasImage:l,hasThumbnail:c,hasDrawCommands:0};G.updateMetaData(r.id,r.secret,o,e,(()=>{g(t)}))}}k.uploadS3WithRetry(o,r.image,{url:window.Globals.s3_url,backupUrl:window.Globals.s3_backup_url,label:p.s("Uploading original image"),maxAge:31536e3,progress:t=>{u=t,d()},success:()=>{o=null,l=1,m()}}),k.uploadS3WithRetry(s(),r.thumbnail,{url:window.Globals.s3_url,backupUrl:window.Globals.s3_backup_url,label:p.s("Uploading thumbnail"),maxAge:31536e3,progress:t=>{h=t,d()},success:()=>{c=1,m()}})}))}),!0)}(t),u()}}function h(t){t.progressContainerEl.empty().text(p.s("Already queued, ignored")),t.statusEl.text(p.s("Duplicate")).attr("class","hair b")}function d(t,e,o){if(t.progressContainerEl.empty().text(e),o){let e="<span class='bg b'>"+p.s("Error")+"</span> <small class='i'>(<a href='#'>"+p.s("Retry")+"</a>)</small>";t.statusEl.html(e).click((()=>(t.statusEl.off("click"),t.tr.remove(),s.push(c(t.file)),u(),!1))),m(t)}else t.statusEl.text(p.s("Error")).attr("class","bg b")}function g(t){t.statusEl.text(p.s("Ok")).attr("class","fg b"),P.Bulk.Upload.StartClippingButton.$().attr("class","app_bttn app_bttn_dark app_bttn_large"),m(t)}function m(t){var e=i.indexOf(t);e>=0&&i.splice(e,1),u()}t.handleNewFiles=function(t){e||(e=!0,R.modal(P.Bulk.Upload.Dialog),$(document).off("focusin.bs.modal"),$(window).on("beforeunload",l),n=P.Bulk.Upload.StartClippingButton.$().attr("href"));for(var o=0,i=0;i<t.length;i++){var a=t[i],p=c(a),d=a.name+"_"+a.size;r.add(d)?(s.push(p),o++):h(p)}o>0&&R.gaTrack("bulk","upload",null,o),u()},t.simulateEntry=function(t,e){let o=c(t);o.statusEl.attr("class","uploading").text(p.s("Uploading...")),o.progressEl.attr("style","width: "+e+"%;"),100==e&&g(o)};let f=new Kt([new Zt(P.Bulk.Download.Mode.single,D.BulkDownloadModeSingle),new Zt(P.Bulk.Download.Mode.zip,D.BulkDownloadModeZip)]);$(document).ready((()=>{let t={};try{t=JSON.parse(window.GlobalsEx.stickySettings)}catch(t){}let e=t.bulkDownloadMode||window.GlobalsEx.defaultBulkDownloadMode||D.BulkDownloadModeSingle;f.update(e),window.bulkDownloadMode=e,E.registerRadioGroup(f,(t=>{f.update(t),window.bulkDownloadMode=t,G.modifyStickySettings(JSON.stringify({bulkDownloadMode:t}),(t=>{}),(()=>{}))}))}))}(mt||(mt={})),function(t){let e=null,o=[],i=new Set,s=new Set,r=new Set,n=null,a=null,l=null,c=!0,p=null,u=null,h=new qt,d=0;class g{constructor(t){this.elemId=t,this.other=null,this.el=document.getElementById(t),this.contentWindow=this.el.contentWindow,this.image={id:-1,secret:"unknown"},this.readyForNextImage=!0,this.wantsStep=!1,this.hasGenerated=!1,this.hasSaved=!1,this.hasGenerateError=!1,this.exitOnSave=!1}checkHandleEvent(t){if(t.source==this.contentWindow){let e=JSON.parse(t.data);switch(e.command){case D.DocumentReady:case D.Booted:m();break;case D.Skip:this.image.id>0&&(s.add(this.image.id),k(!0)),this.wantsStep=!0,this.hasGenerated=!0,this.hasGenerateError=!1,this.hasSaved=e.saved,A(),this.checkStepImageForThisIframe();break;case D.GenerateResult:this.image.id>0&&(r.add(this.image.id),k(!0)),this.wantsStep=!0,this.hasGenerated=!1,this.hasGenerateError=!1,this.hasSaved=e.saved,A();break;case D.MaybeSaved:this.hasSaved=e.saved,this.checkStepImageForThisIframe(),this.hasSaved&&this.exitOnSave&&this.doExit();break;case D.SavedAndResultReady:window.checkPostMessage(e),this.hasGenerated=e.success,this.hasSaved=e.saved,this.hasGenerateError=!e.success,this.checkStepImageForThisIframe();break;case D.SavedMaskUpdated:this.other.contentWindow.M&&this.other.contentWindow.M.savedMaskUpdated();break;case D.StickySettingsUpdated:this.other.contentWindow.M&&this.other.contentWindow.M.bulkSetStickySettings(e.settings);break;case D.Exiting:this.other.contentWindow.M&&this.other.contentWindow.M.checkSaveDrawCommands();break;case D.Exit:e.isNice&&this.other.contentWindow.M&&this.other.contentWindow.M.hasUnsavedChanges()?this.other.exitOnSave=!0:this.doExit()}return(e.error||e.command==D.Error)&&(window.checkPostMessage(e),this.wantsStep=this.hasGenerated=this.hasSaved=!1,this.readyForNextImage=!0,this.checkStepImageForThisIframe()),!0}return!1}doExit(){this.contentWindow.M.unhookBeforeunload(),this.other.contentWindow.M&&this.other.contentWindow.M.unhookBeforeunload(),window.Globals.Bulk.isApi?R():N.exit()}checkStepImageForThisIframe(){this.wantsStep&&this.hasGenerated&&this.hasSaved?(this.wantsStep=this.hasGenerated=this.hasSaved=!1,this.readyForNextImage=!0,v(!1)):this.hasGenerateError&&E()}setImage(t){t&&(this.wantsStep=!1,this.readyForNextImage=!1,this.hasGenerateError=!1,this.image=t,this.contentWindow.location.replace(this.getUrl()),this.updatImagesRemaining())}getId(){return this.image.id}getUrl(){return"/bulk/iframe/"+this.image.id+"/"+this.image.secret+"?api="+!!window.Globals.Bulk.isApi+"&useStickySettings="+!!window.Globals.Bulk.useStickySettings}updatImagesRemaining(t=!1){if(this.contentWindow&&this.contentWindow.M){let t=i.size-r.size-s.size;this.contentWindow.M.setBulkImagesRemaining(i.size,r.size,s.size,t)}}}function m(){c||n.el.contentWindow.focus()}function f(){if(window.Globals.Bulk.isApi)return;let t=0;for(let o=0;o<e.length;o++)e[o].hasImage&&t++;t<=3&&C()}function S(t){P.BulkLoadingErrorMessage.$().text(t),T("error")}function w(t){e.length;let o=0;e=e.concat(t.images).sort(((t,e)=>t.id-e.id)).filter((t=>{let e=t.id!=o;return o=t.id,e}));for(let t of e)i.add(t.id);k(!0),v(!1),T("ready")}function C(){window.Globals.Bulk.isApi||(T("loading"),o.length>0&&(G.listImagesEx(window.Globals.Bulk.State,void 0,void 0,D.ImagesPerClipBatch,o,window.Globals.Bulk.q,S,w),o=[],k()),G.listImagesEx(window.Globals.Bulk.State,d+1,void 0,D.ImagesPerClipBatch,[],window.Globals.Bulk.q,S,w))}function y(t){let e=t.originalEvent;e.origin!=window.Globals.targetOrigin&&"*"!=window.Globals.targetOrigin||n.checkHandleEvent(e)||a.checkHandleEvent(e)}function b(){for(;;){let t=e.shift();if(k(),null==t)return null;if(!h.contains(t.id)){if(t.hasImage)return t.id>d&&(d=t.id),h.add(t.id),t;o.push(t.id),k()}}}function v(t){n.readyForNextImage&&n.setImage(b()),a.readyForNextImage&&a.setImage(b()),t&&f(),E()}function A(){let t=a;a=n,n=t,M($(a.el)),f(),E()}function k(t=!1){n.updatImagesRemaining(t),a.updatImagesRemaining(t)}function M(t){t.css("z-index",0)}function x(t){t.css("z-index",1001)}function T(t){if(c){l.toggleClass("loading","loading"==t),l.toggleClass("error","error"==t);let e="ready"==t&&!a.readyForNextImage;l.toggleClass("generating",e),e?u.attr("disabled","true"):u.removeAttr("disabled")}p=t}$(document).ready((()=>{if(window.Globals.Bulk.isClip){$(window).on("message",y),e=window.Globals.Bulk.ClipImages;for(let t of e)i.add(t.id);setInterval(k,2e3),n=new g("bulk-iframe-0"),a=new g("bulk-iframe-1"),a.other=n,n.other=a,l=P.BulkStatus.$(),u=P.bulk_download_button.$(),d=window.Globals.Bulk.MinId,v(!1);let t="/bulk";window.Globals.Bulk.q&&(t+="?q="+window.Globals.Bulk.q),N.exitHref=t,$("html").addClass("html-app-mode"),P.UnpaidApiSubscription.$().modal()}}));let _=!1;function R(){_||(window.checkPostMessage({command:D.Exit}),_=!0)}function E(){let t=window.bulkDownloadMode==D.BulkDownloadModeSingle;if(P.bulk_download_button.$().toggle(!t),n.readyForNextImage&&!a.readyForNextImage&&a.hasGenerateError)A();else if(n.readyForNextImage&&a.readyForNextImage&&R(),n.readyForNextImage)M($(n.el)),c=!0,T(p),x(l),l.focus();else{let t=`/bulk/clip?state=${window.Globals.Bulk.State}&minId=${n.getId()}`;window.Globals.Bulk.q&&(t+="&q="+window.Globals.Bulk.q),history.replaceState({},"",t),x($(n.el)),c=!1,m(),setTimeout(m,100),M(l)}}window.bulkUpdateImages=C}(ft||(ft={})),function(t){let e;!function(t){t[t.Waiting=0]="Waiting",t[t.Ready=1]="Ready",t[t.Error=2]="Error",t[t.Empty=3]="Empty",t[t.Single=4]="Single"}(e||(e={})),t.simulateProgress=function(){P.Bulk.Download.Dialog.state.$().hide(),P.Bulk.Download.Dialog.Progress.$().css("width","70%"),P.Bulk.Download.Dialog.Waiting.$().show(),P.Bulk.Download.Dialog.Dialog.addClass(P.Bulk.Download.Dialog.useZip)},t.simulateReady=function(){P.Bulk.Download.Dialog.state.$().hide(),P.Bulk.Download.Dialog.Ready.$().show(),P.Bulk.Download.Dialog.Dialog.addClass(P.Bulk.Download.Dialog.useZip)};let o,i,s=!1;function r(t,r,a=s){if(!window.GlobalsEx.Bulk_isAllowed)return void alert(p.s("Please subscribe to a Bulk Clipping plan first, thanks!"));const l=window.Globals.Bulk.q,c=window.GlobalsEx.Bulk_downloadFormat;window.Globals.Bulk.MinId=t||r,s=a;const u=P.Bulk.Download.Dialog.Waiting.$(),h=P.Bulk.Download.Dialog.Empty.$(),d=P.Bulk.Download.Dialog.Progress.$(),g=P.Bulk.Download.Dialog.Ready.$(),m=P.Bulk.Download.Dialog.Error.$(),f=P.Bulk.Download.Dialog.ErrorMsg.$();let S=null;const w=P.Bulk.Download.Dialog.DownloadLink.$();it.attachToLink(w,(function(){return S?(a?"text/plain":"application/zip")+":"+S:null}));const C=P.Bulk.Download.Dialog.Single.$(),y=P.Bulk.Download.Dialog.SingleDownloadLink.$();let b=null,v=!1;function A(t){u.toggle(t==e.Waiting),g.toggle(t==e.Ready),m.toggle(t==e.Error),h.toggle(t==e.Empty),C.toggle(t==e.Single)}d.css("width","0%"),P.Bulk.Download.Dialog.Dialog.addClass(a?P.Bulk.Download.Dialog.useCsv:P.Bulk.Download.Dialog.useZip).removeClass(a?P.Bulk.Download.Dialog.useZip:P.Bulk.Download.Dialog.useCsv),A(e.Waiting),R.modal(P.Bulk.Download.Dialog.Dialog.css()),G.listImagesEx(r?"generated":"generatedButNotDownloaded",t,r,a?D.ImagesPerCsvfile:D.ImagesPerZipfile,[],l,(t=>{f.text(t),A(e.Error)}),(t=>{var s=t.images;if(0==s.length)A(e.Empty);else if(1!=s.length||a){function r(t){v||(f.text(t),A(e.Error))}function l(t){t.error?r(t.error.message):t.progress?d.css("width",t.progress+"%"):t.url?(w.attr("href",t.url),S=t.filename,P.Bulk.Download.Dialog.emailSent.$().toggle(t.emailSent),t.tsv&&(o||(o=new le(P.Bulk.Download.Dialog.CopyBtn,n)),i=t.tsv),A(e.Ready),v=!0,R.gaTrack("bulk","download",null,s.length)):t.redirectUrl?(location.href=z.redirectUrl(t.redirectUrl,t.kind,t.message),v=!0):t.empty&&(A(e.Empty),v=!0)}!function(){const t=G.getWorkerUrl("/bulk/websocket",{}),e={images:s,csv:a,format:c};b=new re({url:function(){return t},connectedToNewServer:R.empty,disconnectedFromServer:function(){return!0},newMessageFromServer:l,sendOnOpen:e,heartbeat:{millis:0,message:{command:D.StatusCheck}},label:p.s("Connect to worker"),closeReasonToMessage:function(t){switch(t){case"3":return p.s("Invalid input");case"-1":return p.s("Internal server error");default:return p.s("Timeout or worker termination")}},unableToConnectMessage:p.s("Unable to connect to the worker. Is your firewall or proxy blocking WebSockets?"),unexpectedCloseMessage:p.s("Download server closed connection prematurely."),sendFailedMessage:p.s("Failed to send message to worker. "),customOnError:function(t){return r(t),!1}})}()}else{R.gaTrack("bulk","download",null,s.length);var u=s[0];y.attr("href",z.downloadUrl(u.id,u.secret)),A(e.Single)}}))}function n(t,e){R.copyTextToClipboard(i,t,e)}$(document).ready((()=>{P.bulk_download_button_zip.$().click((()=>{r(window.Globals.Bulk.MinId,void 0,!1)})),P.bulk_download_button_csv.$().click((()=>{r(window.Globals.Bulk.MinId,void 0,!0)})),P.bulk_download_button_repeat.$().click((()=>{r(window.Globals.Bulk.MinId,void 0)}))})),window.bulkDownload=r}(St||(St={})),function(t){t.checkInit=function(){0!==P.CmApp.Help.scroll_crop.$().length&&(P.CmApp.Help.scroll_crop.$().each((function(){const t=$(this);t.css("clip",i(t,0))})),$(window).on("resize.ScrollCrop scroll.ScrollCrop",s),s())};const e=350,o=16;function i(t,e){return"rect(0px, "+(t.width()+1)+"px, "+e+"px, 0px)"}function s(){const t=$(document).scrollTop()+.7*$(window).height(),s=P.CmApp.Help.scroll_crop.$(!0);0==s.length?$(window).off(".ScrollCrop"):s.each((function(){var s=$(this);t>s.offset().top&&function(t){t.removeClass(P.CmApp.Help.scroll_crop.name());const s=Date.now(),r=t.data("scroll-crop-companion"),n=r?$(r):null;n&&n.show(),setTimeout((function r(){const a=Date.now(),l=R.clamp((a-s)/e,0,1),c=t.height()*l,p=l<1?i(t,c):"";t.css("clip",p),n&&(l<1?n.css("top",c+"px"):n.hide()),l<1&&setTimeout(r,o)}),o)}(s)}))}}(wt||(wt={})),function(t){let e;!function(t){t[t.paypal=0]="paypal",t[t.fake=1]="fake"}(e||(e={}));function o(t){let e=[];function o(t,o){e.push(encodeURIComponent(t)+"="+encodeURIComponent(o))}function i(t,e){if($.isArray(e))$.each(e,(function(e,o){i(t+"["+e+"]",o)}));else if("object"==$.type(e))for(let o in e)e.hasOwnProperty(o)&&i(t+"."+o,e[o]);else o(t,e)}o(GlobalsShared.localeQueryParameter,GlobalsShared.locale);for(let e in t)t.hasOwnProperty(e)&&i(e,t[e]);return e.join("&").replace(" ","+")}function i(t){return function(e,o,i){t({error:{message:r(e,o)}})}}function r(t,e){if(0===t.status)return p.s("Failed to connect to the server.")+"\n"+p.s("Please verify your network connection.")+"\n";{const o=t.responseText.toString().substring(0,200);return t.status<200||299<t.status?t.statusText+" ["+t.status+"]\n"+o:"parsererror"===e?p.s("Failed to parse JSON response.")+" ["+e+"]\n"+o:"timeout"===e?p.s("Request time out.")+" ["+e+"]":"abort"===e?p.s("Request aborted by the server.")+" ["+e+"]":p.s("Unknown error.")+"\n"+o}}function n(){return merchantJs.settings.host+"/payments/v0/preapprovals/"+merchantJs.settings.wud+"/"}function a(t,e){let s=n()+"payment_method?"+o(t);$.ajax(s,{dataType:"jsonp",timeout:3e4,success:function(t){e(t)},error:i(e)})}let l,c,u,h;!function(t){let s=null,r=null;function l(){s&&(r&&(clearInterval(r),r=null),s.close(),s=null)}function c(t,r,a){l(),s=window.open("","_blank"),s.document.write("<h3>Loading...</h3>");var c=n()+e[t]+"?"+o(r);$.ajax(c,{dataType:"jsonp",timeout:3e4,success:function(t){a(t)},error:i(a)})}t.handler=function(t){return function(e,o,i){c(t,e,(function(t){var e,n;!t||t.error?(l(),o(t)):(e=t.preapproval.processorToken.url,n=function(){i(),a(t.preapproval,o)},s&&(s.location.href=e,s.focus(),r=setInterval((function(){s.closed&&(clearInterval(r),r=null,n())}),100)))}))}}}(l||(l={})),function(t){t.initialize=function(){return!0},t.pay=function(t){t({error:{message:"Unavailable"}})},t.radioButton=function(){return new s("__unavailable_payment_processor__")},t.name=function(){return"unavailable"}}(c||(c={})),function(t){let e,o,i;t.initialize=function(){return"undefined"!=typeof Stripe&&(e=Stripe(merchantJs.settings.stripePublishableKey),o=e.elements({locale:GlobalsShared.locale}),i=o.create("card",{style:{base:{lineHeight:"1.429"}}}),i.mount(P.merchant.StripeCardElement.css()),i.on("change",(function(t){t&&t.error?P.merchant.StripeCardErrors.$().text(t.error.message):P.merchant.StripeCardErrors.$().text("")})),i.on("focus",(function(){P.merchant.StripeCardElement.$().addClass("focus")})),i.on("blur",(function(){P.merchant.StripeCardElement.$().removeClass("focus")})),!0)},t.pay=function(t){m(),e.createToken(i,{name:P.merchant.StripeNameElement.$().val()}).then((function(e){if(e.error)t({error:{message:e.error.message}});else{w();const o=e.token;a({processor:"stripe",processorToken:{id:o.id,card:o.card},preapprovalSpec:merchantJs.preapprovalSpec},t)}}))},t.radioButton=function(){return P.merchant.RadioStripe},t.name=function(){return"stripe"}}(u||(u={})),function(t){let e;t.initialize=function(){if("undefined"!=typeof braintree){let t=!0;return braintree.dropin.create({authorization:merchantJs.settings.braintreeTokenizationKey,container:P.merchant.BraintreeDropinContainer.css(),locale:GlobalsShared.locale.replace("-","_"),card:{cardholderName:!0},dataCollector:{kount:!0}}).then((function(t){e=t})).catch((function(e){t=!1,m(),P.merchant.PaymentError.$().text(e.message).show()})),t}return!1},t.pay=function(t){m(),e.requestPaymentMethod((function(o,i){if(o)e.clearSelectedPaymentMethod(),t({error:o});else{w();a({processor:"braintree",processorToken:i,preapprovalSpec:merchantJs.preapprovalSpec},(function(o){o.error&&e.clearSelectedPaymentMethod(),t(o)}))}}))},t.radioButton=function(){return P.merchant.RadioBraintree},t.name=function(){return"braintree"}}(h||(h={}));const d=l.handler(e.paypal),g=l.handler(e.fake);function m(){P.merchant.PaymentError.$().hide(),P.merchant.StripePaymentError.$().hide(),P.merchant.PaymentMethodFormSubmit.$().attr("disabled","disabled")}function f(){P.merchant.PaymentMethodFormSubmit.$().removeAttr("disabled")}function S(t){P.merchant.PaymentError.$().html("<p>"+t).show(),f()}function w(){P.merchant.ShowWhenMinibrowsing.$().modal("hide"),P.merchant.ShowWhenCreatingPm.$().modal("show")}function C(t){P.merchant.ShowWhenMinibrowsing.$().modal("hide"),P.merchant.ShowWhenCreatingPm.$().modal("hide"),null===t?S("Got a null response from the server"):t.error?S(t.error.message):(P.merchant.ShowWhenSubmitting.$().modal("show"),b({streamlexPaymentToken:t.paymentMethod.streamlexPaymentToken,defaultPaymentMethod:y}))}let y="stripe",b=null;$((function(){"undefined"!=typeof merchantJs&&(!function(t){b=t;let e=!1,o=!1;merchantJs.settings.braintreePrimary?merchantJs.settings.canBraintree?e=!0:merchantJs.settings.canStripe&&(o=!0):merchantJs.settings.canStripe?o=!0:merchantJs.settings.canBraintree&&(e=!0);const i=e?h:o?u:c,s=i.initialize(),r=s&&(merchantJs.settings.canBraintree||merchantJs.settings.canStripe||merchantJs.settings.canPaypal);y=i.name();const n=$("input[type=radio][name=paymentMethod]");let a=null,l=!1;n.change((function(){var t;P.merchant.CreditCardProcessorForm.$().toggle(i.radioButton().$().prop("checked")),a=$(this),l=merchantJs.needZipCode&&("paypal"==(t=a.data("processor")||a.val())||"fake"==t),P.merchant.TaxSection.$().toggle(l)})),$("#paymentMethod_"+merchantJs.defaultPaymentMethod).prop("checked",!0).change(),P.merchant.AcceptTermsWrapper.$().removeClass(P.merchant.has_error.name()),P.merchant.InitializingIndicator.$().hide(),P.merchant.SubmitSection.$().show(),P.merchant.PaymentMethodForm.$().submit((function(){y=a&&a.val()||i.name();let e=!1;if(l){let t=/^\d{5}$/,o=(""+P.merchant.TaxPostalCode.$().val()).trim();t.test(o)?(P.merchant.TaxPostalCodeFormGroup.removeClass(P.merchant.has_error),P.merchant.TaxLocationPostalCode.$().val(o)):(P.merchant.TaxPostalCodeFormGroup.addClass(P.merchant.has_error),e=!0)}if(P.merchant.AcceptTerms.$().prop("checked")?P.merchant.AcceptTermsWrapper.removeClass(P.merchant.has_error):(P.merchant.AcceptTermsWrapper.addClass(P.merchant.has_error),e=!0),e)return!1;switch(m(),y){case"stripe":u.pay(C);break;case"braintree":h.pay(C);break;case"paypal":P.merchant.ShowWhenMinibrowsing.$().modal("show"),d(merchantJs.preapprovalSpec,C,w);break;case"fake":merchantJs.settings.isTesting&&(P.merchant.ShowWhenMinibrowsing.$().modal("show"),g(merchantJs.preapprovalSpec,C,w));break;default:P.merchant.ShowWhenSubmitting.$().modal("show"),t({streamlexPaymentToken:y,defaultPaymentMethod:y})}return!1})),r?f():(m(),s||P.merchant.FailedToLoadPaymentBackendJs.$().show())}((function(t){P.merchant.StreamlexPaymentToken.$().val(t.streamlexPaymentToken),P.merchant.DefaultPaymentMethod.$().val(t.defaultPaymentMethod),P.merchant.PaymentForm.$().submit()})),$(window).on("load",(function(){(new Image).src="https://www.paypal.com/home"})))}))}(Ct||(Ct={})),function(t){t.list=function(){var t=[];function e(e,o){e||t.push(o)}function o(t,o){try{e(t(),o)}catch(t){e(!1,o)}}return o((function(){var t=document.createElement("canvas");return!(!t.getContext||!t.getContext("2d"))}),"HTML5 Canvas"),e("undefined"!=typeof WebSocket,"WebSockets"),o((function(){var t=document.createElement("div");return"draggable"in t||"ondragstart"in t&&"ondrop"in t}),"HTML5 Drag-and-Drop"),e("undefined"!=typeof URL,"window.URL Support"),e("undefined"!=typeof XMLHttpRequest,"XML Http Requests"),o((function(){return"undefined"!=typeof Uint32Array&&"undefined"!=typeof Uint8Array&&void 0!==new Uint8Array(2).set}),"Native Type Arrays"),o((function(){var t=document.createElement("canvas");t.width=1,t.height=1;var e=t.getContext("2d").getImageData(0,0,1,1).data;return new Int32Array(e.buffer).length>0}),"ImageData.data is not a Uint8ClampedArray"),e(!(!window.history||!window.history.pushState),"HTML5 History"),e("undefined"!=typeof Worker,"Web Workers"),e(!!Date.now,"Date.now()"),o((function(){return!!new Blob}),"Blob and/or Blob Constructor"),e(navigator.userAgent.indexOf("Trident/7.0;")<0&&navigator.userAgent.indexOf("rv:11.0")<0,"IE 11 not supported due to browser bugs"),t.sort(),t}}(yt||(yt={})),function(t){const e=P.Signon.Dialog.anscestorOf(new i("modal-header")),o="message.signup",s=[];let r=null;function n(t){const e=t.originalEvent,o=function(t){for(let e of s)if(e.contentWindow==t)return e;return null}(e.source);if(o){let t=parseInt(e.data);t>10&&(o.height=t+"px"),o.hasLoaded||(o.hasLoaded=!0,c())}}function a(){l($(this))}function l(t){const e=t.data("url");if(null==r||r.src!=e){r=function(t){for(let e of s)if(e.src==t)return e;return null}(e)||function(t){let e=document.createElement("iframe");return e.setAttribute("seamless","seamless"),e.frameBorder="0",e.width="100%",e.height="650px",e.style.backgroundColor="#fff",e.hasLoaded=!1,e.onload=function(t){e.hasLoaded=!0,c()},e.src=t,s.push(e),P.Signon.IframeContainer.$().prepend(e),e}(e),r.style.display="block";for(let t of s)t!=r&&(t.style.display="none")}c()}function c(){P.Signon.LoadingIndicator.$().toggle(!(r&&r.hasLoaded))}function p(){const t=$(this);l(t),P.$window.on(o,n);const i=t.data("header");return i?(P.Signon.Header.$().text(i).show(),e.$().css("border-bottom","")):(P.Signon.Header.$().hide(),e.$().css("border-bottom","none")),P.Signon.Dialog.$().modal(),!1}t.checkInit=function(){P.Signon.Dialog.$().length>0&&P.Signon.trigger.$().length>0&&(P.Signon.Dialog.$().on("hide.bs.modal",(function(){P.$window.off(o)})),P.Signon.trigger.elements().forEach((t=>{t.addEventListener("touchstart",a,{passive:!0}),t.addEventListener("mouseover",a,{passive:!0})})),P.Signon.trigger.$().click(p),P.Signon.preload.$().each(a))}}(bt||(bt={})),function(t){var e=[];function o(){for(var t=0;t<e.length;t++)e[t].update()}class i{constructor(t){this.iframe=t,this.initialized=!1,this.$iframe=$(t),this.$iframe.on("load",(()=>{this.initialize(),setTimeout((()=>{this.initialize()}),100)}))}initialize(){this.oh=this.iframe.contentDocument.body.offsetHeight,this.ow=this.iframe.contentDocument.body.offsetWidth;let t=100*this.oh/this.ow+"%";this.$iframe.parent().css({paddingBottom:t}),this.initialized=!0,this.update()}update(){if(this.initialized){let t="scale("+(this.$iframe.parent(P.TutorialScreenshots.wrapper.css()).width()/this.ow).toString()+")";this.iframe.contentWindow.document.body.style.transform=t}}}$((function(){P.TutorialScreenshots.iframe.$().each((function(){e.push(new i(this))})),e.length>0&&$(window).resize(o)}))}(vt||(vt={}));class we{constructor(t){this.$link=t,this.id=0|t.data("id"),this.$container=$("#"+this.cssId())}name(){return this.$link.data("name")}undoName(){return this.$link.data("undoname")}secret(){return this.$link.data("secret")}undeleteSecret(){return this.$link.data("undeletesecret")}cssId(){return"user_image_"+this.id}cssIdLoader(){return this.cssId()+"-loader"}$loader(){return $("#"+this.cssIdLoader())}}!function(t){let e=!1;function o(){e&&(P.UserImage.rename.$().off("click",i),P.UserImage.remove.$().off("click",s),P.UserImage.undelete.$().off("click",r)),P.UserImage.rename.$(e).click(i),P.UserImage.remove.$(e).click(s),P.UserImage.undelete.$(e).click(r),e=!0}function i(){let t=new we($(this)),e=t.undoName()||prompt(p.s("Rename image to:"),t.name());return e&&n(t,z.userImageRename(t.id,window.Globals.Bulk.isUpload),{name:e}),!1}function s(){let t=new we($(this));return n(t,z.userImageRemove(t.id,window.Globals.Bulk.isUpload)),!1}function r(){let t=new we($(this));return n(t,z.userImageUndelete(t.id,t.secret(),t.undeleteSecret(),window.Globals.Bulk.isUpload)),!1}function n(t,e,i={}){let s=t.$container;s.addClass(P.ajax_loading.name());let r=s.position();t.$loader().css({top:r.top,left:r.left,width:s.width(),height:s.height()}),c.ajax({url:e,cache:!1,complete:function(){s.removeClass(P.ajax_loading.name())},success:function(t){s.html(t),o()},error:function(t,e,o){alert(p.s("Terribly sorry, but the request failed. ")+e+", "+o)},data:i,dataType:"html",type:"POST"})}t.init=o}(At||(At={})),function(t){let e=null,o=!1;class i{constructor(t,o,i){this.start=t,this.end=o,this.lastPercent=-1,this.progressChunkEl=i,this.progressBarEl=i.querySelector(P.V2.DemoPitch.progress_bar.css()),this.progressBarSpanEl=this.progressBarEl.querySelector("span"),i.addEventListener("click",(function(){null!=e&&(e.currentTime=t)}))}getPercent(t){return t<=this.start?0:t>=this.end?100:Math.round(100*(t-this.start)/(this.end-this.start))}updateTime(t){let e=this.getPercent(t);e!=this.lastPercent&&(this.progressBarSpanEl.style.width=e+"%",this.lastPercent=e),this.setActiveClass(t)}setActiveClass(t){t>=this.start&&t<=this.end?this.progressChunkEl.classList.add(P.V2.DemoPitch.active.name()):this.progressChunkEl.classList.remove(P.V2.DemoPitch.active.name())}}function s(t,e=0){function i(t){let e=0,o=t;if(o.offsetParent)do{e+=o.offsetTop,o=o.offsetParent}while(o);return e}function s(){o||(r-e>pageYOffset+window.innerHeight||r+t.offsetHeight+e<pageYOffset?t.pause():t.play())}let r=i(t);window.addEventListener("resize",(function(){r=i(t),s()})),window.addEventListener("scroll",(function(){s()})),window.onload=function(){s()}}t.pauseAndDisable=function(){o=!0,e&&e.pause();let t=P.video.hero.el();t&&t.pause()},$(document).ready((function(){if(e=P.video.main.el(),null!=e){let t=P.V2.DemoPitch.video_progress_chunks.elements(),o=0,r=[new i(0,17,t.item(o++)),new i(17,31,t.item(o++)),new i(31,78,t.item(o++))];e.addEventListener("timeupdate",(function(t){let e=t.target.currentTime;for(let t of r)t.updateTime(e)})),s(e,200)}let t=P.video.hero.el();null!=t&&(t.addEventListener("ended",(function(t){let e=t.target;e.classList.add(P.V2.DemoPitch.video_no_shadow.name()),setTimeout((function(){e.classList.remove(P.V2.DemoPitch.video_no_shadow.name()),e.play()}),5e3)})),s(t))}))}(kt||(kt={})),function(t){const e=".CtrlV",o=P.MainUploadTarget;let i,s=!1;function r(t){let e=t.keyCode;y.isCommandOrCtrl(e)?(o.ctl_key.addClass(o.active_key),s=!0):s&&86==e&&o.v_key.addClass(o.active_key)}function n(t){let e=t.keyCode;y.isCommandOrCtrl(e)&&(s=!1,o.ctl_key.removeClass(o.active_key),o.v_key.removeClass(o.active_key))}t.afterPaste=function(t){t||(o.paste_buttons.addClass(o.wrong_shake),null!=i&&clearTimeout(i),i=setTimeout((()=>{o.paste_buttons.removeClass(o.wrong_shake)}),600))},t.initialize=function(){P.$window.on("keydown"+e,r).on("keyup"+e,n)},t.disable=function(){P.$window.off(e)}}(Mt||(Mt={})),function(t){let e=null;function o(){e=setTimeout(i,5e3),P.TopAnimationImage.$().fadeIn(1e3)}function i(){e=setTimeout(o,7e3),P.TopAnimationImage.$().fadeOut(1e3)}t.checkStart=function(){P.TopAnimationImage.$().length>0&&(e=setTimeout(i,2e3))},t.stop=function(){clearTimeout(e)}}(xt||(xt={})),Tt||(Tt={}),$(document).ready((()=>{const t=window.Globals.Hosted;if(t){let o=t.spec,i=[],s={};function e(t){let e=[];for(let t of o.images)s.hasOwnProperty(t.id)||e.push(t);let r={event:t.event,error:t.error,images:o.images,clipped:i,skipped:e},n=document.createElement("form"),a=document.createElement("input");a.name="clippingMagicJson",a.value=JSON.stringify(r),n.append(a),n.method="POST",n.target="_top",n.action=o.returnUrl,document.body.append(n),n.submit()}let r=ClippingMagic.initialize({apiId:t.apiId});if(r&&r.length>0)e({event:"error",error:{status:400,code:2e3,message:r.join("\n")}});else{let n=1==o.images.length,a=n?o.images[0]:void 0,l=n?void 0:o.images;ClippingMagic.edit({image:a,images:l,locale:o.locale,useStickySettings:t.spec.useStickySettings,hideBottomToolbar:t.spec.hideBottomToolbar},(t=>{switch(t.event){case"error":e(t);break;case"result-generated":let o=t.image;i.push(o),s[o.id]=!0,n&&e({event:"editor-exit"});break;case"editor-exit":e({event:"editor-exit"})}})),document.getElementById("clipping-magic-container").style.padding="0"}}}));for(let t of __jqdeferred)$(t);__jqdeferred.length=0,function(t){try{window.myLocalStorage=window.localStorage||{}}catch(t){window.myLocalStorage={}}window.M=lt,T.M=a.cast(lt),T.App=at,lt.appHasAlreadyRun=!1;var e=null;function i(){var t=!window.Globals.Bulk.isUpload||window.GlobalsEx.Bulk_isAllowed;if(null==e){if((e=yt.list()).length>0){for(var i="<h3>"+p.s("Unsupported Browser")+"</h3><p>"+p.s("Terribly sorry, but your browser appears to be missing key feature(s) required to use this website:")+"</p><ul>",s=0;s<e.length;s++)i+="<li>"+e[s]+"</li>";i+="</ul>",i+="<p>"+p.s("Please try the latest version of one of these browsers instead: <b>{0}, {1}, {2}, {3}</b>.",'<a href="'+D.BrowserChromeUrl+'">Chrome</a>','<a href="'+D.BrowserFirefoxUrl+'">Firefox</a>','<a href="'+D.BrowserSafariUrl+'">Safari</a>','<a href="'+D.BrowserMicrosoftEdgeUrl+'">Microsoft Edge</a>')+"</p>",$("#modernizr-alert").html(i).slideDown(500)}0==e.length&&t||(P.body.$().addClass(P.cannot_run_app.name()),P.app_starter.$().attr("disabled","disabled").addClass("disabled"),P.app_starter.anscestorOf(new o("button")).$().attr("disabled","disabled").addClass("disabled"))}else e.length>0&&($("html, body").scrollTop(0),R.blink("#modernizr-alert"));return 0==e.length&&t&&$("#app").length>0}function s(){kt.pauseAndDisable(),Mt.disable(),xt.stop()}function r(t,e,o){s(),lt.checkSaveChanges((()=>{let i=Date.now(),s=t.type.toLowerCase().split(";")[0];R.spinner(!0),n=!1,pt.loadImageShrinkAndThumbnail(!1,t,(e=>{R.gaTrack("image","loadFailed","Type: "+s+", Ext: "+R.getExtensionWithDot(t.name).toLowerCase()),R.fatalErrorStr(p.s('Failed to read image file with name: "{0}", and type: "{1}".',t.name,t.type))}),((t,r)=>{if(n)return;R.gaTrack("StartupProgress","readImage",void 0,Date.now()-i);let a=Date.now();R.gaTrack("image","uploaded",s),G.createUserImageSpec(t,r,R.fatalError,(i=>{n||(R.gaTrack("StartupProgress","reserveId",void 0,Date.now()-a),R.spinner(!1),lt.create(t,r,i,e,o))}))}),!0)}))}let n=!1;function l(){return n=!0,P.$window.off("beforeunload"),void 0!==window.ResumeImage?top.location.href.indexOf("/bulk")>=0?top.location.href="/bulk":top.location.href="/":top.location.reload(),!1}function c(t,e,o,s){if(!i())return;V.track("newImageFromUrl"),R.gaTrack("image","fromUrl",s||t),R.progress(!0);let n=Date.now(),l=null,c=!1,p=null;function u(){l&&p&&(R.gaTrack("StartupProgress","downloadedImageAndDrawCommandsFromUrl",void 0,Date.now()-n),R.progress(!1),r(l,p,c))}o?R.fetchJson(o,(t=>{p=t||{},u()})):(c=!0,p={}),rt.download({url:t,displayUrl:s,progress:R.progressUpdate,error:R.fatalErrorStr,success:t=>{e&&a.set(t,"name",e),l=t,u()}})}function u(t,e){i()&&(V.track("resumeUserImage"),s(),R.gaTrack("image","resumed"),R.progress(!0),G.readUserImageSpec(t,e,R.fatalError,(t=>{let e=Date.now();var o=null,i=null;function s(){o&&i&&(R.gaTrack("StartupProgress","downloadedImageAndDrawCommandsResume",void 0,Date.now()-e),R.progress(!1),lt.resume(o,t,i),P.UnpaidApiSubscription.$().modal())}t.hasDrawCommands>0?R.fetchJson(t.drawCommands.url,(t=>{i=t||{},s()})):i={},rt.download({url:t.image.url,progress:R.progressUpdate,error:R.fatalErrorStr,success:e=>{let i=R.blobToFile(e,t.originalFilename);pt.loadCheckRotateFlattenImage(i,R.fatalError,(t=>{o=t,s()}))}})})))}function h(t){window!=window.top&&window.parent&&window.parent.postMessage(JSON.stringify(t),window.Globals.targetOrigin)}$(document).ready((()=>{P.MainUploadTarget.jsNotInitializedYet.removeClass(P.MainUploadTarget.jsNotInitializedYet),P.FileInput.UploadFromWeb.show_dialog.$().attr("href","#");const t=i();xt.checkStart(),lt.setStickySettings(window.GlobalsEx.stickySettings,!1),lt.initializeMaxNumMegapixels(),P.cancel_upload.$().click(l),P.ImageThumbs.admin_show_original_button.$().click((()=>{$(document.body).toggleClass(P.ImageThumbs.admin_show_original.name())})),le.checkSupported(P.resultDialog.Ready),window.Globals.err?h(window.Globals.err):h({command:D.DocumentReady,canRun:t}),t&&(O.initialize(),b.initialize({monitor_file_input:P.FileInput.Field,monitor_paste:P.FileInput.PasteTarget,monitor_drag:P.body,hover_class:P.drop_ready,error:(t,e,o)=>{e!=b.InputMethod.Pasted&&alert(t)},drop:(t,e)=>{var o;window.Globals.Bulk.isUpload?mt.handleNewFiles(t):window.Globals.Bulk.isIframe||(o=t[0],V.track("pickedFile"),r(o,{},!0))},pastedUrl:function(t){c(z.fetchUrl(t),void 0,void 0,t)},dropOnce:!1,afterPaste:Mt.afterPaste}),N.initialize(),void 0!==window.ResumeImage&&u(window.ResumeImage.id,window.ResumeImage.secret),C.initialize(P.FileInput.UploadFromWeb.show_dialog,(function(t){c(z.fetchUrl(t),void 0,void 0,t),window.Globals.Bulk.isUpload})),P.FileInput.click_to_upload.$().click((function(){let t=P.FileInput.Field.el();t.value=null,t.click()})),Mt.initialize(),M.setFileReceiver((t=>{r(t,{},!0)}),!0)),it.attachDecorated(),bt.checkInit(),At.init(),ut.deviceHasTouch()||$('[data-toggle="tooltip"]').tooltip(),P.tabLink.$().click((function(t){t.preventDefault(),$("."+$(this).data("tab")).each((function(t,e){$(e).tab("show")}))})),P.returnUrlForm.$().on("submit",(function(t){let e=$(this),o=e.data("form-element"),i=$(o+" input").val();e.prop("action",i)}));let e=new Kt([new Zt(P.PricingPanel.period_monthly,D.PricingMonthly),new Zt(P.PricingPanel.period_annual,D.PricingAnnual)]);e.update(D.PricingMonthly),E.registerRadioGroup(e,(t=>{e.update(t);let o=t==D.PricingAnnual;P.PricingPanel.period_annual_container.$().toggle(o),P.PricingPanel.period_monthly_container.$().toggle(!o)}))})),$(window).on("load",(function(){wt.checkInit()}));let d=window;d.checkPostMessage=h,d.resumeUserImage=u,d.newImageFromUrl=c,d.M_initializeFarbtastic=lt.initializeFarbtastic,d.Tr_s=p.s,d.StickySettings_backgroundSwatch=gt.backgroundSwatch,d.BulkUpload_simulateEntry=mt.simulateEntry,d.BulkDownload_simulateProgress=St.simulateProgress,d.BulkDownload_simulateReady=St.simulateReady}(_t||(_t={}))}("undefined"==typeof MainExport?MainExport={}:MainExport);